(function(za,$i){typeof exports=="object"&&typeof module=="object"?module.exports=$i():typeof define=="function"&&define.amd?define([],$i):typeof exports=="object"?exports.videojs=$i():za.videojs=$i()})(this,()=>(()=>{var cl={14:(Te,Qe,Le)=>{"use strict";Le.d(Qe,{default:()=>qh});var Me=Le(50),ke=Le.n(Me);/*! @name videojs-contrib-quality-levels @version 2.2.1 @license Apache-2.0 */function _e(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.__proto__=e}function qe(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}var _t=function(e){var t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:function(){return t.enabled_()},set:function(r){t.enabled_(r)}}),t},Ue=function(o){_e(e,o);function e(){var i;i=o.call(this)||this;var r=qe(qe(i));return r.levels_=[],r.selectedIndex_=-1,Object.defineProperty(r,"selectedIndex",{get:function(){return r.selectedIndex_}}),Object.defineProperty(r,"length",{get:function(){return r.levels_.length}}),r||qe(i)}var t=e.prototype;return t.addQualityLevel=function(r){var s=this.getQualityLevelById(r.id);if(s)return s;var a=this.levels_.length;return s=new _t(r),""+a in this||Object.defineProperty(this,a,{get:function(){return this.levels_[a]}}),this.levels_.push(s),this.trigger({qualityLevel:s,type:"addqualitylevel"}),s},t.removeQualityLevel=function(r){for(var s=null,a=0,c=this.length;a<c;a++)if(this[a]===r){s=this.levels_.splice(a,1)[0],this.selectedIndex_===a?this.selectedIndex_=-1:this.selectedIndex_>a&&this.selectedIndex_--;break}return s&&this.trigger({qualityLevel:r,type:"removequalitylevel"}),s},t.getQualityLevelById=function(r){for(var s=0,a=this.length;s<a;s++){var c=this[s];if(c.id===r)return c}return null},t.dispose=function(){this.selectedIndex_=-1,this.levels_.length=0},e}(ke().EventTarget);Ue.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(var ut in Ue.prototype.allowedEvents_)Ue.prototype["on"+ut]=null;var We="2.2.1",Et=ke().registerPlugin||ke().plugin,gt=function(e,t){var i=e.qualityLevels,r=new Ue,s=function a(){r.dispose(),e.qualityLevels=i,e.off("dispose",a)};return e.on("dispose",s),e.qualityLevels=function(){return r},e.qualityLevels.VERSION=We,r},gi=function(e){return gt(this,ke().mergeOptions({},e))};Et("qualityLevels",gi),gi.VERSION=We;const Pe=null;var Z="1.1.6";function oe(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.__proto__=e}function Wt(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}var ze=ke().getComponent("MenuItem"),Ge=ke().getComponent("Component"),ge=function(o){oe(e,o);function e(i,r){return r.selectable=!0,r.multiSelectable=!1,o.call(this,i,r)||this}var t=e.prototype;return t.handleClick=function(){var r=this.options_;console.log("Changing quality to:",r.label),o.prototype.handleClick.call(this);for(var s=this.player().qualityLevels(),a=0;a<s.length;a++)r.index==s.length||r.index==a?s[a].enabled=!0:s[a].enabled=!1},t.update=function(){var r=this.player().qualityLevels().selectedIndex;this.selected(this.options_.index==r)},e}(ze);Ge.registerComponent("SourceMenuItem",ge);var Ye=ke().getComponent("MenuButton"),It=function(o){oe(e,o);function e(i,r){var s;s=o.call(this,i,r)||this,Ye.apply(Wt(s),arguments);var a=s.player().qualityLevels();if(r&&r.default){if(r.default=="low")for(var c=0;c<a.length;c++)a[c].enabled=c==0;else if(r.default="high")for(var c=0;c<a.length;c++)a[c].enabled=c==a.length-1}return s.player().qualityLevels().on(["change","addqualitylevel"],ke().bind(Wt(s),s.update)),s}var t=e.prototype;return t.createEl=function(){return ke().dom.createEl("div",{className:"vjs-http-source-selector vjs-menu-button vjs-menu-button-popup vjs-control vjs-button"})},t.buildCSSClass=function(){return Ye.prototype.buildCSSClass.call(this)+" vjs-icon-cog"},t.update=function(){return Ye.prototype.update.call(this)},t.createItems=function(){for(var r=[],s=this.player().qualityLevels(),a=[],c=0;c<s.length;c++){var f=s.length-(c+1),h=f===s.selectedIndex,v=""+f,y=f;s[f].height?(v=s[f].height+"p",y=parseInt(s[f].height,10)):s[f].bitrate&&(v=Math.floor(s[f].bitrate/1e3)+" kbps",y=parseInt(s[f].bitrate,10)),!(a.indexOf(v)>=0)&&(a.push(v),r.push(new ge(this.player_,{label:v,index:f,selected:h,sortVal:y})))}return s.length>1&&r.push(new ge(this.player_,{label:"Auto",index:s.length,selected:!1,sortVal:99999})),r.sort(function(_,b){return _.options_.sortVal<b.options_.sortVal?1:_.options_.sortVal>b.options_.sortVal?-1:0}),r},e}(Ye),li={},Ze=ke().registerPlugin||ke().plugin,Yt=function(e,t){if(e.addClass("vjs-http-source-selector"),console.log("videojs-http-source-selector initialized!"),console.log("player.techName_:"+e.techName_),e.techName_!="Html5")return!1;e.on(["loadedmetadata"],function(i){var r=e.qualityLevels();if(ke().log("loadmetadata event"),e.videojs_http_source_selector_initialized=="undefined"||e.videojs_http_source_selector_initialized==!0)console.log("player.videojs_http_source_selector_initialized == true");else{console.log("player.videojs_http_source_selector_initialized == false"),e.videojs_http_source_selector_initialized=!0;var s=e.controlBar,a=s.getChild("fullscreenToggle").el();s.el().insertBefore(s.addChild("SourceMenuButton").el(),a)}})},Hi=function(e){var t=this;this.ready(function(){Yt(t,ke().mergeOptions(li,e))}),ke().registerComponent("SourceMenuButton",It),ke().registerComponent("SourceMenuItem",ge)};Ze("httpSourceSelector",Hi),Hi.VERSION=Z;const ti=null,N=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},W=Number.isSafeInteger||function(o){return typeof o=="number"&&Math.abs(o)<=be},be=Number.MAX_SAFE_INTEGER||9007199254740991;let le=function(o){return o.NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError",o}({}),H=function(o){return o.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",o.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",o.KEY_SYSTEM_NO_SESSION="keySystemNoSession",o.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",o.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",o.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",o.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",o.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",o.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",o.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",o.MANIFEST_LOAD_ERROR="manifestLoadError",o.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",o.MANIFEST_PARSING_ERROR="manifestParsingError",o.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",o.LEVEL_EMPTY_ERROR="levelEmptyError",o.LEVEL_LOAD_ERROR="levelLoadError",o.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",o.LEVEL_PARSING_ERROR="levelParsingError",o.LEVEL_SWITCH_ERROR="levelSwitchError",o.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",o.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",o.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",o.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",o.FRAG_LOAD_ERROR="fragLoadError",o.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",o.FRAG_DECRYPT_ERROR="fragDecryptError",o.FRAG_PARSING_ERROR="fragParsingError",o.FRAG_GAP="fragGap",o.REMUX_ALLOC_ERROR="remuxAllocError",o.KEY_LOAD_ERROR="keyLoadError",o.KEY_LOAD_TIMEOUT="keyLoadTimeOut",o.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",o.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",o.BUFFER_APPEND_ERROR="bufferAppendError",o.BUFFER_APPENDING_ERROR="bufferAppendingError",o.BUFFER_STALLED_ERROR="bufferStalledError",o.BUFFER_FULL_ERROR="bufferFullError",o.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",o.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",o.ASSET_LIST_LOAD_ERROR="assetListLoadError",o.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",o.ASSET_LIST_PARSING_ERROR="assetListParsingError",o.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",o.INTERNAL_EXCEPTION="internalException",o.INTERNAL_ABORTED="aborted",o.ATTACH_MEDIA_ERROR="attachMediaError",o.UNKNOWN="unknown",o}({}),x=function(o){return o.MEDIA_ATTACHING="hlsMediaAttaching",o.MEDIA_ATTACHED="hlsMediaAttached",o.MEDIA_DETACHING="hlsMediaDetaching",o.MEDIA_DETACHED="hlsMediaDetached",o.MEDIA_ENDED="hlsMediaEnded",o.STALL_RESOLVED="hlsStallResolved",o.BUFFER_RESET="hlsBufferReset",o.BUFFER_CODECS="hlsBufferCodecs",o.BUFFER_CREATED="hlsBufferCreated",o.BUFFER_APPENDING="hlsBufferAppending",o.BUFFER_APPENDED="hlsBufferAppended",o.BUFFER_EOS="hlsBufferEos",o.BUFFERED_TO_END="hlsBufferedToEnd",o.BUFFER_FLUSHING="hlsBufferFlushing",o.BUFFER_FLUSHED="hlsBufferFlushed",o.MANIFEST_LOADING="hlsManifestLoading",o.MANIFEST_LOADED="hlsManifestLoaded",o.MANIFEST_PARSED="hlsManifestParsed",o.LEVEL_SWITCHING="hlsLevelSwitching",o.LEVEL_SWITCHED="hlsLevelSwitched",o.LEVEL_LOADING="hlsLevelLoading",o.LEVEL_LOADED="hlsLevelLoaded",o.LEVEL_UPDATED="hlsLevelUpdated",o.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",o.LEVELS_UPDATED="hlsLevelsUpdated",o.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",o.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",o.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",o.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",o.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",o.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",o.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",o.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",o.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",o.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",o.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",o.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",o.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",o.CUES_PARSED="hlsCuesParsed",o.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",o.INIT_PTS_FOUND="hlsInitPtsFound",o.FRAG_LOADING="hlsFragLoading",o.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",o.FRAG_LOADED="hlsFragLoaded",o.FRAG_DECRYPTED="hlsFragDecrypted",o.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",o.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",o.FRAG_PARSING_METADATA="hlsFragParsingMetadata",o.FRAG_PARSED="hlsFragParsed",o.FRAG_BUFFERED="hlsFragBuffered",o.FRAG_CHANGED="hlsFragChanged",o.FPS_DROP="hlsFpsDrop",o.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",o.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",o.ERROR="hlsError",o.DESTROYING="hlsDestroying",o.KEY_LOADING="hlsKeyLoading",o.KEY_LOADED="hlsKeyLoaded",o.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",o.BACK_BUFFER_REACHED="hlsBackBufferReached",o.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",o.ASSET_LIST_LOADING="hlsAssetListLoading",o.ASSET_LIST_LOADED="hlsAssetListLoaded",o.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",o.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",o.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",o.INTERSTITIAL_STARTED="hlsInterstitialStarted",o.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",o.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",o.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",o.INTERSTITIAL_ENDED="hlsInterstitialEnded",o.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",o.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",o.EVENT_CUE_ENTER="hlsEventCueEnter",o}({});var ye={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ue={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ke{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Je{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ke(e),this.fast_=new Ke(t),this.defaultTTFB_=r,this.ttfb_=new Ke(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new Ke(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Ke(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Ke(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Fe(o,e,t){return(e=Jt(e))in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}function me(){return me=Object.assign?Object.assign.bind():function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},me.apply(null,arguments)}function ct(o,e){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),t.push.apply(t,i)}return t}function ve(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ct(Object(t),!0).forEach(function(i){Fe(o,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):ct(Object(t)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(t,i))})}return o}function xt(o,e){if(typeof o!="object"||!o)return o;var t=o[Symbol.toPrimitive];if(t!==void 0){var i=t.call(o,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(o)}function Jt(o){var e=xt(o,"string");return typeof e=="symbol"?e:e+""}class mt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=pt,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const pt=function(){},Ai={trace:pt,debug:pt,log:pt,warn:pt,info:pt,error:pt};function Ot(){return me({},Ai)}function zt(o,e){const t=self.console[o];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${o}] >`):pt}function Si(o,e,t){return e[o]?e[o].bind(e):zt(o,t)}const ii=Ot();function ui(o,e,t){const i=Ot();if(typeof console=="object"&&o===!0||typeof o=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=Si(s,o,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.7`)}catch(s){return Ot()}r.forEach(s=>{ii[s]=Si(s,o)})}else me(ii,i);return i}const At=ii;function Zi(o=!0){return typeof self=="undefined"?void 0:(o||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Ms(o){return typeof self!="undefined"&&o===self.ManagedMediaSource}function mn(o,e){const t=Object.keys(o),i=Object.keys(e),r=t.length,s=i.length;return!r||!s||r===s&&!t.some(a=>i.indexOf(a)===-1)}function rt(o,e=!1){if(typeof TextDecoder!="undefined"){const h=new TextDecoder("utf-8").decode(o);if(e){const v=h.indexOf("\0");return v!==-1?h.substring(0,v):h}return h.replace(/\0/g,"")}const t=o.length;let i,r,s,a="",c=0;for(;c<t;){if(i=o[c++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:r=o[c++],a+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=o[c++],s=o[c++],a+=String.fromCharCode((i&15)<<12|(r&63)<<6|(s&63)<<0);break}}return a}const Mi={hexDump:function(o){let e="";for(let t=0;t<o.length;t++){let i=o[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function Or(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function et(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Gt={exports:{}},Fi;function Ni(){return Fi||(Fi=1,function(o,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(f,h,v){if(v=v||{},f=f.trim(),h=h.trim(),!h){if(!v.alwaysNormalize)return f;var y=c.parseURL(f);if(!y)throw new Error("Error trying to parse base URL.");return y.path=c.normalizePath(y.path),c.buildURLFromParts(y)}var _=c.parseURL(h);if(!_)throw new Error("Error trying to parse relative URL.");if(_.scheme)return v.alwaysNormalize?(_.path=c.normalizePath(_.path),c.buildURLFromParts(_)):h;var b=c.parseURL(f);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var S=r.exec(b.path);b.netLoc=S[1],b.path=S[2]}b.netLoc&&!b.path&&(b.path="/");var R={scheme:b.scheme,netLoc:_.netLoc,path:null,params:_.params,query:_.query,fragment:_.fragment};if(!_.netLoc&&(R.netLoc=b.netLoc,_.path[0]!=="/"))if(!_.path)R.path=b.path,_.params||(R.params=b.params,_.query||(R.query=b.query));else{var k=b.path,O=k.substring(0,k.lastIndexOf("/")+1)+_.path;R.path=c.normalizePath(O)}return R.path===null&&(R.path=v.alwaysNormalize?c.normalizePath(_.path):_.path),c.buildURLFromParts(R)},parseURL:function(f){var h=i.exec(f);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(s,"");f.length!==(f=f.replace(a,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};o.exports=c})()}(Gt)),Gt.exports}var Ee=Ni();class Yi{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Rt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class er{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Fr(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let r;i.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Rt.AUDIO]:null,[Rt.VIDEO]:null,[Rt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Yi),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ee.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Rt.AUDIO]=null,e[Rt.VIDEO]=null,e[Rt.AUDIOVIDEO]=null}}function Xt(o){return o.sn!=="initSegment"}class Mr extends er{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(N(e)&&N(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=N(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!N(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Xt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,s,a=!1){const{elementaryStreams:c}=this,f=c[e];if(!f){c[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:a};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,i),f.startDTS=Math.min(f.startDTS,r),f.endDTS=Math.max(f.endDTS,s)}}class mi extends er{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function vi(o,e){const t=Object.getPrototypeOf(o);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||vi(t,e)}}function Fr(o,e){const t=vi(o,e);t&&(t.enumerable=!0,Object.defineProperty(o,e,t))}const Nr=Math.pow(2,32)-1,Br=[].push,Zt={video:1,audio:2,id3:3,text:4};function Bt(o){return String.fromCharCode.apply(null,o)}function zi(o,e){const t=o[e]<<8|o[e+1];return t<0?65536+t:t}function tt(o,e){const t=Tt(o,e);return t<0?4294967296+t:t}function Fs(o,e){let t=tt(o,e);return t*=Math.pow(2,32),t+=tt(o,e+4),t}function Tt(o,e){return o[e]<<24|o[e+1]<<16|o[e+2]<<8|o[e+3]}function Gi(o){const e=o.byteLength;for(let t=0;t<e;){const i=tt(o,t);if(i>8&&o[t+4]===109&&o[t+5]===111&&o[t+6]===111&&o[t+7]===102)return!0;t=i>1?t+i:e}return!1}function ht(o,e){const t=[];if(!e.length)return t;const i=o.byteLength;for(let r=0;r<i;){const s=tt(o,r),a=Bt(o.subarray(r+4,r+8)),c=s>1?r+s:i;if(a===e[0])if(e.length===1)t.push(o.subarray(r+8,c));else{const f=ht(o.subarray(r+8,c),e.slice(1));f.length&&Br.apply(t,f)}r=c}return t}function Vi(o){const e=[],t=o[0];let i=8;const r=tt(o,i);i+=4;let s=0,a=0;t===0?(s=tt(o,i),a=tt(o,i+4),i+=8):(s=Fs(o,i),a=Fs(o,i+8),i+=16),i+=2;let c=o.length+a;const f=zi(o,i);i+=2;for(let h=0;h<f;h++){let v=i;const y=tt(o,v);v+=4;const _=y&2147483647;if((y&2147483648)>>>31===1)return At.warn("SIDX has hierarchical references (not supported)"),null;const S=tt(o,v);v+=4,e.push({referenceSize:_,subsegmentDuration:S,info:{duration:S/r,start:c,end:c+_-1}}),c+=_,v+=4,i=v}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:f,references:e}}function xi(o){const e=[],t=ht(o,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],a=ht(s,["tkhd"])[0];if(a){let c=a[0];const f=tt(a,c===0?12:20),h=ht(s,["mdia","mdhd"])[0];if(h){c=h[0];const v=tt(h,c===0?12:20),y=ht(s,["mdia","hdlr"])[0];if(y){const _=Bt(y.subarray(8,12)),b={soun:Rt.AUDIO,vide:Rt.VIDEO}[_],S=ht(s,["mdia","minf","stbl","stsd"])[0],R=br(S);b?(e[f]={timescale:v,type:b,stsd:R},e[b]=ve({timescale:v,id:f},R)):e[f]={timescale:v,type:_,stsd:R}}}}}return ht(o,["moov","mvex","trex"]).forEach(r=>{const s=tt(r,4),a=e[s];a&&(a.default={duration:tt(r,12),flags:tt(r,20)})}),e}function br(o){const e=o.subarray(8),t=e.subarray(8+78),i=Bt(e.subarray(4,8));let r=i,s;const a=i==="enca"||i==="encv";if(a){const h=ht(e,[i])[0].subarray(i==="enca"?28:78);ht(h,["sinf"]).forEach(y=>{const _=ht(y,["schm"])[0];if(_){const b=Bt(_.subarray(4,8));if(b==="cbcs"||b==="cenc"){const S=ht(y,["frma"])[0];S&&(r=Bt(S))}}})}const c=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const f=ht(t,["avcC"])[0];f&&f.length>3&&(r+="."+Sr(f[1])+Sr(f[2])+Sr(f[3]),s=Ur(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=ht(e,[i])[0],h=ht(f.subarray(28),["esds"])[0];if(h&&h.length>7){let v=4;if(h[v++]!==3)break;v=Bi(h,v),v+=2;const y=h[v++];if(y&128&&(v+=2),y&64&&(v+=h[v++]),h[v++]!==4)break;v=Bi(h,v);const _=h[v++];if(_===64)r+="."+Sr(_);else break;if(v+=12,h[v++]!==5)break;v=Bi(h,v);const b=h[v++];let S=(b&248)>>3;S===31&&(S+=1+((b&7)<<3)+((h[v]&224)>>5)),r+="."+S}break}case"hvc1":case"hev1":{const f=ht(t,["hvcC"])[0];if(f&&f.length>12){const h=f[1],v=["","A","B","C"][h>>6],y=h&31,_=tt(f,2),b=(h&32)>>5?"H":"L",S=f[12],R=f.subarray(6,12);r+="."+v+y,r+="."+vn(_).toString(16).toUpperCase(),r+="."+b+S;let k="";for(let O=R.length;O--;){const B=R[O];(B||k)&&(k="."+B.toString(16).toUpperCase()+k)}r+=k}s=Ur(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Ur(r,t)||r;break}case"vp09":{const f=ht(t,["vpcC"])[0];if(f&&f.length>6){const h=f[4],v=f[5],y=f[6]>>4&15;r+="."+yi(h)+"."+yi(v)+"."+yi(y)}break}case"av01":{const f=ht(t,["av1C"])[0];if(f&&f.length>2){const h=f[1]>>>5,v=f[1]&31,y=f[2]>>>7?"H":"M",_=(f[2]&64)>>6,b=(f[2]&32)>>5,S=h===2&&_?b?12:10:_?10:8,R=(f[2]&16)>>4,k=(f[2]&8)>>3,O=(f[2]&4)>>2,B=f[2]&3,F=1,V=1,z=1,re=0;r+="."+h+"."+yi(v)+y+"."+yi(S)+"."+R+"."+k+O+B+"."+yi(F)+"."+yi(V)+"."+yi(z)+"."+re,s=Ur("dav1",t)}break}}return{codec:r,encrypted:a,supplemental:s}}function Ur(o,e){const t=ht(e,["dvvC"]),i=t.length?t[0]:ht(e,["dvcC"])[0];if(i){const r=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return o+"."+yi(r)+"."+yi(s)}}function vn(o){let e=0;for(let t=0;t<32;t++)e|=(o>>t&1)<<31-t;return e>>>0}function Bi(o,e){const t=e+5;for(;o[e++]&128&&e<t;);return e}function Sr(o){return("0"+o.toString(16).toUpperCase()).slice(-2)}function yi(o){return(o<10?"0":"")+o}function cs(o,e){if(!o||!e)return o;const t=e.keyId;return t&&e.isCommonEncryption&&ht(o,["moov","trak"]).forEach(r=>{const a=ht(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=ht(a,["enca"]);const f=c.length>0;f||(c=ht(a,["encv"])),c.forEach(h=>{const v=f?h.subarray(28):h.subarray(78);ht(v,["sinf"]).forEach(_=>{const b=hs(_);if(b){const S=b.subarray(8,24);S.some(R=>R!==0)||(At.log(`[eme] Patching keyId in 'enc${f?"a":"v"}>sinf>>tenc' box: ${Mi.hexDump(S)} -> ${Mi.hexDump(t)}`),b.set(t,8))}})})}),o}function hs(o){const e=ht(o,["schm"])[0];if(e){const t=Bt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return ht(o,["schi","tenc"])[0]}return null}function yn(o,e,t){const i={},r=ht(o,["moof","traf"]);for(let s=0;s<r.length;s++){const a=r[s],c=ht(a,["tfhd"])[0],f=tt(c,4),h=e[f];if(!h)continue;const v=i[f]||(i[f]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type}),y=ht(a,["tfdt"])[0];if(y){const F=y[0];let V=tt(y,4);F===1&&(V===Nr?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(V*=Nr+1,V+=tt(y,8))),N(V)&&(!N(v.start)||V<v.start)&&(v.start=V)}const _=h.default,b=tt(c,0)|(_==null?void 0:_.flags);let S=(_==null?void 0:_.duration)||0;b&8&&(b&2?S=tt(c,12):S=tt(c,8));const R=ht(a,["trun"]);let k=v.start||0,O=0,B=S;for(let F=0;F<R.length;F++){const V=R[F],z=tt(V,4),re=v.sampleCount;v.sampleCount+=z;const Y=V[3]&1,J=V[3]&4,ee=V[2]&1,q=V[2]&2,pe=V[2]&4,Ie=V[2]&8;let Xe=8,Ve=z;for(Y&&(Xe+=4),J&&z&&(!(V[Xe+1]&1)&&v.keyFrameIndex===void 0&&(v.keyFrameIndex=re),Xe+=4,ee?(B=tt(V,Xe),Xe+=4):B=S,q&&(Xe+=4),Ie&&(Xe+=4),k+=B,O+=B,Ve--);Ve--;)ee?(B=tt(V,Xe),Xe+=4):B=S,q&&(Xe+=4),pe&&(V[Xe+1]&1||v.keyFrameIndex===void 0&&(v.keyFrameIndex=v.sampleCount-(Ve+1),v.keyFrameStart=k),Xe+=4),Ie&&(Xe+=4),k+=B,O+=B;!O&&S&&(O+=S*z)}v.duration+=O}if(!Object.keys(i).some(s=>i[s].duration)){let s=1/0,a=0;const c=ht(o,["sidx"]);for(let f=0;f<c.length;f++){const h=Vi(c[f]);if(h!=null&&h.references){s=Math.min(s,h.earliestPresentationTime/h.timescale);const v=h.references.reduce((y,_)=>y+_.info.duration||0,0);a=Math.max(a,v+h.earliestPresentationTime/h.timescale)}}a&&N(a)&&Object.keys(i).forEach(f=>{i[f].duration||(i[f].duration=a*i[f].timescale-i[f].start)})}return i}function xr(o){const e={valid:null,remainder:null},t=ht(o,["moof"]);if(t.length<2)return e.remainder=o,e;const i=t[t.length-1];return e.valid=o.slice(0,i.byteOffset-8),e.remainder=o.slice(i.byteOffset-8),e}function fi(o,e){const t=new Uint8Array(o.length+e.length);return t.set(o),t.set(e,o.length),t}function $r(o,e){const t=[],i=e.samples,r=e.timescale,s=e.id;let a=!1;return ht(i,["moof"]).map(f=>{const h=f.byteOffset-8;ht(f,["traf"]).map(y=>{const _=ht(y,["tfdt"]).map(b=>{const S=b[0];let R=tt(b,4);return S===1&&(R*=Math.pow(2,32),R+=tt(b,8)),R/r})[0];return _!==void 0&&(o=_),ht(y,["tfhd"]).map(b=>{const S=tt(b,4),R=tt(b,0)&16777215,k=(R&1)!==0,O=(R&2)!==0,B=(R&8)!==0;let F=0;const V=(R&16)!==0;let z=0;const re=(R&32)!==0;let Y=8;S===s&&(k&&(Y+=8),O&&(Y+=4),B&&(F=tt(b,Y),Y+=4),V&&(z=tt(b,Y),Y+=4),re&&(Y+=4),e.type==="video"&&(a=Hr(e.codec)),ht(y,["trun"]).map(J=>{const ee=J[0],q=tt(J,0)&16777215,pe=(q&1)!==0;let Ie=0;const Xe=(q&4)!==0,Ve=(q&256)!==0;let He=0;const Be=(q&512)!==0;let at=0;const Ce=(q&1024)!==0,lt=(q&2048)!==0;let ot=0;const Oe=tt(J,4);let Ae=8;pe&&(Ie=tt(J,Ae),Ae+=4),Xe&&(Ae+=4);let St=Ie+h;for(let Ct=0;Ct<Oe;Ct++){if(Ve?(He=tt(J,Ae),Ae+=4):He=F,Be?(at=tt(J,Ae),Ae+=4):at=z,Ce&&(Ae+=4),lt&&(ee===0?ot=tt(J,Ae):ot=Tt(J,Ae),Ae+=4),e.type===Rt.VIDEO){let Nt=0;for(;Nt<at;){const Pt=tt(i,St);if(St+=4,ds(a,i[St])){const oi=i.subarray(St,St+Pt);fs(oi,a?2:1,o+ot/r,t)}St+=Pt,Nt+=Pt+4}}o+=He/r}}))})})}),t}function Hr(o){if(!o)return!1;const e=o.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function ds(o,e){if(o){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function fs(o,e,t,i){const r=ps(o);let s=0;s+=e;let a=0,c=0,f=0;for(;s<r.length;){a=0;do{if(s>=r.length)break;f=r[s++],a+=f}while(f===255);c=0;do{if(s>=r.length)break;f=r[s++],c+=f}while(f===255);const h=r.length-s;let v=s;if(c<h)s+=c;else if(c>h){At.error(`Malformed SEI payload. ${c} is too small, only ${h} bytes left to parse.`);break}if(a===4){if(r[v++]===181){const _=zi(r,v);if(v+=2,_===49){const b=tt(r,v);if(v+=4,b===1195456820){const S=r[v++];if(S===3){const R=r[v++],k=31&R,O=64&R,B=O?2+k*3:0,F=new Uint8Array(B);if(O){F[0]=R;for(let V=1;V<B;V++)F[V]=r[v++]}i.push({type:S,payloadType:a,pts:t,bytes:F})}}}}}else if(a===5&&c>16){const y=[];for(let S=0;S<16;S++){const R=r[v++].toString(16);y.push(R.length==1?"0"+R:R),(S===3||S===5||S===7||S===9)&&y.push("-")}const _=c-16,b=new Uint8Array(_);for(let S=0;S<_;S++)b[S]=r[v++];i.push({payloadType:a,pts:t,uuid:y.join(""),userData:rt(b),userDataBytes:b})}}}function ps(o){const e=o.byteLength,t=[];let i=1;for(;i<e-2;)o[i]===0&&o[i+1]===0&&o[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return o;const r=e-t.length,s=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===t[0]&&(a++,t.shift()),s[i]=o[a];return s}function _n(o){const e=o[0];let t="",i="",r=0,s=0,a=0,c=0,f=0,h=0;if(e===0){for(;Bt(o.subarray(h,h+1))!=="\0";)t+=Bt(o.subarray(h,h+1)),h+=1;for(t+=Bt(o.subarray(h,h+1)),h+=1;Bt(o.subarray(h,h+1))!=="\0";)i+=Bt(o.subarray(h,h+1)),h+=1;i+=Bt(o.subarray(h,h+1)),h+=1,r=tt(o,12),s=tt(o,16),c=tt(o,20),f=tt(o,24),h=28}else if(e===1){h+=4,r=tt(o,h),h+=4;const y=tt(o,h);h+=4;const _=tt(o,h);for(h+=4,a=4294967296*y+_,W(a)||(a=Number.MAX_SAFE_INTEGER,At.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=tt(o,h),h+=4,f=tt(o,h),h+=4;Bt(o.subarray(h,h+1))!=="\0";)t+=Bt(o.subarray(h,h+1)),h+=1;for(t+=Bt(o.subarray(h,h+1)),h+=1;Bt(o.subarray(h,h+1))!=="\0";)i+=Bt(o.subarray(h,h+1)),h+=1;i+=Bt(o.subarray(h,h+1)),h+=1}const v=o.subarray(h,o.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:a,presentationTimeDelta:s,eventDuration:c,id:f,payload:v}}function Gr(o,...e){const t=e.length;let i=8,r=t;for(;r--;)i+=e[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(o,4),r=0,i=8;r<t;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function tr(o,e,t){if(o.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),Gr([112,115,115,104],new Uint8Array([i,0,0,0]),o,s,r,a,t||new Uint8Array)}const Ns=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ir={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function gs(o,e){const t=ir[e];return!!t&&!!t[o.slice(0,4)]}function Vr(o,e,t=!0){return!o.split(",").some(i=>!ms(i,e,t))}function ms(o,e,t=!0){var i;const r=Zi(t);return(i=r==null?void 0:r.isTypeSupported(hr(o,e)))!=null?i:!1}function hr(o,e){return`${e}/mp4;codecs=${o}`}function vs(o){if(o){const e=o.substring(0,4);return ir.video[e]}return 2}function dr(o){const e=Ns();return o.split(",").reduce((t,i)=>{const s=e&&Hr(i)?9:ir.video[i];return s?(s*2+t)/(t?3:2):(ir.audio[i]+t)/(t?2:1)},0)}const jr={};function Tn(o,e=!0){if(jr[o])return jr[o];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[o];for(let r=0;r<t.length;r++){var i;if(ms(t[r],"audio",e))return jr[o]=t[r],t[r];if(t[r]==="mp3"&&(i=Zi(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return o}const En=/flac|opus|mp4a\.40\.34/i;function Li(o,e=!0){return o.replace(En,t=>Tn(t.toLowerCase(),e))}function bn(o,e){const t=[];if(o){const i=o.split(",");for(let r=0;r<i.length;r++)gs(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function ci(o,e){if(o&&(o.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(o)!==-1)&&(Bs(o,"audio")||Bs(o,"video")))return o;if(e){const t=e.split(",");if(t.length>1){if(o){for(let i=t.length;i--;)if(t[i].substring(0,4)===o.substring(0,4))return t[i]}return t[0]}}return e||o}function Bs(o,e){return gs(o,e)&&ms(o,e)}function ys(o){const e=o.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Kr(o){if(o.startsWith("av01.")){const e=o.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return o}function qr(o){const e=Zi(o)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Us(o){return o.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const $s={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function _i(o,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:o}}function hi(o,e,t,i,r,s){const a=o.videoCodec,c=o.audioCodec?o.audioGroups:null,f=s==null?void 0:s.audioCodec,h=s==null?void 0:s.channels,v=h?parseInt(h):f?1/0:2;let y=null;if(c!=null&&c.length)try{c.length===1&&c[0]?y=e.groups[c[0]].channels:y=c.reduce((_,b)=>{if(b){const S=e.groups[b];if(!S)throw new Error(`Audio track group ${b} not found`);Object.keys(S.channels).forEach(R=>{_[R]=(_[R]||0)+S.channels[R]})}return _},{2:0})}catch(_){return!0}return a!==void 0&&(a.split(",").some(_=>Hr(_))||o.width>1920&&o.height>1088||o.height>1920&&o.width>1088||o.frameRate>Math.max(i,30)||o.videoRange!=="SDR"&&o.videoRange!==t||o.bitrate>Math.max(r,8e6))||!!y&&N(v)&&Object.keys(y).some(_=>parseInt(_)>v)}function Ii(o,e,t,i={}){const r=o.videoCodec;if(!r&&!o.audioCodec||!t)return Promise.resolve($s);const s=[],a=_s(o),c=a.length,f=Sn(o,e,c>0),h=f.length;for(let v=c||1*h||1;v--;){const y={type:"media-source"};if(c&&(y.video=a[v%c]),h){y.audio=f[v%h];const _=y.audio.bitrate;y.video&&_&&(y.video.bitrate-=_)}s.push(y)}if(r){const v=navigator.userAgent;if(r.split(",").some(y=>Hr(y))&&Ns())return Promise.resolve(_i(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${v})`),s))}return Promise.all(s.map(v=>{const y=Lt(v);return i[y]||(i[y]=t.decodingInfo(v))})).then(v=>({supported:!v.some(y=>!y.supported),configurations:s,decodingInfoResults:v})).catch(v=>({supported:!1,configurations:s,decodingInfoResults:[],error:v}))}function _s(o){var e;const t=(e=o.videoCodec)==null?void 0:e.split(","),i=ki(o),r=o.width||640,s=o.height||480,a=o.frameRate||30,c=o.videoRange.toLowerCase();return t?t.map(f=>{const h={contentType:hr(Kr(f),"video"),width:r,height:s,bitrate:i,framerate:a};return c!=="sdr"&&(h.transferFunction=c),h}):[]}function Sn(o,e,t){var i;const r=(i=o.audioCodec)==null?void 0:i.split(","),s=ki(o);return r&&o.audioGroups?o.audioGroups.reduce((a,c)=>{var f;const h=c?(f=e.groups[c])==null?void 0:f.tracks:null;return h?h.reduce((v,y)=>{if(y.groupId===c){const _=parseFloat(y.channels||"");r.forEach(b=>{const S={contentType:hr(b,"audio"),bitrate:t?na(b,s):s};_&&(S.channels=""+_),v.push(S)})}return v},a):a},[]):[]}function na(o,e){if(e<=1)return 1;let t=128e3;return o==="ec-3"?t=768e3:o==="ac-3"&&(t=64e4),Math.min(e/2,t)}function ki(o){return Math.ceil(Math.max(o.bitrate*.9,o.averageBitrate)/1e3)*1e3||1}function Lt(o){let e="";const{audio:t,video:i}=o;if(i){const r=Us(i.contentType);e+=`${r}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const r=Us(t.contentType);e+=`${i?"_":""}${r}_c${t.channels}`}return e}const Ui=["NONE","TYPE-0","TYPE-1",null];function xn(o){return Ui.indexOf(o)>-1}const ei=["SDR","PQ","HLG"];function Wr(o){return!!o&&ei.indexOf(o)>-1}var fr={No:"",Yes:"YES",v2:"v2"};function ji(o){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=o,r=i<e/2;return e&&r?t?fr.v2:fr.Yes:fr.No}class An{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class pr{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Yr(this._audioGroups,e)}hasSubtitleGroup(e){return Yr(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Yr(o,e){return!e||!o?!1:o.indexOf(e)!==-1}function Ln(){if(typeof matchMedia=="function"){const o=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(o.media!==e.media)return o.matches===!0}return!1}function Hs(o,e){let t=!1,i=[];if(o&&(t=o!=="SDR",i=[o]),e){i=e.allowedVideoRanges||ei.slice(0);const r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&Ln(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const Gs=o=>{const e=new WeakSet;return(t,i)=>{if(o&&(i=o(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},kt=(o,e)=>JSON.stringify(o,Gs(e));function aa(o,e,t,i,r){const s=Object.keys(o),a=i==null?void 0:i.channels,c=i==null?void 0:i.audioCodec,f=r==null?void 0:r.videoCodec,h=a&&parseInt(a)===2;let v=!1,y=!1,_=1/0,b=1/0,S=1/0,R=1/0,k=0,O=[];const{preferHDR:B,allowedVideoRanges:F}=Hs(e,r);for(let J=s.length;J--;){const ee=o[s[J]];v||(v=ee.channels[2]>0),_=Math.min(_,ee.minHeight),b=Math.min(b,ee.minFramerate),S=Math.min(S,ee.minBitrate),F.filter(pe=>ee.videoRanges[pe]>0).length>0&&(y=!0)}_=N(_)?_:0,b=N(b)?b:0;const V=Math.max(1080,_),z=Math.max(30,b);S=N(S)?S:t,t=Math.max(S,t),y||(e=void 0);const re=s.length>1;return{codecSet:s.reduce((J,ee)=>{const q=o[ee];if(ee===J)return J;if(O=y?F.filter(pe=>q.videoRanges[pe]>0):[],re){if(q.minBitrate>t)return Ri(ee,`min bitrate of ${q.minBitrate} > current estimate of ${t}`),J;if(!q.hasDefaultAudio)return Ri(ee,"no renditions with default or auto-select sound found"),J;if(c&&ee.indexOf(c.substring(0,4))%5!==0)return Ri(ee,`audio codec preference "${c}" not found`),J;if(a&&!h){if(!q.channels[a])return Ri(ee,`no renditions with ${a} channel sound found (channels options: ${Object.keys(q.channels)})`),J}else if((!c||h)&&v&&q.channels[2]===0)return Ri(ee,"no renditions with stereo sound found"),J;if(q.minHeight>V)return Ri(ee,`min resolution of ${q.minHeight} > maximum of ${V}`),J;if(q.minFramerate>z)return Ri(ee,`min framerate of ${q.minFramerate} > maximum of ${z}`),J;if(!O.some(pe=>q.videoRanges[pe]>0))return Ri(ee,`no variants with VIDEO-RANGE of ${kt(O)} found`),J;if(f&&ee.indexOf(f.substring(0,4))%5!==0)return Ri(ee,`video codec preference "${f}" not found`),J;if(q.maxScore<k)return Ri(ee,`max score of ${q.maxScore} < selected max of ${k}`),J}return J&&(dr(ee)>=dr(J)||q.fragmentError>o[J].fragmentError)?J:(R=q.minIndex,k=q.maxScore,ee)},void 0),videoRanges:O,preferHDR:B,minFramerate:b,minBitrate:S,minIndex:R}}function Ri(o,e){At.log(`[abr] start candidates with "${o}" ignored because ${e}`)}function In(o){return o.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Ar(o,e,t,i){return o.slice(t,i+1).reduce((r,s,a)=>{if(!s.codecSet)return r;const c=s.audioGroups;let f=r[s.codecSet];f||(r[s.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,s.bitrate);const h=Math.min(s.height,s.width);return f.minHeight=Math.min(f.minHeight,h),f.minFramerate=Math.min(f.minFramerate,s.frameRate),f.minIndex=Math.min(f.minIndex,a),f.maxScore=Math.max(f.maxScore,s.score),f.fragmentError+=s.fragmentError,f.videoRanges[s.videoRange]=(f.videoRanges[s.videoRange]||0)+1,c&&c.forEach(v=>{if(!v)return;const y=e.groups[v];y&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?y.hasDefault:y.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(y.channels).forEach(_=>{f.channels[_]=(f.channels[_]||0)+y.channels[_]}))}),r},{})}function zr(o){if(!o)return o;const{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}=o;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}}function wt(o,e,t){if("attrs"in o){const i=e.indexOf(o);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(wi(o,r,t))return i}return-1}function wi(o,e,t){const{groupId:i,name:r,lang:s,assocLang:a,default:c}=o,f=o.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||Dt(s,e.lang))&&(s===void 0||e.assocLang===a)&&(c===void 0||e.default===c)&&(f===void 0||e.forced===f)&&(!("characteristics"in o)||oa(o.characteristics||"",e.characteristics))&&(t===void 0||t(o,e))}function Dt(o,e="--"){return o.length===e.length?o===e:o.startsWith(e)||e.startsWith(o)}function oa(o,e=""){const t=o.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function gr(o,e){const{audioCodec:t,channels:i}=o;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function la(o,e,t,i,r){const s=e[i],c=e.reduce((_,b,S)=>{const R=b.uri;return(_[R]||(_[R]=[])).push(S),_},{})[s.uri];c.length>1&&(i=Math.max.apply(Math,c));const f=s.videoRange,h=s.frameRate,v=s.codecSet.substring(0,4),y=Ts(e,i,_=>{if(_.videoRange!==f||_.frameRate!==h||_.codecSet.substring(0,4)!==v)return!1;const b=_.audioGroups,S=t.filter(R=>!b||b.indexOf(R.groupId)!==-1);return wt(o,S,r)>-1});return y>-1?y:Ts(e,i,_=>{const b=_.audioGroups,S=t.filter(R=>!b||b.indexOf(R.groupId)!==-1);return wt(o,S,r)>-1})}function Ts(o,e,t){for(let i=e;i>-1;i--)if(t(o[i]))return i;for(let i=e+1;i<o.length;i++)if(t(o[i]))return i;return-1}function ce(o,e){var t;return!!o&&o!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ua extends mt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:r,partCurrent:s,hls:a}=this,{autoLevelEnabled:c,media:f}=a;if(!r||!f)return;const h=performance.now(),v=s?s.stats:r.stats,y=s?s.duration:r.duration,_=h-v.loading.start,b=a.minAutoLevel,S=r.level,R=this._nextAutoLevel;if(v.aborted||v.loaded&&v.loaded===v.total||S<=b){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const k=R>-1&&R!==S,O=!!t||k;if(!O&&(f.paused||!f.playbackRate||!f.readyState))return;const B=a.mainForwardBufferInfo;if(!O&&B===null)return;const F=this.bwEstimator.getEstimateTTFB(),V=Math.abs(f.playbackRate);if(_<=Math.max(F,1e3*(y/(V*2))))return;const z=B?B.len/V:0,re=v.loading.first?v.loading.first-v.loading.start:-1,Y=v.loaded&&re>-1,J=this.getBwEstimate(),ee=a.levels,q=ee[S],pe=Math.max(v.loaded,Math.round(y*(r.bitrate||q.averageBitrate)/8));let Ie=Y?_-re:_;Ie<1&&Y&&(Ie=Math.min(_,v.loaded*8/J));const Xe=Y?v.loaded*1e3/Ie:0,Ve=F/1e3,He=Xe?(pe-v.loaded)/Xe:pe*8/J+Ve;if(He<=z)return;const Be=Xe?Xe*8:J,at=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,Ce=this.hls.config.abrBandWidthUpFactor;let lt=Number.POSITIVE_INFINITY,ot;for(ot=S-1;ot>b;ot--){const Ct=ee[ot].maxBitrate,Nt=!ee[ot].details||at;if(lt=this.getTimeToLoadFrag(Ve,Be,y*Ct,Nt),lt<Math.min(z,y+Ve))break}if(lt>=He||lt>y*10)return;Y?this.bwEstimator.sample(_-Math.min(F,re),v.loaded):this.bwEstimator.sampleTTFB(_);const Oe=ee[ot].maxBitrate;this.getBwEstimate()*Ce>Oe&&this.resetEstimator(Oe);const Ae=this.findBestLevel(Oe,b,ot,0,z,1,1);Ae>-1&&(ot=Ae),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${z.toFixed(3)} s
      Estimated load time for current fragment: ${He.toFixed(3)} s
      Estimated load time for down switch fragment: ${lt.toFixed(3)} s
      TTFB estimate: ${re|0} ms
      Current BW estimate: ${N(J)?J|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ot} @ ${Oe|0} bps`),a.nextLoadLevel=a.nextAutoLevel=ot,this.clearTimer();const St=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===ot&&ot>0){const Ct=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ot>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${Ct.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,ot>b){let Nt=this.findBestLevel(this.hls.levels[b].bitrate,b,ot,0,Ct,1,1);Nt===-1&&(Nt=b),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Nt,this.resetEstimator(this.hls.levels[Nt].bitrate)}}};k||He>lt*2?St():this.timer=self.setInterval(St,lt*1e3),a.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:v})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Je(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case H.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const a=performance.now(),c=s?s.stats:i.stats,f=a-c.loading.start,h=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&h>-1){const y=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(y,h),c.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,i,r){const s=e+i/t,a=r?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const i=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;N(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===ue.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=i?i.duration:t.duration,a=this.hls.levels[t.level],c=(a.loaded?a.loaded.bytes:0)+r.loaded,f=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:c,duration:f},a.realBitrate=Math.round(8*c/f)}if(t.bitrateTest){const s={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(x.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ue.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,t,e,0,r,1,1);if(s>-1)return s;const a=this.hls.firstLevel,c=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:a}=i,c=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),h=this.getStarvationDelay();let v=s.abrBandWidthFactor,y=s.abrBandWidthUpFactor;if(h){const k=this.findBestLevel(f,a,r,h,0,v,y);if(k>=0)return this.rebufferNotice=-1,k}let _=c?Math.min(c,s.maxStarvationDelay):s.maxStarvationDelay;if(!h){const k=this.bitrateTestDelay;k&&(_=(c?Math.min(c,s.maxLoadingDelay):s.maxLoadingDelay)-k,this.info(`bitrate test took ${Math.round(1e3*k)}ms, set first fragment max fetchDuration to ${Math.round(1e3*_)} ms`),v=y=1)}const b=this.findBestLevel(f,a,r,h,_,v,y);if(this.rebufferNotice!==b&&(this.rebufferNotice=b,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${b}`)),b>-1)return b;const S=i.levels[a],R=i.loadLevelObj;return R&&(S==null?void 0:S.bitrate)<R.bitrate?a:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,s,a,c){var f;const h=r+s,v=this.lastLoadedFragLevel,y=v===-1?this.hls.firstLevel:v,{fragCurrent:_,partCurrent:b}=this,{levels:S,allAudioTracks:R,loadLevel:k,config:O}=this.hls;if(S.length===1)return 0;const B=S[y],F=!!((f=this.hls.latestLevelDetails)!=null&&f.live),V=k===-1||v===-1;let z,re="SDR",Y=(B==null?void 0:B.frameRate)||0;const{audioPreference:J,videoPreference:ee}=O,q=this.audioTracksByGroup||(this.audioTracksByGroup=In(R));let pe=-1;if(V){if(this.firstSelection!==-1)return this.firstSelection;const at=this.codecTiers||(this.codecTiers=Ar(S,q,t,i)),Ce=aa(at,re,e,J,ee),{codecSet:lt,videoRanges:ot,minFramerate:Oe,minBitrate:Ae,minIndex:St,preferHDR:Ct}=Ce;pe=St,z=lt,re=Ct?ot[ot.length-1]:ot[0],Y=Oe,e=Math.max(e,Ae),this.log(`picked start tier ${kt(Ce)}`)}else z=B==null?void 0:B.codecSet,re=B==null?void 0:B.videoRange;const Ie=b?b.duration:_?_.duration:0,Xe=this.bwEstimator.getEstimateTTFB()/1e3,Ve=[];for(let at=i;at>=t;at--){var He,Be;const Ce=S[at],lt=at>y;if(!Ce)continue;if(O.useMediaCapabilities&&!Ce.supportedResult&&!Ce.supportedPromise){const Pt=navigator.mediaCapabilities;typeof(Pt==null?void 0:Pt.decodingInfo)=="function"&&hi(Ce,q,re,Y,e,J)?(Ce.supportedPromise=Ii(Ce,q,Pt,this.supportedCache),Ce.supportedPromise.then(oi=>{if(!this.hls)return;Ce.supportedResult=oi;const Qi=this.hls.levels,Pi=Qi.indexOf(Ce);oi.error?this.warn(`MediaCapabilities decodingInfo error: "${oi.error}" for level ${Pi} ${kt(oi)}`):oi.supported?oi.decodingInfoResults.some(Ji=>Ji.smooth===!1||Ji.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Pi} not smooth or powerEfficient: ${kt(oi)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Pi} ${kt(oi)}`),Pi>-1&&Qi.length>1&&(this.log(`Removing unsupported level ${Pi}`),this.hls.removeLevel(Pi),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):Ce.supportedResult=$s}if((z&&Ce.codecSet!==z||re&&Ce.videoRange!==re||lt&&Y>Ce.frameRate||!lt&&Y>0&&Y<Ce.frameRate||(He=Ce.supportedResult)!=null&&(Be=He.decodingInfoResults)!=null&&Be.some(Pt=>Pt.smooth===!1))&&(!V||at!==pe)){Ve.push(at);continue}const ot=Ce.details,Oe=(b?ot==null?void 0:ot.partTarget:ot==null?void 0:ot.averagetargetduration)||Ie;let Ae;lt?Ae=c*e:Ae=a*e;const St=Ie&&r>=Ie*2&&s===0?Ce.averageBitrate:Ce.maxBitrate,Ct=this.getTimeToLoadFrag(Xe,Ae,St*Oe,ot===void 0);if(Ae>=St&&(at===v||Ce.loadError===0&&Ce.fragmentError===0)&&(Ct<=Xe||!N(Ct)||F&&!this.bitrateTestDelay||Ct<h)){const Pt=this.forcedAutoLevel;return at!==k&&(Pt===-1||Pt!==k)&&(Ve.length&&this.trace(`Skipped level(s) ${Ve.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${S[Ve[0]].codecs}" ${S[Ve[0]].videoRange}; not compatible with "${z}" ${re}`),this.info(`switch candidate:${y}->${at} adjustedbw(${Math.round(Ae)})-bitrate=${Math.round(Ae-St)} ttfb:${Xe.toFixed(1)} avgDuration:${Oe.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${Ct.toFixed(1)} firstSelection:${V} codecSet:${Ce.codecSet} videoRange:${Ce.videoRange} hls.loadLevel:${k}`)),V&&(this.firstSelection=at),at}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const Vs={search:function(o,e){let t=0,i=o.length-1,r=null,s=null;for(;t<=i;){r=(t+i)/2|0,s=o[r];const a=e(s);if(a>0)t=r+1;else if(a<0)i=r-1;else return s}return null}};function Lr(o,e,t){if(e===null||!Array.isArray(o)||!o.length||!N(e))return null;const i=o[0].programDateTime;if(e<(i||0))return null;const r=o[o.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<o.length;++s){const a=o[s];if(Ir(e,t,a))return a}return null}function Ti(o,e,t=0,i=0,r=.005){let s=null;if(o){s=e[1+o.sn-e[0].sn]||null;const c=o.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),s&&o.level!==s.level&&s.end<=o.end&&(s=e[2+o.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!o||o.level===s.level)&&di(t,i,s)===0||js(s,o,Math.min(r,i))))return s;const a=Vs.search(e,di.bind(null,t,i));return a&&(a!==o||!s)?a:s}function js(o,e,t){if(e&&e.start===0&&e.level<o.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return o.start<=i}return!1}function di(o=0,e=0,t){if(t.start<=o&&t.start+t.duration>o)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=o?1:t.start-i>o&&t.start?-1:0}function Ir(o,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>o}function Cr(o,e,t){if(o&&o.startCC<=e&&o.endCC>=e){let i=o.fragments;const{fragmentHint:r}=o;r&&(i=i.concat(r));let s;return Vs.search(i,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function Ci(o){switch(o.details){case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_TIMEOUT:case H.LEVEL_LOAD_TIMEOUT:case H.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Es(o,e){const t=Ci(e);return o.default[`${t?"timeout":"error"}Retry`]}function Ks(o,e){const t=o.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*o.retryDelayMs,o.maxRetryDelayMs)}function Cn(o){return ve(ve({},o),{errorRetry:null,timeoutRetry:null})}function Xr(o,e,t,i){if(!o)return!1;const r=i==null?void 0:i.code,s=e<o.maxNumRetry&&(qs(r)||!!t);return o.shouldRetry?o.shouldRetry(o,e,t,i,s):s}function qs(o){return o===0&&navigator.onLine===!1||!!o&&(o<400||o>499)}var ft={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Kt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ca extends mt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.ERROR,this.onError,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.ERROR,this.onError,this),e.off(x.ERROR,this.onErrorOut,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ue.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case H.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=jt();return}case H.FRAG_GAP:case H.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ft.SendAlternateToPenaltyBox;return}case H.LEVEL_EMPTY_ERROR:case H.LEVEL_PARSING_ERROR:{var a,c;const h=t.parent===ue.MAIN?t.level:r.loadLevel;t.details===H.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(c=a.levelDetails)!=null&&c.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case H.LEVEL_LOAD_ERROR:case H.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case H.AUDIO_TRACK_LOAD_ERROR:case H.AUDIO_TRACK_LOAD_TIMEOUT:case H.SUBTITLE_LOAD_ERROR:case H.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const h=r.loadLevelObj;if(h&&(s.type===ye.AUDIO_TRACK&&h.hasAudioGroup(s.groupId)||s.type===ye.SUBTITLE_TRACK&&h.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=ft.SendAlternateToPenaltyBox,t.errorAction.flags=Kt.MoveAllAlternatesMatchingHost;return}}return;case H.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const h=r.loadLevelObj,v=h==null?void 0:h.attrs["HDCP-LEVEL"];v?t.errorAction={action:ft.SendAlternateToPenaltyBox,flags:Kt.MoveAllAlternatesMatchingHDCP,hdcpLevel:v}:this.keySystemError(t)}return;case H.BUFFER_ADD_CODEC_ERROR:case H.REMUX_ALLOC_ERROR:case H.BUFFER_APPEND_ERROR:if(!t.errorAction){var f;t.errorAction=this.getLevelSwitchAction(t,(f=t.level)!=null?f:r.loadLevel)}return;case H.INTERNAL_EXCEPTION:case H.BUFFER_APPENDING_ERROR:case H.BUFFER_FULL_ERROR:case H.LEVEL_SWITCH_ERROR:case H.BUFFER_STALLED_ERROR:case H.BUFFER_SEEK_OVER_HOLE:case H.BUFFER_NUDGE_ON_STALL:t.errorAction=jt();return}t.type===le.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,r=Es(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(Xr(r,s,Ci(e),e.response))return{action:ft.RetryRequest,flags:Kt.None,retryConfig:r,retryCount:s};const c=this.getLevelSwitchAction(e,t);return r&&(c.retryConfig=r,c.retryCount=s),c}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,c=Es(e.details.startsWith("key")?a:s,e),f=t.levels.reduce((v,y)=>v+y.fragmentError,0);if(r&&(e.details!==H.FRAG_GAP&&r.fragmentError++,Xr(c,f,Ci(e),e.response)))return{action:ft.RetryRequest,flags:Kt.None,retryConfig:c,retryCount:f};const h=this.getLevelSwitchAction(e,i);return c&&(h.retryConfig=c,h.retryCount=f),h}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const r=this.hls.levels[t];if(r){var s,a;const h=e.details;r.loadError++,h===H.BUFFER_APPEND_ERROR&&r.fragmentError++;let v=-1;const{levels:y,loadLevel:_,minAutoLevel:b,maxAutoLevel:S}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const R=(s=e.frag)==null?void 0:s.type,O=(R===ue.AUDIO&&h===H.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===H.BUFFER_ADD_CODEC_ERROR||h===H.BUFFER_APPEND_ERROR))&&y.some(({audioCodec:re})=>r.audioCodec!==re),F=e.sourceBufferName==="video"&&(h===H.BUFFER_ADD_CODEC_ERROR||h===H.BUFFER_APPEND_ERROR)&&y.some(({codecSet:re,audioCodec:Y})=>r.codecSet!==re&&r.audioCodec===Y),{type:V,groupId:z}=(a=e.context)!=null?a:{};for(let re=y.length;re--;){const Y=(re+_)%y.length;if(Y!==_&&Y>=b&&Y<=S&&y[Y].loadError===0){var c,f;const J=y[Y];if(h===H.FRAG_GAP&&R===ue.MAIN&&e.frag){const ee=y[Y].details;if(ee){const q=Ti(e.frag,ee.fragments,e.frag.start);if(q!=null&&q.gap)continue}}else{if(V===ye.AUDIO_TRACK&&J.hasAudioGroup(z)||V===ye.SUBTITLE_TRACK&&J.hasSubtitleGroup(z))continue;if(R===ue.AUDIO&&(c=r.audioGroups)!=null&&c.some(ee=>J.hasAudioGroup(ee))||R===ue.SUBTITLE&&(f=r.subtitleGroups)!=null&&f.some(ee=>J.hasSubtitleGroup(ee))||O&&r.audioCodec===J.audioCodec||!O&&r.audioCodec!==J.audioCodec||F&&r.codecSet===J.codecSet)continue}v=Y;break}}if(v>-1&&i.loadLevel!==v)return e.levelRetry=!0,this.playlistError=0,{action:ft.SendAlternateToPenaltyBox,flags:Kt.None,nextAutoLevel:v}}return{action:ft.SendAlternateToPenaltyBox,flags:Kt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case ft.DoNothing:break;case ft.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==H.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case ft.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r,hdcpLevel:s,nextAutoLevel:a}=i;switch(r){case Kt.None:this.switchLevel(e,a);break;case Kt.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=Ui[Ui.indexOf(s)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===H.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Us(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(s)}}}function jt(o){const e={action:ft.DoNothing,flags:Kt.None};return o&&(e.resolved=!0),e}var ri={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class bs{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;const a=s.end;if(s.start<=e&&a!==null&&e<=a)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:r}=this,s=Object.keys(r);for(let a=s.length;a--;){const c=r[s[a]];if((c==null?void 0:c.body.type)===t&&(!i||c.buffered)){const f=c.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,i,r,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(c=>{const f=this.fragments[c];if(!f||a>=f.body.sn)return;if(!f.buffered&&(!f.loaded||s)){f.body.type===i&&this.removeFragment(f.body);return}const h=f.range[e];if(h){if(h.time.length===0){this.removeFragment(f.body);return}h.time.some(v=>{const y=!this.isTimeBuffered(v.startPTS,v.endPTS,t);return y&&this.removeFragment(f.body),y})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,r=mr(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;const a=!i.relurl;Object.keys(t).forEach(c=>{const f=i.elementaryStreams[c];if(!f)return;const h=t[c],v=a||f.partial===!0;s.range[c]=this.getBufferedTimes(i,e.part,v,h)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=i.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),Qr(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=Ws(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){const i=mr(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){const s={time:[],partial:i},a=e.start,c=e.end,f=e.minEndPTS||c,h=e.maxStartPTS||a;for(let v=0;v<r.length;v++){const y=r.start(v)-this.bufferPadding,_=r.end(v)+this.bufferPadding;if(h>=y&&f<=_){s.time.push({startPTS:Math.max(a,r.start(v)),endPTS:Math.min(c,r.end(v))});break}else if(a<_&&c>y){const b=Math.max(a,r.start(v)),S=Math.min(c,r.end(v));S>b&&(s.partial=!0,s.time.push({startPTS:b,endPTS:S}))}else if(c<=y)break}return s}getPartialFragment(e){let t=null,i,r,s,a=0;const{bufferPadding:c,fragments:f}=this;return Object.keys(f).forEach(h=>{const v=f[h];v&&Qr(v)&&(r=v.body.start-c,s=v.body.end+c,e>=r&&e<=s&&(i=Math.min(e-r,s-e),a<=i&&(t=v.body,a=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Qr(t))}getState(e){const t=mr(e),i=this.fragments[t];return i?i.buffered?Qr(i)?ri.PARTIAL:ri.OK:ri.APPENDING:ri.NOT_LOADED}isTimeBuffered(e,t,i){let r,s;for(let a=0;a<i.length;a++){if(r=i.start(a)-this.bufferPadding,s=i.end(a)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,r=t.part?null:t,s=mr(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:s,type:a}=t;if(i.sn==="initSegment")return;const c=i.type;if(r){let h=this.activePartLists[c];h||(this.activePartLists[c]=h=[]),h.push(r)}this.timeRanges=s;const f=s[a];this.detectEvictedFragments(a,f,c,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=mr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){const s=t[i[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const c=this.fragments[a];if(!c)return;const f=c.body;f.type!==i||r&&!f.gap||f.start<t&&f.end>e&&(c.buffered||s)&&this.removeFragment(f)})}removeFragment(e){const t=mr(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=Ws(i,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const i=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(r=>r.clearElementaryStreamInfo())}}function Qr(o){var e,t,i;return o.buffered&&(o.body.gap||((e=o.range.video)==null?void 0:e.partial)||((t=o.range.audio)==null?void 0:t.partial)||((i=o.range.audiovideo)==null?void 0:i.partial))}function mr(o){return`${o.type}_${o.level}_${o.sn}`}function Ws(o,e){return o.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Ki={cbc:0,ctr:1};class kn{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Ki.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ki.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Rn(o){const e=o.byteLength,t=e&&new DataView(o.buffer).getUint8(e-1);return t?o.slice(0,e-t):o}class Jr{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],a=i[2],c=i[3],f=this.invSubMix,h=f[0],v=f[1],y=f[2],_=f[3],b=new Uint32Array(256);let S=0,R=0,k=0;for(k=0;k<256;k++)k<128?b[k]=k<<1:b[k]=k<<1^283;for(k=0;k<256;k++){let O=R^R<<1^R<<2^R<<3^R<<4;O=O>>>8^O&255^99,e[S]=O,t[O]=S;const B=b[S],F=b[B],V=b[F];let z=b[O]*257^O*16843008;r[S]=z<<24|z>>>8,s[S]=z<<16|z>>>16,a[S]=z<<8|z>>>24,c[S]=z,z=V*16843009^F*65537^B*257^S*16843008,h[O]=z<<24|z>>>8,v[O]=z<<16|z>>>16,y[O]=z<<8|z>>>24,_[O]=z,S?(S=B^b[b[b[V^B]]],R^=b[b[R]]):S=R=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let c,f;const h=this.keySchedule=new Uint32Array(a),v=this.invKeySchedule=new Uint32Array(a),y=this.sBox,_=this.rcon,b=this.invSubMix,S=b[0],R=b[1],k=b[2],O=b[3];let B,F;for(c=0;c<a;c++){if(c<s){B=h[c]=t[c];continue}F=B,c%s===0?(F=F<<8|F>>>24,F=y[F>>>24]<<24|y[F>>>16&255]<<16|y[F>>>8&255]<<8|y[F&255],F^=_[c/s|0]<<24):s>6&&c%s===4&&(F=y[F>>>24]<<24|y[F>>>16&255]<<16|y[F>>>8&255]<<8|y[F&255]),h[c]=B=(h[c-s]^F)>>>0}for(f=0;f<a;f++)c=a-f,f&3?F=h[c]:F=h[c-4],f<4||c<=4?v[f]=F:v[f]=S[y[F>>>24]]^R[y[F>>>16&255]]^k[y[F>>>8&255]]^O[y[F&255]],v[f]=v[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,c=this.invSubMix,f=c[0],h=c[1],v=c[2],y=c[3],_=this.uint8ArrayToUint32Array_(i);let b=_[0],S=_[1],R=_[2],k=_[3];const O=new Int32Array(e),B=new Int32Array(O.length);let F,V,z,re,Y,J,ee,q,pe,Ie,Xe,Ve,He,Be;const at=this.networkToHostOrderSwap;for(;t<O.length;){for(pe=at(O[t]),Ie=at(O[t+1]),Xe=at(O[t+2]),Ve=at(O[t+3]),Y=pe^s[0],J=Ve^s[1],ee=Xe^s[2],q=Ie^s[3],He=4,Be=1;Be<r;Be++)F=f[Y>>>24]^h[J>>16&255]^v[ee>>8&255]^y[q&255]^s[He],V=f[J>>>24]^h[ee>>16&255]^v[q>>8&255]^y[Y&255]^s[He+1],z=f[ee>>>24]^h[q>>16&255]^v[Y>>8&255]^y[J&255]^s[He+2],re=f[q>>>24]^h[Y>>16&255]^v[J>>8&255]^y[ee&255]^s[He+3],Y=F,J=V,ee=z,q=re,He=He+4;F=a[Y>>>24]<<24^a[J>>16&255]<<16^a[ee>>8&255]<<8^a[q&255]^s[He],V=a[J>>>24]<<24^a[ee>>16&255]<<16^a[q>>8&255]<<8^a[Y&255]^s[He+1],z=a[ee>>>24]<<24^a[q>>16&255]<<16^a[Y>>8&255]<<8^a[J&255]^s[He+2],re=a[q>>>24]<<24^a[Y>>16&255]<<16^a[J>>8&255]<<8^a[ee&255]^s[He+3],B[t]=at(F^b),B[t+1]=at(re^S),B[t+2]=at(z^R),B[t+3]=at(V^k),b=pe,S=Ie,R=Xe,k=Ve,t=t+4}return B.buffer}}class wn{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=Ys(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function Ys(o){switch(o){case Ki.cbc:return"AES-CBC";case Ki.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${o}`)}}const zs=16;class Ss{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(i){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Rn(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((s,a)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,i,r);const f=this.flush();f?s(f.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){const{currentIV:s,currentResult:a,remainderData:c}=this;if(r!==Ki.cbc||t.byteLength!==16)return At.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=fi(c,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;s&&(i=s);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new Jr),h.expandKey(t);const v=a;return this.currentResult=h.decrypt(f.buffer,0,i),this.currentIV=f.slice(-16).buffer,v||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new wn(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new kn(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(At.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%zs;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(At.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Zr=Math.pow(2,17);class es{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new Ut({type:le.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){f(xs(e));return}else e.gap=!1;const h=this.loader=s?new s(r):new a(r),v=vr(e);e.loader=h;const y=Cn(r.fragLoadPolicy.default),_={loadPolicy:y,timeout:y.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Zr};e.stats=h.stats;const b={onSuccess:(S,R,k,O)=>{this.resetLoader(e,h);let B=S.data;k.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(B.slice(0,16)),B=B.slice(16)),c({frag:e,part:null,payload:B,networkDetails:O})},onError:(S,R,k,O)=>{this.resetLoader(e,h),f(new Ut({type:le.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ve({url:i,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:k,stats:O}))},onAbort:(S,R,k)=>{this.resetLoader(e,h),f(new Ut({type:le.NETWORK_ERROR,details:H.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:k,stats:S}))},onTimeout:(S,R,k)=>{this.resetLoader(e,h),f(new Ut({type:le.NETWORK_ERROR,details:H.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${_.timeout}ms`),networkDetails:k,stats:S}))}};t&&(b.onProgress=(S,R,k,O)=>t({frag:e,part:null,payload:k,networkDetails:O})),h.load(v,_,b)})}loadPart(e,t,i){this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(xs(e,t));return}const h=this.loader=s?new s(r):new a(r),v=vr(e,t);e.loader=h;const y=Cn(r.fragLoadPolicy.default),_={loadPolicy:y,timeout:y.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Zr};t.stats=h.stats,h.load(v,_,{onSuccess:(b,S,R,k)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);const O={frag:e,part:t,payload:b.data,networkDetails:k};i(O),c(O)},onError:(b,S,R,k)=>{this.resetLoader(e,h),f(new Ut({type:le.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ve({url:v.url,data:void 0},b),error:new Error(`HTTP Error ${b.code} ${b.text}`),networkDetails:R,stats:k}))},onAbort:(b,S,R)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),f(new Ut({type:le.NETWORK_ERROR,details:H.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:R,stats:b}))},onTimeout:(b,S,R)=>{this.resetLoader(e,h),f(new Ut({type:le.NETWORK_ERROR,details:H.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${_.timeout}ms`),networkDetails:R,stats:b}))}})})}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){const f=Math.round(e.duration/t.duration),h=Math.min(Math.round(i.loaded/s),f),y=(f-h)*Math.round(i.loaded/h);i.total=i.loaded+y}else i.total=Math.max(i.loaded,i.total);const a=i.loading,c=r.loading;a.start?a.first+=c.first-c.start:(a.start=c.start,a.first=c.first),a.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function vr(o,e=null){const t=e||o,i={frag:o,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(N(r)&&N(s)){var a;let c=r,f=s;if(o.sn==="initSegment"&&Xs((a=o.decryptdata)==null?void 0:a.method)){const h=s-r;h%16&&(f=s+(16-h%16)),r!==0&&(i.resetIV=!0,c=r-16)}i.rangeStart=c,i.rangeEnd=f}return i}function xs(o,e){const t=new Error(`GAP ${o.gap?"tag":"attribute"} found`),i={type:le.MEDIA_ERROR,details:H.FRAG_GAP,fatal:!1,frag:o,error:t,networkDetails:null};return e&&(i.part=e),(e||o).stats.aborted=!0,new Ut(i)}function Xs(o){return o==="AES-128"||o==="AES-256"}class Ut extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class As extends mt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ts{constructor(e,t,i,r=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=is(),this.buffering={audio:is(),video:is(),audiovideo:is()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=a}}function is(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Dn={length:0,start:()=>0,end:()=>0};class st{static isBuffered(e,t){if(e){const i=st.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=st.getBuffered(e);return st.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const r=st.bufferedRanges(e);if(r.length)return st.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((v,y)=>v.start-y.start||y.end-v.end);let r=-1,s=[];if(i)for(let v=0;v<e.length;v++){t>=e[v].start&&t<=e[v].end&&(r=v);const y=s.length;if(y){const _=s[y-1].end;e[v].start-_<i?e[v].end>_&&(s[y-1].end=e[v].end):s.push(e[v])}else s.push(e[v])}else s=e;let a=0,c,f=t,h=t;for(let v=0;v<s.length;v++){const y=s[v].start,_=s[v].end;if(r===-1&&t>=y&&t<=_&&(r=v),t+i>=y&&t<_)f=y,h=_,a=h-t;else if(t+i<y){c=y;break}}return{len:a,start:f||0,end:h||0,nextStart:c,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Dn}catch(t){return At.log("failed to get media.buffered",t),Dn}}}const I=/\{\$([a-zA-Z0-9-_]+)\}/g;function T(o){return I.test(o)}function E(o,e){if(o.variableList!==null||o.hasVariableRefs){const t=o.variableList;return e.replace(I,i=>{const r=i.substring(2,i.length-1),s=t==null?void 0:t[r];return s===void 0?(o.playlistParsingError||(o.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function w(o,e,t){let i=o.variableList;i||(o.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(r))s=a.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(a){o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=e.NAME,s=e.VALUE;r in i?o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function D(o,e,t){const i=e.IMPORT;if(t&&i in t){let r=o.variableList;r||(o.variableList=r={}),r[i]=t[i]}else o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const P=/^(\d+)x(\d+)$/,C=/(.+?)=(".*?"|.*?)(?:,|$)/g;class U{constructor(e,t){typeof e=="string"&&(e=U.parseAttrList(e,t)),me(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=P.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const r={},s='"';for(C.lastIndex=0;(i=C.exec(e))!==null;){const a=i[1].trim();let c=i[2];const f=c.indexOf(s)===0&&c.lastIndexOf(s)===c.length-1;let h=!1;if(f)c=c.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(t&&(f||h))c=E(t,c);else if(!h&&!f)switch(a){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":At.warn(`${e}: attribute ${a} is missing quotes`)}r[a]=c}return r}}const j="com.apple.hls.interstitial";function X(o){return o!=="ID"&&o!=="CLASS"&&o!=="CUE"&&o!=="START-DATE"&&o!=="DURATION"&&o!=="END-DATE"&&o!=="END-ON-NEXT"}function se(o){return o==="SCTE35-OUT"||o==="SCTE35-IN"||o==="SCTE35-CMD"}class te{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:i,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){At.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=me(new U({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);N(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(At.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(N(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===j}get isValid(){return!!this.id&&!this._badValueForSameId&&N(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const de=10;class K{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?N(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||de}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ie(o){return o==="AES-128"||o==="AES-256"||o==="AES-256-CTR"}function Se(o){switch(o){case"AES-128":case"AES-256":return Ki.cbc;case"AES-256-CTR":return Ki.ctr;default:throw new Error(`invalid full segment method ${o}`)}}function xe(o){return Uint8Array.from(atob(o),e=>e.charCodeAt(0))}function it(o){return Uint8Array.from(unescape(encodeURIComponent(o)),e=>e.charCodeAt(0))}function qt(o){const e=it(o).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Mt(o){const e=function(i,r,s){const a=i[r];i[r]=i[s],i[s]=a};e(o,0,3),e(o,1,2),e(o,4,5),e(o,6,7)}function yt(o){const e=o.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const s=r[0]==="base64",a=r[1];s?(i.splice(-1,1),t=xe(a)):t=qt(a)}}return t}const we=typeof self!="undefined"?self:void 0;var he={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ae={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Re(o){switch(o){case ae.FAIRPLAY:return he.FAIRPLAY;case ae.PLAYREADY:return he.PLAYREADY;case ae.WIDEVINE:return he.WIDEVINE;case ae.CLEARKEY:return he.CLEARKEY}}function Ne(o){switch(o){case he.FAIRPLAY:return ae.FAIRPLAY;case he.PLAYREADY:return ae.PLAYREADY;case he.WIDEVINE:return ae.WIDEVINE;case he.CLEARKEY:return ae.CLEARKEY}}function nt(o){const{drmSystems:e,widevineLicenseUrl:t}=o,i=e?[he.FAIRPLAY,he.WIDEVINE,he.PLAYREADY,he.CLEARKEY].filter(r=>!!e[r]):[];return!i[he.WIDEVINE]&&t&&i.push(he.WIDEVINE),i}const dt=function(o){return we!=null&&(o=we.navigator)!=null&&o.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function $t(o,e,t,i){let r;switch(o){case he.FAIRPLAY:r=["cenc","sinf"];break;case he.WIDEVINE:case he.PLAYREADY:r=["cenc"];break;case he.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${o}`)}return Ht(r,e,t,i)}function Ht(o,e,t,i){return[{initDataTypes:o,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function vt(o){var e;return o.sessionType==="persistent-license"||!!((e=o.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function Vt(o){const e=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){const c=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(c){const f=xe(c).subarray(0,16);return Mt(f),f}}return null}let Qt={};class Xi{static clearKeyUriToKeyIdMap(){Qt={}}constructor(e,t,i,r=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ie(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(Or(a)))}matches(e){var t,i;return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&e.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((t=e.iv)==null?void 0:t.join(","))===((i=this.iv)==null?void 0:i.join(","))}isSupported(){if(this.method){if(ie(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ae.FAIRPLAY:case ae.WIDEVINE:case ae.PLAYREADY:case ae.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(ie(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(At.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=rs(e);return new Xi(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.pssh&&this.keyId)return this;const t=yt(this.uri);if(t)switch(this.keyFormat){case ae.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const i=t.length-22;this.keyId=t.subarray(i,i+16)}break;case ae.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=tr(i,null,t),this.keyId=Vt(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const r=new Uint8Array(16);r.set(i,16-i.length),i=r}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Qt[this.uri];if(!i){const r=Object.keys(Qt).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,r),Qt[this.uri]=i}this.keyId=i}return this}}function rs(o){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=o>>8*(15-t)&255;return e}const Ei=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,qi=/#EXT-X-MEDIA:(.*)/g,Qs=/^#EXT(?:INF|-X-TARGETDURATION):/m,ss=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),bi=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class si{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static resolve(e,t){return Ee.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Qs.test(e)}static parseMasterPlaylist(e,t){const i=T(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];Ei.lastIndex=0;let a;for(;(a=Ei.exec(e))!=null;)if(a[1]){var c;const h=new U(a[1],r),v=E(r,a[2]),y={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:si.resolve(v,t)},_=h.decimalResolution("RESOLUTION");_&&(y.width=_.width,y.height=_.height),Xa(h.CODECS,y);const b=h["SUPPLEMENTAL-CODECS"];b&&(y.supplemental={},Xa(b,y.supplemental)),(c=y.unknownCodecs)!=null&&c.length||s.push(y),r.levels.push(y)}else if(a[3]){const h=a[3],v=a[4];switch(h){case"SESSION-DATA":{const y=new U(v,r),_=y["DATA-ID"];_&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[_]=y);break}case"SESSION-KEY":{const y=Js(v,t,r);y.encrypted&&y.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(y)):At.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${v}"`);break}case"DEFINE":{{const y=new U(v,r);w(r,y,t)}break}case"CONTENT-STEERING":{const y=new U(v,r);r.contentSteering={uri:si.resolve(y["SERVER-URI"],t),pathwayId:y["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Ls(v);break}}}const f=s.length>0&&s.length<r.levels.length;return r.levels=f?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r;const s={},a=i.levels,c={AUDIO:a.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:a.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(qi.lastIndex=0;(r=qi.exec(e))!==null;){const h=new U(r[1],i),v=h.TYPE;if(v){const y=c[v],_=s[v]||[];s[v]=_;const b=h.LANGUAGE,S=h["ASSOC-LANGUAGE"],R=h.CHANNELS,k=h.CHARACTERISTICS,O=h["INSTREAM-ID"],B={attrs:h,bitrate:0,id:f++,groupId:h["GROUP-ID"]||"",name:h.NAME||b||"",type:v,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:b,url:h.URI?si.resolve(h.URI,t):""};if(S&&(B.assocLang=S),R&&(B.channels=R),k&&(B.characteristics=k),O&&(B.instreamId=O),y!=null&&y.length){const F=si.findGroup(y,B.groupId)||y[0];Qa(B,F,"audioCodec"),Qa(B,F,"textCodec")}_.push(B)}}return s}static parseLevelPlaylist(e,t,i,r,s,a){var c;const f={url:t},h=new K(t),v=h.fragments,y=[];let _=null,b=0,S=0,R=0,k=0,O=0,B=null,F=new Mr(r,f),V,z,re,Y=-1,J=!1,ee=null,q;if(ss.lastIndex=0,h.m3u8=e,h.hasVariableRefs=T(e),((c=ss.exec(e))==null?void 0:c[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(V=ss.exec(e))!==null;){J&&(J=!1,F=new Mr(r,f),F.playlistOffset=R,F.start=R,F.sn=b,F.cc=k,O&&(F.bitrate=O),F.level=i,_&&(F.initSegment=_,_.rawProgramDateTime&&(F.rawProgramDateTime=_.rawProgramDateTime,_.rawProgramDateTime=null),ee&&(F.setByteRange(ee),ee=null)));const Ve=V[1];if(Ve){F.duration=parseFloat(Ve);const He=(" "+V[2]).slice(1);F.title=He||null,F.tagList.push(He?["INF",Ve,He]:["INF",Ve])}else if(V[3]){if(N(F.duration)){F.playlistOffset=R,F.start=R,re&&Fn(F,re,h),F.sn=b,F.level=i,F.cc=k,v.push(F);const He=(" "+V[3]).slice(1);F.relurl=E(h,He),kr(F,B,y),B=F,R+=F.duration,b++,S=0,J=!0}}else{if(V=V[0].match(bi),!V){At.warn("No matches on slow regex match for level playlist!");continue}for(z=1;z<V.length&&V[z]===void 0;z++);const He=(" "+V[z]).slice(1),Be=(" "+V[z+1]).slice(1),at=V[z+2]?(" "+V[z+2]).slice(1):null;switch(He){case"BYTERANGE":B?F.setByteRange(Be,B):F.setByteRange(Be);break;case"PROGRAM-DATE-TIME":F.rawProgramDateTime=Be,F.tagList.push(["PROGRAM-DATE-TIME",Be]),Y===-1&&(Y=v.length);break;case"PLAYLIST-TYPE":h.type&&yr(h,He,V),h.type=Be.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?yr(h,He,V):v.length>0&&Nn(h,He,V),b=h.startSN=parseInt(Be);break;case"SKIP":{h.skippedSegments&&yr(h,He,V);const Ce=new U(Be,h),lt=Ce.decimalInteger("SKIPPED-SEGMENTS");if(N(lt)){h.skippedSegments+=lt;for(let Oe=lt;Oe--;)v.push(null);b+=lt}const ot=Ce.enumeratedString("RECENTLY-REMOVED-DATERANGES");ot&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(ot.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&yr(h,He,V),h.targetduration=Math.max(parseInt(Be),1);break;case"VERSION":h.version!==null&&yr(h,He,V),h.version=parseInt(Be);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||yr(h,He,V),h.live=!1;break;case"#":(Be||at)&&F.tagList.push(at?[Be,at]:[Be]);break;case"DISCONTINUITY":k++,F.tagList.push(["DIS"]);break;case"GAP":F.gap=!0,F.tagList.push([He]);break;case"BITRATE":F.tagList.push([He,Be]),O=parseInt(Be)*1e3,N(O)?F.bitrate=O:O=0;break;case"DATERANGE":{const Ce=new U(Be,h),lt=new te(Ce,h.dateRanges[Ce.ID],h.dateRangeTagCount);h.dateRangeTagCount++,lt.isValid||h.skippedSegments?h.dateRanges[lt.id]=lt:At.warn(`Ignoring invalid DATERANGE tag: "${Be}"`),F.tagList.push(["EXT-X-DATERANGE",Be]);break}case"DEFINE":{{const Ce=new U(Be,h);"IMPORT"in Ce?D(h,Ce,a):w(h,Ce,t)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?yr(h,He,V):v.length>0&&Nn(h,He,V),h.startCC=k=parseInt(Be);break;case"KEY":{const Ce=Js(Be,t,h);if(Ce.isSupported()){if(Ce.method==="NONE"){re=void 0;break}re||(re={});const lt=re[Ce.keyFormat];lt!=null&&lt.matches(Ce)||(lt&&(re=me({},re)),re[Ce.keyFormat]=Ce)}else At.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Be}"`);break}case"START":h.startTimeOffset=Ls(Be);break;case"MAP":{const Ce=new U(Be,h);if(F.duration){const lt=new Mr(r,f);Mn(lt,Ce,i,re),_=lt,F.initSegment=_,_.rawProgramDateTime&&!F.rawProgramDateTime&&(F.rawProgramDateTime=_.rawProgramDateTime)}else{const lt=F.byteRangeEndOffset;if(lt){const ot=F.byteRangeStartOffset;ee=`${lt-ot}@${ot}`}else ee=null;Mn(F,Ce,i,re),_=F,J=!0}_.cc=k;break}case"SERVER-CONTROL":{q&&yr(h,He,V),q=new U(Be),h.canBlockReload=q.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=q.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&q.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=q.optionalFloat("PART-HOLD-BACK",0),h.holdBack=q.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&yr(h,He,V);const Ce=new U(Be);h.partTarget=Ce.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Ce=h.partList;Ce||(Ce=h.partList=[]);const lt=S>0?Ce[Ce.length-1]:void 0,ot=S++,Oe=new U(Be,h),Ae=new mi(Oe,F,f,ot,lt);Ce.push(Ae),F.duration+=Ae.duration;break}case"PRELOAD-HINT":{const Ce=new U(Be,h);h.preloadHint=Ce;break}case"RENDITION-REPORT":{const Ce=new U(Be,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(Ce);break}default:At.warn(`line parsed but not handled: ${V}`);break}}}B&&!B.relurl?(v.pop(),R-=B.duration,h.partList&&(h.fragmentHint=B)):h.partList&&(kr(F,B,y),F.cc=k,h.fragmentHint=F,re&&Fn(F,re,h)),h.targetduration||(h.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const pe=v.length,Ie=v[0],Xe=v[pe-1];if(R+=h.skippedSegments*h.targetduration,R>0&&pe&&Xe){h.averagetargetduration=R/pe;const Ve=Xe.sn;h.endSN=Ve!=="initSegment"?Ve:0,h.live||(Xe.endList=!0),Ie&&h.startCC===void 0&&(h.startCC=Ie.cc),Y>0&&(Is(v,Y),Ie&&y.unshift(Ie))}else h.endSN=0,h.startCC=0;return h.fragmentHint&&(R+=h.fragmentHint.duration),h.totalduration=R,y.length&&h.dateRangeTagCount&&Ie&&Pn(y,h),h.endCC=k,h}}function Pn(o,e){const t=o.length;if(!t)return;const i=o[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){const c=e.dateRanges[s[a]],f=c.startDate.getTime();c.tagAnchor=i.ref;for(let h=t;h--;){const v=On(e,f,o,h,r);if(v!==-1){c.tagAnchor=e.fragments[v].ref;break}}}}function On(o,e,t,i,r){const s=t[i];if(s){const c=s.programDateTime;if(e>=c||i===0){var a;const f=(((a=t[i+1])==null?void 0:a.start)||r)-s.start;if(e<=c+f*1e3){const h=t[i].sn-o.startSN,v=o.fragments;if(v.length>t.length){const _=(t[i+1]||v[v.length-1]).sn-o.startSN;for(let b=_;b>h;b--){const S=v[b].programDateTime;if(e>=S&&e<S+v[b].duration*1e3)return b}}return h}}}return-1}function Js(o,e,t){var i,r;const s=new U(o,t),a=(i=s.METHOD)!=null?i:"",c=s.URI,f=s.hexadecimalInteger("IV"),h=s.KEYFORMATVERSIONS,v=(r=s.KEYFORMAT)!=null?r:"identity";c&&s.IV&&!f&&At.error(`Invalid IV: ${s.IV}`);const y=c?si.resolve(c,e):"",_=(h||"1").split("/").map(Number).filter(Number.isFinite);return new Xi(a,y,v,_,f,s.KEYID)}function Ls(o){const t=new U(o).decimalFloatingPoint("TIME-OFFSET");return N(t)?t:null}function Xa(o,e){let t=(o||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=t.filter(s=>gs(s,i));r.length&&(e[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function Qa(o,e,t){const i=e[t];i&&(o[t]=i)}function Is(o,e){let t=o[e];for(let i=e;i--;){const r=o[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function kr(o,e,t){o.rawProgramDateTime?t.push(o):e!=null&&e.programDateTime&&(o.programDateTime=e.endProgramDateTime)}function Mn(o,e,t,i){o.relurl=e.URI,e.BYTERANGE&&o.setByteRange(e.BYTERANGE),o.level=t,o.sn="initSegment",i&&(o.levelkeys=i),o.initSegment=null}function Fn(o,e,t){o.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(o)}function yr(o,e,t){o.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Nn(o,e,t){o.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function ha(o,e){const t=e.startPTS;if(N(t)){let i=0,r;e.sn>o.sn?(i=t-o.start,r=o):(i=o.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>o.sn?o.cc===e.cc&&o.minEndPTS?e.setStart(o.start+(o.minEndPTS-o.start)):e.setStart(o.start+o.duration):e.setStart(Math.max(o.start-e.duration,0))}function da(o,e,t,i,r,s){i-t<=0&&(At.warn("Fragment should have a positive duration",e),i=t+e.duration,s=r+e.duration);let c=t,f=i;const h=e.startPTS,v=e.endPTS;if(N(h)){const k=Math.abs(h-t);N(e.deltaPTS)?e.deltaPTS=Math.max(k,e.deltaPTS):e.deltaPTS=k,c=Math.max(t,h),t=Math.min(t,h),r=Math.min(r,e.startDTS),f=Math.min(i,v),i=Math.max(i,v),s=Math.max(s,e.endDTS)}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=c,e.startDTS=r,e.endPTS=i,e.minEndPTS=f,e.endDTS=s;const _=e.sn;if(!o||_<o.startSN||_>o.endSN)return 0;let b;const S=_-o.startSN,R=o.fragments;for(R[S]=e,b=S;b>0;b--)ha(R[b],R[b-1]);for(b=S;b<R.length-1;b++)ha(R[b],R[b+1]);return o.fragmentHint&&ha(R[R.length-1],o.fragmentHint),o.PTSKnown=o.alignedSliding=!0,y}function Bn(o,e){if(o===e)return;let t=null;const i=o.fragments;for(let h=i.length-1;h>=0;h--){const v=i[h].initSegment;if(v){t=v;break}}o.fragmentHint&&delete o.fragmentHint.endPTS;let r;Io(o,e,(h,v,y,_)=>{if((!e.startCC||e.skippedSegments)&&v.cc!==h.cc){const b=h.cc-v.cc;for(let S=y;S<_.length;S++)_[S].cc+=b;e.endCC=_[_.length-1].cc}N(h.startPTS)&&N(h.endPTS)&&(v.setStart(v.startPTS=h.startPTS),v.startDTS=h.startDTS,v.maxStartPTS=h.maxStartPTS,v.endPTS=h.endPTS,v.endDTS=h.endDTS,v.minEndPTS=h.minEndPTS,v.setDuration(h.endPTS-h.startPTS),v.duration&&(r=v),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(v.elementaryStreams=h.elementaryStreams),v.loader=h.loader,h.hasStats&&(v.stats=h.stats),h.initSegment&&(v.initSegment=h.initSegment,t=h.initSegment)});const s=e.fragments,a=e.fragmentHint?s.concat(e.fragmentHint):s;if(t&&a.forEach(h=>{var v;h&&(!h.initSegment||h.initSegment.relurl===((v=t)==null?void 0:v.relurl))&&(h.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=s.some(h=>!h),e.deltaUpdateFailed){At.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)s.shift();e.startSN=s[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=fa(o.dateRanges,e));const h=o.fragments.filter(v=>v.rawProgramDateTime);if(o.hasProgramDateTime&&!e.hasProgramDateTime)for(let v=1;v<a.length;v++)a[v].programDateTime===null&&kr(a[v],a[v-1],h);Pn(h,e)}e.endCC=s[s.length-1].cc}if(!e.startCC){var c;const h=ga(o,e.startSN-1);e.startCC=(c=h==null?void 0:h.cc)!=null?c:s[0].cc}pa(o.partList,e.partList,(h,v)=>{v.elementaryStreams=h.elementaryStreams,v.stats=h.stats}),r?da(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Un(o,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=o.driftStartTime,e.driftStart=o.driftStart;const f=e.advancedDateTime;if(e.advanced&&f){const h=e.edge;e.driftStart||(e.driftStartTime=f,e.driftStart=h),e.driftEndTime=f,e.driftEnd=h}else e.driftEndTime=o.driftEndTime,e.driftEnd=o.driftEnd,e.advancedDateTime=o.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=o.requestScheduled)}function fa(o,e){const{dateRanges:t,recentlyRemovedDateranges:i}=e,r=me({},o);i&&i.forEach(c=>{delete r[c]});const a=Object.keys(r).length;return a&&Object.keys(t).forEach(c=>{const f=r[c],h=new te(t[c].attr,f);h.isValid?(r[c]=h,f||(h.tagOrder+=a)):At.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${kt(t[c].attr)}"`)}),r}function pa(o,e,t){if(o&&e){let i=0;for(let r=0,s=o.length;r<=s;r++){const a=o[r],c=e[r+i];a&&c&&a.index===c.index&&a.fragment.sn===c.fragment.sn?t(a,c):i--}}}function Io(o,e,t){const i=e.skippedSegments,r=Math.max(o.startSN,e.startSN)-e.startSN,s=(o.fragmentHint?1:0)+(i?e.endSN:Math.min(o.endSN,e.endSN))-e.startSN,a=e.startSN-o.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments;for(let h=r;h<=s;h++){const v=f[a+h];let y=c[h];if(i&&!y&&v&&(y=e.fragments[h]=v),v&&y){if(t(v,y,h,c),v.url&&v.url!==y.url){e.playlistParsingError=Ja(`media sequence mismatch ${y.sn}:`,o,e,v,y);return}else if(v.cc!==y.cc){e.playlistParsingError=Ja(`discontinuity sequence mismatch (${v.cc}!=${y.cc})`,o,e,v,y);return}}}}function Ja(o,e,t,i,r){return new Error(`${o} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Un(o,e,t=!0){const i=e.startSN+e.skippedSegments-o.startSN,r=o.fragments,s=i>=0;let a=0;if(s&&i<r.length)a=r[i].start;else if(s&&e.startSN===o.endSN+1)a=o.fragmentEnd;else if(s&&t)a=o.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=o.fragmentStart;else return;$n(e,a)}function $n(o,e){if(e){const t=o.fragments;for(let i=o.skippedSegments;i<t.length;i++)t[i].addStart(e);o.fragmentHint&&o.fragmentHint.addStart(e)}}function Zs(o,e=1/0){let t=1e3*o.targetduration;if(o.updated){const i=o.fragments,r=4;if(i.length&&t*r>e){const s=i[i.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function ga(o,e,t){if(!o)return null;let i=o.fragments[e-o.startSN];return i||(i=o.fragmentHint,i&&i.sn===e)?i:e<o.startSN&&t&&t.sn===e?t:null}function Hn(o,e,t){return o?ma(o.partList,e,t):null}function ma(o,e,t){if(o)for(let i=o.length;i--;){const r=o[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function va(o){o.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Cs(o,e){for(let i=0,r=o.length;i<r;i++){var t;if(((t=o[i])==null?void 0:t.cc)===e)return o[i]}return null}function Co(o,e){return!!(o&&e.startCC<o.endCC&&e.endCC>o.startCC)}function Za(o,e){if(o){const t=o.start+e;o.start=o.startPTS=t,o.endPTS=t+o.duration}}function eo(o,e){const t=e.fragments;for(let i=0,r=t.length;i<r;i++)Za(t[i],o);e.fragmentHint&&Za(e.fragmentHint,o),e.alignedSliding=!0}function to(o,e){o&&(en(e,o),!e.alignedSliding&&o&&tn(e,o),!e.alignedSliding&&o&&!e.skippedSegments&&Un(o,e,!1))}function en(o,e){if(!Co(e,o))return;const t=Math.min(e.endCC,o.endCC),i=Cs(e.fragments,t),r=Cs(o.fragments,t);if(!i||!r)return;At.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=i.start-r.start;eo(s,o)}function tn(o,e){if(!o.hasProgramDateTime||!e.hasProgramDateTime)return;const t=o.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,s;const a=Math.min(e.endCC,o.endCC);e.startCC<a&&o.startCC<a&&(r=Cs(i,a),s=Cs(t,a)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=Cs(t,r.cc)||t[Math.floor(t.length/2)]);const c=r.programDateTime,f=s.programDateTime;if(!c||!f)return;const h=(f-c)/1e3-(s.start-r.start);eo(h,o)}const ko={toString:function(o){let e="";const t=o.length;for(let i=0;i<t;i++)e+=`[${o.start(i).toFixed(3)}-${o.end(i).toFixed(3)}]`;return e}},ne={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Gn extends As{constructor(e,t,i,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ne.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:c,media:f,mediaBuffer:h,state:v}=this,y=f?f.currentTime:0,_=st.bufferInfo(h||f,y,a.maxBufferHole),b=!_.len;if(this.log(`Media seeking to ${N(y)?y.toFixed(3):y}, state: ${v}, ${b?"out of":"in"} buffer`),this.state===ne.ENDED)this.resetLoadingState();else if(c){const S=a.maxFragLookUpTolerance,R=c.start-S,k=c.start+c.duration+S;if(b||k<_.start||R>_.end){const O=y>k;(y<R||O)&&(O&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(y,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(y>S&&(this.lastCurrentTime=y),!this.loadingParts){const R=Math.max(_.end,y),k=this.shouldLoadParts(this.getLevelDetails(),R);k&&(this.log(`LL-Part loading ON after seeking to ${y.toFixed(2)} with buffer @${R.toFixed(2)}`),this.loadingParts=k)}}this.hls.hasEnoughToStart||(this.log(`Setting ${b?"startPosition":"nextLoadPosition"} to ${y} for seek without enough to start`),this.nextLoadPosition=y,b&&(this.startPosition=y)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new es(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ss(e.config)}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ne.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ne.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=st.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>r&&a<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const v=f[f.length-1];return st.isBuffered(this.media,v.start+v.duration/2)}const h=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===ne.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ne.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const r=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,i,r).then(s=>{if(!s)return;const a=this.state,c=s.frag;if(this.fragContextChanged(c)){(a===ne.FRAG_LOADING||!this.fragCurrent&&a===ne.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=ne.IDLE);return}"payload"in s&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(x.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===ri.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),c=Math.max(e.duration,a?a.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===ri.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(x.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const r=i==null?void 0:i.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:s,payload:a}=i,c=s.decryptdata;if(a&&a.byteLength>0&&c!=null&&c.key&&c.iv&&ie(c.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),c.key.buffer,c.iv.buffer,Se(c.method)).catch(h=>{throw r.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:s}),h}).then(h=>{const v=self.performance.now();return r.trigger(x.FRAG_DECRYPTED,{frag:s,payload:h,stats:{tstart:f,tdecrypt:v}}),i.payload=h,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ne.STOPPED&&(this.state=ne.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?ko.toString(st.getBuffered(i)):"(detached)"})`),Xt(e)){var r;if(e.type!==ue.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(c=>!!a[c])){this.state=ne.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=ne.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:s}=e,a=!s||s.length===0||s.some(f=>!f),c=new ts(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!a);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;this.fragCurrent=e;const a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let c=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ne.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(x.KEY_LOADED,y),this.state===ne.KEY_LOADING&&(this.state=ne.IDLE),y}),this.hls.trigger(x.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(c=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(Xt(e)&&(!f||e.sn!==f.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${f==null?void 0:f.sn}->${e.sn}`),this.loadingParts=y)}if(i=Math.max(e.start,i||0),this.loadingParts&&Xt(e)){const y=a.partList;if(y&&r){i>e.end&&a.fragmentHint&&(e=a.fragmentHint);const _=this.getNextPart(y,e,i);if(_>-1){const b=y[_];e=this.fragCurrent=b.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${b.index} (${_}/${y.length-1}) of ${this.fragInfo(e,!1,b)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=b.start+b.duration,this.state=ne.FRAG_LOADING;let S;return c?S=c.then(R=>!R||this.fragContextChanged(R.frag)?null:this.doFragPartsLoad(e,b,t,r)).catch(R=>this.handleFragLoadError(R)):S=this.doFragPartsLoad(e,b,t,r).catch(R=>this.handleFragLoadError(R)),this.hls.trigger(x.FRAG_LOADING,{frag:e,part:b,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!e.url||this.loadedEndOfParts(y,i))return Promise.resolve(null)}}if(Xt(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),N(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ne.FRAG_LOADING;const h=this.config.progressive;let v;return h&&c?v=c.then(y=>!y||this.fragContextChanged(y==null?void 0:y.frag)?null:this.fragmentLoader.load(e,r)).catch(y=>this.handleFragLoadError(y)):v=Promise.all([this.fragmentLoader.load(e,h?r:void 0),c]).then(([y])=>(!h&&y&&r&&r(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(x.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):v}doFragPartsLoad(e,t,i,r){return new Promise((s,a)=>{var c;const f=[],h=(c=i.details)==null?void 0:c.partList,v=y=>{this.fragmentLoader.loadPart(e,y,r).then(_=>{f[y.index]=_;const b=_.part;this.hls.trigger(x.FRAG_LOADED,_);const S=Hn(i.details,e.sn,y.index+1)||ma(h,e.sn,y.index+1);if(S)v(S);else return s({frag:e,part:b,partsLoaded:f})}).catch(a)};v(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===H.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(x.ERROR,t)}else this.hls.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ne.PARSING){!this.fragCurrent&&this.state!==ne.STOPPED&&this.state!==ne.ERROR&&(this.state=ne.IDLE);return}const{frag:i,part:r,level:s}=t,a=self.performance.now();i.stats.parsing.end=a,r&&(r.stats.parsing.end=a);const c=this.getLevelDetails(),h=c&&i.sn>c.endSN||this.shouldLoadParts(c,i.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(i,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i;const s=e.partList[0],a=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=a){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:a}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const c=t[r],f=c.details,h=a>-1?Hn(f,s,a):null,v=h?h.fragment:ga(f,s,i);return v?(i&&i!==v&&(v.stats=i.stats),{frag:v,part:h,level:c}):null}bufferFragmentData(e,t,i,r,s){var a;if(!e||this.state!==ne.PARSING)return;const{data1:c,data2:f}=e;let h=c;if(c&&f&&(h=fi(c,f)),!((a=h)!=null&&a.length))return;const v=this.initPTS[t.cc],y=v?-v.baseTime/v.timescale:void 0,_={type:e.type,frag:t,part:i,chunkMeta:r,offset:y,parent:t.type,data:h};if(this.hls.trigger(x.BUFFER_APPENDING,_),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!st.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,r=st.bufferInfo(t,i,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),c=Math.max(Math.min(e.start-a,r.end-a),i+a);e.start-c>a&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var i;const r=this.getLoadPosition();if(!N(r))return null;const a=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,a)}getFwdBufferInfoAtPos(e,t,i,r){const s=st.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&(s.nextStart<=a.end||a.gap)){const c=Math.max(Math.min(s.nextStart,a.end)-t,r);return st.bufferInfo(e,t,c)}}return s}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),s=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return s>=r?(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=ue.MAIN){var i;const r=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:s}=this,a=i[0].start,c=s.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const y=s.initialLiveManifestSize;if(r<y)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${y})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var h;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const _=this.hls.startPosition,b=this.hls.liveSyncPosition,S=f?(_!==-1&&_>=a?_:b)||f.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${_} liveSyncPosition: ${b} frag.start: ${(h=f)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=a&&(f=i[0]);if(!f){const y=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,y,t)}let v=this.filterReplacedPrimary(f,t);if(!v&&f){const y=f.sn-t.startSN;v=this.filterReplacedPrimary(i[y+1]||null,t)}return this.mapToInitFragWhenRequired(v)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===ri.OK||i===ri.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&i.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(c!==null&&i.len+c.len>=s){const f=a.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(ya(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ya(this.hls.config)&&e.type!==ue.SUBTITLE){const i=this.hls.interstitialsManager,r=i==null?void 0:i.bufferingItem;if(r){const a=r.event;if(a){if(a.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=i==null?void 0:i.playerQueue;if(s)for(let a=s.length;a--;){const c=s[a].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,s=!1,a=!0;for(let c=0,f=e.length;c<f;c++){const h=e[c];if(a=a&&!h.independent,r>-1&&i<h.start)break;const v=h.loaded;v?r=-1:(s||h.independent||a)&&h.fragment===t&&(r=c),s=v}return r}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=Lr(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];i.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=Cr(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:a,endSN:c}=i;const{fragmentHint:f}=i,{maxFragLookUpTolerance:h}=r,v=i.partList,y=!!(this.loadingParts&&v!=null&&v.length&&f);y&&f&&!this.bitrateTest&&v[v.length-1].fragment.sn===f.sn&&(a=a.concat(f),c=f.sn);let _;if(e<t){var b;const R=e<this.lastCurrentTime||e>t-h||(b=this.media)!=null&&b.paused||!this.startFragRequested?0:h;_=Ti(s,a,e,R)}else _=a[a.length-1];if(_){const S=_.sn-i.startSN,R=this.fragmentTracker.getState(_);if((R===ri.OK||R===ri.PARTIAL&&_.gap)&&(s=_),s&&_.sn===s.sn&&(!y||v[0].fragment.sn>_.sn||!i.live&&!y)&&s&&_.level===s.level){const O=a[S+1];_.sn<c&&this.fragmentTracker.getState(O)!==ri.OK?_=O:_=null}}return _}alignPlaylists(e,t,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,c=e.alignedSliding&&N(s);if(a||!c&&!s){to(i,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),f}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const r=this.timelineOffset;if(i===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&N(a)?(i=t+a,a<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Xt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ne.FRAG_LOADING_WAITING_RETRY)&&(this.state=ne.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const S=this.getCurrentContext(t.chunkMeta);S&&(t.frag=S.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const s=t.details===H.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const a=t.errorAction,{action:c,flags:f,retryCount:h=0,retryConfig:v}=a||{},y=!!a&&!!v,_=y&&c===ft.RetryRequest,b=y&&!a.resolved&&f===Kt.MoveAllAlternatesMatchingHost;if(!_&&b&&Xt(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),a.resolved=!0;else if((_||b)&&h<v.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const S=Ks(v,h);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${h+1}/${v.maxNumRetry} in ${S}ms`),a.resolved=!0,this.retryDate=self.performance.now()+S,this.state=ne.FRAG_LOADING_WAITING_RETRY}else if(v&&a)if(this.resetFragmentErrors(e),h<v.maxNumRetry)!s&&c!==ft.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else c===ft.SendAlternateToPenaltyBox?this.state=ne.WAITING_LEVEL:this.state=ne.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ne.PARSING||this.state===ne.PARSED){const t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ue.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ne.STOPPED&&(this.state=ne.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const r=st.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===ne.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ne.STOPPED&&(this.state=ne.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){const s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,h)=>{const v=e.elementaryStreams[h];if(v){const y=v.endPTS-v.startPTS;if(y<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${y})`),f||!1;const _=r?0:da(s,e,v.startPTS,v.endPTS,v.startDTS,v.endDTS);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:s,level:i,drift:_,type:h,frag:e,start:v.startPTS,end:v.endPTS}),!0}return f},!1)){var c;if(i.fragmentError===0&&this.treatAsGap(e,i),((c=this.transmuxer)==null?void 0:c.error)===null){const f=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(f.message),this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ne.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(x.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ue.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,s;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!i?e.endPTS:(i||e).end)!=null?s:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ya(o){return!!o.interstitialsController&&o.enableInterstitialPlayback!==!1}class Vn{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=_a(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function _a(o,e){const t=new Uint8Array(e);let i=0;for(let r=0;r<o.length;r++){const s=o[r];t.set(s,i),i+=s.length}return t}var Ta={exports:{}},ks;function rn(){return ks||(ks=1,function(o){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(f,h,v){this.fn=f,this.context=h,this.once=v||!1}function s(f,h,v,y,_){if(typeof v!="function")throw new TypeError("The listener must be a function");var b=new r(v,y||f,_),S=t?t+h:h;return f._events[S]?f._events[S].fn?f._events[S]=[f._events[S],b]:f._events[S].push(b):(f._events[S]=b,f._eventsCount++),f}function a(f,h){--f._eventsCount===0?f._events=new i:delete f._events[h]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var h=[],v,y;if(this._eventsCount===0)return h;for(y in v=this._events)e.call(v,y)&&h.push(t?y.slice(1):y);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(v)):h},c.prototype.listeners=function(h){var v=t?t+h:h,y=this._events[v];if(!y)return[];if(y.fn)return[y.fn];for(var _=0,b=y.length,S=new Array(b);_<b;_++)S[_]=y[_].fn;return S},c.prototype.listenerCount=function(h){var v=t?t+h:h,y=this._events[v];return y?y.fn?1:y.length:0},c.prototype.emit=function(h,v,y,_,b,S){var R=t?t+h:h;if(!this._events[R])return!1;var k=this._events[R],O=arguments.length,B,F;if(k.fn){switch(k.once&&this.removeListener(h,k.fn,void 0,!0),O){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,v),!0;case 3:return k.fn.call(k.context,v,y),!0;case 4:return k.fn.call(k.context,v,y,_),!0;case 5:return k.fn.call(k.context,v,y,_,b),!0;case 6:return k.fn.call(k.context,v,y,_,b,S),!0}for(F=1,B=new Array(O-1);F<O;F++)B[F-1]=arguments[F];k.fn.apply(k.context,B)}else{var V=k.length,z;for(F=0;F<V;F++)switch(k[F].once&&this.removeListener(h,k[F].fn,void 0,!0),O){case 1:k[F].fn.call(k[F].context);break;case 2:k[F].fn.call(k[F].context,v);break;case 3:k[F].fn.call(k[F].context,v,y);break;case 4:k[F].fn.call(k[F].context,v,y,_);break;default:if(!B)for(z=1,B=new Array(O-1);z<O;z++)B[z-1]=arguments[z];k[F].fn.apply(k[F].context,B)}}return!0},c.prototype.on=function(h,v,y){return s(this,h,v,y,!1)},c.prototype.once=function(h,v,y){return s(this,h,v,y,!0)},c.prototype.removeListener=function(h,v,y,_){var b=t?t+h:h;if(!this._events[b])return this;if(!v)return a(this,b),this;var S=this._events[b];if(S.fn)S.fn===v&&(!_||S.once)&&(!y||S.context===y)&&a(this,b);else{for(var R=0,k=[],O=S.length;R<O;R++)(S[R].fn!==v||_&&!S[R].once||y&&S[R].context!==y)&&k.push(S[R]);k.length?this._events[b]=k.length===1?k[0]:k:a(this,b)}return this},c.prototype.removeAllListeners=function(h){var v;return h?(v=t?t+h:h,this._events[v]&&a(this,v)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,o.exports=c}(Ta)),Ta.exports}var io=rn(),Rr=et(io);const Rs="1.6.7",wr={};function Ea(){return typeof __HLS_WORKER_BUNDLE__=="function"}function ba(){const o=wr[Rs];if(o)return o.clientCount++,o;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return wr[Rs]=r,r}function Sa(o){const e=wr[o];if(e)return e.clientCount++,e;const t=new self.URL(o,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return wr[o]=r,r}function xa(o){const e=wr[o||Rs];if(e&&e.clientCount--===1){const{worker:i,objectURL:r}=e;delete wr[o||Rs],r&&self.URL.revokeObjectURL(r),i.terminate()}}function Aa(o,e){return e+10<=o.length&&o[e]===51&&o[e+1]===68&&o[e+2]===73&&o[e+3]<255&&o[e+4]<255&&o[e+6]<128&&o[e+7]<128&&o[e+8]<128&&o[e+9]<128}function sn(o,e){return e+10<=o.length&&o[e]===73&&o[e+1]===68&&o[e+2]===51&&o[e+3]<255&&o[e+4]<255&&o[e+6]<128&&o[e+7]<128&&o[e+8]<128&&o[e+9]<128}function nn(o,e){let t=0;return t=(o[e]&127)<<21,t|=(o[e+1]&127)<<14,t|=(o[e+2]&127)<<7,t|=o[e+3]&127,t}function ws(o,e){const t=e;let i=0;for(;sn(o,e);){i+=10;const r=nn(o,e+6);i+=r,Aa(o,e+10)&&(i+=10),e+=i}if(i>0)return o.subarray(t,t+i)}function La(o,e,t,i){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const b=new Error(`invalid ADTS sampling index:${a}`);o.emit(x.ERROR,x.ERROR,{type:le.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!0,error:b,reason:b.message});return}const c=(s>>6&3)+1,f=e[t+3]>>6&3|(s&1)<<2,h="mp4a.40."+c,v=r[a];let y=a;(c===5||c===29)&&(y-=3);const _=[c<<3|(y&14)>>1,(y&1)<<7|f<<3];return At.log(`manifest codec:${i}, parsed codec:${h}, channels:${f}, rate:${v} (ADTS object type:${c} sampling index:${a})`),{config:_,samplerate:v,channelCount:f,codec:h,parsedCodec:h,manifestCodec:i}}function Ia(o,e){return o[e]===255&&(o[e+1]&246)===240}function Ca(o,e){return o[e+1]&1?7:9}function ka(o,e){return(o[e+3]&3)<<11|o[e+4]<<3|(o[e+5]&224)>>>5}function jn(o,e){return e+5<o.length}function an(o,e){return e+1<o.length&&Ia(o,e)}function Ra(o,e){return jn(o,e)&&Ia(o,e)&&ka(o,e)<=o.length-e}function ro(o,e){if(an(o,e)){const t=Ca(o,e);if(e+t>=o.length)return!1;const i=ka(o,e);if(i<=t)return!1;const r=e+i;return r===o.length||an(o,r)}return!1}function wa(o,e,t,i,r){if(!o.samplerate){const s=La(e,t,i,r);if(!s)return;me(o,s)}}function Da(o){return 9216e4/o}function so(o,e){const t=Ca(o,e);if(e+t<=o.length){const i=ka(o,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function Pa(o,e,t,i,r){const s=Da(o.samplerate),a=i+r*s,c=so(e,t);let f;if(c){const{frameLength:y,headerLength:_}=c,b=_+y,S=Math.max(0,t+b-e.length);S?(f=new Uint8Array(b-_),f.set(e.subarray(t+_,e.length),0)):f=e.subarray(t+_,t+b);const R={unit:f,pts:a};return S||o.samples.push(R),{sample:R,length:b,missing:S}}const h=e.length-t;return f=new Uint8Array(h),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:a},length:h,missing:-1}}function no(o,e){return sn(o,e)&&nn(o,e+6)+10<=o.length-e}function ao(o){return o instanceof ArrayBuffer?o:o.byteOffset==0&&o.byteLength==o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer}function Kn(o,e=0,t=1/0){return Oa(o,e,t,Uint8Array)}function Oa(o,e,t,i){const r=Ma(o);let s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);const a=oo(o)?o.byteOffset:0,c=(a+o.byteLength)/s,f=(a+e)/s,h=Math.floor(Math.max(0,Math.min(f,c))),v=Math.floor(Math.min(h+Math.max(t,0),c));return new i(r,h,v-h)}function Ma(o){return o instanceof ArrayBuffer?o:o.buffer}function oo(o){return o&&o.buffer instanceof ArrayBuffer&&o.byteLength!==void 0&&o.byteOffset!==void 0}function ns(o){const e={key:o.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(o.size<2)return;if(o.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=o.data.subarray(1).indexOf(0);if(i===-1)return;const r=rt(Kn(o.data,1,i)),s=o.data[2+i],a=o.data.subarray(3+i).indexOf(0);if(a===-1)return;const c=rt(Kn(o.data,3+i,a));let f;return r==="-->"?f=rt(Kn(o.data,4+i+a)):f=ao(o.data.subarray(4+i+a)),e.mimeType=r,e.pictureType=s,e.description=c,e.data=f,e}function lo(o){if(o.size<2)return;const e=rt(o.data,!0),t=new Uint8Array(o.data.subarray(e.length+1));return{key:o.type,info:e,data:t.buffer}}function Ro(o){if(o.size<2)return;if(o.type==="TXXX"){let t=1;const i=rt(o.data.subarray(t),!0);t+=i.length+1;const r=rt(o.data.subarray(t));return{key:o.type,info:i,data:r}}const e=rt(o.data.subarray(1));return{key:o.type,info:"",data:e}}function wo(o){if(o.type==="WXXX"){if(o.size<2)return;let t=1;const i=rt(o.data.subarray(t),!0);t+=i.length+1;const r=rt(o.data.subarray(t));return{key:o.type,info:i,data:r}}const e=rt(o.data);return{key:o.type,info:"",data:e}}function Do(o){return o.type==="PRIV"?lo(o):o.type[0]==="W"?wo(o):o.type==="APIC"?ns(o):Ro(o)}function Po(o){const e=String.fromCharCode(o[0],o[1],o[2],o[3]),t=nn(o,4),i=10;return{type:e,size:t,data:o.subarray(i,i+t)}}const qn=10,Oo=10;function Wn(o){let e=0;const t=[];for(;sn(o,e);){const i=nn(o,e+6);o[e+5]>>6&1&&(e+=qn),e+=qn;const r=e+i;for(;e+Oo<r;){const s=Po(o.subarray(e)),a=Do(s);a&&t.push(a),e+=s.size+qn}Aa(o,e)&&(e+=qn)}return t}function uo(o){return o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp"}function co(o){if(o.data.byteLength===8){const e=new Uint8Array(o.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Fa(o){const e=Wn(o);for(let t=0;t<e.length;t++){const i=e[t];if(uo(i))return co(i)}}let Di=function(o){return o.audioId3="org.id3",o.dateRange="com.apple.quicktime.HLS",o.emsg="https://aomedia.org/emsg/ID3",o.misbklv="urn:misb:KLV:bin:1910.1",o}({});function rr(o="",e=9e4){return{type:o,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Na{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=fi(this.cachedData,e),this.cachedData=null);let i=ws(e,0),r=i?i.length:0,s;const a=this._audioTrack,c=this._id3Track,f=i?Fa(i):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&N(f))&&(this.basePTS=Mo(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Di.audioId3,duration:Number.POSITIVE_INFINITY});r<h;){if(this.canParse(e,r)){const v=this.appendFrame(a,e,r);v?(this.frameIndex++,this.lastPTS=v.sample.pts,r+=v.length,s=r):r=h}else no(e,r)?(i=ws(e,r),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Di.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===h&&s!==h){const v=e.slice(s);this.cachedData?this.cachedData=fi(this.cachedData,v):this.cachedData=v}}return{audioTrack:a,videoTrack:rr(),id3Track:c,textTrack:rr()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:rr(),id3Track:this._id3Track,textTrack:rr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Mo=(o,e,t)=>{if(N(o))return o*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let Ds=null;const De=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Yn=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ho=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ba=[0,1,1,4];function zn(o,e,t,i,r){if(t+24>e.length)return;const s=on(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,c=i+r*a,f={unit:e.subarray(t,t+s.frameLength),pts:c,dts:c};return o.config=[],o.channelCount=s.channelCount,o.samplerate=s.sampleRate,o.samples.push(f),{sample:f,length:s.frameLength,missing:0}}}function on(o,e){const t=o[e+1]>>3&3,i=o[e+1]>>1&3,r=o[e+2]>>4&15,s=o[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const a=o[e+2]>>1&1,c=o[e+3]>>6,f=t===3?3-i:i===3?3:4,h=De[f*14+r-1]*1e3,y=Yn[(t===3?0:t===2?1:2)*3+s],_=c===3?1:2,b=ho[t][i],S=Ba[i],R=b*8*S,k=Math.floor(b*h/y+a)*S;if(Ds===null){const F=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ds=F?parseInt(F[1]):0}return!!Ds&&Ds<=87&&i===2&&h>=224e3&&c===0&&(o[e+3]=o[e+3]|128),{sampleRate:y,channelCount:_,frameLength:k,samplesPerFrame:R}}}function Ua(o,e){return o[e]===255&&(o[e+1]&224)===224&&(o[e+1]&6)!==0}function ni(o,e){return e+1<o.length&&Ua(o,e)}function ln(o,e){return Ua(o,e)&&4<=o.length-e}function un(o,e){if(e+1<o.length&&Ua(o,e)){const i=on(o,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const s=e+r;return s===o.length||ni(o,s)}return!1}class Ps extends Na{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=ws(e,0);let r=(i==null?void 0:i.length)||0;if(un(e,r))return!1;for(let s=e.length;r<s;r++)if(ro(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Ra(e,t)}appendFrame(e,t,i){wa(e,this.observer,t,i,e.manifestCodec);const r=Pa(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const as=(o,e)=>{let t=0,i=5;e+=i;const r=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=o[e];const c=Math.min(i,8),f=8-c;s[0]=4278190080>>>24+f<<f,r[0]=(a[0]&s[0])>>f,t=t?t<<c|r[0]:r[0],e+=1,i-=c}return t};class Xn extends Na{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const r=cn(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=ws(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Fa(t)!==void 0&&as(e,i)<16}}function cn(o,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const c=[48e3,44100,32e3][s],f=e[t+4]&63,v=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+s]*2;if(t+v>e.length)return-1;const y=e[t+6]>>5;let _=0;y===2?_+=2:(y&1&&y!==1&&(_+=2),y&4&&(_+=2));const b=(e[t+6]<<8|e[t+7])>>12-_&1,R=[2,1,2,3,3,4,4,5][y]+b,k=e[t+5]>>3,O=e[t+5]&7,B=new Uint8Array([s<<6|k<<1|O>>2,(O&3)<<6|y<<3|b<<2|f>>4,f<<4&224]),F=1536/c*9e4,V=i+r*F,z=e.subarray(t,t+v);return o.config=B,o.channelCount=R,o.samplerate=c,o.samples.push({unit:z,pts:V}),v}class fo extends Na{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ws(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&Fa(t)!==void 0&&as(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(un(e,i))return At.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return ln(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return zn(e,t,i,this.basePTS,this.frameIndex)}}const Qn=/\/emsg[-/]ID3/i;class Fo{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const s=this.videoTrack=rr("video",1),a=this.audioTrack=rr("audio",1),c=this.txtTrack=rr("text",1);if(this.id3Track=rr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=xi(e);if(f.video){const{id:h,timescale:v,codec:y,supplemental:_}=f.video;s.id=h,s.timescale=c.timescale=v,s.codec=y,s.supplemental=_}if(f.audio){const{id:h,timescale:v,codec:y}=f.audio;a.id=h,a.timescale=v,a.codec=y}c.id=Zt.text,s.sampleDuration=0,s.duration=a.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return Gi(e)}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=fi(this.remainderData,e));const c=xr(i);this.remainderData=c.remainder,r.samples=c.valid||new Uint8Array}else r.samples=i;const a=this.extractID3Track(r,t);return s.samples=$r(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=$r(e,t),{videoTrack:t,audioTrack:rr(),id3Track:r,textTrack:rr()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=ht(e.samples,["emsg"]);r&&r.forEach(s=>{const a=_n(s);if(Qn.test(a.schemeIdUri)){const c=$a(a,t);let f=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const h=a.payload;i.samples.push({data:h,len:h.byteLength,dts:c,pts:c,type:Di.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=$a(a,t);i.samples.push({data:a.payload,len:a.payload.byteLength,dts:c,pts:c,type:Di.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function $a(o,e){return N(o.presentationTime)?o.presentationTime/o.timeScale:e+o.presentationTimeDelta/o.timeScale}class sr{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Ss(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ki.cbc)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(c=>{const f=new Uint8Array(c);r.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){const a=ps(s.data),c=this.getAvcEncryptedData(a);this.decryptBuffer(c.buffer).then(f=>{s.data=this.getAvcDecryptedUnit(a,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)})}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(i>=s.length);i++){const a=s[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,i,r,a),!this.decrypter.isSync()))return}}}}class Ha{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,r=i.length;if(r){const s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const r=t.byteLength;let s=e.naluState||0;const a=s,c=[];let f=0,h,v,y,_=-1,b=0;for(s===-1&&(_=0,b=this.getNALuType(t,0),s=0,f=1);f<r;){if(h=t[f++],!s){s=h?0:1;continue}if(s===1){s=h?0:2;continue}if(!h)s=3;else if(h===1){if(v=f-s-1,_>=0){const S={data:t.subarray(_,v),type:b};c.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(a&&f<=4-a&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-a)),v>0&&(S.data=fi(S.data,t.subarray(0,v)),S.state=0))}f<r?(y=this.getNALuType(t,f),_=f,b=y,s=0):s=-1}else s=0}if(_>=0&&s>=0){const S={data:t.subarray(_,r),type:b,state:s};c.push(S)}if(c.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=fi(S.data,t))}return e.naluState=s,c}}class hn{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&At.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Ga extends Ha{parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let a=this.VideoSample,c,f=!1;i.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(h=>{var v,y;switch(h.type){case 1:{let R=!1;c=!0;const k=h.data;if(f&&k.length>4){const O=this.readSliceType(k);(O===2||O===4||O===7||O===9)&&(R=!0)}if(R){var _;(_=a)!=null&&_.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.frame=!0,a.key=R;break}case 5:c=!0,(v=a)!=null&&v.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 6:{c=!0,fs(h.data,1,i.pts,t.samples);break}case 7:{var b,S;c=!0,f=!0;const R=h.data,k=this.readSPS(R);if(!e.sps||e.width!==k.width||e.height!==k.height||((b=e.pixelRatio)==null?void 0:b[0])!==k.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==k.pixelRatio[1]){e.width=k.width,e.height=k.height,e.pixelRatio=k.pixelRatio,e.sps=[R];const O=R.subarray(1,4);let B="avc1.";for(let F=0;F<3;F++){let V=O[F].toString(16);V.length<2&&(V="0"+V),B+=V}e.codec=B}break}case 8:c=!0,e.pps=[h.data];break;case 9:c=!0,e.audFound=!0,(y=a)!=null&&y.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:c=!0;break;default:c=!1;break}a&&c&&a.units.push(h)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new hn(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,s;for(let a=0;a<e;a++)r!==0&&(s=t.readEG(),r=(i+s+256)%256),i=r===0?i:r}readSPS(e){const t=new hn(e);let i=0,r=0,s=0,a=0,c,f,h;const v=t.readUByte.bind(t),y=t.readBits.bind(t),_=t.readUEG.bind(t),b=t.readBoolean.bind(t),S=t.skipBits.bind(t),R=t.skipEG.bind(t),k=t.skipUEG.bind(t),O=this.skipScalingList.bind(this);v();const B=v();if(y(5),S(3),v(),k(),B===100||B===110||B===122||B===244||B===44||B===83||B===86||B===118||B===128){const J=_();if(J===3&&S(1),k(),k(),S(1),b())for(f=J!==3?8:12,h=0;h<f;h++)b()&&(h<6?O(16,t):O(64,t))}k();const F=_();if(F===0)_();else if(F===1)for(S(1),R(),R(),c=_(),h=0;h<c;h++)R();k(),S(1);const V=_(),z=_(),re=y(1);re===0&&S(1),S(1),b()&&(i=_(),r=_(),s=_(),a=_());let Y=[1,1];if(b()&&b())switch(v()){case 1:Y=[1,1];break;case 2:Y=[12,11];break;case 3:Y=[10,11];break;case 4:Y=[16,11];break;case 5:Y=[40,33];break;case 6:Y=[24,11];break;case 7:Y=[20,11];break;case 8:Y=[32,11];break;case 9:Y=[80,33];break;case 10:Y=[18,11];break;case 11:Y=[15,11];break;case 12:Y=[64,33];break;case 13:Y=[160,99];break;case 14:Y=[4,3];break;case 15:Y=[3,2];break;case 16:Y=[2,1];break;case 255:{Y=[v()<<8|v(),v()<<8|v()];break}}return{width:Math.ceil((V+1)*16-i*2-r*2),height:(2-re)*(z+1)*16-(re?2:4)*(s+a),pixelRatio:Y}}}class je extends Ha{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let a=this.VideoSample,c,f=!1;i.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(h=>{var v,y;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,f){var _;(_=a)!=null&&_.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:c=!0,(v=a)!=null&&v.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 39:c=!0,fs(h.data,2,i.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=me(e.params,this.readVPS(h.data)),this.initVPS=h.data),e.vps=[h.data];break;case 33:if(c=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],h.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const b=this.readSPS(h.data);e.width=b.width,e.height=b.height,e.pixelRatio=b.pixelRatio,e.codec=b.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in b.params)e.params[S]=b.params[S]}this.pushParameterSet(e.sps,h.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const b=this.readPPS(h.data);for(const S in b)e.params[S]=b[S]}this.pushParameterSet(e.pps,h.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(y=a)!=null&&y.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:c=!1;break}a&&c&&a.units.push(h)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new hn(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){const t=new hn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),c=t.readUByte(),f=t.readUByte(),h=t.readUByte(),v=t.readUByte(),y=t.readUByte(),_=t.readUByte(),b=t.readUByte(),S=t.readUByte(),R=t.readUByte(),k=t.readUByte(),O=t.readUByte(),B=[],F=[];for(let Ft=0;Ft<i;Ft++)B.push(t.readBoolean()),F.push(t.readBoolean());if(i>0)for(let Ft=i;Ft<8;Ft++)t.readBits(2);for(let Ft=0;Ft<i;Ft++)B[Ft]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),F[Ft]&&t.readUByte();t.readUEG();const V=t.readUEG();V==3&&t.skipBits(1);const z=t.readUEG(),re=t.readUEG(),Y=t.readBoolean();let J=0,ee=0,q=0,pe=0;Y&&(J+=t.readUEG(),ee+=t.readUEG(),q+=t.readUEG(),pe+=t.readUEG());const Ie=t.readUEG(),Xe=t.readUEG(),Ve=t.readUEG(),He=t.readBoolean();for(let Ft=He?0:i;Ft<=i;Ft++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Oi=0;Oi<4;Oi++)for(let cr=0;cr<(Oi===3?2:6);cr++)if(!t.readBoolean())t.readUEG();else{const Er=Math.min(64,1<<4+(Oi<<1));Oi>1&&t.readEG();for(let sa=0;sa<Er;sa++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const Ce=t.readUEG();let lt=0;for(let Ft=0;Ft<Ce;Ft++){let Oi=!1;if(Ft!==0&&(Oi=t.readBoolean()),Oi){Ft===Ce&&t.readUEG(),t.readBoolean(),t.readUEG();let cr=0;for(let pn=0;pn<=lt;pn++){const Er=t.readBoolean();let sa=!1;Er||(sa=t.readBoolean()),(Er||sa)&&cr++}lt=cr}else{const cr=t.readUEG(),pn=t.readUEG();lt=cr+pn;for(let Er=0;Er<cr;Er++)t.readUEG(),t.readBoolean();for(let Er=0;Er<pn;Er++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ft=t.readUEG();for(let Oi=0;Oi<Ft;Oi++){for(let cr=0;cr<Ve+4;cr++)t.readBits(1);t.readBits(1)}}let Oe=0,Ae=1,St=1,Ct=!0,Nt=1,Pt=0;t.readBoolean(),t.readBoolean();let oi=!1;if(t.readBoolean()){if(t.readBoolean()){const gn=t.readUByte(),gu=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Lo=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];gn>0&&gn<16?(Ae=gu[gn-1],St=Lo[gn-1]):gn===255&&(Ae=t.readBits(16),St=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),oi=t.readBoolean(),oi&&(J+=t.readUEG(),ee+=t.readUEG(),q+=t.readUEG(),pe+=t.readUEG()),t.readBoolean()&&(Nt=t.readBits(32),Pt=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Lo=t.readBoolean(),mu=t.readBoolean();let Wa=!1;(Lo||mu)&&(Wa=t.readBoolean(),Wa&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Wa&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let vu=0;vu<=i;vu++){Ct=t.readBoolean();const Yh=Ct||t.readBoolean();let yu=!1;Yh?t.readEG():yu=t.readBoolean();const _u=yu?1:t.readUEG()+1;if(Lo)for(let Ya=0;Ya<_u;Ya++)t.readUEG(),t.readUEG(),Wa&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(mu)for(let Ya=0;Ya<_u;Ya++)t.readUEG(),t.readUEG(),Wa&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Oe=t.readUEG())}let Pi=z,Ji=re;if(Y||oi){let Ft=1,Oi=1;V===1?Ft=Oi=2:V==2&&(Ft=2),Pi=z-Ft*ee-Ft*J,Ji=re-Oi*pe-Oi*q}const fn=r?["A","B","C"][r]:"",Wh=c<<24|f<<16|h<<8|v;let ll=0;for(let Ft=0;Ft<32;Ft++)ll=(ll|(Wh>>Ft&1)<<31-Ft)>>>0;let ul=ll.toString(16);return a===1&&ul==="2"&&(ul="6"),{codecString:`hvc1.${fn}${a}.${ul}.${s?"H":"L"}${O}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:r,general_profile_compatibility_flags:[c,f,h,v],general_constraint_indicator_flags:[y,_,b,S,R,k],general_level_idc:O,bit_depth:Ie+8,bit_depth_luma_minus8:Ie,bit_depth_chroma_minus8:Xe,min_spatial_segmentation_idc:Oe,chroma_format_idc:V,frame_rate:{fixed:Ct,fps:Pt/Nt}},width:Pi,height:Ji,pixelRatio:[Ae,St]}}readPPS(e){const t=new hn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let a=1;return s&&r?a=0:s?a=3:r&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ai=188;class nr{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){const i=nr.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(ai*5,t-ai)+1,r=0;for(;r<i;){let s=!1,a=-1,c=0;for(let f=r;f<t;f+=ai)if(e[f]===71&&(t-f===ai||e[f+ai]===71)){if(c++,a===-1&&(a=f,a!==0&&(i=Math.min(a+ai*99,e.length-ai)+1)),s||(s=p(e,f)===0),s&&c>1&&(a===0&&c>2||f+ai>i))return a}else{if(c)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Zt[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=nr.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=nr.createTrack("audio",r),this._id3Track=nr.createTrack("id3"),this._txtTrack=nr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let s;const a=this._videoTrack,c=this._audioTrack,f=this._id3Track,h=this._txtTrack;let v=a.pid,y=a.pesData,_=c.pid,b=f.pid,S=c.pesData,R=f.pesData,k=null,O=this.pmtParsed,B=this._pmtId,F=e.length;if(this.remainderData&&(e=fi(this.remainderData,e),F=e.length,this.remainderData=null),F<ai&&!r)return this.remainderData=e,{audioTrack:c,videoTrack:a,id3Track:f,textTrack:h};const V=Math.max(0,nr.syncOffset(e));F-=(F-V)%ai,F<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,F,e.buffer.byteLength-F));let z=0;for(let Y=V;Y<F;Y+=ai)if(e[Y]===71){const J=!!(e[Y+1]&64),ee=p(e,Y),q=(e[Y+3]&48)>>4;let pe;if(q>1){if(pe=Y+5+e[Y+4],pe===Y+ai)continue}else pe=Y+4;switch(ee){case v:if(J){if(y&&(s=l(y,this.logger))){if(this.videoParser===null)switch(a.segmentCodec){case"avc":this.videoParser=new Ga;break;case"hevc":this.videoParser=new je;break}this.videoParser!==null&&this.videoParser.parsePES(a,h,s,!1)}y={data:[],size:0}}y&&(y.data.push(e.subarray(pe,Y+ai)),y.size+=Y+ai-pe);break;case _:if(J){if(S&&(s=l(S,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,s);break;case"mp3":this.parseMPEGPES(c,s);break;case"ac3":this.parseAC3PES(c,s);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(pe,Y+ai)),S.size+=Y+ai-pe);break;case b:J&&(R&&(s=l(R,this.logger))&&this.parseID3PES(f,s),R={data:[],size:0}),R&&(R.data.push(e.subarray(pe,Y+ai)),R.size+=Y+ai-pe);break;case 0:J&&(pe+=e[pe]+1),B=this._pmtId=m(e,pe);break;case B:{J&&(pe+=e[pe]+1);const Ie=d(e,pe,this.typeSupported,i,this.observer,this.logger);v=Ie.videoPid,v>0&&(a.pid=v,a.segmentCodec=Ie.segmentVideoCodec),_=Ie.audioPid,_>0&&(c.pid=_,c.segmentCodec=Ie.segmentAudioCodec),b=Ie.id3Pid,b>0&&(f.pid=b),k!==null&&!O&&(this.logger.warn(`MPEG-TS PMT found at ${Y} after unknown PID '${k}'. Backtracking to sync byte @${V} to parse all TS packets.`),k=null,Y=V-188),O=this.pmtParsed=!0;break}case 17:case 8191:break;default:k=ee;break}}else z++;z>0&&u(this.observer,new Error(`Found ${z} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=y,c.pesData=S,f.pesData=R;const re={audioTrack:c,videoTrack:a,id3Track:f,textTrack:h};return r&&this.extractRemainingSamples(re),re}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,a=i.pesData,c=t.pesData,f=r.pesData;let h;if(a&&(h=l(a,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new Ga;break;case"hevc":this.videoParser=new je;break}this.videoParser!==null&&(this.videoParser.parsePES(i,s,h,!0),i.pesData=null)}else i.pesData=a;if(c&&(h=l(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;f&&(h=l(f,this.logger))?(this.parseID3PES(r,h),r.pesData=null):r.pesData=f}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new sr(this.observer,this.config,t);return this.decrypt(r,s)}decrypt(e,t){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const y=r.missing,_=r.sample.unit.byteLength;if(y===-1)s=fi(r.sample.unit,s);else{const b=_-y;r.sample.unit.set(s.subarray(0,y),b),e.samples.push(r.sample),i=r.missing}}let a,c;for(a=i,c=s.length;a<c-1&&!an(s,a);a++);if(a!==i){let y;const _=a<c-1;if(_?y=`AAC PES did not start with ADTS header,offset:${a}`:y="No ADTS header found in AAC PES",u(this.observer,new Error(y),_,this.logger),!_)return}wa(e,this.observer,s,a,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(r){const y=Da(e.samplerate);f=r.sample.pts+y}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,v;for(;a<c;)if(v=Pa(e,s,a,f,h),a+=v.length,v.missing){this.aacOverFlow=v;break}else for(h++;a<c-1&&!an(s,a);a++);}parseMPEGPES(e,t){const i=t.data,r=i.length;let s=0,a=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<r;)if(ni(i,a)){const f=zn(e,i,a,c,s);if(f)a+=f.length,s++;else break}else a++}parseAC3PES(e,t){{const i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=i.length;let a=0,c=0,f;for(;c<s&&(f=cn(e,i,c,r,a++))>0;)c+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=me({},t,{type:this._videoTrack?Di.emsg:Di.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function p(o,e){return((o[e+1]&31)<<8)+o[e+2]}function m(o,e){return(o[e+10]&31)<<8|o[e+11]}function d(o,e,t,i,r,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(o[e+1]&15)<<8|o[e+2],f=e+3+c-4,h=(o[e+10]&15)<<8|o[e+11];for(e+=12+h;e<f;){const v=p(o,e),y=(o[e+3]&15)<<8|o[e+4];switch(o[e]){case 207:if(!i){n("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=v);break;case 21:a.id3Pid===-1&&(a.id3Pid=v);break;case 219:if(!i){n("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=v);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=v,a.segmentAudioCodec="mp3");break;case 193:if(!i){n("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=v,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&y>0){let _=e+5,b=y;for(;b>2;){switch(o[_]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=v,a.segmentAudioCodec="ac3");break}const R=o[_+1]+2;_+=R,b-=R}}break;case 194:case 135:return u(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=v,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=y+5}return a}function u(o,e,t,i){i.warn(`parsing error: ${e.message}`),o.emit(x.ERROR,x.ERROR,{type:le.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function n(o,e){e.log(`${o} with AES-128-CBC encryption found in unencrypted stream`)}function l(o,e){let t=0,i,r,s,a,c;const f=o.data;if(!o||o.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=fi(f[0],f[1]),f.splice(1,1);if(i=f[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>o.size-6)return null;const v=i[7];v&192&&(a=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,v&64?(c=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,a-c>54e5&&(e.warn(`${Math.round((a-c)/9e4)}s delta between PTS and DTS, align them`),a=c)):c=a),s=i[8];let y=s+9;if(o.size<=y)return null;o.size-=y;const _=new Uint8Array(o.size);for(let b=0,S=f.length;b<S;b++){i=f[b];let R=i.byteLength;if(y)if(y>R){y-=R;continue}else i=i.subarray(y),R-=y,y=0;_.set(i,t),t+=R}return r&&(r-=s+3),{data:_,pts:a,dts:c,len:r}}return null}class g{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const A=Math.pow(2,32)-1;class L{static init(){L.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in L.types)L.types.hasOwnProperty(e)&&(L.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=s,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,a,f,a,c),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,r))}static box(e,...t){let i=8,r=t.length;const s=r;for(;r--;)i+=t[r].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(e,4),r=0,i=8;r<s;r++)a.set(t[r],i),i+=t[r].byteLength;return a}static hdlr(e){return L.box(L.types.hdlr,L.HDLR_TYPES[e])}static mdat(e){return L.box(L.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(A+1)),r=Math.floor(t%(A+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return L.box(L.types.mdia,L.mdhd(e.timescale||0,e.duration||0),L.hdlr(e.type),L.minf(e))}static mfhd(e){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(e)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(e))}static moof(e,t,i){return L.box(L.types.moof,L.mfhd(e),L.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=L.trak(e[t]);return L.box.apply(null,[L.types.moov,L.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(L.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=L.trex(e[t]);return L.box.apply(null,[L.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(A+1)),r=Math.floor(t%(A+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,s)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return L.box(L.types.sdtp,i)}static stbl(e){return L.box(L.types.stbl,L.stsd(e),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))}static avc1(e){let t=[],i=[],r,s,a;for(r=0;r<e.sps.length;r++)s=e.sps[r],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],a=s.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(s));const c=L.box(L.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),f=e.width,h=e.height,v=e.pixelRatio[0],y=e.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,y>>24,y>>16&255,y>>8&255,y&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return L.box(L.types.mp4a,L.audioStsd(e),L.box(L.types.esds,L.esds(e)))}static mp3(e){return L.box(L.types[".mp3"],L.audioStsd(e))}static ac3(e){return L.box(L.types["ac-3"],L.audioStsd(e),L.box(L.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return L.box(L.types.stsd,L.STSD,L.mp4a(e));if(t==="ac3"&&e.config)return L.box(L.types.stsd,L.STSD,L.ac3(e));if(t==="mp3"&&e.codec==="mp3")return L.box(L.types.stsd,L.STSD,L.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return L.box(L.types.stsd,L.STSD,L.avc1(e));if(t==="hevc"&&e.vps)return L.box(L.types.stsd,L.STSD,L.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,a=Math.floor(i/(A+1)),c=Math.floor(i%(A+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const i=L.sdtp(e),r=e.id,s=Math.floor(t/(A+1)),a=Math.floor(t%(A+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),L.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,L.box(L.types.trak,L.tkhd(e),L.mdia(e))}static trex(e){const t=e.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,s=12+16*r,a=new Uint8Array(s);let c,f,h,v,y,_;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<r;c++)f=i[c],h=f.duration,v=f.size,y=f.flags,_=f.cts,a.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,v>>>24&255,v>>>16&255,v>>>8&255,v&255,y.isLeading<<2|y.dependsOn,y.isDependedOn<<6|y.hasRedundancy<<4|y.paddingValue<<1|y.isNonSync,y.degradPrio&61440,y.degradPrio&15,_>>>24&255,_>>>16&255,_>>>8&255,_&255],12+16*c);return L.box(L.types.trun,a)}static initSegment(e){L.types||L.init();const t=L.moov(e);return fi(L.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let a=s.length;for(let S=0;S<i.length;S+=1){a+=3;for(let R=0;R<i[S].length;R+=1)a+=2+i[S][R].length}const c=new Uint8Array(a);c.set(s,0),a=s.length;const f=i.length-1;for(let S=0;S<i.length;S+=1){c.set(new Uint8Array([32+S|(S===f?128:0),0,i[S].length]),a),a+=3;for(let R=0;R<i[S].length;R+=1)c.set(new Uint8Array([i[S][R].length>>8,i[S][R].length&255]),a),a+=2,c.set(i[S][R],a),a+=i[S][R].length}const h=L.box(L.types.hvcC,c),v=e.width,y=e.height,_=e.pixelRatio[0],b=e.pixelRatio[1];return L.box(L.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>8&255,v&255,y>>8&255,y&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([_>>24,_>>16&255,_>>8&255,_&255,b>>24,b>>16&255,b>>8&255,b&255])))}}L.types=void 0,L.HDLR_TYPES=void 0,L.STTS=void 0,L.STSC=void 0,L.STCO=void 0,L.STSZ=void 0,L.VMHD=void 0,L.SMHD=void 0,L.STSD=void 0,L.FTYP=void 0,L.DINF=void 0;const M=9e4;function G(o,e,t=1,i=!1){const r=o*e*t;return i?Math.round(r):r}function Q(o,e,t=1,i=!1){return G(o,e,1/t,i)}function $(o,e=!1){return G(o,1e3,1/M,e)}function fe(o,e=1){return G(o,M,1/e)}const $e=10*1e3,bt=1024,os=1152,ar=1536;let Dr=null,No=null;function hl(o,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:o?2:1,isNonSync:o?0:1}}}class po extends mt{constructor(e,t,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Dr===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Dr=a?parseInt(a[1]):0}if(No===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);No=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,r=e.reduce((s,a)=>{let c=a.pts,f=c-s;return f<-4294967296&&(t=!0,c=or(c,i),f=c-s),f>0?s:c},i);return t&&this.debug("PTS rollover detected"),r}remux(e,t,i,r,s,a,c,f){let h,v,y,_,b,S,R=s,k=s;const O=e.pid>-1,B=t.pid>-1,F=t.samples.length,V=e.samples.length>0,z=c&&F>0||F>1;if((!O||V)&&(!B||z)||this.ISGenerated||c){if(this.ISGenerated){var Y,J,ee,q;const Ve=this.videoTrackConfig;(Ve&&(t.width!==Ve.width||t.height!==Ve.height||((Y=t.pixelRatio)==null?void 0:Y[0])!==((J=Ve.pixelRatio)==null?void 0:J[0])||((ee=t.pixelRatio)==null?void 0:ee[1])!==((q=Ve.pixelRatio)==null?void 0:q[1]))||!Ve&&z||this.nextAudioTs===null&&V)&&this.resetInitSegment()}this.ISGenerated||(y=this.generateIS(e,t,s,a));const pe=this.isVideoContiguous;let Ie=-1,Xe;if(z&&(Ie=Eu(t.samples),!pe&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,Ie>0){this.warn(`Dropped ${Ie} out of ${F} video samples due to a missing keyframe`);const Ve=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Ie),t.dropped+=Ie,k+=(t.samples[0].pts-Ve)/t.inputTimeScale,Xe=k}else Ie===-1&&(this.warn(`No keyframe found out of ${F} video samples`),S=!1);if(this.ISGenerated){if(V&&z){const Ve=this.getVideoStartPts(t.samples),Be=(or(e.samples[0].pts,Ve)-Ve)/t.inputTimeScale;R+=Math.max(0,Be),k+=Math.max(0,-Be)}if(V){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),y=this.generateIS(e,t,s,a)),v=this.remuxAudio(e,R,this.isAudioContiguous,a,B||z||f===ue.AUDIO?k:void 0),z){const Ve=v?v.endPTS-v.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),y=this.generateIS(e,t,s,a)),h=this.remuxVideo(t,k,pe,Ve)}}else z&&(h=this.remuxVideo(t,k,pe,0));h&&(h.firstKeyFrame=Ie,h.independent=Ie!==-1,h.firstKeyFramePTS=Xe)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(b=dl(i,s,this._initPTS,this._initDTS)),r.samples.length&&(_=fl(r,s,this._initPTS))),{audio:v,video:h,initSegment:y,independent:S,text:_,id3:b}}generateIS(e,t,i,r){const s=e.samples,a=t.samples,c=this.typeSupported,f={},h=this._initPTS;let v=!h||r,y="audio/mp4",_,b,S,R;if(v&&(_=b=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(y="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:y,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):L.initSegment([e]),metadata:{channelCount:e.channelCount}},v&&(R=e.id,S=e.inputTimeScale,!h||S!==h.timescale?_=b=s[0].pts-Math.round(S*i):v=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:L.initSegment([t]),metadata:{width:t.width,height:t.height}},v)if(R=t.id,S=t.inputTimeScale,!h||S!==h.timescale){const k=this.getVideoStartPts(a),O=Math.round(S*i);b=Math.min(b,or(a[0].dts,k)-O),_=Math.min(_,k-O)}else v=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,v?(this._initPTS={baseTime:_,timescale:S},this._initDTS={baseTime:b,timescale:S}):_=S=void 0,{tracks:f,initPTS:_,timescale:S,trackId:R}}remuxVideo(e,t,i,r){const s=e.inputTimeScale,a=e.samples,c=[],f=a.length,h=this._initPTS,v=h.baseTime*s/h.timescale;let y=this.nextVideoTs,_=8,b=this.videoSampleDuration,S,R,k=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY,B=!1;if(!i||y===null){const Oe=v+t*s,Ae=a[0].pts-or(a[0].dts,a[0].pts);Dr&&y!==null&&Math.abs(Oe-Ae-(y+v))<15e3?i=!0:y=Oe-Ae-v}const F=y+v;for(let Oe=0;Oe<f;Oe++){const Ae=a[Oe];Ae.pts=or(Ae.pts,F),Ae.dts=or(Ae.dts,F),Ae.dts<a[Oe>0?Oe-1:Oe].dts&&(B=!0)}B&&a.sort(function(Oe,Ae){const St=Oe.dts-Ae.dts,Ct=Oe.pts-Ae.pts;return St||Ct}),S=a[0].dts,R=a[a.length-1].dts;const V=R-S,z=V?Math.round(V/(f-1)):b||e.inputTimeScale/30;if(i){const Oe=S-F,Ae=Oe>z,St=Oe<-1;if((Ae||St)&&(Ae?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${$(Oe,!0)} ms (${Oe}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${$(-Oe,!0)} ms (${Oe}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!St||F>=a[0].pts||Dr)){S=F;const Ct=a[0].pts-Oe;if(Ae)a[0].dts=S,a[0].pts=Ct;else{let Nt=!0;for(let Pt=0;Pt<a.length&&!(a[Pt].dts>Ct&&Nt);Pt++){const oi=a[Pt].pts;if(a[Pt].dts-=Oe,a[Pt].pts-=Oe,Pt<a.length-1){const Qi=a[Pt+1].pts,Pi=a[Pt].pts,Ji=Qi<=Pi,fn=Qi<=oi;Nt=Ji==fn}}}this.log(`Video: Initial PTS/DTS adjusted: ${$(Ct,!0)}/${$(S,!0)}, delta: ${$(Oe,!0)} ms`)}}S=Math.max(0,S);let re=0,Y=0,J=S;for(let Oe=0;Oe<f;Oe++){const Ae=a[Oe],St=Ae.units,Ct=St.length;let Nt=0;for(let Pt=0;Pt<Ct;Pt++)Nt+=St[Pt].data.length;Y+=Nt,re+=Ct,Ae.length=Nt,Ae.dts<J?(Ae.dts=J,J+=z/4|0||1):J=Ae.dts,k=Math.min(Ae.pts,k),O=Math.max(Ae.pts,O)}R=a[f-1].dts;const ee=Y+4*re+8;let q;try{q=new Uint8Array(ee)}catch(Oe){this.observer.emit(x.ERROR,x.ERROR,{type:le.MUX_ERROR,details:H.REMUX_ALLOC_ERROR,fatal:!1,error:Oe,bytes:ee,reason:`fail allocating video mdat ${ee}`});return}const pe=new DataView(q.buffer);pe.setUint32(0,ee),q.set(L.types.mdat,4);let Ie=!1,Xe=Number.POSITIVE_INFINITY,Ve=Number.POSITIVE_INFINITY,He=Number.NEGATIVE_INFINITY,Be=Number.NEGATIVE_INFINITY;for(let Oe=0;Oe<f;Oe++){const Ae=a[Oe],St=Ae.units;let Ct=0;for(let oi=0,Qi=St.length;oi<Qi;oi++){const Pi=St[oi],Ji=Pi.data,fn=Pi.data.byteLength;pe.setUint32(_,fn),_+=4,q.set(Ji,_),_+=fn,Ct+=4+fn}let Nt;if(Oe<f-1)b=a[Oe+1].dts-Ae.dts,Nt=a[Oe+1].pts-Ae.pts;else{const oi=this.config,Qi=Oe>0?Ae.dts-a[Oe-1].dts:z;if(Nt=Oe>0?Ae.pts-a[Oe-1].pts:z,oi.stretchShortVideoTrack&&this.nextAudioTs!==null){const Pi=Math.floor(oi.maxBufferHole*s),Ji=(r?k+r*s:this.nextAudioTs+v)-Ae.pts;Ji>Pi?(b=Ji-Qi,b<0?b=Qi:Ie=!0,this.log(`It is approximately ${Ji/90} ms to the next segment; using duration ${b/90} ms for the last video frame.`)):b=Qi}else b=Qi}const Pt=Math.round(Ae.pts-Ae.dts);Xe=Math.min(Xe,b),He=Math.max(He,b),Ve=Math.min(Ve,Nt),Be=Math.max(Be,Nt),c.push(hl(Ae.key,b,Ct,Pt))}if(c.length){if(Dr){if(Dr<70){const Oe=c[0].flags;Oe.dependsOn=2,Oe.isNonSync=0}}else if(No&&Be-Ve<He-Xe&&z/He<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let Oe=S;for(let Ae=0,St=c.length;Ae<St;Ae++){const Ct=Oe+c[Ae].duration,Nt=Oe+c[Ae].cts;if(Ae<St-1){const Pt=Ct+c[Ae+1].cts;c[Ae].duration=Pt-Nt}else c[Ae].duration=Ae?c[Ae-1].duration:z;c[Ae].cts=0,Oe=Ct}}}b=Ie||!b?z:b;const at=R+b;this.nextVideoTs=y=at-v,this.videoSampleDuration=b,this.isVideoContiguous=!0;const Ce=L.moof(e.sequenceNumber++,S,me(e,{samples:c})),lt="video",ot={data1:Ce,data2:q,startPTS:(k-v)/s,endPTS:(O+b-v)/s,startDTS:(S-v)/s,endDTS:y/s,type:lt,hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ot}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return os;case"ac3":return ar;default:return bt}}remuxAudio(e,t,i,r,s){const a=e.inputTimeScale,c=e.samplerate?e.samplerate:a,f=a/c,h=this.getSamplesPerFrame(e),v=h*f,y=this._initPTS,_=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,b=[],S=s!==void 0;let R=e.samples,k=_?0:8,O=this.nextAudioTs||-1;const B=y.baseTime*a/y.timescale,F=B+t*a;if(this.isAudioContiguous=i=i||R.length&&O>0&&(r&&Math.abs(F-(O+B))<9e3||Math.abs(or(R[0].pts,F)-(O+B))<20*v),R.forEach(function(Be){Be.pts=or(Be.pts,F)}),!i||O<0){if(R=R.filter(Be=>Be.pts>=0),!R.length)return;s===0?O=0:r&&!S?O=Math.max(0,F-B):O=R[0].pts-B}if(e.segmentCodec==="aac"){const Be=this.config.maxAudioFramesDrift;for(let at=0,Ce=O+B;at<R.length;at++){const lt=R[at],ot=lt.pts,Oe=ot-Ce,Ae=Math.abs(1e3*Oe/a);if(Oe<=-Be*v&&S)at===0&&(this.warn(`Audio frame @ ${(ot/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*Oe/a)} ms.`),this.nextAudioTs=O=ot-B,Ce=ot);else if(Oe>=Be*v&&Ae<$e&&S){let St=Math.round(Oe/v);for(Ce=ot-St*v;Ce<0&&St&&v;)St--,Ce+=v;at===0&&(this.nextAudioTs=O=Ce-B),this.warn(`Injecting ${St} audio frames @ ${((Ce-B)/a).toFixed(3)}s due to ${Math.round(1e3*Oe/a)} ms gap.`);for(let Ct=0;Ct<St;Ct++){let Nt=g.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Nt||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Nt=lt.unit.subarray()),R.splice(at,0,{unit:Nt,pts:Ce}),Ce+=v,at++}}lt.pts=Ce,Ce+=v}}let V=null,z=null,re,Y=0,J=R.length;for(;J--;)Y+=R[J].unit.byteLength;for(let Be=0,at=R.length;Be<at;Be++){const Ce=R[Be],lt=Ce.unit;let ot=Ce.pts;if(z!==null){const Ae=b[Be-1];Ae.duration=Math.round((ot-z)/f)}else if(i&&e.segmentCodec==="aac"&&(ot=O+B),V=ot,Y>0){Y+=k;try{re=new Uint8Array(Y)}catch(Ae){this.observer.emit(x.ERROR,x.ERROR,{type:le.MUX_ERROR,details:H.REMUX_ALLOC_ERROR,fatal:!1,error:Ae,bytes:Y,reason:`fail allocating audio mdat ${Y}`});return}_||(new DataView(re.buffer).setUint32(0,Y),re.set(L.types.mdat,4))}else return;re.set(lt,k);const Oe=lt.byteLength;k+=Oe,b.push(hl(!0,h,Oe,0)),z=ot}const ee=b.length;if(!ee)return;const q=b[b.length-1];O=z-B,this.nextAudioTs=O+f*q.duration;const pe=_?new Uint8Array(0):L.moof(e.sequenceNumber++,V/f,me({},e,{samples:b}));e.samples=[];const Ie=(V-B)/a,Xe=O/a,He={data1:pe,data2:re,startPTS:Ie,endPTS:Xe,startDTS:Ie,endDTS:Xe,type:"audio",hasAudio:!0,hasVideo:!1,nb:ee};return this.isAudioContiguous=!0,He}}function or(o,e){let t;if(e===null)return o;for(e<o?t=-8589934592:t=8589934592;Math.abs(o-e)>4294967296;)o+=t;return o}function Eu(o){for(let e=0;e<o.length;e++)if(o[e].key)return e;return-1}function dl(o,e,t,i){const r=o.samples.length;if(!r)return;const s=o.inputTimeScale;for(let c=0;c<r;c++){const f=o.samples[c];f.pts=or(f.pts-t.baseTime*s/t.timescale,e*s)/s,f.dts=or(f.dts-i.baseTime*s/i.timescale,e*s)/s}const a=o.samples;return o.samples=[],{samples:a}}function fl(o,e,t){const i=o.samples.length;if(!i)return;const r=o.inputTimeScale;for(let a=0;a<i;a++){const c=o.samples[a];c.pts=or(c.pts-t.baseTime*r/t.timescale,e*r)/r}o.samples.sort((a,c)=>a.pts-c.pts);const s=o.samples;return o.samples=[],{samples:s}}class bu extends mt{constructor(e,t,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(cs(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=xi(e);r.audio&&(t=pl(r.audio,Rt.AUDIO,this)),r.video&&(i=pl(r.video,Rt.VIDEO,this));const s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:r.video.supplemental,initSegment:e,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?s.video={container:"video/mp4",codec:i,supplemental:r.video.supplemental,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,i,r,s,a){var c,f;let{initPTS:h,lastEndTime:v}=this;const y={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};N(v)||(v=this.lastEndTime=s||0);const _=t.samples;if(!(_!=null&&_.length))return y;const b={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((c=S)!=null&&c.length||(this.generateInitSegment(_),S=this.initData),!((f=S)!=null&&f.length))return this.warn("Failed to generate initSegment."),y;this.emitInitSegment&&(b.tracks=this.initTracks,this.emitInitSegment=!1);const R=yn(_,S,this),k=S.audio?R[S.audio.id]:null,O=S.video?R[S.video.id]:null,B=go(O,1/0),F=go(k,1/0),V=go(O,0,!0),z=go(k,0,!0);let re,Y=s,J=0;if(k&&(!O||!h&&F<B||h&&h.trackId===S.audio.id)?(b.trackId=S.audio.id,re=k,J=z-F):O&&(b.trackId=S.video.id,re=O,J=V-B),re){const Be=re.timescale;Y=re.start/Be,b.initPTS=re.start-s*Be,b.timescale=Be,h||(this.initPTS=h={baseTime:b.initPTS,timescale:Be,trackId:b.trackId})}(a||!h)&&(Su(h,Y,s,J)||b.timescale!==h.timescale)&&(b.initPTS=Y-s,b.timescale=1,h&&h.timescale===1&&this.warn(`Adjusting initPTS @${s} from ${h.baseTime/h.timescale} to ${b.initPTS}`),this.initPTS=h={baseTime:b.initPTS,timescale:1});const ee=e?Y-h.baseTime/h.timescale:v,q=ee+J;J>0?this.lastEndTime=q:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const pe=!!S.audio,Ie=!!S.video;let Xe="";pe&&(Xe+="audio"),Ie&&(Xe+="video");const Ve={data1:_,startPTS:ee,startDTS:ee,endPTS:q,endDTS:q,type:Xe,hasAudio:pe,hasVideo:Ie,nb:1,dropped:0};y.audio=pe&&!Ie?Ve:void 0,y.video=Ie?Ve:void 0;const He=O==null?void 0:O.sampleCount;if(He){const Be=O.keyFrameIndex,at=Be!==-1;Ve.nb=He,Ve.dropped=Be===0||this.isVideoContiguous?0:at?Be:He,Ve.independent=at,Ve.firstKeyFrame=Be,at&&O.keyFrameStart&&(Ve.firstKeyFramePTS=(O.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(y.independent=at),this.isVideoContiguous||(this.isVideoContiguous=at),Ve.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Be}/${He} dropped: ${Ve.dropped} start: ${Ve.firstKeyFramePTS||"NA"}`)}return y.initSegment=b,y.id3=dl(i,s,h,h),r.samples.length&&(y.text=fl(r,s,h)),y}}function go(o,e,t=!1){return(o==null?void 0:o.start)!==void 0?(o.start+(t?o.duration:0))/o.timescale:e}function Su(o,e,t,i){if(o===null)return!0;const r=Math.max(i,1),s=e-o.baseTime/o.timescale;return Math.abs(s-t)>r}function pl(o,e,t){const i=o==null?void 0:o.codec;return i&&i.length>4?i:e===Rt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Li(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let ls;try{ls=self.performance.now.bind(self.performance)}catch(o){ls=Date.now}const mo=[{demux:Fo,remux:bu},{demux:nr,remux:po},{demux:Ps,remux:po},{demux:fo,remux:po}];mo.splice(2,0,{demux:Xn,remux:po});class gl{constructor(e,t,i,r,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const s=i.transmuxing;s.executeStart=ls();let a=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:f}=this;r&&(this.currentTransmuxState=r);const{contiguous:h,discontinuity:v,trackSwitch:y,accurateTimeOffset:_,timeOffset:b,initSegmentChange:S}=r||c,{audioCodec:R,videoCodec:k,defaultInitPts:O,duration:B,initSegmentData:F}=f,V=xu(a,t);if(V&&ie(V.method)){const J=this.getDecrypter(),ee=Se(V.method);if(J.isSync()){let q=J.softwareDecrypt(a,V.key.buffer,V.iv.buffer,ee);if(i.part>-1){const Ie=J.flush();q=Ie&&Ie.buffer}if(!q)return s.executeEnd=ls(),Bo(i);a=new Uint8Array(q)}else return this.asyncResult=!0,this.decryptionPromise=J.webCryptoDecrypt(a,V.key.buffer,V.iv.buffer,ee).then(q=>{const pe=this.push(q,null,i);return this.decryptionPromise=null,pe}),this.decryptionPromise}const z=this.needsProbing(v,y);if(z){const J=this.configureTransmuxer(a);if(J)return this.logger.warn(`[transmuxer] ${J.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:le.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,error:J,reason:J.message}),s.executeEnd=ls(),Bo(i)}(v||y||S||z)&&this.resetInitSegment(F,R,k,B,t),(v||S||z)&&this.resetInitialTimestamp(O),h||this.resetContiguity();const re=this.transmux(a,V,b,_,i);this.asyncResult=Va(re);const Y=this.currentTransmuxState;return Y.contiguous=!0,Y.discontinuity=!1,Y.trackSwitch=!1,s.executeEnd=ls(),re}flush(e){const t=e.transmuxing;t.executeStart=ls();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:c}=r;if(i){const y=i.flush();y&&a.push(this.push(y.buffer,null,e))}const{demuxer:f,remuxer:h}=this;if(!f||!h){t.executeEnd=ls();const y=[Bo(e)];return this.asyncResult?Promise.resolve(y):y}const v=f.flush(c);return Va(v)?(this.asyncResult=!0,v.then(y=>(this.flushRemux(a,y,e),a))):(this.flushRemux(a,v,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:c}=t,{accurateTimeOffset:f,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===ue.MAIN?"level":"track"} ${i.level}`);const v=this.remuxer.remux(r,s,a,c,h,f,!0,this.id);e.push({remuxResult:v,chunkMeta:i}),i.transmuxing.executeEnd=ls()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){const{demuxer:a,remuxer:c}=this;!a||!c||(a.resetInitSegment(e,t,i,r),c.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,i,r,s):a=this.transmuxUnencrypted(e,i,r,s),a}transmuxUnencrypted(e,t,i,r){const{audioTrack:s,videoTrack:a,id3Track:c,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,c,f,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r}=this;let s;for(let y=0,_=mo.length;y<_;y++){var a;if((a=mo[y].demux)!=null&&a.probe(e,this.logger)){s=mo[y];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,f=this.remuxer,h=s.remux,v=s.demux;(!f||!(f instanceof h))&&(this.remuxer=new h(i,t,r,this.logger)),(!c||!(c instanceof v))&&(this.demuxer=new v(i,t,r,this.logger),this.probe=v.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ss(this.config)),e}}function xu(o,e){let t=null;return o.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Bo=o=>({remuxResult:{},chunkMeta:o});function Va(o){return"then"in o&&o.then instanceof Function}class Au{constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class Lu{constructor(e,t,i,r,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=a}}let ml=0;class vl{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ml++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const h=f.data,v=this.hls;if(!(!v||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var y;const _=(y=this.workerContext)==null?void 0:y.objectURL;_&&self.URL.revokeObjectURL(_);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{v.logger[h.data.logType]&&v.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,v.trigger(h.event,h.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const h=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const a=(f,h)=>{h=h||{},h.frag=this.frag||void 0,f===x.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(f,h)};this.observer=new Rr,this.observer.on(x.FRAG_DECRYPTED,a),this.observer.on(x.ERROR,a);const c=qr(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker!="undefined"){const f=this.hls.logger;if(s.workerPath||Ea()){try{s.workerPath?(f.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Sa(s.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=ba());const{worker:v}=this.workerContext;v.addEventListener("message",this.onWorkerMessage),v.addEventListener("error",this.onWorkerError),v.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:kt(s)})}catch(v){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,v),this.terminateWorker(),this.error=null,this.transmuxer=new gl(this.observer,c,s,"",t,e.logger)}return}}this.transmuxer=new gl(this.observer,c,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ml++;const t=this.hls.config,i=qr(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:kt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),xa(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,s,a,c,f,h,v){var y,_;h.transmuxing.start=self.performance.now();const{instanceNo:b,transmuxer:S}=this,R=a?a.start:s.start,k=s.decryptdata,O=this.frag,B=!(O&&s.cc===O.cc),F=!(O&&h.level===O.level),V=O?h.sn-O.sn:-1,z=this.part?h.part-this.part.index:-1,re=V===0&&h.id>1&&h.id===(O==null?void 0:O.stats.chunkCount),Y=!F&&(V===1||V===0&&(z===1||re&&z<=0)),J=self.performance.now();(F||V||s.stats.parsing.start===0)&&(s.stats.parsing.start=J),a&&(z||!Y)&&(a.stats.parsing.start=J);const ee=!(O&&((y=s.initSegment)==null?void 0:y.url)===((_=O.initSegment)==null?void 0:_.url)),q=new Lu(B,Y,f,F,R,ee);if(!Y||B||ee){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===ue.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${B}
        trackSwitch: ${F}
        contiguous: ${Y}
        accurateTimeOffset: ${f}
        timeOffset: ${R}
        initSegmentChange: ${ee}`);const pe=new Au(i,r,t,c,v);this.configureTransmuxer(pe)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:b,cmd:"demux",data:e,decryptdata:k,chunkMeta:h,state:q},e instanceof ArrayBuffer?[e]:[]);else if(S){const pe=S.push(e,k,h,q);Va(pe)?pe.then(Ie=>{this.handleTransmuxComplete(Ie)}).catch(Ie=>{this.transmuxerError(Ie,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(pe)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const r=i.flush(e);Va(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const yl=100;class Iu extends Gn{constructor(e,t,i){super(e,t,i,"audio-stream-controller",ue.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){if(i===ue.MAIN){const a=t.cc,c=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:s},this.log(`InitPTS for cc: ${a} found from main: ${r}/${s}`),this.mainAnchor=t,this.state===ne.WAITING_INIT_PTS){const f=this.waitingData;(!f&&!this.loadingParts||f&&f.frag.cc!==a)&&this.syncWithAnchor(t,f==null?void 0:f.frag)}else!this.hls.hasEnoughToStart&&c&&c.cc!==a?(c.abortRequests(),this.syncWithAnchor(t,c)):this.state===ne.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const s=(r||e).cc,a=this.getLevelDetails(),c=this.getLoadPosition(),f=Cr(a,s,c);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===ne.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ne.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(yl),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ne.IDLE):this.state=ne.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ne.IDLE:this.doTickIdle();break;case ne.WAITING_TRACK:{const{levels:t,trackId:i}=this,r=t==null?void 0:t[i],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=ne.WAITING_INIT_PTS}break}case ne.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((r==null?void 0:r[s])||null),this.state=ne.IDLE}break}case ne.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:i,part:r,cache:s,complete:a}=t,c=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=ne.FRAG_LOADING;const f=s.flush().buffer,h={frag:i,part:r,payload:f,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else c&&c.cc!==t.frag.cc&&this.syncWithAnchor(c,t.frag)}else this.state=ne.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:r,trackId:s}=this,a=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(i!=null&&i[s]))return;const c=i[s],f=c.details;if(!f||this.waitForLive(c)||this.waitForCdnTuneIn(f)){this.state=ne.WAITING_TRACK,this.startFragRequested=!1;return}const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,Rt.AUDIO,ue.AUDIO));const v=this.getFwdBufferInfo(h,ue.AUDIO);if(v===null)return;if(!this.switchingTrack&&this._streamEnded(v,f)){t.trigger(x.BUFFER_EOS,{type:"audio"}),this.state=ne.ENDED;return}const y=v.len,_=t.maxBufferLength,b=f.fragments,S=b[0].start,R=this.getLoadPosition(),k=this.flushing?R:v.end;if(this.switchingTrack&&r){const F=R;f.PTSKnown&&F<S&&(v.end>S||v.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=S+.05)}if(y>=_&&!this.switchingTrack&&k<b[b.length-1].start)return;let O=this.getNextFragment(k,f);if(O&&this.isLoopLoading(O,k)&&(O=this.getNextFragmentLoopLoading(O,f,v,ue.MAIN,_)),!O){this.bufferFlushed=!0;return}let B=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&B&&Xt(O)&&!O.endList&&(!f.live||!this.loadingParts&&k<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(B)===ri.OK&&(this.mainFragLoading=B=null),B&&Xt(B))){if(O.start>B.end){const V=this.fragmentTracker.getFragAtPos(k,ue.MAIN);V&&V.end>B.end&&(B=V,this.mainFragLoading={frag:V,targetBufferTime:null})}if(O.start>B.end)return}this.loadFragment(O,c,k)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new pr(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ne.STOPPED&&(this.setInterval(yl),this.state=ne.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(x.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:r}=this,{details:s,id:a,groupId:c,track:f}=t;if(!r){this.warn(`Audio tracks reset while loading track ${a} "${f.name}" of "${c}"`);return}const h=this.mainDetails;if(!h||s.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==ne.STOPPED&&(this.state=ne.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${f.name}" of "${c}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const v=r[a];let y=0;if(s.live||(i=v.details)!=null&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(v.details){var _;y=this.alignPlaylists(s,v.details,(_=this.levelLastLoaded)==null?void 0:_.details)}s.alignedSliding||(en(s,h),s.alignedSliding||tn(s,h),y=s.fragmentStart)}v.details=s,this.levelLastLoaded=v,this.startFragRequested||this.setStartPosition(h,y),this.hls.trigger(x.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===ne.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=ne.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{config:a,trackId:c,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const h=f[c];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const v=h.details;if(!v){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const y=a.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let _=this.transmuxer;_||(_=this.transmuxer=new vl(this.hls,ue.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const b=this.initPTS[i.cc],S=(t=i.initSegment)==null?void 0:t.data;if(b!==void 0){const k=r?r.index:-1,O=k!==-1,B=new ts(i.level,i.sn,i.stats.chunkCount,s.byteLength,k,O);_.push(s,S,y,"",i,r,v.totalduration,!1,B,b)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${v.startSN} ,${v.endSN}],track ${c}`);const{cache:R}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new Vn,complete:!1};R.push(new Uint8Array(s)),this.state!==ne.STOPPED&&(this.state=ne.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ue.MAIN&&Xt(t.frag)&&(this.mainFragLoading=t,this.state===ne.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type!==ue.AUDIO){!this.audioOnly&&i.type===ue.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Xt(i)){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,ve({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case H.FRAG_GAP:case H.FRAG_PARSING_ERROR:case H.FRAG_DECRYPT_ERROR:case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ue.AUDIO,t);break;case H.AUDIO_TRACK_LOAD_ERROR:case H.AUDIO_TRACK_LOAD_TIMEOUT:case H.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===ye.AUDIO_TRACK&&(this.state=ne.IDLE);break;case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case H.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case H.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Rt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Rt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ne.ENDED&&(this.state=ne.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,ue.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:f,part:h,level:v}=c,{details:y}=v,{audio:_,text:b,id3:S,initSegment:R}=s;if(this.fragContextChanged(f)||!y){this.fragmentTracker.removeFragment(f);return}if(this.state=ne.PARSING,this.switchingTrack&&_&&this.completeAudioSwitch(this.switchingTrack),R!=null&&R.tracks){const k=f.initSegment||f;this._bufferInitSegment(v,R.tracks,k,a),r.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:i,tracks:R.tracks})}if(_){const{startPTS:k,endPTS:O,startDTS:B,endDTS:F}=_;h&&(h.elementaryStreams[Rt.AUDIO]={startPTS:k,endPTS:O,startDTS:B,endDTS:F}),f.setElementaryStreamInfo(Rt.AUDIO,k,O,B,F),this.bufferFragmentData(_,f,h,a)}if(S!=null&&(t=S.samples)!=null&&t.length){const k=me({id:i,frag:f,details:y},S);r.trigger(x.FRAG_PARSING_METADATA,k)}if(b){const k=me({id:i,frag:f,details:y},b);r.trigger(x.FRAG_PARSING_USERDATA,k)}}_bufferInitSegment(e,t,i,r){if(this.state!==ne.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=ue.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(x.BUFFER_CODECS,t);const c=s.initSegment;if(c!=null&&c.byteLength){const f={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:c};this.hls.trigger(x.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===ri.NOT_LOADED||r===ri.PARTIAL){var s;if(!Xt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ne.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&tn(t.details,a)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:c}=this.bufferedTrack;wi({name:t,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:c},e,gr)||(ce(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(x.AUDIO_TRACK_SWITCHED,ve({},e))}}class Uo extends mt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let a=0;a<r.length;a++){const c=r[a];let f;try{f=new self.URL(c.URI,t.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),f=c.URI||""}if(f===e){s=a;break}else f===e.substring(0,f.length)&&(s=a)}if(s!==-1){const a=r[s],c=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let f=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const v=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&v>t.partTarget&&(f+=1)}const h=i&&ji(i);return new An(c,f>=0?f:void 0,h)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:r,stats:s}=t,a=self.performance.now(),c=s.loading.first?Math.max(0,a-s.loading.first):0;r.advancedDateTime=Date.now()-c;const f=this.hls.config.timelineOffset;if(f!==r.appliedTimelineOffset){const v=Math.max(f||0,0);r.appliedTimelineOffset=v,r.fragments.forEach(y=>{y.start=y.playlistOffset+v})}if(r.live||i!=null&&i.live){const v="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){Bn(i,r);const B=r.playlistParsingError;if(B){this.warn(B);const F=this.hls;if(!F.config.ignorePlaylistParsingErrors){var h;const{networkDetails:V}=t;F.trigger(x.ERROR,{type:le.NETWORK_ERROR,details:H.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:B,reason:B.message,level:t.level||void 0,parent:(h=r.fragments[0])==null?void 0:h.type,networkDetails:V,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const y=this.hls.mainForwardBufferInfo,_=y?y.end-y.len:0,b=(r.edge-_)*1e3,S=Zs(r,b);if(r.requestScheduled+S<a?r.requestScheduled=a:r.requestScheduled+=S,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let R,k,O;if(r.canBlockReload&&r.endSN&&r.advanced){const B=this.hls.config.lowLatencyMode,F=r.lastPartSn,V=r.endSN,z=r.lastPartIndex,re=z!==-1,Y=F===V;re?Y?(k=V+1,O=B?0:z):(k=F,O=B?z+1:r.maxPartIndex):k=V+1;const J=r.age,ee=J+r.ageHeader;let q=Math.min(ee-r.partTarget,r.targetduration*1.5);if(q>0){if(ee>r.targetduration*3)this.log(`Playlist last advanced ${J.toFixed(2)}s ago. Omitting segment and part directives.`),k=void 0,O=void 0;else if(i!=null&&i.tuneInGoal&&ee-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${q} with playlist age: ${r.age}`),q=0;else{const pe=Math.floor(q/r.targetduration);if(k+=pe,O!==void 0){const Ie=Math.round(q%r.targetduration/r.partTarget);O+=Ie}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${J.toFixed(2)}s goal: ${q} skip sn ${pe} to part ${O}`)}r.tuneInGoal=q}if(R=this.getDeliveryDirectives(r,t.deliveryDirectives,k,O),B||!Y){r.requestScheduled=a,this.loadingPlaylist(v,R);return}}else(r.canBlockReload||r.canSkipUntil)&&(R=this.getDeliveryDirectives(r,t.deliveryDirectives,k,O));R&&k!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(S-c*2,S/2)),this.scheduleLoading(v,R,r)}else this.clearTimer()}scheduleLoading(e,t,i){const r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=r.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const c=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,i,r){let s=ji(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=fr.No),new An(i,r,s)}checkRetry(e){const t=e.details,i=Ci(e),r=e.errorAction,{action:s,retryCount:a=0,retryConfig:c}=r||{},f=!!r&&!!c&&(s===ft.RetryRequest||!r.resolved&&s===ft.SendAlternateToPenaltyBox);if(f){var h;if(a>=c.maxNumRetry)return!1;if(i&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const v=Ks(c,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),v),this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" in ${v}ms`)}e.levelRetry=!0,r.resolved=!0}return f}}function _l(o,e){if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!ja(o[t].attrs,e[t].attrs))return!1;return!0}function ja(o,e,t){const i=o["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>o[r]!==e[r])}function $o(o,e){return e.label.toLowerCase()===o.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(o.lang||"").toLowerCase())}class Cu extends Uo{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(c=>(r==null?void 0:r.indexOf(c))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(_=>!i||i.indexOf(_.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(_=>_.default)&&(this.selectDefaultTrack=!1),c.forEach((_,b)=>{_.id=b});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const f=this.hls.config.audioPreference;if(!s&&f){const _=wt(f,c,gr);if(_>-1)s=c[_];else{const b=wt(f,this.tracks);s=this.tracks[b]}}let h=this.findTrackId(s);h===-1&&s&&(h=this.findTrackId(null));const v={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,v);const y=this.trackId;if(h!==-1&&y===-1)this.setAudioTrack(h);else if(c.length&&y===-1){var a;const _=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${c.length}`);this.warn(_.message),this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:_})}}}onError(e,t){t.fatal||!t.context||t.context.type===ye.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&wi(e,r,gr))return r;const s=wt(e,this.tracksInGroup,gr);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(r){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const c=la(e,t.levels,i,a,gr);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const a=wt(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,ve({},r)),s))return;const a=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||wi(e,r,gr)))return i}if(e){const{name:i,lang:r,assocLang:s,characteristics:a,audioCodec:c,channels:f}=e;for(let h=0;h<t.length;h++){const v=t[h];if(wi({name:i,lang:r,assocLang:s,characteristics:a,audioCodec:c,channels:f},v,gr))return h}for(let h=0;h<t.length;h++){const v=t[h];if(ja(e.attrs,v.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){const v=t[h];if(ja(e.attrs,v.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&ce(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,c=a==null?void 0:a.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&a.live?" age "+c.toFixed(1)+(a.type?" "+a.type||0:""):""} ${s}`),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}}class ku{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var i;if(r.onError(s),this.queues===null||this.tracks===null)return;const a=(i=this.tracks[e])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],r=i==null?void 0:i.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const Tl=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,El="HlsJsTrackRemovedError";class Ru extends Error{constructor(e){super(e),this.name=El}}class wu extends mt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=Ms(Zi(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_APPENDING,this.onBufferAppending,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.BUFFER_EOS,this.onBufferEos,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.FRAG_PARSED,this.onFragParsed,this),e.on(x.FRAG_CHANGED,this.onFragChanged,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_APPENDING,this.onBufferAppending,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_EOS,this.onBufferEos,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.FRAG_PARSED,this.onFragParsed,this),e.off(x.FRAG_CHANGED,this.onFragChanged,this),e.off(x.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?me(i,r.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(i[a]=me({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media,r=Zi(this.appendSource);if(this.transferData=this.overrides=void 0,i&&r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(a),s)this._objectUrl=i.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");const f=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||f&&a instanceof f,bl(i),Du(i,c),i.load()}catch(f){i.src=c}else i.src=c}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,r=t.tracks,s=r?Object.keys(r):null,a=s?s.length:0,c=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(r&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${kt(i,(f,h)=>f==="initSegment"?void 0:h)};
transfer tracks: ${kt(r,(f,h)=>f==="initSegment"?void 0:h)}}`),!mn(r,i)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,h=this.details,v=Math.max(f,(h==null?void 0:h.fragments[0].start)||0);if(v-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${v}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${v} currentTime: ${f}`),this.onMediaDetaching(x.MEDIA_DETACHING,{}),this.onMediaAttaching(x.MEDIA_ATTACHING,t),e.currentTime=v;return}this.transferData=void 0,s.forEach(f=>{const h=f,v=r[h];if(v){const y=v.buffer;if(y){const _=this.fragmentTracker,b=v.id;if(_.hasFragments(b)||_.hasParts(b)){const k=st.getBuffered(y);_.detectEvictedFragments(h,k,b,null,!0)}const S=Ho(h),R=[h,y];this.sourceBuffers[S]=R,y.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,v)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=s.readyState==="open";try{const f=s.sourceBuffers;for(let h=f.length;h--;)c&&f[h].abort(),s.removeSourceBuffer(f[h]);c&&s.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(r.removeAttribute("src"),this.appendSource&&bl(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(x.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ho(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new ku(this.tracks)}onBufferCodecs(e,t){const i=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),a=!s&&this.sourceBufferCount&&this.media&&r.some(c=>!i[c]);if(s||a){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`);return}r.forEach(c=>{var f,h,v;const y=t[c],{id:_,codec:b,levelCodec:S,container:R,metadata:k,supplemental:O}=y;let B=i[c];const F=(f=this.transferData)==null||(h=f.tracks)==null?void 0:h[c],V=F!=null&&F.buffer?F:B,z=(V==null?void 0:V.pendingCodec)||(V==null?void 0:V.codec),re=V==null?void 0:V.levelCodec;B||(B=i[c]={buffer:void 0,listeners:[],codec:b,supplemental:O,container:R,levelCodec:S,metadata:k,id:_});const Y=ci(z,re),J=Y==null?void 0:Y.replace(Tl,"$1");let ee=ci(b,S);const q=(v=ee)==null?void 0:v.replace(Tl,"$1");ee&&Y&&J!==q&&(c.slice(0,5)==="audio"&&(ee=Li(ee,this.appendSource)),this.log(`switching codec ${z} to ${ee}`),ee!==(B.pendingCodec||B.codec)&&(B.pendingCodec=ee),B.container=R,this.appendChangeType(c,R,ee))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const r=`${t};codecs=${i}`,s={label:`change-type=${r}`,execute:()=>{const a=this.tracks[e];if(a){const c=a.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),c.changeType(r),a.codec=i,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,ue.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var c;const f=this.tracks.video;(this.lastVideoAppendEnd>r||f!=null&&f.buffer&&st.isBuffered(f.buffer,r)||((c=this.fragmentTracker.getAppendedFrag(r,ue.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:r,type:s,parent:a,frag:c,part:f,chunkMeta:h,offset:v}=t,y=h.buffering[s],{sn:_,cc:b}=c,S=self.performance.now();y.start=S;const R=c.stats.buffering,k=f?f.stats.buffering:null;R.start===0&&(R.start=S),k&&k.start===0&&(k.start=S);const O=i.audio;let B=!1;s==="audio"&&(O==null?void 0:O.container)==="audio/mpeg"&&(B=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const F=i.video,V=F==null?void 0:F.buffer;if(V&&_!=="initSegment"){const Y=f||c,J=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend){const q=Y.start+Y.duration*.05,pe=V.buffered,Ie=this.currentOp("video");!pe.length&&!Ie?this.blockAudio(Y):!Ie&&!st.isBuffered(V,q)&&this.lastVideoAppendEnd<q&&this.blockAudio(Y)}else if(s==="video"){const ee=Y.end;if(J){const q=J.frag.start;(ee>q||ee<this.lastVideoAppendEnd||st.isBuffered(V,q))&&this.unblockAudio()}this.lastVideoAppendEnd=ee}}const z=(f||c).start,re={label:`append-${s}`,execute:()=>{var Y;y.executeStart=self.performance.now();const J=(Y=this.tracks[s])==null?void 0:Y.buffer;J&&(B?this.updateTimestampOffset(J,z,.1,s,_,b):v!==void 0&&N(v)&&this.updateTimestampOffset(J,v,1e-6,s,_,b)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const Y=self.performance.now();y.executeEnd=y.end=Y,R.first===0&&(R.first=Y),k&&k.first===0&&(k.first=Y);const J={};this.sourceBuffers.forEach(([ee,q])=>{ee&&(J[ee]=st.getBuffered(q))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:s,frag:c,part:f,chunkMeta:h,parent:c.type,timeRanges:J})},onError:Y=>{var J;const ee={type:le.MEDIA_ERROR,parent:c.type,details:H.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:c,part:f,chunkMeta:h,error:Y,err:Y,fatal:!1},q=(J=this.media)==null?void 0:J.error;if(Y.code===DOMException.QUOTA_EXCEEDED_ERR||Y.name=="QuotaExceededError"||"quota"in Y)ee.details=H.BUFFER_FULL_ERROR;else if(Y.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!q)ee.errorAction=jt(!0);else if(Y.name===El&&this.sourceBufferCount===0)ee.errorAction=jt(!0);else{const pe=++this.appendErrors[s];this.warn(`Failed ${pe}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${q||"no media error"})`),(pe>=this.hls.config.appendErrorMaxRetry||q)&&(ee.fatal=!0)}this.hls.trigger(x.ERROR,ee)}};this.append(re,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:i,startOffset:r,endOffset:s}=t;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,r,s),a)})}onFragParsed(e,t){const{frag:i,part:r}=t,s=[],a=r?r.elementaryStreams:i.elementaryStreams;a[Rt.AUDIOVIDEO]?s.push("audiovideo"):(a[Rt.AUDIO]&&s.push("audio"),a[Rt.VIDEO]&&s.push("video"));const c=()=>{const f=self.performance.now();i.stats.buffering.end=f,r&&(r.stats.buffering.end=f);const h=r?r.stats:i.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:i,part:r,stats:h,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(c,s).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,i;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((i=this.tracks[e])==null?void 0:i.ending))})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([a])=>{if(a){const c=this.tracks[a];(!t.type||t.type===a)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${a} buffer reached EOS`)))}});const r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var c;return a&&!((c=this.tracks[a])!=null&&c.ended)})&&(r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(x.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(x.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===H.BUFFER_APPEND_ERROR&&t.frag){var i;const r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;N(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const r=e.config,s=i.currentTime,a=t.levelTargetDuration,c=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(N(c)&&c>=0){const f=Math.max(c,a),h=Math.floor(s/a)*a-f;this.flushBackBuffer(s,a,h)}if(N(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const f=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),h=Math.max(f,a),v=Math.floor(s/a)*a+h;this.flushFrontBuffer(s,a,v)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const c=st.getBuffered(s);if(c.length>0&&i>c.start(0)){var a;this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:i});const f=this.tracks[r];if((a=this.details)!=null&&a.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(f!=null&&f.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=st.getBuffered(s),c=a.length;if(c<2)return;const f=a.start(c-1),h=a.end(c-1);if(i>f||e>=f&&e<=h)return;this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&i.setLiveSeekableRange){const h=Math.max(0,t.fragmentStart),v=Math.max(h,r);return{duration:1/0,start:h,end:v}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return N(s)?{duration:s}:null;const a=this.media.duration,c=N(i.duration)?i.duration:0;return r>c&&r>a||!N(a)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(N(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${kt(i)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(x.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,c=e[a];if(this.isPending(c)){const f=this.getTrackCodec(c,a),h=`${c.container};codecs=${f}`;c.codec=f,this.log(`creating sourceBuffer(${h})${this.currentOp(a)?" Queued":""} ${kt(c)}`);try{const v=i.addSourceBuffer(h),y=Ho(a),_=[a,v];t[y]=_,c.buffer=v}catch(v){var r;this.error(`error while trying to add sourceBuffer: ${v.message}`),this.shiftAndExecuteNext(a),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[a],this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:v,sourceBufferName:a,mimeType:h,parent:c.id});return}this.trackSourceBuffer(a,c)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let r=e.codec;i&&(t==="video"||t==="audiovideo")&&Vr(i,"video")&&(r=bn(r,i));const s=ci(r,e.levelCodec);return s?t.slice(0,5)==="audio"?Li(s,this.appendSource):s:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const c=a.removedRanges;c!=null&&c.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,i,r,s,a){const c=t-e.timestampOffset;Math.abs(c)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:r,mediaSource:s}=this,a=this.tracks[e],c=a==null?void 0:a.buffer;if(!r||!s||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=N(r.duration)?r.duration:1/0,h=N(s.duration)?s.duration:1/0,v=Math.max(0,t),y=Math.min(i,f,h);y>v&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${v},${y}] from the ${e} SourceBuffer`),c.remove(v,y)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],r=i==null?void 0:i.buffer;if(!r)throw new Ru(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(a=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const a=i.bind(this,e);r.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function bl(o){const e=o.querySelectorAll("source");[].slice.call(e).forEach(t=>{o.removeChild(t)})}function Du(o,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,o.appendChild(t)}function Ho(o){return o==="audio"?1:0}class Go{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&N(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,Go.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const r=(c,f)=>f?c.width!==f.width||c.height!==f.height:!0;let s=e.length-1;const a=Math.max(t,i);for(let c=0;c<e.length;c+=1){const f=e[c];if((f.width>=a||f.height>=a)&&r(f,e[c+1])){s=c;break}}return s}}const Wi={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Pu={HLS:"h"},Ka={OBJECT:"CMCD-Object",REQUEST:"CMCD-Request",SESSION:"CMCD-Session",STATUS:"CMCD-Status"},Ou={[Ka.OBJECT]:["br","ab","d","ot","tb","tpb","lb","tab","lab","url"],[Ka.REQUEST]:["pb","bl","tbl","dl","ltc","mtp","nor","nrr","rc","sn","sta","su","ttfb","ttfbb","ttlb","cmsdd","cmsds","smrt","df","cs"],[Ka.SESSION]:["cid","pr","sf","sid","st","v","msd"],[Ka.STATUS]:["bs","bsd","cdn","rtp","bg","pt","ec","e"]};class Jn{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof Jn?i:new Jn(i))),this.value=e,this.params=t}}const Mu="Dict";function Fu(o){return Array.isArray(o)?JSON.stringify(o):o instanceof Map?"Map{}":o instanceof Set?"Set{}":typeof o=="object"?JSON.stringify(o):String(o)}function Nu(o,e,t,i){return new Error(`failed to ${o} "${Fu(e)}" as ${t}`,{cause:i})}function Pr(o,e,t){return Nu("serialize",o,e,t)}class Sl{constructor(e){this.description=e}}const xl="Bare Item",Bu="Boolean";function Uu(o){if(typeof o!="boolean")throw Pr(o,Bu);return o?"?1":"?0"}function $u(o){return btoa(String.fromCharCode(...o))}const Hu="Byte Sequence";function Gu(o){if(ArrayBuffer.isView(o)===!1)throw Pr(o,Hu);return`:${$u(o)}:`}const Vu="Integer";function ju(o){return o<-999999999999999||999999999999999<o}function Al(o){if(ju(o))throw Pr(o,Vu);return o.toString()}function Ku(o){return`@${Al(o.getTime()/1e3)}`}function Ll(o,e){if(o<0)return-Ll(-o,e);const t=Math.pow(10,e);if(Math.abs(o*t%1-.5)<Number.EPSILON){const r=Math.floor(o*t);return(r%2===0?r:r+1)/t}else return Math.round(o*t)/t}const qu="Decimal";function Wu(o){const e=Ll(o,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Pr(o,qu);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Yu="String",zu=/[\x00-\x1f\x7f]+/;function Xu(o){if(zu.test(o))throw Pr(o,Yu);return`"${o.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Qu(o){return o.description||o.toString().slice(7,-1)}const Ju="Token";function Il(o){const e=Qu(o);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Pr(e,Ju);return e}function Vo(o){switch(typeof o){case"number":if(!N(o))throw Pr(o,xl);return Number.isInteger(o)?Al(o):Wu(o);case"string":return Xu(o);case"symbol":return Il(o);case"boolean":return Uu(o);case"object":if(o instanceof Date)return Ku(o);if(o instanceof Uint8Array)return Gu(o);if(o instanceof Sl)return Il(o);default:throw Pr(o,xl)}}const Zu="Key";function jo(o){if(/^[a-z*][a-z0-9\-_.*]*$/.test(o)===!1)throw Pr(o,Zu);return o}function Ko(o){return o==null?"":Object.entries(o).map(([e,t])=>t===!0?`;${jo(e)}`:`;${jo(e)}=${Vo(t)}`).join("")}function Cl(o){return o instanceof Jn?`${Vo(o.value)}${Ko(o.params)}`:Vo(o)}function ec(o){return`(${o.value.map(Cl).join(" ")})${Ko(o.params)}`}function tc(o,e={whitespace:!0}){if(typeof o!="object")throw Pr(o,Mu);const t=o instanceof Map?o.entries():Object.entries(o),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof Jn||(s=new Jn(s));let a=jo(r);return s.value===!0?a+=Ko(s.params):(a+="=",Array.isArray(s.value)?a+=ec(s):a+=Cl(s)),a}).join(`,${i}`)}function ic(o,e){return tc(o,e)}function rc(o){return["ot","sf","st","e","sta"].includes(o)}function sc(o){return typeof o=="number"?N(o):o!=null&&o!==""&&o!==!1}function nc(o,e){const t=new URL(o),i=new URL(e);if(t.origin!==i.origin)return o;const r=t.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")}const vo=o=>Math.round(o),ac=(o,e)=>(e!=null&&e.baseUrl&&(o=nc(o,e.baseUrl)),encodeURIComponent(o)),yo=o=>vo(o/100)*100,oc={br:vo,d:vo,bl:yo,dl:yo,mtp:yo,nor:ac,rtp:yo,tb:vo};function lc(o,e){const t={};if(o==null||typeof o!="object")return t;const i=Object.keys(o).sort(),r=me({},oc,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return i.forEach(a=>{if((s==null?void 0:s(a))===!1)return;let c=o[a];const f=r[a];f&&(c=f(c,e)),!(a==="v"&&c===1)&&(a=="pr"&&c===1||sc(c)&&(rc(a)&&typeof c=="string"&&(c=new Sl(c)),t[a]=c))}),t}function kl(o,e={}){return o?ic(lc(o,e),me({whitespace:!1},e)):""}function uc(o,e={}){const t={};if(!o)return t;const i=Object.entries(o),r=Object.entries(Ou).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=i.reduce((a,c)=>{var f,h;const[v,y]=c,_=((f=r.find(b=>b[1].includes(v)))===null||f===void 0?void 0:f[0])||Ka.REQUEST;return(h=a[_])!==null&&h!==void 0||(a[_]={}),a[_][v]=y,a},{});return Object.entries(s).reduce((a,[c,f])=>(a[c]=kl(f,e),a),t)}function cc(o,e,t){return me(o,uc(e,t))}const hc="CMCD";function dc(o,e={}){if(!o)return"";const t=kl(o,e);return`${hc}=${encodeURIComponent(t)}`}const Rl=/CMCD=[^&#]+/;function fc(o,e,t){const i=dc(e,t);if(!i)return o;if(Rl.test(o))return o.replace(Rl,i);const r=o.includes("?")?"&":"?";return`${o}${r}${i}`}class pc{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Wi.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:a}=r,c=this.hls.levels[s.level],f=this.getObjectType(s),h={d:(a||s).duration*1e3,ot:f};(f===Wi.VIDEO||f===Wi.AUDIO||f==Wi.MUXED)&&(h.br=c.bitrate/1e3,h.tb=this.getTopBandwidth(f)/1e3,h.bl=this.getBufferLength(f));const v=a?this.getNextPart(a):this.getNextFrag(s);v!=null&&v.url&&v.url!==s.url&&(h.nor=v.url),this.apply(r,h)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHED,this.onMediaDetached,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHED,this.onMediaDetached,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:Pu.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){me(t,this.createData());const i=t.ot===Wi.INIT||t.ot===Wi.VIDEO||t.ot===Wi.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((a,c)=>(r.includes(c)&&(a[c]=t[c]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),cc(e.headers,t,s)):e.url=fc(e.url,t,s)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t,i;const{index:r,fragment:s}=e,a=(t=this.hls.levels[s.level])==null||(i=t.details)==null?void 0:i.partList;if(a){const{sn:c}=s;for(let f=a.length-1;f>=0;f--){const h=a[f];if(h.index===r&&h.fragment.sn===c)return a[f+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Wi.TIMED_TEXT;if(e.sn==="initSegment")return Wi.INIT;if(t==="audio")return Wi.AUDIO;if(t==="main")return this.hls.audioTracks.length?Wi.VIDEO:Wi.MUXED}getTopBandwidth(e){let t=0,i;const r=this.hls;if(e===Wi.AUDIO)i=r.audioTracks;else{const s=r.maxAutoLevel,a=s>-1?s+1:r.levels.length;i=r.levels.slice(0,a)}return i.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Wi.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:st.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,c){t(s),this.loader.load(s,a,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,c){t(s),this.loader.load(s,a,c)}}}}const gc=3e5;class mc extends mt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===ft.SendAlternateToPenaltyBox&&i.flags===Kt.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:c,pathwayId:f,type:h}=t.context;c&&r?a=this.getPathwayForGroupId(c,h,a):f&&(a=f)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==a),t.details===H.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${r&&r.length} priorities: ${kt(s)} penalized: ${kt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>gc&&delete i[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in i)continue;if(a===this.pathwayId)return;const c=this.hls.nextLoadLevel,f=this.hls.levels[c];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,va(t),this.hls.trigger(x.LEVELS_UPDATED,{levels:t});const h=this.hls.levels[c];f&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===ye.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===ye.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach(s=>{const{ID:a,"BASE-ID":c,"URI-REPLACEMENT":f}=s;if(t.some(v=>v.pathwayId===a))return;const h=this.getLevelsForPathway(c).map(v=>{const y=new U(v.attrs);y["PATHWAY-ID"]=a;const _=y.AUDIO&&`${y.AUDIO}_clone_${a}`,b=y.SUBTITLES&&`${y.SUBTITLES}_clone_${a}`;_&&(i[y.AUDIO]=_,y.AUDIO=_),b&&(r[y.SUBTITLES]=b,y.SUBTITLES=b);const S=Dl(v.uri,y["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),R=new pr({attrs:y,audioCodec:v.audioCodec,bitrate:v.bitrate,height:v.height,name:v.name,url:S,videoCodec:v.videoCodec,width:v.width});if(v.audioGroups)for(let k=1;k<v.audioGroups.length;k++)R.addGroupId("audio",`${v.audioGroups[k]}_clone_${a}`);if(v.subtitleGroups)for(let k=1;k<v.subtitleGroups.length;k++)R.addGroupId("text",`${v.subtitleGroups[k]}_clone_${a}`);return R});t.push(...h),wl(this.audioTracks,i,f,a),wl(this.subtitleTracks,r,f,a)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch(v){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const v=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+v)}const s={responseType:"json",url:r.href},a=t.steeringManifestLoadPolicy.default,c=a.errorRetry||a.timeoutRetry||{},f={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},h={onSuccess:(v,y,_,b)=>{this.log(`Loaded steering manifest: "${r}"`);const S=v.data;if((S==null?void 0:S.VERSION)!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":R,"PATHWAY-CLONES":k,"PATHWAY-PRIORITY":O}=S;if(R)try{this.uri=new self.URL(R,r).href}catch(F){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${R}`);return}this.scheduleRefresh(this.uri||_.url),k&&this.clonePathways(k);const B={steeringManifest:S,url:r.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,B),O&&this.updatePathwayPriority(O)},onError:(v,y,_,b)=>{if(this.log(`Error loading steering manifest: ${v.code} ${v.text} (${y.url})`),this.stopLoad(),v.code===410){this.enabled=!1,this.log(`Steering manifest ${y.url} no longer available`);return}let S=this.timeToLoad*1e3;if(v.code===429){const R=this.loader;if(typeof(R==null?void 0:R.getResponseHeader)=="function"){const k=R.getResponseHeader("Retry-After");k&&(S=parseFloat(k)*1e3)}this.log(`Steering manifest ${y.url} rate limited`);return}this.scheduleRefresh(this.uri||y.url,S)},onTimeout:(v,y,_)=>{this.log(`Timeout loading steering manifest (${y.url})`),this.scheduleRefresh(this.uri||y.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,f,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function wl(o,e,t,i){o&&Object.keys(e).forEach(r=>{const s=o.filter(a=>a.groupId===r).map(a=>{const c=me({},a);return c.details=void 0,c.attrs=new U(c.attrs),c.url=c.attrs.URI=Dl(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[r],c.attrs["PATHWAY-ID"]=i,c});o.push(...s)})}function Dl(o,e,t,i){const{HOST:r,PARAMS:s,[t]:a}=i;let c;e&&(c=a==null?void 0:a[e],c&&(o=c));const f=new self.URL(o);return r&&!c&&(f.host=r),s&&Object.keys(s).sort().forEach(h=>{h&&f.searchParams.set(h,s[h])}),f.href}function lr(o,e,t){_r(o,e,t),o.addEventListener(e,t)}function _r(o,e,t){o.removeEventListener(e,t)}class Zn extends mt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Zn.CDMCleanupPromise?[Zn.CDMCleanupPromise]:[],this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(x.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===he.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(a,c,f)=>!!a&&f.indexOf(a)===c,r=t.map(a=>a.audioCodec).filter(i),s=t.map(a=>a.videoCodec).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,c)=>{const f=h=>{const v=h.shift();this.getMediaKeysPromise(v,r,s).then(y=>a({keySystem:v,mediaKeys:y})).catch(y=>{h.length?f(h):y instanceof ur?c(y):c(new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_ACCESS,error:y,fatal:!0},y.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return dt===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,t)}getMediaKeysPromise(e,t,i){const r=$t(e,t,i,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${kt(r)}`),a=this.requestMediaKeySystemAccess(e,r);const c=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(f=>{this.log(`Failed to obtain access to key-system "${e}": ${f}`)}),a.then(f=>{this.log(`Access for key-system "${f.keySystem}" obtained`);const h=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),c.mediaKeys=f.createMediaKeys().then(v=>(this.log(`Media-keys created for "${e}"`),c.hasMediaKeys=!0,h.then(y=>y?this.setMediaKeysServerCertificate(v,e,y):v))),c.mediaKeys.catch(v=>{this.error(`Failed to create media-keys for "${e}"}: ${v}`)}),c.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Mi.hexDump(e.keyId||[])}`);const r=i.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Mi.hexDump(e.keyId)}updateKeySession(e,t){var i;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${Mi.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Ne(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const s=Ne(r);s?t(s):i(new Error(`Unable to find format for key-system "${r}"`))}).catch(i))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=nt(this.config),i=e.map(Re).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(i)}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[i];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:c,mediaKeys:f})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(c,f).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:f,decryptdata:t}))))),(this.keyIdToKeySessionPromise[i]=s.then(c=>{const f="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,f,h,"playlist-key")})).catch(c=>this.handleError(c))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof ur?this.hls.trigger(x.ERROR,e.data):this.hls.trigger(x.ERROR,{type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const r=Re(e.keyFormat),s=r?[r]:nt(this.config);return this.attemptKeySystemAccess(s)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=nt(this.config)),e.length===0)throw new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${kt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>i.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,i,r){var s,a;const c=(s=this.config.drmSystems)==null||(a=s[e.keySystem])==null?void 0:a.generateRequest;if(c)try{const S=c.call(this.hls,t,i,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,i=S.initData?S.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(S){var f;if(this.warn(S.message),(f=this.hls)!=null&&f.config.debug)throw S}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const h=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${h} (init data type: ${t} length: ${i?i.byteLength:null})`);const v=new Rr,y=e._onmessage=S=>{const R=e.mediaKeysSession;if(!R){v.emit("error",new Error("invalid state"));return}const{messageType:k,message:O}=S;this.log(`"${k}" message event for session "${R.sessionId}" message size: ${O.byteLength}`),k==="license-request"||k==="license-renewal"?this.renewLicense(e,O).catch(B=>{v.eventNames().length?v.emit("error",B):this.handleError(B)}):k==="license-release"?e.keySystem===he.FAIRPLAY&&(this.updateKeySession(e,it("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${k}"`)},_=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){v.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const k=e.keyStatus;v.emit("keyStatus",k),k==="expired"&&(this.warn(`${e.keySystem} expired for key ${h}`),this.renewKeySession(e))};lr(e.mediaKeysSession,"message",y),lr(e.mediaKeysSession,"keystatuseschange",_);const b=new Promise((S,R)=>{v.on("error",R),v.on("keyStatus",k=>{k.startsWith("usable")?S():k==="output-restricted"?R(new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):k==="internal-error"?R(new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${k}"`)):k==="expired"?R(new Error("key expired while generating request")):this.warn(`unhandled key status change "${k}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var S;this.log(`Request generated for key-session "${(S=e.mediaKeysSession)==null?void 0:S.sessionId}" keyId: ${h}`)}).catch(S=>{throw new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_SESSION,error:S,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>b).catch(S=>{throw v.removeAllListeners(),this.removeSession(e),S}).then(()=>(v.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{if(typeof i=="string"&&typeof t=="object"){const r=i;i=t,t=r}this.log(`key status change "${t}" for keyStatuses keyId: ${Mi.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Mi.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,r=new i(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,c)=>{const f={responseType:"arraybuffer",url:s},h=t.certLoadPolicy.default,v={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},y={onSuccess:(_,b,S,R)=>{a(_.data)},onError:(_,b,S,R)=>{c(new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:ve({url:f.url,data:void 0},_)},`"${e}" certificate request failed (${s}). Status: ${_.code} (${_.text})`))},onTimeout:(_,b,S)=>{c(new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(_,b,S)=>{c(new Error("aborted"))}};r.load(f,v,y)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,s)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),r(e)}).catch(a=>{s(new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(i,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let v;for(let y=0,_=s.length;y<_;y++){var a,c;v=s[y];const b=(a=v.querySelector("name"))==null?void 0:a.textContent,S=(c=v.querySelector("value"))==null?void 0:c.textContent;b&&S&&e.setRequestHeader(b,S)}}const f=r.querySelector("Challenge"),h=f==null?void 0:f.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return it(atob(h))}setupLicenseXHR(e,t,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,i,r)}).catch(a=>{if(!i.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,i,r)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let f=c.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const h=this.config.licenseResponseCallback;if(h)try{f=h.call(this.hls,c,a,e)}catch(v){this.error(v)}r(f)}else{const f=i.errorRetry,h=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||c.status>=400&&c.status<500)s(new ur({type:le.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:a,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${a}). Status: ${c.status} (${c.statusText})`));else{const v=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${v} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,a,e,t).then(({xhr:f,licenseChallenge:h})=>{e.keySystem==he.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(f,h)),f.send(h)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,lr(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(_r(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Xi.clearKeyUriToKeyIdMap();const r=i.length;Zn.CDMCleanupPromise=Promise.all(i.map(s=>this.removeSession(s)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(s=>{var a;this.log(`Could not clear media keys: ${s}`),(a=this.hls)==null||a.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).catch(s=>{var a;this.log(`Could not close sessions and clear media keys: ${s}`),(a=this.hls)==null||a.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{drmSystemOptions:s}=this.config;return(vt(s)?new Promise((c,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c)}):Promise.resolve()).catch(c=>{var f;this.log(`Could not remove session: ${c}`),(f=this.hls)==null||f.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{var f;this.log(`Could not close session: ${c}`),(f=this.hls)==null||f.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}}}Zn.CDMCleanupPromise=void 0;class ur extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class vc{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,a=i-this.lastDroppedFrames,c=t-this.lastDecodedFrames,f=1e3*a/s,h=this.hls;if(h.trigger(x.FPS_DROP,{currentDropped:a,currentDecoded:c,totalDroppedFrames:i}),f>0&&a>h.config.fpsDroppedMonitoringThreshold*c){let v=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+v),v>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=v)&&(v=v-1,h.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:v,droppedLevel:h.currentLevel}),h.autoLevelCapping=v,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Pl(o,e){let t;try{t=new Event("addtrack")}catch(i){t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=o,e.dispatchEvent(t)}function Ol(o,e){const t=o.mode;if(t==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(e.id))try{if(o.addCue(e),!o.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){At.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,o.addCue(r)}catch(r){At.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(o.mode=t)}function ea(o,e){const t=o.mode;if(t==="disabled"&&(o.mode="hidden"),o.cues)for(let i=o.cues.length;i--;)e&&o.cues[i].removeEventListener("enter",e),o.removeCue(o.cues[i]);t==="disabled"&&(o.mode=t)}function qo(o,e,t,i){const r=o.mode;if(r==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0){const s=_c(o.cues,e,t);for(let a=0;a<s.length;a++)(!i||i(s[a]))&&o.removeCue(s[a])}r==="disabled"&&(o.mode=r)}function yc(o,e){if(e<=o[0].startTime)return 0;const t=o.length-1;if(e>o[t].endTime)return-1;let i=0,r=t,s;for(;i<=r;)if(s=Math.floor((r+i)/2),e<o[s].startTime)r=s-1;else if(e>o[s].startTime&&i<t)i=s+1;else return s;return o[i].startTime-e<e-o[r].startTime?i:r}function _c(o,e,t){const i=[],r=yc(o,e);if(r>-1)for(let s=r,a=o.length;s<a;s++){const c=o[s];if(c.startTime>=e&&c.endTime<=t)i.push(c);else if(c.startTime>t)return i}return i}function _o(o){const e=[];for(let t=0;t<o.length;t++){const i=o[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(o[t])}return e}class Tc extends Uo{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=_o(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;_o(i.textTracks).forEach(a=>{ea(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(v=>!i||i.indexOf(v.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(v=>v.default)&&(this.selectDefaultTrack=!1),a.forEach((v,y)=>{v.id=y});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const c=this.hls.config.subtitlePreference;if(!s&&c){this.selectDefaultTrack=!1;const v=wt(c,a);if(v>-1)s=a[v];else{const y=wt(c,this.tracks);s=this.tracks[y]}}let f=this.findTrackId(s);f===-1&&s&&(f=this.findTrackId(null));const h={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,h),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(i&&!s.default||!i&&!e)&&(!e||wi(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(ja(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(ja(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if($o(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ye.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&wi(e,i))return i;const r=wt(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{const s=wt(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,c=a==null?void 0:a.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&a.live?" age "+c.toFixed(1)+(a.type?" "+a.type||0:""):""} ${s}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=_o(e.textTracks),i=this.currentTrack;let r;if(i&&(r=t.filter(s=>$o(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!N(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:a,groupId:c="",name:f,type:h,url:v}=r;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:a,groupId:c,name:f,type:h,url:v});const y=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(y)}}function Ec(){try{return crypto.randomUUID()}catch(o){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function qa(o){let e=5381,t=o.length;for(;t;)e=e*33^o.charCodeAt(--t);return(e>>>0).toString()}const ta=.025;let To=function(o){return o[o.Point=0]="Point",o[o.Range=1]="Range",o}({});function bc(o,e,t){return`${o.identifier}-${t+1}-${qa(e)}`}class Sc{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Wo(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Wo(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=N(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Wo(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ta))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?To.Range:To.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return xc(this)}}function Wo(o,e){return o-e.start<e.duration/2&&!(Math.abs(o-(e.start+e.duration))<ta)?e.start:e.start+e.duration}function Ml(o,e,t){const i=new self.URL(o,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function Yo(o,e){for(;(t=o.assetList[++e])!=null&&t.error;)var t;return e}function xc(o){return`["${o.identifier}" ${o.cue.pre?"<pre>":o.cue.post?"<post>":""}${o.timelineStart.toFixed(2)}-${o.resumeTime.toFixed(2)}]`}function ia(o){const e=o.timelineStart,t=o.duration||0;return`["${o.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Ac{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(x.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=i,this.assetItem=r;let a=r.uri;try{a=Ml(a,t.primarySessionId).href}catch(f){}s.loadSource(a);const c=()=>{this.hasDetails=!0};s.once(x.LEVEL_LOADED,c),s.once(x.AUDIO_TRACK_LOADED,c),s.once(x.SUBTITLE_TRACK_LOADED,c),s.on(x.MEDIA_ATTACHING,(f,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(x.BUFFER_APPENDED,()=>{const y=this.bufferedEnd;this.reachedPlayout(y)&&(this._bufferedEosTime=y,s.trigger(x.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const i=this.timelineOffset,r=st.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=st.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>11111111111111112e-21){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){this.hls.on(e,t)}once(e,t,i){this.hls.once(e,t)}off(e,t,i){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ia(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Fl=.033;class Lc extends mt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(s=r[i])!=null&&s.event;){var s;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){const s=i[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){const i=e.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){const a=i[s];if(!a.error){const c=a.timelineStart;if(t===c||t>c&&t<c+(a.duration||0))return s}}return 0}get assetIdAtEnd(){var e,t;const i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){const r=i.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:r}=i,s=this.events,a=this.parseDateRanges(r,{url:i.url},t),c=Object.keys(r),f=s?s.filter(h=>!c.includes(h.identifier)):[];a.length&&a.sort((h,v)=>{const y=h.cue.pre,_=h.cue.post,b=v.cue.pre,S=v.cue.post;if(y&&!b)return-1;if(b&&!y||_&&!S)return 1;if(S&&!_)return-1;if(!y&&!b&&!_&&!S){const R=h.startTime,k=v.startTime;if(R!==k)return R-k}return h.dateRange.tagOrder-v.dateRange.tagOrder}),this.events=a,f.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(e,f)}updateSchedule(e,t=[]){const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,s=this.parseSchedule(i,e);(t.length||(r==null?void 0:r.length)!==s.length||s.some((c,f)=>Math.abs(c.playout.start-r[f].playout.start)>.005||Math.abs(c.playout.end-r[f].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,i){const r=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const c=s[a],f=e[c];if(f.isInterstitial){let h=this.eventMap[c];h?h.setDateRange(f):(h=new Sc(f,t),this.eventMap[c]=h,i===!1&&(h.appendInPlace=i)),r.push(h)}}return r}parseSchedule(e,t){const i=[],r=t.main.details,s=r.live?1/0:r.edge;let a=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,h=0;if(e.forEach((v,y)=>{const _=v.cue.pre,b=v.cue.post,S=e[y-1]||null,R=v.appendInPlace,k=b?s:v.startOffset,O=v.duration,B=v.timelineOccupancy===To.Range?O:0,F=v.resumptionOffset,V=(S==null?void 0:S.startTime)===k,z=k+v.cumulativeDuration;let re=R?z+O:k+F;if(_||!b&&k<=0){const J=h;h+=B,v.timelineStart=z;const ee=a;a+=O,i.push({event:v,start:z,end:re,playout:{start:ee,end:a},integrated:{start:J,end:h}})}else if(k<=s){if(!V){const q=k-f;if(q>Fl){const pe=f,Ie=h;h+=q;const Xe=a;a+=q;const Ve={previousEvent:e[y-1]||null,nextEvent:v,start:pe,end:pe+q,playout:{start:Xe,end:a},integrated:{start:Ie,end:h}};i.push(Ve)}else q>0&&S&&(S.cumulativeDuration+=q,i[i.length-1].end=k)}b&&(re=z),v.timelineStart=z;const J=h;h+=B;const ee=a;a+=O,i.push({event:v,start:z,end:re,playout:{start:ee,end:a},integrated:{start:J,end:h}})}else return;const Y=v.resumeTime;b||Y>s?f=s:f=Y}),f<s){var c;const v=f,y=h,_=s-f;h+=_;const b=a;a+=_,i.push({previousEvent:((c=i[i.length-1])==null?void 0:c.event)||null,nextEvent:null,start:f,end:v+_,playout:{start:b,end:a},integrated:{start:y,end:h}})}this.setDurations(s,a,h)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,r=i.live?1/0:i.edge;let s=0,a=-1;e.forEach((c,f)=>{const h=c.cue.pre,v=c.cue.post,y=h?0:v?r:c.startTime;this.updateAssetDurations(c),a===y?c.cumulativeDuration=s:(s=0,a=y),!v&&c.snapOptions.in&&(c.resumeAnchor=Ti(null,i.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<Fl&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const b=N(c.resumeOffset)?c.resumeOffset:c.duration;s+=b})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>ta?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):t?!Object.keys(t).some(a=>{const c=t[a].details,f=c.edge;if(i>=f)return this.log(`"${e.identifier}" resumption ${i} past ${a} playlist end ${f}`),!1;const h=Ti(null,c.fragments,i);if(!h)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${a} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const v=a==="audio"?.175:0;return Math.abs(h.start-i)<ta+v||Math.abs(h.end-i)<ta+v?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${a} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,r=!1,s=!1;e.assetList.forEach((a,c)=>{const f=t+i;a.startOffset=i,a.timelineStart=f,r||(r=a.duration===null),s||(s=!!a.error);const h=a.error?0:a.duration||0;i+=h}),r&&!s?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Os(o){return`[${o.event?'"'+o.event.identifier+'"':"primary"}: ${o.start.toFixed(2)}-${o.end.toFixed(2)}]`}class Ic{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let r;try{r=Ml(i,this.hls.sessionId,e.baseUrl)}catch(_){const b=this.assignAssetListError(e,H.ASSET_LIST_LOAD_ERROR,_,i);this.hls.trigger(x.ERROR,b);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,c=new a(s),f={responseType:"json",url:r.href},h=s.interstitialAssetListLoadPolicy.default,v={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},y={onSuccess:(_,b,S,R)=>{const k=_.data,O=k==null?void 0:k.ASSETS;if(!Array.isArray(O)){const B=this.assignAssetListError(e,H.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,b,R);this.hls.trigger(x.ERROR,B);return}e.assetListResponse=k,this.hls.trigger(x.ASSET_LIST_LOADED,{event:e,assetListResponse:k,networkDetails:R})},onError:(_,b,S,R)=>{const k=this.assignAssetListError(e,H.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${_.code} ${_.text} (${b.url})`),b.url,R,S);this.hls.trigger(x.ERROR,k)},onTimeout:(_,b,S)=>{const R=this.assignAssetListError(e,H.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${b.url})`),b.url,_,S);this.hls.trigger(x.ERROR,R)}};return c.load(f,v,y),this.hls.trigger(x.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,i,r,s,a){return e.error=i,{type:le.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:a,stats:s}}}function Nl(o){o==null||o.play().catch(()=>{})}class Cc extends mt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const a=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const c=this.playingItem;if(!c){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(),this.checkBuffer(),a&&i<c.start||i>=c.end){var f;const _=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(c)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!a){const b=this.findItemIndex(c);if(_>b){const S=this.schedule.findJumpRestrictedIndex(b+1,_);if(S>b){this.setSchedulePosition(S);return}}}this.setSchedulePosition(_);return}const h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(c)){const _=c.event.assetList[0];_&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,_))}return}const v=h.timelineStart,y=h.duration||0;(a&&i<v||i>=v+y)&&this.setScheduleToAssetAtTime(i,h)},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const c=this.findItemIndex(r);this.setSchedulePosition(c+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);i>=a&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{const s=this.schedule,a=this.playingItem,c=s.events||[],f=s.items||[],h=s.durations,v=i.map(S=>S.identifier),y=!!(c.length||v.length);(y||r)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${f.map(S=>Os(S))} pos: ${this.timelinePos}`),v.length&&this.log(`Removed events ${v}`),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const R=S.assetItem.timelineStart,k=S.timelineOffset-R;if(k)try{S.timelineOffset=R}catch(O){Math.abs(k)>ta&&this.warn(`${O} ("${S.assetId}" ${S.timelineOffset}->${R})`)}}});let _=null;if(a){const S=this.updateItem(a,this.timelinePos);this.itemsMatch(a,S)&&(this.playingItem=S,this.waitingItem=this.endedItem=null,_=()=>this.trimInPlace(S,a))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const b=this.bufferingItem;if(b){const S=this.updateItem(b,this.bufferedPos);this.itemsMatch(b,S)?(this.bufferingItem=S,_||(_=()=>this.trimInPlace(S,b))):b.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(b.event,null))}if(i.forEach(S=>{S.assetList.forEach(R=>{this.clearAssetPlayer(R.identifier,null)})}),y||r){if(this.hls.trigger(x.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:f.slice(0),durations:h,removedIds:v}),this.isInterstitial(a)&&v.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}_&&_(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Ic(e),this.schedule=new Lc(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(x.MEDIA_ENDED,this.onMediaEnded,this),e.on(x.ERROR,this.onError,this),e.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(x.MEDIA_ENDED,this.onMediaEnded,this),e.off(x.ERROR,this.onError,this),e.off(x.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){_r(e,"play",this.onPlay),_r(e,"pause",this.onPause),_r(e,"seeking",this.onSeeking),_r(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;lr(i,"seeking",this.onSeeking),lr(i,"timeupdate",this.onTimeupdate),lr(i,"play",this.onPlay),lr(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=y=>y&&e.getAssetPlayer(y.identifier),r=(y,_,b,S,R)=>{if(y){let k=y[_].start;const O=y.event;if(O){if(_==="playout"||O.timelineOccupancy!==To.Point){const B=i(b);(B==null?void 0:B.interstitial)===O&&(k+=B.assetItem.startOffset+B[R])}}else{const B=S==="bufferedPos"?a():e[S];k+=B-y.start}return k}return 0},s=(y,_)=>{if(y!==0&&_!=="primary"&&e.schedule.length){var b;const S=e.schedule.findItemIndexAtTime(y),R=(b=e.schedule.items)==null?void 0:b[S];if(R){const k=R[_].start-R.start;return y+k}}return y},a=()=>{const y=e.bufferedPos;return y===Number.MAX_VALUE?c("primary"):Math.max(y,0)},c=y=>{var _;return(_=e.primaryDetails)!=null&&_.live?e.primaryDetails.edge:e.schedule.durations[y]},f=(y,_)=>{var b,S;const R=e.effectivePlayingItem;if(R!=null&&(b=R.event)!=null&&b.restrictions.skip)return;e.log(`seek to ${y} "${_}"`);const k=e.effectivePlayingItem,O=e.schedule.findItemIndexAtTime(y,_),B=(S=e.schedule.items)==null?void 0:S[O],F=e.getBufferingPlayer(),V=F==null?void 0:F.interstitial,z=V==null?void 0:V.appendInPlace,re=k&&e.itemsMatch(k,B);if(k&&(z||re)){const J=i(e.playingAsset),ee=(J==null?void 0:J.media)||e.primaryMedia;if(ee){const q=_==="primary"?ee.currentTime:r(k,_,e.playingAsset,"timelinePos","currentTime"),pe=y-q,Ie=(z?q:ee.currentTime)+pe;if(Ie>=0&&(!J||z||Ie<=J.duration)){ee.currentTime=Ie;return}}}if(B){let J=y;if(_!=="primary"){const q=B[_].start,pe=y-q;J=B.start+pe}const ee=!e.isInterstitial(B);if((!e.isInterstitial(k)||k.event.appendInPlace)&&(ee||B.event.appendInPlace)){const q=e.media||(z?F==null?void 0:F.media:null);q&&(q.currentTime=J)}else if(k){const q=e.findItemIndex(k);if(O>q){const Ie=e.schedule.findJumpRestrictedIndex(q+1,O);if(Ie>q){e.setSchedulePosition(Ie);return}}let pe=0;if(ee)e.timelinePos=J,e.checkBuffer();else{var Y;const Ie=B==null||(Y=B.event)==null?void 0:Y.assetList;if(Ie){const Xe=y-(B[_]||B).start;for(let Ve=Ie.length;Ve--;){const He=Ie[Ve];if(He.duration&&Xe>=He.startOffset&&Xe<He.startOffset+He.duration){pe=Ve;break}}}}e.setSchedulePosition(O,pe)}}},h=()=>{const y=e.effectivePlayingItem;if(e.isInterstitial(y))return y;const _=t();return e.isInterstitial(_)?_:null},v={get currentTime(){const y=h(),_=e.effectivePlayingItem;return _&&_===y?r(_,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-_.playout.start:0},set currentTime(y){const _=h(),b=e.effectivePlayingItem;b&&b===_&&f(y+b.playout.start,"playout")},get duration(){const y=h();return y?y.playout.end-y.playout.start:0},get assetPlayers(){var y;const _=(y=h())==null?void 0:y.event.assetList;return _?_.map(b=>e.getAssetPlayer(b.identifier)):[]},get playingIndex(){var y;const _=(y=h())==null?void 0:y.event;return _&&e.effectivePlayingAsset?_.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};this.manager={get events(){var y,_;return((y=e.schedule)==null||(_=y.events)==null?void 0:_.slice(0))||[]},get schedule(){var y,_;return((y=e.schedule)==null||(_=y.items)==null?void 0:_.slice(0))||[]},get interstitialPlayer(){return h()?v:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const y=t();return e.findItemIndex(y)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const y=e.effectivePlayingItem;return e.findItemIndex(y)},primary:{get bufferedEnd(){return a()},get currentTime(){const y=e.timelinePos;return y>0?y:0},set currentTime(y){f(y,"primary")},get duration(){return c("primary")},get seekableStart(){var y;return((y=e.primaryDetails)==null?void 0:y.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(y){f(y,"integrated")},get duration(){return c("integrated")},get seekableStart(){var y;return s(((y=e.primaryDetails)==null?void 0:y.fragmentStart)||0,"integrated")}},skip:()=>{const y=e.effectivePlayingItem,_=y==null?void 0:y.event;if(_&&!_.restrictions.skip){const b=e.findItemIndex(y);if(_.appendInPlace){const S=y.playout.start+y.event.duration;f(S+.001,"playout")}else e.advanceAfterAssetEnded(_,b,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,i;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const a=(i=s)==null?void 0:i.currentTime;if(!(a===void 0||!N(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${kt(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let s=null;const a=this.hls,c=e!==a,f=c&&e.interstitial.appendInPlace,h=(i=this.detachedData)==null?void 0:i.mediaSource;let v;if(a.media)f&&(s=a.transferMedia(),this.detachedData=s),v="Primary";else if(h){const b=this.getBufferingPlayer();b?(s=b.transferMedia(),v=`${b}`):v="detached MediaSource"}else v="detached media";if(!s){if(h)s=this.detachedData,this.log(`using detachedData: MediaSource ${kt(s)}`);else if(!this.detachedData||a.media===t){const b=this.playerQueue;b.length>1&&b.forEach(S=>{if(c&&S.interstitial.appendInPlace!==f){const R=S.interstitial;this.clearInterstitial(S.interstitial,null),R.appendInPlace=!1,R.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${R}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const y=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",_=y&&s?s:t;if(this.log(`${y?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${v}`),_===s){const b=c&&e.assetId===this.schedule.assetIdAtEnd;_.overrides={duration:this.schedule.duration,endOfStream:!c||b,cueRemoval:!c}}e.attachMedia(_)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,c=e.findItemIndexAtTime(a);this.setSchedulePosition(c)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAfterAssetEnded(e,t,i){const r=Yo(e,i);if(!e.isAssetPastPlayoutLimit(r))this.setSchedulePosition(t,r);else{const s=this.schedule.items;if(s){const a=t+1,c=s.length;if(a>=c){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.timelinePos=f,this.checkBuffer()),this.setSchedulePosition(a)}}}setScheduleToAssetAtTime(e,t){const i=this.schedule,r=t.parentIdentifier,s=i.getEvent(r);if(s){const a=i.findEventIndex(r),c=i.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,c-1)}}setSchedulePosition(e,t){const i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const r=e>=0?i[e]:null,s=this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){var c;const h=s.event,v=this.playingAsset,y=v==null?void 0:v.identifier,_=y?this.getAssetPlayer(y):null;if(_&&y&&(!this.eventItemsMatch(s,r)||t!==void 0&&y!==((c=h.assetList)==null?void 0:c[t].identifier))){var f;const b=h.findAssetIndex(v);if(this.log(`INTERSTITIAL_ASSET_ENDED ${b+1}/${h.assetList.length} ${ia(v)}`),this.endedAsset=v,this.playingAsset=null,this.hls.trigger(x.INTERSTITIAL_ASSET_ENDED,{asset:v,assetListIndex:b,event:h,schedule:i.slice(0),scheduleIndex:e,player:_}),s!==this.playingItem){this.itemsMatch(s,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),b);return}this.retreiveMediaSource(y,r),_.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&_.detachMedia()}if(!this.eventItemsMatch(s,r)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${Os(s)}`),h.hasPlayed=!0,this.hls.trigger(x.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:e}),h.cue.once)){this.updateSchedule();const b=this.schedule.items;if(r&&b){const S=this.findItemIndex(r);this.advanceSchedule(S,b,t,s,a)}return}}this.advanceSchedule(e,i,t,s,a)}advanceSchedule(e,t,i,r,s){const a=e>=0?t[e]:null,c=this.primaryMedia,f=this.playerQueue;if(f.length&&f.forEach(h=>{const v=h.interstitial,y=this.schedule.findEventIndex(v.identifier);(y<e||y>e+1)&&this.clearInterstitial(v,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const h=a.event;if(i===void 0){i=this.schedule.findAssetIndex(h,this.timelinePos);const b=Yo(h,i-1);if(h.isAssetPastPlayoutLimit(b)){this.advanceAfterAssetEnded(h,e,i);return}i=b}const v=this.waitingItem;this.assetsBuffered(a,c)||this.setBufferingItem(a);let y=this.preloadAssets(h,i);if(this.eventItemsMatch(a,v||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Os(a)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(x.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!c){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const _=h.assetList[i];if(!_){const b=t[e+1],S=this.media;b&&S&&!this.isInterstitial(b)&&S.currentTime<b.start&&(S.currentTime=this.timelinePos=b.start),this.advanceAfterAssetEnded(h,e,i||0);return}if(y||(y=this.getAssetPlayer(_.identifier)),y===null||y.destroyed){const b=h.assetList.length;this.warn(`asset ${i+1}/${b} player destroyed ${h}`),y=this.createAssetPlayer(h,_,i)}if(!this.eventItemsMatch(a,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(_))return;this.startAssetPlayer(y,i,t,e,c),this.shouldPlay&&Nl(y.media)}else a!==null?(this.resumePrimary(a,e,r),this.shouldPlay&&Nl(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Os(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.timelinePos=a),this.attachPrimary(a,e)}if(!i)return;const s=this.schedule.items;s&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Os(e)}`),this.hls.trigger(x.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:st.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(x.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(x.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const i=this.hls.levels[t.level],r=ve(ve({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=ve(ve({},this.altSelection),{},{audio:i});return}const s=ve(ve({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=ve(ve({},this.altSelection),{},{subtitles:i});return}const s=ve(ve({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(e,t){const i=zr(t);this.playerQueue.forEach(r=>r.hls.setAudioOption(t)||r.hls.setAudioOption(i))}onSubtitleTrackSwitch(e,t){const i=zr(t);this.playerQueue.forEach(r=>r.hls.setSubtitleOption(t)||t.id!==-1&&r.hls.setSubtitleOption(i))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var i;const a=this.schedule.findEventIndex(s.identifier),c=(i=this.schedule.items)==null?void 0:i[a];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){const i=this.schedule.items;if(e&&i){const r=this.findItemIndex(e,t);return i[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const i=e.end+.25,r=st.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.attachPrimary(i,null),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const i=st.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}updateBufferedPos(e,t,i){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,c=this.findItemIndex(a);let f=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var h,v;const y=this.findItemIndex(s),_=Math.min(y+1,t.length-1),b=t[_];if((f===-1&&s&&e>=s.end||(h=b.event)!=null&&h.appendInPlace&&e+.01>=b.start)&&(f=_),_-c>1&&(s==null||(v=s.event)==null?void 0:v.appendInPlace)===!1)return;if(this.bufferedPos=e,f>y&&f>c)this.bufferedToItem(b);else{const S=this.primaryDetails;this.primaryLive&&S&&e>S.edge-S.targetduration&&b.start<S.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(b)&&this.preloadAssets(b.event,0)}}else i&&a&&!this.itemsMatch(a,s)&&(f===c?this.bufferedToItem(a):f===c+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:r,events:s}=i;if(!r||!s)return t;const a=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=c?c.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Os(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),this.playbackDisabled||(a?e.event.assetList.forEach(h=>{const v=this.getAssetPlayer(h.identifier);v&&v.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering()))),this.hls.trigger(x.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,r=i.assetList.length===0&&!i.assetListLoader,s=i.cue.once;if(r||!s){const a=this.preloadAssets(i,t);if(a!=null&&a.interstitial.appendInPlace){const c=i.assetList[t],f=this.primaryMedia;c&&f&&this.bufferAssetPlayer(a,f)}}}preloadAssets(e,t){const i=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,a=e.cue.once;if(s){const f=e.timelineStart;if(e.appendInPlace){var c;const _=this.playingItem;!this.isInterstitial(_)&&(_==null||(c=_.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let h,v=0;if(!this.playingItem&&this.primaryLive&&(v=this.hls.startPosition,v===-1&&(v=this.hls.liveSyncPosition||0)),v&&!(e.cue.pre||e.cue.post)){const _=v-f;_>0&&(h=Math.round(_*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${h?` live-start: ${v} start-offset: ${h}`:""}`),i)return this.createAsset(e,0,0,f,e.duration,i);const y=this.assetListLoader.loadAssetList(e,h);y&&(e.assetListLoader=y)}else if(!a&&r){for(let f=t;f<r;f++){const h=e.assetList[f],v=this.getAssetPlayerQueueIndex(h.identifier);(v===-1||this.playerQueue[v].destroyed)&&!h.error&&this.createAssetPlayer(e,h,f)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,s,a){const c={parentIdentifier:e.identifier,identifier:bc(e,a,t),duration:s,startOffset:i,timelineStart:r,uri:a};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,i){const r=this.hls,s=r.userConfig;let a=s.videoPreference;const c=r.loadLevelObj||r.levels[r.currentLevel];(a||c)&&(a=me({},a),c.videoCodec&&(a.videoCodec=c.videoCodec),c.videoRange&&(a.allowedVideoRanges=[c.videoRange]));const f=r.audioTracks[r.audioTrack],h=r.subtitleTracks[r.subtitleTrack];let v=0;if(this.primaryLive||e.appendInPlace){const F=this.timelinePos-t.timelineStart;if(F>1){const V=t.duration;V&&F<V&&(v=F)}}const y=t.identifier,_=ve(ve({},s),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:y,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:v,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:f||s.audioPreference,subtitlePreference:h||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(_.timelineOffset=t.timelineStart));const b=_.cmcd;b!=null&&b.sessionId&&b.contentId&&(_.cmcd=me({},b,{contentId:qa(t.uri)})),this.getAssetPlayer(y)&&this.warn(`Duplicate date range identifier ${e} and asset ${y}`);const S=new Ac(this.HlsPlayerClass,_,e,t);this.playerQueue.push(S),e.assetList[i]=t;const R=F=>{if(F.live){const re=new Error(`Interstitials MUST be VOD assets ${e}`),Y={fatal:!0,type:le.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:re};this.handleAssetItemError(Y,e,this.schedule.findEventIndex(e.identifier),i,re.message);return}const V=F.edge-F.fragmentStart,z=t.duration;(z===null||V>z)&&(this.log(`Interstitial asset "${y}" duration change ${z} > ${V}`),t.duration=V,this.updateSchedule())};S.on(x.LEVEL_UPDATED,(F,{details:V})=>R(V)),S.on(x.LEVEL_PTS_UPDATED,(F,{details:V})=>R(V));const k=(F,V)=>{const z=this.getAssetPlayer(y);if(z&&V.tracks){z.off(x.BUFFER_CODECS,k),z.tracks=V.tracks;const re=this.primaryMedia;this.bufferingAsset===z.assetItem&&re&&!z.media&&this.bufferAssetPlayer(z,re)}};S.on(x.BUFFER_CODECS,k);const O=()=>{var F;const V=this.getAssetPlayer(y);if(this.log(`buffered to end of asset ${V}`),!V)return;const z=this.schedule.findEventIndex(e.identifier),re=(F=this.schedule.items)==null?void 0:F[z];if(this.isInterstitial(re)){const J=e.findAssetIndex(t),ee=Yo(e,J);if(!e.isAssetPastPlayoutLimit(ee))this.bufferedToItem(re,ee);else{var Y;const q=(Y=this.schedule.items)==null?void 0:Y[z+1];q&&this.bufferedToItem(q)}}};S.on(x.BUFFERED_TO_END,O);const B=F=>()=>{if(!this.getAssetPlayer(y))return;this.shouldPlay=!0;const z=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,z,F)};return S.once(x.MEDIA_ENDED,B(i)),S.once(x.PLAYOUT_LIMIT_REACHED,B(1/0)),S.on(x.ERROR,(F,V)=>{const z=this.getAssetPlayer(y);if(V.details===H.BUFFER_STALLED_ERROR){if(z!=null&&z.media){const re=z.currentTime,Y=z.duration-re;re&&e.appendInPlace&&Y/z.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${y} ${e} at ${z.media.currentTime}`),O()):(this.warn(`Stalled at ${re} of ${re+Y} in asset ${y} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(V,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${V.error} ${e}`)}),S.on(x.DESTROYING,()=>{if(!this.getAssetPlayer(y))return;const V=new Error(`Asset player destroyed unexpectedly ${y}`),z={fatal:!0,type:le.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:V};this.handleAssetItemError(z,e,this.schedule.findEventIndex(e.identifier),i,V.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ia(t)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:S}),S}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&Os(t)}`);const r=this.playerQueue[i];this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,s){const{interstitial:a,assetItem:c,assetId:f}=e,h=a.assetList.length,v=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!v||v.identifier!==f)&&(v&&(this.clearAssetPlayer(v.identifier,i[r]),delete v.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${h} ${ia(c)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:a,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var i,r;const{interstitial:s,assetItem:a}=e,c=this.schedule.findEventIndex(s.identifier),f=(i=this.schedule.items)==null?void 0:i[c];if(!f)return;this.setBufferingItem(f),this.bufferingAsset=a;const h=this.getBufferingPlayer();if(h===e)return;const v=s.appendInPlace;if(v&&(h==null?void 0:h.interstitial.appendInPlace)===!1)return;const y=(h==null?void 0:h.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(v&&a!==this.playingAsset){if(!e.tracks)return;if(y&&!mn(y,e.tracks)){const _=new Error(`Asset ${ia(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(y)}')`),b={fatal:!0,type:le.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:_},S=s.findAssetIndex(a);this.handleAssetItemError(b,s,c,S,_.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,i,r,s){if(e.details===H.BUFFER_STALLED_ERROR)return;const a=t.assetList[r];this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&ia(a)} ${e.error}`);const c=a==null?void 0:a.identifier,f=this.getAssetPlayerQueueIndex(c),h=this.playerQueue[f]||null,v=this.schedule.items,y=me({},e,{fatal:!1,errorAction:jt(!0),asset:a,assetListIndex:r,event:t,schedule:v,scheduleIndex:i,player:h});if(this.hls.trigger(x.INTERSTITIAL_ASSET_ERROR,y),!e.fatal)return;const _=this.playingAsset,b=new Error(s);if(a&&(this.clearAssetPlayer(c,null),a.error=b),!t.assetList.some(S=>!S.error))t.error=b;else{for(let S=r;S<t.assetList.length;S++)this.resetAssetPlayer(t.assetList[S].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):_&&_.identifier===c&&this.advanceAfterAssetEnded(t,i,r)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${i?Os(i):"<none>"} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const s=this.updateItem(i,r);this.itemsMatch(i,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const a=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var i;const r=t.event,s=r.identifier,a=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(s))return;const c=r.timelineStart,f=r.duration;let h=0;a.forEach((S,R)=>{const k=parseFloat(S.DURATION);this.createAsset(r,R,h,c+h,k,S.URI),h+=k}),r.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${f}) ${r}`);const v=this.waitingItem,y=(v==null?void 0:v.event.identifier)===s;this.updateSchedule();const _=(i=this.bufferingItem)==null?void 0:i.event;if(y){var b;const S=this.schedule.findEventIndex(s),R=(b=this.schedule.items)==null?void 0:b[S];if(R){if(!this.playingItem&&this.timelinePos>R.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.primaryFallback(r);return}this.setBufferingItem(R)}this.setSchedulePosition(S)}else if((_==null?void 0:_.identifier)===s&&_.appendInPlace){const S=r.assetList[0],R=this.getAssetPlayer(S.identifier),k=this.primaryMedia;S&&R&&k&&this.bufferAssetPlayer(R,k)}}onError(e,t){switch(t.details){case H.ASSET_LIST_PARSING_ERROR:case H.ASSET_LIST_LOAD_ERROR:case H.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&this.primaryFallback(i);break}case H.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Bl=500;class kc extends Gn{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",ue.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ne.IDLE,this.setInterval(Bl),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(this.fragContextChanged(i)||(Xt(i)&&(this.fragPrevious=i),this.state=ne.IDLE),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const c=i.start;for(let h=0;h<s.length;h++)if(c>=s[h].start&&c<=s[h].end){a=s[h];break}const f=i.start+i.duration;a?a.end=f:(a={start:c,end:f},s.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let c=0;c<a.length;){if(a[c].end<=s){a.shift();continue}else if(a[c].start<s)a[c].start=s;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,s,ue.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===ue.SUBTITLE&&(t.details===H.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ne.STOPPED&&(this.state=ne.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&_l(this.levels,t)){this.levels=t.map(i=>new pr(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const r=new pr(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ue.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==ne.STOPPED&&this.setInterval(Bl)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:r,levels:s}=this,{details:a,id:c}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const f=s[c];if(c>=s.length||!f)return;this.log(`Subtitle track ${c} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(a.live||(i=f.details)!=null&&i.live){if(a.deltaUpdateFailed)return;const y=this.mainDetails;if(!y){this.startFragRequested=!1;return}const _=y.fragments[0];if(!f.details)a.hasProgramDateTime&&y.hasProgramDateTime?(tn(a,y),h=a.fragmentStart):_&&(h=_.start,$n(a,h));else{var v;h=this.alignPlaylists(a,f.details,(v=this.levelLastLoaded)==null?void 0:v.details),h===0&&_&&(h=_.start,$n(a,h))}y&&!this.startFragRequested&&this.setStartPosition(y,h)}f.details=a,this.levelLastLoaded=f,c===r&&(this.hls.trigger(x.SUBTITLE_TRACK_UPDATED,{details:a,id:c,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ne.IDLE&&(Ti(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&ie(r.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,Se(r.method)).catch(c=>{throw s.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const f=performance.now();s.trigger(x.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:a,tdecrypt:f}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ne.IDLE})}}doTick(){if(!this.media){this.state=ne.IDLE;return}if(this.state===ne.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:r}=this,s=this.getLoadPosition(),a=st.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:c,len:f}=a,h=i.details,v=this.hls.maxBufferLength+h.levelTargetDuration;if(f>v)return;const y=h.fragments,_=y.length,b=h.edge;let S=null;const R=this.fragPrevious;if(c<b){const B=r.maxFragLookUpTolerance,F=c>b-B?0:B;S=Ti(R,y,Math.max(y[0].start,c),F),!S&&R&&R.start<y[0].start&&(S=y[0])}else S=y[_-1];if(S=this.filterReplacedPrimary(S,i.details),!S)return;const k=S.sn-h.startSN,O=y[k-1];if(O&&O.cc===S.cc&&this.fragmentTracker.getState(O)===ri.NOT_LOADED&&(S=O),this.fragmentTracker.getState(S)===ri.NOT_LOADED){const B=this.mapToInitFragWhenRequired(S);B&&this.loadFragment(B,i,c)}}}loadFragment(e,t,i){Xt(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Rc(this.tracksBuffered[this.currentTrackId]||[])}}class Rc{constructor(e){this.buffered=void 0;const t=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const wc={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ul=o=>String.fromCharCode(wc[o]||o),Tr=15,us=100,Dc={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Pc={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Oc={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Mc={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Fc=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Nc{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;At.log(`${this.time} [${e}] ${i}`)}}}const dn=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class $l{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Bc{constructor(){this.uchar=" ",this.penState=new $l}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Uc{constructor(e){this.chars=[],this.pos=0,this.currPenState=new $l,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<us;t++)this.chars.push(new Bc);this.logger=e}equals(e){for(let t=0;t<us;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<us;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<us;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>us&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=us)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ul(e);if(this.pos>=us){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<us;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<us;i++){const r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class zo{constructor(e){this.rows=[],this.currRow=Tr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Tr;t++)this.rows.push(new Uc(e));this.logger=e}reset(){for(let e=0;e<Tr;e++)this.rows[e].clear();this.currRow=Tr-1}equals(e){let t=!0;for(let i=0;i<Tr;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Tr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Tr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+kt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Tr;c++)this.rows[c].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const c=a.rows[s].cueStartTime,f=this.logger.time;if(c!==null&&f!==null&&c<f)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(a.rows[s+h])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+kt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let s=0;s<Tr;s++){const a=this.rows[s].getTextString();a&&(r=s+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Hl{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new zo(i),this.nonDisplayedMemory=new zo(i),this.lastOutputScreen=new zo(i),this.currRollUpRow=this.displayedMemory.rows[Tr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Tr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+kt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Gl{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Hc(),this.logger=void 0;const r=this.logger=new Nc;this.channels=[null,new Hl(e,t,r),new Hl(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const r=t[i]&127,s=t[i+1]&127;let a=!1,c=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+dn([t[i],t[i+1]])+"] -> ("+dn([r,s])+")");const f=this.cmdHistory;if(r>=16&&r<=31){if($c(r,s,f)){Eo(null,null,f),this.logger.log(3,()=>"Repeated command ("+dn([r,s])+") is dropped");continue}Eo(r,s,this.cmdHistory),a=this.parseCmd(r,s),a||(a=this.parseMidrow(r,s)),a||(a=this.parsePAC(r,s)),a||(a=this.parseBackgroundAttributes(r,s))}else Eo(null,null,f);if(!a&&(c=this.parseChars(r,s),c)){const v=this.currentChannel;v&&v>0?this.channels[v].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+dn([r,s])+" orig: "+dn([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+dn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?i=a===1?Dc[e]:Oc[e]:i=a===1?Pc[e]:Mc[e];const c=this.channels[a];return c?(c.setPAC(this.interpretPAC(i,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+Ul(a)+"' in channel "+i),r=[a]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+dn(r).join(",")),r}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=Fc[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Eo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Eo(o,e,t){t.a=o,t.b=e}function $c(o,e,t){return t.a===o&&t.b===e}function Hc(){return{a:null,b:null}}var Xo=function(){if(we!=null&&we.VTTCue)return self.VTTCue;const o=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,f){if(typeof f!="string"||!Array.isArray(c))return!1;const h=f.toLowerCase();return~c.indexOf(h)?h:!1}function i(c){return t(o,c)}function r(c){return t(e,c)}function s(c,...f){let h=1;for(;h<arguments.length;h++){const v=arguments[h];for(const y in v)c[y]=v[y]}return c}function a(c,f,h){const v=this,y={enumerable:!0};v.hasBeenReset=!1;let _="",b=!1,S=c,R=f,k=h,O=null,B="",F=!0,V="auto",z="start",re=50,Y="middle",J=50,ee="middle";Object.defineProperty(v,"id",s({},y,{get:function(){return _},set:function(q){_=""+q}})),Object.defineProperty(v,"pauseOnExit",s({},y,{get:function(){return b},set:function(q){b=!!q}})),Object.defineProperty(v,"startTime",s({},y,{get:function(){return S},set:function(q){if(typeof q!="number")throw new TypeError("Start time must be set to a number.");S=q,this.hasBeenReset=!0}})),Object.defineProperty(v,"endTime",s({},y,{get:function(){return R},set:function(q){if(typeof q!="number")throw new TypeError("End time must be set to a number.");R=q,this.hasBeenReset=!0}})),Object.defineProperty(v,"text",s({},y,{get:function(){return k},set:function(q){k=""+q,this.hasBeenReset=!0}})),Object.defineProperty(v,"region",s({},y,{get:function(){return O},set:function(q){O=q,this.hasBeenReset=!0}})),Object.defineProperty(v,"vertical",s({},y,{get:function(){return B},set:function(q){const pe=i(q);if(pe===!1)throw new SyntaxError("An invalid or illegal string was specified.");B=pe,this.hasBeenReset=!0}})),Object.defineProperty(v,"snapToLines",s({},y,{get:function(){return F},set:function(q){F=!!q,this.hasBeenReset=!0}})),Object.defineProperty(v,"line",s({},y,{get:function(){return V},set:function(q){if(typeof q!="number"&&q!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");V=q,this.hasBeenReset=!0}})),Object.defineProperty(v,"lineAlign",s({},y,{get:function(){return z},set:function(q){const pe=r(q);if(!pe)throw new SyntaxError("An invalid or illegal string was specified.");z=pe,this.hasBeenReset=!0}})),Object.defineProperty(v,"position",s({},y,{get:function(){return re},set:function(q){if(q<0||q>100)throw new Error("Position must be between 0 and 100.");re=q,this.hasBeenReset=!0}})),Object.defineProperty(v,"positionAlign",s({},y,{get:function(){return Y},set:function(q){const pe=r(q);if(!pe)throw new SyntaxError("An invalid or illegal string was specified.");Y=pe,this.hasBeenReset=!0}})),Object.defineProperty(v,"size",s({},y,{get:function(){return J},set:function(q){if(q<0||q>100)throw new Error("Size must be between 0 and 100.");J=q,this.hasBeenReset=!0}})),Object.defineProperty(v,"align",s({},y,{get:function(){return ee},set:function(q){const pe=r(q);if(!pe)throw new SyntaxError("An invalid or illegal string was specified.");ee=pe,this.hasBeenReset=!0}})),v.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class Gc{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Vl(o){function e(i,r,s,a){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(a||0)}const t=o.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Vc{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function jl(o,e,t,i){const r=i?o.split(i):[o];for(const s in r){if(typeof r[s]!="string")continue;const a=r[s].split(t);if(a.length!==2)continue;const c=a[0],f=a[1];e(c,f)}}const Qo=new Xo(0,0,""),bo=Qo.align==="middle"?"middle":"center";function jc(o,e,t){const i=o;function r(){const c=Vl(o);if(c===null)throw new Error("Malformed timestamp: "+i);return o=o.replace(/^[^\sa-zA-Z-]+/,""),c}function s(c,f){const h=new Vc;jl(c,function(_,b){let S;switch(_){case"region":for(let R=t.length-1;R>=0;R--)if(t[R].id===b){h.set(_,t[R].region);break}break;case"vertical":h.alt(_,b,["rl","lr"]);break;case"line":S=b.split(","),h.integer(_,S[0]),h.percent(_,S[0])&&h.set("snapToLines",!1),h.alt(_,S[0],["auto"]),S.length===2&&h.alt("lineAlign",S[1],["start",bo,"end"]);break;case"position":S=b.split(","),h.percent(_,S[0]),S.length===2&&h.alt("positionAlign",S[1],["start",bo,"end","line-left","line-right","auto"]);break;case"size":h.percent(_,b);break;case"align":h.alt(_,b,["start",bo,"end","left","right"]);break}},/:/,/\s/),f.region=h.get("region",null),f.vertical=h.get("vertical","");let v=h.get("line","auto");v==="auto"&&Qo.line===-1&&(v=-1),f.line=v,f.lineAlign=h.get("lineAlign","start"),f.snapToLines=h.get("snapToLines",!0),f.size=h.get("size",100),f.align=h.get("align",bo);let y=h.get("position","auto");y==="auto"&&Qo.position===50&&(y=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=y}function a(){o=o.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),o.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);o=o.slice(3),a(),e.endTime=r(),a(),s(o,e)}function Kl(o){return o.replace(/<br(?: \/)?>/gi,`
`)}class Kc{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Gc,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let s=t.buffer,a=0;for(s=Kl(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const c=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),c}function r(s){jl(s,function(a,c){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=i();const c=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=i(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new Xo(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{jc(s,t.cue,t.regionList)}catch(c){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=s.indexOf("-->")!==-1;if(!s||c&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch(s){t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const qc=/\r\n|\n\r|\n|\r/g,Jo=function(e,t,i=0){return e.slice(i,i+t.length)===t},Wc=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!N(t)||!N(i)||!N(r)||!N(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=60*60*1e3*s,t};function Zo(o,e,t){return qa(o.toString())+qa(e.toString())+qa(t)}const Yc=function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function zc(o,e,t,i,r,s,a){const c=new Kc,f=rt(new Uint8Array(o)).trim().replace(qc,`
`).split(`
`),h=[],v=e?fe(e.baseTime,e.timescale):0;let y="00:00.000",_=0,b=0,S,R=!0;c.oncue=function(k){const O=t[i];let B=t.ccOffset;const F=(_-v)/9e4;if(O!=null&&O.new&&(b!==void 0?B=t.ccOffset=O.start:Yc(t,i,F)),F){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}B=F-t.presentationOffset}const V=k.endTime-k.startTime,z=or((k.startTime+B-b)*9e4,r*9e4)/9e4;k.startTime=Math.max(z,0),k.endTime=Math.max(z+V,0);const re=k.text.trim();k.text=decodeURIComponent(encodeURIComponent(re)),k.id||(k.id=Zo(k.startTime,k.endTime,re)),k.endTime>0&&h.push(k)},c.onparsingerror=function(k){S=k},c.onflush=function(){if(S){a(S);return}s(h)},f.forEach(k=>{if(R)if(Jo(k,"X-TIMESTAMP-MAP=")){R=!1,k.slice(16).split(",").forEach(O=>{Jo(O,"LOCAL:")?y=O.slice(6):Jo(O,"MPEGTS:")&&(_=parseInt(O.slice(7)))});try{b=Wc(y)/1e3}catch(O){S=O}return}else k===""&&(R=!1);c.parse(k+`
`)}),c.flush()}const el="stpp.ttml.im1t",ql=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Wl=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Xc={left:"start",center:"center",right:"end",start:"start",end:"end"};function Yl(o,e,t,i){const r=ht(new Uint8Array(o),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(c=>rt(c)),a=Q(e.baseTime,1,e.timescale);try{s.forEach(c=>t(Qc(c,a)))}catch(c){i(c)}}function Qc(o,e){const r=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((y,_)=>(y[_]=r.getAttribute(`ttp:${_}`)||s[_],y),{}),c=r.getAttribute("xml:space")!=="preserve",f=zl(tl(r,"styling","style")),h=zl(tl(r,"layout","region")),v=tl(r,"body","[begin]");return[].map.call(v,y=>{const _=Xl(y,c);if(!_||!y.hasAttribute("begin"))return null;const b=rl(y.getAttribute("begin"),a),S=rl(y.getAttribute("dur"),a);let R=rl(y.getAttribute("end"),a);if(b===null)throw Ql(y);if(R===null){if(S===null)throw Ql(y);R=b+S}const k=new Xo(b-e,R-e,_);k.id=Zo(k.startTime,k.endTime,k.text);const O=h[y.getAttribute("region")],B=f[y.getAttribute("style")],F=Jc(O,B,f),{textAlign:V}=F;if(V){const z=Xc[V];z&&(k.lineAlign=z),k.align=V}return me(k,F),k}).filter(y=>y!==null)}function tl(o,e,t){const i=o.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function zl(o){return o.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function Xl(o,e){return[].slice.call(o.childNodes).reduce((t,i,r)=>{var s;return i.nodeName==="br"&&r?t+`
`:(s=i.childNodes)!=null&&s.length?Xl(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function Jc(o,e,t){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=o!=null&&o.hasAttribute("style")?o.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(r=t[a]),s.reduce((c,f)=>{const h=il(e,i,f)||il(o,i,f)||il(r,i,f);return h&&(c[f]=h),c},{})}function il(o,e,t){return o&&o.hasAttributeNS(e,t)?o.getAttributeNS(e,t):null}function Ql(o){return new Error(`Could not parse ttml timestamp ${o}`)}function rl(o,e){if(!o)return null;let t=Vl(o);return t===null&&(ql.test(o)?t=Zc(o,e):Wl.test(o)&&(t=eh(o,e))),t}function Zc(o,e){const t=ql.exec(o),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function eh(o,e){const t=Wl.exec(o),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class So{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class th{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=eu(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new So(this,"textTrack1"),t=new So(this,"textTrack2"),i=new So(this,"textTrack3"),r=new So(this,"textTrack4");this.cea608Parser1=new Gl(1,e,t),this.cea608Parser2=new Gl(3,i,r)}addCues(e,t,i,r,s){let a=!1;for(let c=s.length;c--;){const f=s[c],h=ih(f[0],f[1],t,i);if(h>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],i),a=!0,h/(i-t)>.5))return}if(a||s.push([t,i]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,i,r)}else{const c=this.Cues.newCue(null,t,i,r);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){const{unparsedVttFrags:a}=this;i===ue.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(c=>{this.initPTS[c.frag.cc]?this.onFragLoaded(x.FRAG_LOADED,c):this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const s=i.textTracks[r];if(Zl(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:a}=t[e],c=this.getExistingTrack(s,a);if(c)i[e]=c,ea(i[e]),Pl(i[e],r);else{const f=this.createTextTrack("captions",s,a);f&&(f[e]=!0,i[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{ea(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=eu(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)ea(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some(s=>s.textCodec===el);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(_l(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media,c=a?_o(a.textTracks):null;if(this.tracks.forEach((f,h)=>{let v;if(c){let y=null;for(let _=0;_<c.length;_++)if(c[_]&&Zl(c[_],f)){y=c[_],c[_]=null;break}y&&(v=y)}if(v)ea(v);else{const y=Jl(f);v=this.createTextTrack(y,f.name,f.lang),v&&(v.mode="disabled")}v&&this.textTracks.push(v)}),c!=null&&c.length){const f=c.filter(h=>h!==null).map(h=>h.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const s=`textTrack${r[1]}`,a=this.captionsProperties[s];a&&(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ue.MAIN){var i,r;const{cea608Parser1:s,cea608Parser2:a,lastSn:c}=this,{cc:f,sn:h}=t.frag,v=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;s&&a&&(h!==c+1||h===c&&v!==this.lastPartIndex+1||f!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=f,this.lastSn=h,this.lastPartIndex=v}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===ue.SUBTITLE)if(r.byteLength){const s=i.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const c=this.tracks[i.level],f=this.vttCCs;f[i.cc]||(f[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&c.textCodec===el?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Yl(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:a}=this,c=s.length-1;if(!s[i.cc]&&c===-1){a.push(e);return}const f=this.hls,h=(t=i.initSegment)!=null&&t.data?fi(i.initSegment.data,new Uint8Array(r)).buffer:r;zc(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,v=>{this._appendCues(v,i.level),f.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},v=>{const y=v.message==="Missing initPTS for VTT MPEGTS";y?a.push(e):this._fallbackToIMSC1(i,r),f.logger.log(`Failed to parse VTT cue: ${v}`),!(y&&c>i.cc)&&f.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:v})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Yl(t,this.initPTS[e.cc],()=>{i.textCodec=el,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>Ol(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;i.trigger(x.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===ue.SUBTITLE&&this.onFragLoaded(x.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=t;if(!(i.type===ue.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let s=0;s<r.length;s++){const a=r[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(a);this.cea608Parser1.addData(r[s].pts,c[0]),this.cea608Parser2.addData(r[s].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:a}=this;if(!(!a||a.currentTime<i)){if(!s||s==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(f=>qo(c[f],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(f=>qo(c[f],t,r))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let r=2;for(let s=0;s<i;s++){const a=e[r++],c=127&e[r++],f=127&e[r++];if(c===0&&f===0)continue;if((4&a)!==0){const v=3&a;(v===0||v===1)&&(t[v].push(c),t[v].push(f))}}return t}}function Jl(o){return o.characteristics&&/transcribes-spoken-dialog/gi.test(o.characteristics)&&/describes-music-and-sound/gi.test(o.characteristics)?"captions":"subtitles"}function Zl(o,e){return!!o&&o.kind===Jl(e)&&$o(e,o)}function ih(o,e,t,i){return Math.min(e,i)-Math.max(o,t)}function eu(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const rh=/\s/,sh={newCue(o,e,t,i){const r=[];let s,a,c,f,h;const v=self.VTTCue||self.TextTrackCue;for(let _=0;_<i.rows.length;_++)if(s=i.rows[_],c=!0,f=0,h="",!s.isEmpty()){var y;for(let R=0;R<s.chars.length;R++)rh.test(s.chars[R].uchar)&&c?f++:(h+=s.chars[R].uchar,c=!1);s.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const b=Kl(h.trim()),S=Zo(e,t,b);o!=null&&(y=o.cues)!=null&&y.getCueById(S)||(a=new v(e,t,b),a.id=S,a.line=_+1,a.align="left",a.position=10+Math.min(80,Math.floor(f*8/32)*10),r.push(a))}return o&&r.length&&(r.sort((_,b)=>_.line==="auto"||b.line==="auto"?0:_.line>8&&b.line>8?b.line-_.line:_.line-b.line),r.forEach(_=>Ol(o,_))),r}};function nh(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(o){}return!1}const ah=/(\d+)-(\d+)\/(\d+)/;class tu{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||ch,this.controller=new self.AbortController,this.stats=new Yi}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=oh(e,this.controller.signal),a=e.responseType==="arraybuffer",c=a?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=f&&N(f)?f:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Va(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(y=>{var _;this.response=this.loader=y;const b=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},h-(b-r.loading.start)),!y.ok){const{status:R,statusText:k}=y;throw new hh(k||"fetch, bad network response",R,y)}r.loading.first=b,r.total=uh(y.headers)||r.total;const S=(_=this.callbacks)==null?void 0:_.onProgress;return S&&N(t.highWaterMark)?this.loadProgressively(y,r,e,t.highWaterMark,S):a?y.arrayBuffer():e.responseType==="json"?y.json():y.text()}).then(y=>{var _,b;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const R=y[c];R&&(r.loaded=r.total=R);const k={url:S.url,data:y,code:S.status},O=(_=this.callbacks)==null?void 0:_.onProgress;O&&!N(t.highWaterMark)&&O(r,e,y,S),(b=this.callbacks)==null||b.onSuccess(k,r,e,S)}).catch(y=>{var _;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const b=y&&y.code||0,S=y?y.message:null;(_=this.callbacks)==null||_.onError({code:b,text:S},e,y?y.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){const a=new Vn,c=e.body.getReader(),f=()=>c.read().then(h=>{if(h.done)return a.dataLength&&s(t,i,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const v=h.value,y=v.length;return t.loaded+=y,y<r||a.dataLength?(a.push(v),a.dataLength>=r&&s(t,i,a.flush().buffer,e)):s(t,i,v.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function oh(o,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(me({},o.headers))};return o.rangeEnd&&t.headers.set("Range","bytes="+o.rangeStart+"-"+String(o.rangeEnd-1)),t}function lh(o){const e=ah.exec(o);if(e)return parseInt(e[2])-parseInt(e[1])+1}function uh(o){const e=o.get("Content-Range");if(e){const i=lh(e);if(N(i))return i}const t=o.get("Content-Length");if(t)return parseInt(t)}function ch(o,e){return new self.Request(o.url,e)}class hh extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const dh=/^age:\s*[\d.]+\s*$/im;class iu{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Yi,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,t.url)}).catch(a=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),s(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(a=>{var c;(c=this.callbacks)==null||c.onError({code:i.status,text:a.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=i.loadPolicy;if(r)for(const c in r)e.setRequestHeader(c,r[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&N(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const h=t.status,v=t.responseType==="text"?t.responseText:null;if(h>=200&&h<300){const S=v!=null?v:t.response;if(S!=null){var a,c;i.loading.end=Math.max(self.performance.now(),i.loading.first);const R=t.responseType==="arraybuffer"?S.byteLength:S.length;i.loaded=i.total=R,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const k=(a=this.callbacks)==null?void 0:a.onProgress;k&&k(i,e,S,t);const O={url:t.responseURL,data:S,code:h};(c=this.callbacks)==null||c.onSuccess(O,i,e,t);return}}const y=s.loadPolicy.errorRetry,_=i.retry,b={url:e.url,data:void 0,code:h};if(Xr(y,_,!1,b))this.retry(y);else{var f;At.error(`${h} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:h,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Xr(e,t,!0))this.retry(e);else{var i;At.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Ks(e,i.retry),i.retry++,At.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&dh.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const fh={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},ph=ve(ve({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:iu,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ua,bufferController:wu,capLevelController:Go,errorController:ca,fpsController:vc,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:dt,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:fh},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},gh()),{},{subtitleStreamController:kc,subtitleTrackController:Tc,timelineController:th,audioStreamController:Iu,audioTrackController:Cu,emeController:Zn,cmcdController:pc,contentSteeringController:mc,interstitialsController:Cc});function gh(){return{cueHandler:sh,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mh(o,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=sl(o),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(a=>{const c=`${a==="level"?"playlist":a}LoadPolicy`,f=e[c]===void 0,h=[];s.forEach(v=>{const y=`${a}Loading${v}`,_=e[y];if(_!==void 0&&f){h.push(y);const b=i[c].default;switch(e[c]={default:b},v){case"TimeOut":b.maxLoadTimeMs=_,b.maxTimeToFirstByteMs=_;break;case"MaxRetry":b.errorRetry.maxNumRetry=_,b.timeoutRetry.maxNumRetry=_;break;case"RetryDelay":b.errorRetry.retryDelayMs=_,b.timeoutRetry.retryDelayMs=_;break;case"MaxRetryTimeout":b.errorRetry.maxRetryDelayMs=_,b.timeoutRetry.maxRetryDelayMs=_;break}}}),h.length&&t.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${c}": ${kt(e[c])}`)}),ve(ve({},i),e)}function sl(o){return o&&typeof o=="object"?Array.isArray(o)?o.map(sl):Object.keys(o).reduce((e,t)=>(e[t]=sl(o[t]),e),{}):o}function vh(o,e){const t=o.loader;t!==tu&&t!==iu?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1):nh()&&(o.loader=tu,o.progressive=!0,o.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const xo=2,yh=.1,_h=.05,Th=100;class Eh extends As{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(Th),this.mediaSource=t.mediaSource;const i=this.media=t.media;lr(i,"playing",this.onMediaPlaying),lr(i,"waiting",this.onMediaWaiting),lr(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(_r(i,"playing",this.onMediaPlaying),_r(i,"waiting",this.onMediaWaiting),_r(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;const s=(i=this.hls)==null?void 0:i.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:c}=a,f=this.seeking&&!c,h=!this.seeking&&c,v=a.paused&&!c||a.ended||a.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!v&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||f){f&&this.stallResolved(e);return}if(v){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1}));return}if(!st.getBuffered(a).length){this.nudgeRetry=0;return}const y=st.bufferInfo(a,e,0),_=y.nextStart||0,b=this.fragmentTracker;if(c&&b&&this.hls){const re=ru(this.hls.inFlightFragments,e),Y=y.len>xo,J=!_||re||_-e>xo&&!b.getPartialFragment(e);if(Y||J)return;this.moved=!1}const S=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&b){if(!(y.len>0)&&!_)return;const Y=Math.max(_,y.start||0)-e,ee=!!(S!=null&&S.live)?S.targetduration*2:xo,q=b.getPartialFragment(e);if(Y>0&&(Y<=ee||q)){a.paused||this._trySkipBufferHole(q);return}}const R=s.detectStallWithCurrentTimeMs,k=self.performance.now(),O=this.waiting;let B=this.stalled;if(B===null)if(O>0&&k-O<R)B=this.stalled=O;else{this.stalled=k;return}const F=k-B;if(!c&&(F>=R||O)&&this.hls){var V;if(((V=this.mediaSource)==null?void 0:V.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-((S==null?void 0:S.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(y),!this.media||!this.hls)return}const z=st.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(z,F,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(x.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){const s=st.bufferedInfo(st.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=st.timeRangesToArray(r),c=st.bufferedInfo(a,t,0).bufferedIndex;if(c>-1&&c<a.length-1){const f=st.bufferedInfo(a,e,0).bufferedIndex,h=a[c].end,v=a[c+1].start;if((f===-1||f>c)&&v-h<1&&e-h<2){const y=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${h} -> ${v} buffered index: ${f}`);this.warn(y.message),this.media.currentTime+=1e-6;const _=this.fragmentTracker.getPartialFragment(e)||void 0,b=st.bufferInfo(this.media,e,0);this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:_,buffer:b.len,bufferInfo:b})}}}}}_tryFixBufferStall(e,t,i){var r,s;const{fragmentTracker:a,media:c}=this,f=(r=this.hls)==null?void 0:r.config;if(!c||!a||!f)return;const h=(s=this.hls)==null?void 0:s.latestLevelDetails,v=a.getPartialFragment(i);if((v||h!=null&&h.live&&i<h.fragmentStart)&&(this._trySkipBufferHole(v)||!this.media))return;const y=e.buffered,_=this.adjacentTraversal(e,i);(y&&y.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-i<f.maxBufferHole||_))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,r=e.nextStart;if(i&&r){const s=i.getFragAtPos(t,ue.MAIN),a=i.getFragAtPos(r,ue.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:r,stalled:s}=this;if(!r&&s!==null&&i&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${kt(e)})`);this.warn(a.message),t.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!i||!s)return 0;const a=r.currentTime,c=st.bufferInfo(r,a,0),f=a<c.start?c.start:c.nextStart;if(f&&this.hls){const v=c.len<=s.maxBufferHole,y=c.len>0&&c.len<1&&r.readyState<3,_=f-a;if(_>0&&(v||y)){if(_>s.maxBufferHole){let S=!1;if(a===0){const R=i.getAppendedFrag(0,ue.MAIN);R&&f<R.end&&(S=!0)}if(!S){const R=e||i.getAppendedFrag(a,ue.MAIN);if(R){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||ru(this.hls.inFlightFragments,f))return 0;let O=!1,B=R.end;for(;B<f;){const F=i.getAppendedFrag(B,ue.MAIN)||i.getPartialFragment(B);if(F)B+=F.duration;else{O=!0;break}}if(O)return 0}}}const b=Math.max(f+_h,a+yh);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${b}`),this.moved=!0,r.currentTime=b,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${b}`);this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,frag:e||void 0,buffer:c.len,bufferInfo:c})}return b}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!i||!s)return 0;const a=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const c=a+(r+1)*s.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${a} to ${c}`);this.warn(f.message),i.currentTime=c,t.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function ru(o,e){const t=su(o.main);if(t&&t.start<=e)return t;const i=su(o.audio);return i&&i.start<=e?i:null}function su(o){if(!o)return null;switch(o.state){case ne.IDLE:case ne.STOPPED:case ne.ENDED:case ne.ERROR:return null}return o.frag}const bh=.25;function nl(){if(typeof self!="undefined")return self.VTTCue||self.TextTrackCue}function nu(o,e,t,i,r){let s=new o(e,t,"");try{s.value=i,r&&(s.type=r)}catch(a){s=new o(e,t,kt(r?ve({type:r},i):i))}return s}const Ao=(()=>{const o=nl();try{o&&new o(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Sh{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(x.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&ea(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return Pl(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=nl();if(a)for(let c=0;c<s.length;c++){const f=s[c].type;if(f===Di.emsg&&!i||!r)continue;const h=Wn(s[c].data);if(h){const v=s[c].pts;let y=v+s[c].duration;y>Ao&&(y=Ao),y-v<=0&&(y=v+bh);for(let b=0;b<h.length;b++){const S=h[b];if(!uo(S)){this.updateId3CueEnds(v,f);const R=nu(a,v,y,S,f);R&&this.id3Track.addCue(R)}}}}}updateId3CueEnds(e,t){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){const a=r[s];a.type===t&&a.startTime<e&&a.endTime===Ao&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:f}}=a;if(s&&(c||f)){let h;r==="audio"?h=v=>v.type===Di.audioId3&&f:r==="video"?h=v=>v.type===Di.emsg&&c:h=v=>v.type===Di.audioId3&&f||v.type===Di.emsg&&c,qo(s,t,i,h)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:i}=this,{dateRanges:r}=e,s=Object.keys(r);let a=this.dateRangeCuesAppended;if(i&&t){var c;if((c=i.cues)!=null&&c.length){const v=Object.keys(a).filter(y=>!s.includes(y));for(let y=v.length;y--;){const _=v[y],b=a[_].cues;delete a[_],Object.keys(b).forEach(S=>{try{const R=b[S];R.removeEventListener("enter",this.onEventCueEnter),i.removeCue(R)}catch(R){}})}}else a=this.dateRangeCuesAppended={}}const f=e.fragments[e.fragments.length-1];if(s.length===0||!N(f==null?void 0:f.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const h=nl();for(let v=0;v<s.length;v++){const y=s[v],_=r[y],b=_.startTime,S=a[y],R=(S==null?void 0:S.cues)||{};let k=(S==null?void 0:S.durationKnown)||!1,O=Ao;const{duration:B,endDate:F}=_;if(F&&B!==null)O=b+B,k=!0;else if(_.endOnNext&&!k){const z=s.reduce((re,Y)=>{if(Y!==_.id){const J=r[Y];if(J.class===_.class&&J.startDate>_.startDate&&(!re||_.startDate<re.startDate))return J}return re},null);z&&(O=z.startTime,k=!0)}const V=Object.keys(_.attr);for(let z=0;z<V.length;z++){const re=V[z];if(!X(re))continue;const Y=R[re];if(Y)k&&!S.durationKnown?Y.endTime=O:Math.abs(Y.startTime-b)>.01&&(Y.startTime=b,Y.endTime=O);else if(h){let J=_.attr[re];se(re)&&(J=Or(J));const q=nu(h,b,O,{key:re,data:J},Di.dateRange);q&&(q.id=y,this.id3Track.addCue(q),R[re]=q,this.hls.config.interstitialsController&&(re==="X-ASSET-LIST"||re==="X-ASSET-URL")&&q.addEventListener("enter",this.onEventCueEnter))}}a[y]={cues:R,dateRange:_,durationKnown:k}}}}class xh{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!i.live)return;const c=this.targetLatency;if(c===null)return;const f=r-c,h=Math.min(this.maxLatency,c+i.targetduration);if(f<h&&f>.05&&this.forwardBufferLength>1){const y=Math.min(2,Math.max(1,a)),_=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,b=Math.min(y,Math.max(1,_));this.changeMediaPlaybackRate(t,b)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:c}=this.config,f=this.hls.userConfig;let h=c&&i||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||h===0)&&(h=s!==void 0?s:a*r);const v=r;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,v)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const r=i.edge,s=e-t-this.edgeStalled,a=r-i.totalduration,c=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,s),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===H.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class Ah extends Uo{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,r=[],s={},a={};let c=!1,f=!1,h=!1;t.levels.forEach(v=>{const y=v.attrs;let{audioCodec:_,videoCodec:b}=v;_&&(v.audioCodec=_=Li(_,i)||void 0),b&&(b=v.videoCodec=ys(b));const{width:S,height:R,unknownCodecs:k}=v;let O=k?k.length:0;if(k)for(let q=O;q--;){const pe=k[q];this.isAudioSupported(pe)?(v.audioCodec=_=_?`${_},${pe}`:pe,O--,ir.audio[_.substring(0,4)]=2):this.isVideoSupported(pe)&&(v.videoCodec=b=b?`${b},${pe}`:pe,O--,ir.video[b.substring(0,4)]=2)}if(c||(c=!!(S&&R)),f||(f=!!b),h||(h=!!_),O||_&&!this.isAudioSupported(_)||b&&!this.isVideoSupported(b)){this.log(`Some or all CODECS not supported "${y.CODECS}"`);return}const{CODECS:B,"FRAME-RATE":F,"HDCP-LEVEL":V,"PATHWAY-ID":z,RESOLUTION:re,"VIDEO-RANGE":Y}=y,ee=`${`${z||"."}-`}${v.bitrate}-${re}-${F}-${B}-${Y}-${V}`;if(s[ee])if(s[ee].uri!==v.url&&!v.attrs["PATHWAY-ID"]){const q=a[ee]+=1;v.attrs["PATHWAY-ID"]=new Array(q+1).join(".");const pe=this.createLevel(v);s[ee]=pe,r.push(pe)}else s[ee].addGroupId("audio",y.AUDIO),s[ee].addGroupId("text",y.SUBTITLES);else{const q=this.createLevel(v);s[ee]=q,a[ee]=1,r.push(q)}}),this.filterAndSortMediaOptions(r,t,c,f,h)}createLevel(e){const t=new pr(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=_i(r,[])}return t}isAudioSupported(e){return Vr(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Vr(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,s){let a=[],c=[],f=e;if((i||r)&&s&&(f=f.filter(({videoCodec:k,videoRange:O,width:B,height:F})=>(!!k||!!(B&&F))&&Wr(O))),f.length===0){Promise.resolve().then(()=>{if(this.hls){let k="no level with compatible codecs found in manifest",O=k;t.levels.length&&(O=`one or more CODECS in variant not supported: ${kt(t.levels.map(F=>F.attrs.CODECS).filter((F,V,z)=>z.indexOf(F)===V))}`,this.warn(O),k+=` (${O})`);const B=new Error(k);this.hls.trigger(x.ERROR,{type:le.MEDIA_ERROR,details:H.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:B,reason:O})}});return}t.audioTracks&&(a=t.audioTracks.filter(k=>!k.audioCodec||this.isAudioSupported(k.audioCodec)),au(a)),t.subtitles&&(c=t.subtitles,au(c));const h=f.slice(0);f.sort((k,O)=>{if(k.attrs["HDCP-LEVEL"]!==O.attrs["HDCP-LEVEL"])return(k.attrs["HDCP-LEVEL"]||"")>(O.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&k.height!==O.height)return k.height-O.height;if(k.frameRate!==O.frameRate)return k.frameRate-O.frameRate;if(k.videoRange!==O.videoRange)return ei.indexOf(k.videoRange)-ei.indexOf(O.videoRange);if(k.videoCodec!==O.videoCodec){const B=vs(k.videoCodec),F=vs(O.videoCodec);if(B!==F)return F-B}if(k.uri===O.uri&&k.codecSet!==O.codecSet){const B=dr(k.codecSet),F=dr(O.codecSet);if(B!==F)return F-B}return k.averageBitrate!==O.averageBitrate?k.averageBitrate-O.averageBitrate:0});let v=h[0];if(this.steering&&(f=this.steering.filterParsedLevels(f),f.length!==h.length)){for(let k=0;k<h.length;k++)if(h[k].pathwayId===f[0].pathwayId){v=h[k];break}}this._levels=f;for(let k=0;k<f.length;k++)if(f[k]===v){var y;this._firstLevel=k;const O=v.bitrate,B=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${f.length} level(s) found, first bitrate: ${O}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const F=Math.min(O,this.hls.config.abrEwmaDefaultEstimateMax);F>B&&B===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=F)}break}const _=s&&!r,b=this.hls.config,S=!!(b.audioStreamController&&b.audioTrackController),R={levels:f,audioTracks:a,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:S&&!_&&a.some(k=>!!k.url)};this.hls.trigger(x.MANIFEST_PARSED,R)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const v=new Error("invalid level idx"),y=e<0;if(this.hls.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.LEVEL_SWITCH_ERROR,level:e,fatal:y,error:v,reason:v.message}),y)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,a=t[e],c=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&r&&s===c)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${c?" with Pathway "+c:""} from level ${i}${s?" with Pathway "+s:""}`);const f={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,f);const h=a.details;if(!h||h.live){const v=this.switchParams(a.uri,r==null?void 0:r.details,h);this.loadPlaylist(v)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===ye.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ue.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:s}=t,a=t.levelInfo;if(!a){var c;this.warn(`Invalid level index ${r}`),(c=t.deliveryDirectives)!=null&&c.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let f=a.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(r,t,f)}else(i=t.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,c=a==null?void 0:a.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${c&&a.live?" age "+c.toFixed(1)+(a.type?" "+a.type||0:""):""} ${i}`),this.hls.trigger(x.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(c=>c.level=-1)),!1));va(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(x.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function au(o){const e={};o.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function ou(){return self.SourceBuffer||self.WebKitSourceBuffer}function lu(){if(!Zi())return!1;const e=ou();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Lh(){if(!lu())return!1;const o=Zi();return typeof(o==null?void 0:o.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>o.isTypeSupported(hr(e,"video")))||["mp4a.40.2","fLaC"].some(e=>o.isTypeSupported(hr(e,"audio"))))}function Ih(){var o;const e=ou();return typeof(e==null||(o=e.prototype)==null?void 0:o.changeType)=="function"}const Ch=100;class kh extends Gn{constructor(e,t,i){super(e,t,i,"stream-controller",ue.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!N(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(r,s,ue.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(Ch),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ne.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ne.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ne.WAITING_LEVEL:{const{levels:t,level:i}=this,r=t==null?void 0:t[i],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=ne.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ne.IDLE;break}break}case ne.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,level:s}=this,a=r==null?void 0:r[s];this.resetStartWhenNotLoaded(a||null),this.state=ne.IDLE}}break}this.state===ne.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[s]))return;const a=i[s],c=this.getMainFwdBufferInfo();if(c===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(c,f)){const R={};this.altAudio===2&&(R.type="video"),this.hls.trigger(x.BUFFER_EOS,R),this.state=ne.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const h=a.details;if(!h||this.state===ne.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=ne.WAITING_LEVEL,this.startFragRequested=!1;return}const v=c.len,y=this.getMaxBufferLength(a.maxBitrate);if(v>=y)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const _=this.backtrackFragment?this.backtrackFragment.start:c.end;let b=this.getNextFragment(_,h);if(this.couldBacktrack&&!this.fragPrevious&&b&&Xt(b)&&this.fragmentTracker.getState(b)!==ri.OK){var S;const k=((S=this.backtrackFragment)!=null?S:b).sn-h.startSN,O=h.fragments[k-1];O&&b.cc===O.cc&&(b=O,this.fragmentTracker.removeFragment(O))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(b&&this.isLoopLoading(b,_)){if(!b.gap){const k=this.audioOnly&&!this.altAudio?Rt.AUDIO:Rt.VIDEO,O=(k===Rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;O&&this.afterBufferFlushed(O,k,ue.MAIN)}b=this.getNextFragmentLoopLoading(b,h,c,ue.MAIN,y)}b&&(b.initSegment&&!b.initSegment.data&&!this.bitrateTest&&(b=b.initSegment),this.loadFragment(b,a,_))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);r===ri.NOT_LOADED||r===ri.PARTIAL?Xt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ue.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<s.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,f=e[c],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*f.maxBitrate/(1e3*h)+1:i=0}else i=0;const a=this.getBufferedFrag(t.currentTime+i);if(a){const c=this.followingBufferedFrag(a);if(c){this.abortCurrentFrag();const f=c.maxStartPTS?c.maxStartPTS:c.start,h=c.duration,v=Math.max(a.end,f+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(v,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ne.KEY_LOADING:case ne.FRAG_LOADING:case ne.FRAG_LOADING_WAITING_RETRY:case ne.PARSING:case ne.PARSED:this.state=ne.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;lr(i,"playing",this.onMediaPlaying),lr(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(_r(i,"playing",this.onMediaPlaying),_r(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;t.levels.forEach(s=>{const a=s.audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,r=r||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&r&&!Ih(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ne.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=ne.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:r,startFragRequested:s}=this,a=t.level,c=t.details,f=c.totalduration;if(!r){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${f}`);const h=t.levelInfo,v=this.fragCurrent;v&&(this.state===ne.FRAG_LOADING||this.state===ne.FRAG_LOADING_WAITING_RETRY)&&v.level!==t.level&&v.loader&&this.abortCurrentFrag();let y=0;if(c.live||(i=h.details)!=null&&i.live){var _;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;y=this.alignPlaylists(c,h.details,(_=this.levelLastLoaded)==null?void 0:_.details)}if(h.details=c,this.levelLastLoaded=h,s||this.setStartPosition(c,y),this.hls.trigger(x.LEVEL_UPDATED,{details:c,level:a}),this.state===ne.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=ne.IDLE}s&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,c=e.edge,f=s>=a-t.maxFragLookUpTolerance&&s<=c;if(r!==null&&i.duration>r&&(s<r||!f)){const v=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&i.readyState<4||s<c-v)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;const y=st.bufferInfo(i,r,0);if(!(y!=null&&(h=y.buffered)!=null&&h.length)){i.currentTime=r;return}if(y.start<=s){i.currentTime=r;return}const{nextStart:b}=st.bufferedInfo(y.buffered,s,0);b&&(i.currentTime=b)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=a[i.level];if(!c){this.warn(`Level ${i.level} not found on progress`);return}const f=c.details;if(!f){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const h=c.videoCodec,v=f.PTSKnown||!f.live,y=(t=i.initSegment)==null?void 0:t.data,_=this._getAudioCodec(c),b=this.transmuxer=this.transmuxer||new vl(this.hls,ue.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=r?r.index:-1,R=S!==-1,k=new ts(i.level,i.sn,i.stats.chunkCount,s.byteLength,S,R),O=this.initPTS[i.cc];b.push(s,y,_,h,i,r,f.totalduration,v,k,O)}onAudioTrackSwitching(e,t){const i=this.hls,r=this.altAudio===2;if(ce(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),i.once(x.BUFFER_FLUSHED,()=>{var a;(a=this.hls)==null||a.trigger(x.AUDIO_TRACK_SWITCHED,t)}),i.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(x.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=ce(t.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,s,a=!1;for(const c in i){const f=i[c];if(f.id==="main"){if(s=c,r=f,c==="video"){const h=i[c];h&&(this.videoBuffer=h.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t,s=i.type===ue.MAIN;if(s){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ne.PARSED&&(this.state=ne.IDLE);return}const c=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),Xt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const a=this.media;a&&(!this._hasEnoughToStart&&st.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case H.FRAG_GAP:case H.FRAG_PARSING_ERROR:case H.FRAG_DECRYPT_ERROR:case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ue.MAIN,t);break;case H.LEVEL_LOAD_ERROR:case H.LEVEL_LOAD_TIMEOUT:case H.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===ye.LEVEL&&(this.state=ne.IDLE);break;case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case H.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case H.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ne.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Rt.AUDIO||!this.altAudio){const i=(t===Rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,ue.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&i&&(i+=r);const s=this.getLevelDetails(),a=st.getBuffered(e),c=a.length?a.start(0):0,f=c-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<h||this.loadingParts&&f<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),i+=f,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${c}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:r}=this,s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=ne.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(x.FRAG_LOADED,i),s.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:f,part:h,level:v}=c,{video:y,text:_,id3:b,initSegment:S}=s,{details:R}=v,k=this.altAudio?void 0:s.audio;if(this.fragContextChanged(f)){this.fragmentTracker.removeFragment(f);return}if(this.state=ne.PARSING,S){if(S!=null&&S.tracks){const V=f.initSegment||f;this._bufferInitSegment(v,S.tracks,V,a),r.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:V,id:i,tracks:S.tracks})}const O=S.initPTS,B=S.timescale,F=this.initPTS[f.cc];N(O)&&(!F||F.baseTime!==O||F.timescale!==B)&&(this.initPTS[f.cc]={baseTime:O,timescale:B},r.trigger(x.INIT_PTS_FOUND,{frag:f,id:i,initPTS:O,timescale:B}))}if(y&&R){k&&y.type==="audiovideo"&&this.logMuxedErr(f);const O=R.fragments[f.sn-1-R.startSN],B=f.sn===R.startSN,F=!O||f.cc>O.cc;if(s.independent!==!1){const{startPTS:V,endPTS:z,startDTS:re,endDTS:Y}=y;if(h)h.elementaryStreams[y.type]={startPTS:V,endPTS:z,startDTS:re,endDTS:Y};else if(y.firstKeyFrame&&y.independent&&a.id===1&&!F&&(this.couldBacktrack=!0),y.dropped&&y.independent){const J=this.getMainFwdBufferInfo(),ee=(J?J.end:this.getLoadPosition())+this.config.maxBufferHole,q=y.firstKeyFramePTS?y.firstKeyFramePTS:V;if(!B&&ee<q-this.config.maxBufferHole&&!F){this.backtrack(f);return}else F&&(f.gap=!0);f.setElementaryStreamInfo(y.type,f.start,z,f.start,Y,!0)}else B&&V-(R.appliedTimelineOffset||0)>xo&&(f.gap=!0);f.setElementaryStreamInfo(y.type,V,z,re,Y),this.backtrackFragment&&(this.backtrackFragment=f),this.bufferFragmentData(y,f,h,a,B||F)}else if(B||F)f.gap=!0;else{this.backtrack(f);return}}if(k){const{startPTS:O,endPTS:B,startDTS:F,endDTS:V}=k;h&&(h.elementaryStreams[Rt.AUDIO]={startPTS:O,endPTS:B,startDTS:F,endDTS:V}),f.setElementaryStreamInfo(Rt.AUDIO,O,B,F,V),this.bufferFragmentData(k,f,h,a)}if(R&&b!=null&&(t=b.samples)!=null&&t.length){const O={id:i,frag:f,details:R,samples:b.samples};r.trigger(x.FRAG_PARSING_METADATA,O)}if(R&&_){const O={id:i,frag:f,details:R,samples:_.samples};r.trigger(x.FRAG_PARSING_USERDATA,O)}}logMuxedErr(e){this.warn(`${Xt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==ne.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:s,video:a,audiovideo:c}=t;if(s){const h=e.audioCodec;let v=ci(s.codec,h);v==="mp4a"&&(v="mp4a.40.5");const y=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){v&&(v.indexOf("mp4a.40.5")!==-1?v="mp4a.40.2":v="mp4a.40.5");const _=s.metadata;_&&"channelCount"in _&&(_.channelCount||1)!==1&&y.indexOf("firefox")===-1&&(v="mp4a.40.5")}v&&v.indexOf("mp4a.40.5")!==-1&&y.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(v="mp4a.40.2",this.log(`Android: force audio codec to ${v}`)),h&&h!==v&&this.log(`Swapping manifest audio codec "${h}" for "${v}"`),s.levelCodec=v,s.id=ue.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${v||""}/${h||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=ue.MAIN;const h=a.codec;if((h==null?void 0:h.length)===4)switch(h){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${h}]${a.codec!==h?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(x.BUFFER_CODECS,t),!this.hls)return;f.forEach(h=>{const y=t[h].initSegment;y!=null&&y.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:h,data:y,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ue.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ne.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(st.isBuffered(e,i)?t=this.getAppendedFrag(i):st.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(x.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(x.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return N(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(N(t)){const i=this.getLevelDetails(),r=this.currentFrag||(i?Ti(null,i.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const a=s+(t-r.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Rh{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=H.KEY_LOAD_ERROR,i,r,s){return new Ut({type:le.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const a=t[r];if(e.cc<=a.cc&&(!Xt(e)||!Xt(a)||e.sn<a.sn)||!i&&r==s-1)return this.emeController.selectKeySystemFormat(a).then(c=>{if(!this.emeController)return;a.setKeyFormat(c);const f=Re(c);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const r=nt(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,h))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let c=this.keyUriToKeyInfo[a];if((i=c)!=null&&i.decryptdata.key)return s.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if((r=c)!=null&&r.keyLoadPromise){var f;switch((f=c.mediaKeySessionContext)==null?void 0:f.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(h=>(s.key=h.keyInfo.decryptdata.key,{frag:e,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(i);if(r)return(e.keyLoadPromise=r.then(s=>(e.mediaKeySessionContext=s,i))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=i.loader,s=new r(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,c)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=i.keyLoadPolicy.default,v={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},y={onSuccess:(_,b,S,R)=>{const{frag:k,keyInfo:O,url:B}=S;if(!k.decryptdata||O!==this.keyUriToKeyInfo[B])return c(this.createKeyLoadError(k,H.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),R));O.decryptdata.key=k.decryptdata.key=new Uint8Array(_.data),k.keyLoader=null,O.loader=null,a({frag:k,keyInfo:O})},onError:(_,b,S,R)=>{this.resetLoader(b),c(this.createKeyLoadError(t,H.KEY_LOAD_ERROR,new Error(`HTTP Error ${_.code} loading key ${_.text}`),S,ve({url:f.url,data:void 0},_)))},onTimeout:(_,b,S)=>{this.resetLoader(b),c(this.createKeyLoadError(t,H.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(_,b,S)=>{this.resetLoader(b),c(this.createKeyLoadError(t,H.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};s.load(f,v,y)})}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}function uu(o){const{type:e}=o;switch(e){case ye.AUDIO_TRACK:return ue.AUDIO;case ye.SUBTITLE_TRACK:return ue.SUBTITLE;default:return ue.MAIN}}function al(o,e){let t=o.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class wh{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,s=i||r,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ye.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:r,pathwayId:s,url:a,deliveryDirectives:c,levelInfo:f}=t;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:ye.LEVEL,url:a,deliveryDirectives:c,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:a,track:c}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:ye.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:a,track:c}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:ye.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:c})}onLevelsUpdated(e,t){const i=this.loaders[ye.LEVEL];if(i){const r=i.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders[ye.LEVEL])}}load(e){var t;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const h=this.hls.logger,v=r.context;if(v&&v.levelOrTrack===e.levelOrTrack&&(v.url===e.url||v.deliveryDirectives&&!e.deliveryDirectives)){v.url===e.url?h.log(`[playlist-loader]: ignore ${e.url} ongoing request`):h.log(`[playlist-loader]: ignore ${e.url} in favor of ${v.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===ye.MANIFEST?s=i.manifestLoadPolicy.default:s=me({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),N((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===ye.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===ye.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===ye.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){const v=h.partTarget,y=h.targetduration;if(v&&y){const _=Math.max(v*3,y*.8)*1e3;s=me({},s,{maxTimeToFirstByteMs:Math.min(_,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(_,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},c={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},f={onSuccess:(h,v,y,_)=>{const b=this.getInternalLoader(y);this.resetInternalLoader(y.type);const S=h.data;if(S.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(h,y,new Error("no EXTM3U delimiter"),_||null,v);return}v.parsing.start=performance.now(),si.isMediaPlaylist(S)||y.type!==ye.MANIFEST?this.handleTrackOrLevelPlaylist(h,v,y,_||null,b):this.handleMasterPlaylist(h,v,y,_)},onError:(h,v,y,_)=>{this.handleNetworkError(v,y,!1,h,_)},onTimeout:(h,v,y)=>{this.handleNetworkError(v,y,!0,void 0,h)}};r.load(e,c,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){const s=this.hls,a=e.data,c=al(e,i),f=si.parseMasterPlaylist(a,c);if(f.playlistParsingError){this.handleManifestParsingError(e,i,f.playlistParsingError,r,t);return}const{contentSteering:h,levels:v,sessionData:y,sessionKeys:_,startTimeOffset:b,variableList:S}=f;this.variableList=S;const{AUDIO:R=[],SUBTITLES:k,"CLOSED-CAPTIONS":O}=si.parseMasterPlaylistMedia(a,c,f);R.length&&!R.some(F=>!F.url)&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),R.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new U({}),bitrate:0,url:""})),s.trigger(x.MANIFEST_LOADED,{levels:v,audioTracks:R,subtitles:k,captions:O,contentSteering:h,url:c,stats:t,networkDetails:r,sessionData:y,sessionKeys:_,startTimeOffset:b,variableList:S})}handleTrackOrLevelPlaylist(e,t,i,r,s){const a=this.hls,{id:c,level:f,type:h}=i,v=al(e,i),y=N(f)?f:N(c)?c:0,_=uu(i),b=si.parseLevelPlaylist(e.data,v,y,_,0,this.variableList);if(h===ye.MANIFEST){const S={attrs:new U({}),bitrate:0,details:b,name:"",url:v};b.requestScheduled=t.loading.start+Zs(b,0),a.trigger(x.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:v,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=b,this.handlePlaylistLoaded(b,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger(x.ERROR,{type:le.NETWORK_ERROR,details:H.MANIFEST_PARSING_ERROR,fatal:t.type===ye.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let a=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===ye.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ye.AUDIO_TRACK||e.type===ye.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let f=H.UNKNOWN,h=!1;const v=this.getInternalLoader(e);switch(e.type){case ye.MANIFEST:f=i?H.MANIFEST_LOAD_TIMEOUT:H.MANIFEST_LOAD_ERROR,h=!0;break;case ye.LEVEL:f=i?H.LEVEL_LOAD_TIMEOUT:H.LEVEL_LOAD_ERROR,h=!1;break;case ye.AUDIO_TRACK:f=i?H.AUDIO_TRACK_LOAD_TIMEOUT:H.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case ye.SUBTITLE_TRACK:f=i?H.SUBTITLE_TRACK_LOAD_TIMEOUT:H.SUBTITLE_LOAD_ERROR,h=!1;break}v&&this.resetInternalLoader(e.type);const y={type:le.NETWORK_ERROR,details:f,fatal:h,url:e.url,loader:v,context:e,error:c,networkDetails:t,stats:s};if(r){const _=(t==null?void 0:t.url)||e.url;y.response=ve({url:_,data:void 0},r)}this.hls.trigger(x.ERROR,y)}handlePlaylistLoaded(e,t,i,r,s,a){const c=this.hls,{type:f,level:h,id:v,groupId:y,deliveryDirectives:_}=r,b=al(t,r),S=uu(r),R=typeof r.level=="number"&&S===ue.MAIN?h:void 0;if(!e.fragments.length){const O=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(x.ERROR,{type:le.NETWORK_ERROR,details:H.LEVEL_EMPTY_ERROR,fatal:!1,url:b,error:O,reason:O.message,response:t,context:r,level:R,parent:S,networkDetails:s,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const k=e.playlistParsingError;if(k){if(this.hls.logger.warn(k),!c.config.ignorePlaylistParsingErrors){c.trigger(x.ERROR,{type:le.NETWORK_ERROR,details:H.LEVEL_PARSING_ERROR,fatal:!1,url:b,error:k,reason:k.message,response:t,context:r,level:R,parent:S,networkDetails:s,stats:i});return}e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case ye.MANIFEST:case ye.LEVEL:c.trigger(x.LEVEL_LOADED,{details:e,levelInfo:r.levelOrTrack||c.levels[0],level:R||0,id:v||0,stats:i,networkDetails:s,deliveryDirectives:_,withoutMultiVariant:f===ye.MANIFEST});break;case ye.AUDIO_TRACK:c.trigger(x.AUDIO_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:v||0,groupId:y||"",stats:i,networkDetails:s,deliveryDirectives:_});break;case ye.SUBTITLE_TRACK:c.trigger(x.SUBTITLE_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:v||0,groupId:y||"",stats:i,networkDetails:s,deliveryDirectives:_});break}}}class pi{static get version(){return Rs}static isMSESupported(){return lu()}static isSupported(){return Lh()}static getMediaSource(){return Zi()}static get Events(){return x}static get MetadataSchema(){return Di}static get ErrorTypes(){return le}static get ErrorDetails(){return H}static get DefaultConfig(){return pi.defaultConfig?pi.defaultConfig:ph}static set DefaultConfig(e){pi.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Rr,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=ui(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=mh(pi.DefaultConfig,e,t);this.userConfig=e,i.progressive&&vh(i,t);const{abrController:r,bufferController:s,capLevelController:a,errorController:c,fpsController:f}=i,h=new c(this),v=this.abrController=new r(this),y=new bs(this),_=i.interstitialsController,b=_?this.interstitialsController=new _(this,pi):null,S=this.bufferController=new s(this,y),R=this.capLevelController=new a(this),k=new f(this),O=new wh(this),B=i.contentSteeringController,F=B?new B(this):null,V=this.levelController=new Ah(this,F),z=new Sh(this),re=new Rh(this.config),Y=this.streamController=new kh(this,y,re),J=this.gapController=new Eh(this,y);R.setStreamController(Y),k.setStreamController(Y);const ee=[O,V,Y];b&&ee.splice(1,0,b),F&&ee.splice(1,0,F),this.networkControllers=ee;const q=[v,S,J,R,k,z,y];this.audioTrackController=this.createController(i.audioTrackController,ee);const pe=i.audioStreamController;pe&&ee.push(this.audioStreamController=new pe(this,y,re)),this.subtitleTrackController=this.createController(i.subtitleTrackController,ee);const Ie=i.subtitleStreamController;Ie&&ee.push(this.subtititleStreamController=new Ie(this,y,re)),this.createController(i.timelineController,q),re.emeController=this.emeController=this.createController(i.emeController,q),this.cmcdController=this.createController(i.cmcdController,q),this.latencyController=this.createController(xh,q),this.coreComponents=q,ee.push(h);const Xe=h.onErrorOut;typeof Xe=="function"&&this.on(x.ERROR,Xe,h),this.on(x.MANIFEST_LOADED,O.onManifestLoaded,O)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===x.ERROR;this.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(x.ERROR,{type:le.OTHER_ERROR,details:H.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,r=t?e:{media:i};this._media=i,this.trigger(x.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(x.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,r=this._url=Ee.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(x.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ue.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ue.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ue.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Ec()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){xn(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,i)for(let s=r;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=i)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=In(t);return Ii(e,i,navigator.mediaCapabilities)}}pi.defaultConfig=void 0;var Dh=Object.defineProperty,cu=Object.getOwnPropertySymbols,Ph=Object.prototype.hasOwnProperty,Oh=Object.prototype.propertyIsEnumerable,ol=(o,e,t)=>e in o?Dh(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Mh=(o,e)=>{for(var t in e||(e={}))Ph.call(e,t)&&ol(o,t,e[t]);if(cu)for(var t of cu(e))Oh.call(e,t)&&ol(o,t,e[t]);return o},hu=(o,e,t)=>(ol(o,typeof e!="symbol"?e+"":e,t),t);class ra{constructor(e,t,i={}){const r=ke().getTech("Tech").prototype.error;this.source=e,this.tech=t,this.player=ke().getPlayer(this.tech.options().playerId),this._html5TechError=this.tech.error,this.tech.error=r,this.el=t.el(),this.hls=new pi(Mh({backBufferLength:30,liveDurationInfinity:!0},i.hls)),this.tech.hlsjs=this.hls,this.player.qualityLevels&&this.setupQualityLevels(),this.setupEventHandlers(),this.setupHls(),this.mediaElErrorHandler_=()=>this.tech.error(this.el.error)}dispose(){this.el.removeEventListener("error",this.mediaElErrorHandler_),this.tech.error=this._html5TechError,this.hls.destroy(),delete this.tech.hlsjs}setupEventHandlers(){const e={MEDIA_ERR_CUSTOM:0,MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4,MEDIA_ERR_ENCRYPTED:5},t={[pi.ErrorTypes.NETWORK_ERROR]:e.MEDIA_ERR_NETWORK,[pi.ErrorTypes.MEDIA_ERROR]:e.MEDIA_ERR_DECODE,[pi.ErrorTypes.MUX_ERROR]:e.MEDIA_ERR_DECODE,[pi.ErrorTypes.KEY_SYSTEM_ERROR]:e.MEDIA_ERR_ENCRYPTED,DEFAULT:e.MEDIA_ERR_CUSTOM};Object.values(pi.Events).forEach(i=>{if(i===pi.Events.ERROR){this.hls.on(i,(r,s)=>{var a;const{type:c,fatal:f}=s;if(!f)return;const h=(a=t[c])!=null?a:t.DEFAULT;this.tech.error({code:h,hlsError:s})});return}this.hls.on(i,(r,s)=>{this.tech.trigger(i,s)})}),this.el.addEventListener("error",this.mediaElErrorHandler_)}setupHls(){pi.isSupported()?(this.hls.attachMedia(this.el),this.hls.loadSource(this.source.src)):this.el.canPlayType("application/vnd.apple.mpegurl")?this.el.src=this.source.src:console.log("[videojs-mux-kit] Error: browser does not support MSE nor Hls natively")}setupQualityLevels(){const e=this.player.qualityLevels();let t;const i=()=>{let c;for(c=t.length-1;c>0&&!t[c];c--);return c},r=()=>i()===this.hls.levels.length-1,s=(c,f)=>{const h=i();r()?this.hls.autoLevelCapping=-1:this.hls.autoLevelCapping=h,f&&this.hls.currentLevel!==c&&(this.hls.currentLevel=c,a())},a=(c,f)=>{let h=this.hls.currentLevel;e.selectedIndex_=h,e.trigger({type:"change",selectedIndex:h})};this.tech.on(pi.Events.MANIFEST_LOADED,(c,f)=>{if(t=new Array(this.hls.levels.length).fill(!0),this.hls.autoLevelCapping!==-1)for(let h=this.hls.maxAutoLevel;h<this.hls.levels.length;h++)t[h]=!1;this.hls.levels.forEach((h,v)=>{e.addQualityLevel({id:v,width:h.width,height:h.height,bitrate:h.bitrate,enabled:y=>{t[v]=y,s(v,y)}})}),e.selectedIndex_=this.hls.currentLevel,e.trigger({type:"change",selectedIndex:this.hls.currentLevel})}),this.tech.on(pi.Events.LEVEL_SWITCHED,a)}}hu(ra,"hlsTypeRE",/^application\/(x-mpegURL|vnd\.apple\.mpegURL)$/i),hu(ra,"hlsExtRE",/\.m3u8/i);const Fh={canHandleSource(o){return o.skipHlsJs?"":ra.hlsTypeRE.test(o.type)?"probably":ra.hlsExtRE.test(o.src)?"maybe":""},handleSource(o,e,t={}){return new ra(o,e,t)},canPlayType(o){return ra.hlsTypeRE.test(o)?"probably":""}};ke().getTech("Html5").registerSourceHandler(Fh,0);const td=null,Nh={rE:"0.12.2"};var id=Le(906);function Bh(o){var e,t;if((t=(e=o.tech_)==null?void 0:e.sourceHandler_)!=null&&t.hls){const i=o.tech_.sourceHandler_.hls;o.mux.addHLSJS({hlsjs:i,Hls:pi})}}function Uh(o,e){var t,i,r,s,a;if((t=o==null?void 0:o.dataset)!=null&&t.setup){let c=o.dataset.setup;c=JSON.parse(c),c&&((r=(i=c==null?void 0:c.plugins)==null?void 0:i.mux)!=null&&r.data)&&(c=du(c),c=JSON.stringify(c),o.dataset.setup=c)}return(a=(s=e==null?void 0:e.plugins)==null?void 0:s.mux)!=null&&a.data&&(e=du(e)),e}function du(o){var e;return o.plugins.mux.data.player_software_name="vjs-mux-kit-"+((e=ke())==null?void 0:e.VERSION.split(".")[0])+(typeof pi=="function"?"-hlsjs":"-vhs"),o.plugins.mux.data.player_software_version=Nh.rE,o}function fu(o){var e,t;(t=(e=o.tech_)==null?void 0:e.sourceHandler_)==null||t.hls.on(pi.Events.MANIFEST_LOADED,function(i,r){if(r.subtitles){let s;for(s=0;s<r.subtitles.length;s++)o.addRemoteTextTrack({kind:r.subtitles[s].type,label:r.subtitles[s].name,srclang:r.subtitles[s].lang,default:r.subtitles[s].default},!1)}}),o.remoteTextTracks().addEventListener("change",i=>{let r=o.remoteTextTracks(),s,a=!1;for(s=0;s<r.length;s++)r[s].mode==="showing"&&(o.tech_.sourceHandler_.hls.subtitleTrack=s,a=!0);a!==!0&&(o.tech_.sourceHandler_.hls.subtitleTrack=-1)})}const $h={},pu={},Hh=ke().registerPlugin||ke().plugin,Gh=(o,e)=>{o.addClass("vjs-vtt-thumbnails"),o.vttThumbnails=new jh(o,e)},Vh=function(o){this.ready(()=>{Gh(this,ke().mergeOptions($h,o))})};class jh{constructor(e,t){return this.player=e,this.options=t,this.listenForDurationChange(),this.initializeThumbnails(),this.registeredEvents={},this}src(e){this.resetPlugin(),this.options.src=e,this.initializeThumbnails()}detach(){this.resetPlugin()}resetPlugin(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&(this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove)),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle}listenForDurationChange(){this.player.on("durationchange",()=>{})}initializeThumbnails(){if(!this.options.src)return;const e=this.getBaseUrl(),t=this.getFullyQualifiedUrl(this.options.src,e);this.getVttFile(t).then(i=>{this.vttData=this.processVtt(i),this.setupThumbnailElement()})}getBaseUrl(){return[window.location.protocol,"//",window.location.hostname,window.location.port?":"+window.location.port:"",window.location.pathname].join("").split(/([^\/]*)$/gi).shift()}getVttFile(e){return new Promise((t,i)=>{const r=new XMLHttpRequest;r.data={resolve:t},r.addEventListener("load",this.vttFileLoaded),r.open("GET",e),r.overrideMimeType("text/plain; charset=utf-8"),r.send()})}vttFileLoaded(){this.data.resolve(this.responseText)}setupThumbnailElement(e){let t=null;this.options.showTimestamp||(t=this.player.$(".vjs-mouse-display"));const i=document.createElement("div");i.setAttribute("class","vjs-vtt-thumbnail-display"),this.progressBar=this.player.$(".vjs-progress-control"),this.progressBar.appendChild(i),this.thumbnailHolder=i,t&&!this.options.showTimestamp&&t.classList.add("vjs-hidden"),this.registeredEvents.progressBarMouseEnter=()=>this.onBarMouseenter(),this.registeredEvents.progressBarMouseLeave=()=>this.onBarMouseleave(),this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)}onBarMouseenter(){this.mouseMoveCallback=e=>{this.onBarMousemove(e)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()}onBarMouseleave(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()}getXCoord(e,t){const i=e.getBoundingClientRect(),r=document.documentElement;return t-(i.left+(window.pageXOffset||r.scrollLeft||0))}onBarMousemove(e){this.updateThumbnailStyle(ke().dom.getPointerPosition(this.progressBar,e).x,this.progressBar.offsetWidth)}getStyleForTime(e){for(let t=0;t<this.vttData.length;++t){const i=this.vttData[t];if(e>=i.start&&e<i.end){if(i.css.url&&!pu[i.css.url]){const r=new Image;r.src=i.css.url,pu[i.css.url]=r}return i.css}}}showThumbnailHolder(){this.thumbnailHolder.style.opacity="1"}hideThumbnailHolder(){this.thumbnailHolder.style.opacity="0"}updateThumbnailStyle(e,t){const i=this.player.duration(),r=e*i,s=this.getStyleForTime(r);if(!s)return this.hideThumbnailHolder();const a=e*t,c=parseInt(s.width,10),f=c>>1,h=t-(a+f),v=a-f;if(v>0&&h>0?this.thumbnailHolder.style.transform="translateX("+(a-f)+"px)":v<=0?this.thumbnailHolder.style.transform="translateX("+0+"px)":h<=0&&(this.thumbnailHolder.style.transform="translateX("+(t-c)+"px)"),!(this.lastStyle&&this.lastStyle===s)){this.lastStyle=s;for(const y in s)s.hasOwnProperty(y)&&(this.thumbnailHolder.style[y]=s[y])}}processVtt(e){const t=[];return e.split(/[\r\n][\r\n]/i).forEach(r=>{if(r.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){const s=r.split(/[\r\n]/i),c=s[0].split(/ ?--> ?/i),f=c[0],h=c[1],v=s[1],y=this.getVttCss(v);t.push({start:this.getSecondsFromTimestamp(f),end:this.getSecondsFromTimestamp(h),css:y})}}),t}getFullyQualifiedUrl(e,t){return e.indexOf("//")>=0?e:t.indexOf("//")===0?[t.replace(/\/$/gi,""),this.trim(e,"/")].join("/"):t.indexOf("//")>0?[this.trim(t,"/"),this.trim(e,"/")].join("/"):e}getPropsFromDef(e){const t=e.split(/#xywh=/i),i=t[0],s=t[1].match(/[0-9]+/gi);return{x:s[0],y:s[1],w:s[2],h:s[3],image:i}}getVttCss(e){const t={};let i;if(this.options.src.indexOf("//")>=0?i=this.options.src.split(/([^\/]*)$/gi).shift():i=this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),e=this.getFullyQualifiedUrl(e,i),!e.match(/#xywh=/i))return t.background='url("'+e+'")',t;const r=this.getPropsFromDef(e);return t.background='url("'+r.image+'") no-repeat -'+r.x+"px -"+r.y+"px",t.width=r.w+"px",t.height=r.h+"px",t.url=r.image,t}deconstructTimestamp(e){const t=e.split("."),r=t[0].split(":");return{milliseconds:parseInt(t[1],10)||0,seconds:parseInt(r.pop(),10)||0,minutes:parseInt(r.pop(),10)||0,hours:parseInt(r.pop(),10)||0}}getSecondsFromTimestamp(e){const t=this.deconstructTimestamp(e);return parseInt(t.hours*3600+t.minutes*60+t.seconds+t.milliseconds/1e3,10)}trim(e,t){let i=[" ",`
`,"\r","	","\f","\v","\xA0","\u2000","\u2001","\u2002","\u2003","\u2004","\u2005","\u2006","\u2007","\u2008","\u2009","\u200A","\u200B","\u2028","\u2029","\u3000"].join(""),r=0,s=0;for(e+="",t&&(i=(t+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),r=e.length,s=0;s<r;s++)if(i.indexOf(e.charAt(s))===-1){e=e.substring(s);break}for(r=e.length,s=r-1;s>=0;s--)if(i.indexOf(e.charAt(s))===-1){e=e.substring(0,s+1);break}return i.indexOf(e.charAt(0))===-1?e:""}}Hh("vttThumbnails",Vh);const rd=null;function Kh(o){o.timelineHoverPreviews=function(e){let t=(e==null?void 0:e.enabled)||!1,i=(e==null?void 0:e.src)||null;if(!t&&typeof o.vttThumbnails.detach=="function"){o.vttThumbnails.detach(),o.options().timelineHoverPreviewsUrl=null;return}else if(typeof o.vttThumbnails=="function"&&i!==null){o.vttThumbnails({src:i}),o.options().timelineHoverPreviewsUrl=i;return}else if(typeof o.vttThumbnails.src=="function"&&i!==null){o.vttThumbnails.src(i),o.options().timelineHoverPreviewsUrl=i;return}}}ke().hook("beforesetup",function(o,e){return e=Uh(o,e),e}),ke().hook("setup",function(o){Kh(o),o.options().timelineHoverPreviewsUrl&&o.timelineHoverPreviews({enabled:!0,src:o.options().timelineHoverPreviewsUrl})}),ke().use("video/mux",o=>({setSource({src:e},t){const{customDomain:i="mux.com",timelineHoverPreviews:r}=o.options();if(r){let s=e.split("?",1),a=`https://image.${i}/${s[0]}/storyboard.vtt`;o.timelineHoverPreviews({enabled:!0,src:a})}t(null,{src:`https://stream.${i}/${e}`,type:"application/x-mpegurl"}),o.mux&&o.mux.addHLSJS&&Bh(o),typeof fu!="undefined"&&fu(o)}}));const qh=ke()},22:Te=>{function Qe(){return Te.exports=Qe=Object.assign?Object.assign.bind():function(Le){for(var Me=1;Me<arguments.length;Me++){var ke=arguments[Me];for(var _e in ke)({}).hasOwnProperty.call(ke,_e)&&(Le[_e]=ke[_e])}return Le},Te.exports.__esModule=!0,Te.exports.default=Te.exports,Qe.apply(null,arguments)}Te.exports=Qe,Te.exports.__esModule=!0,Te.exports.default=Te.exports},40:Te=>{function Qe(Le,Me){return Te.exports=Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(ke,_e){return ke.__proto__=_e,ke},Te.exports.__esModule=!0,Te.exports.default=Te.exports,Qe(Le,Me)}Te.exports=Qe,Te.exports.__esModule=!0,Te.exports.default=Te.exports},50:(Te,Qe,Le)=>{"use strict";/**
 * @license
 * Video.js 7.21.7 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */var Me=Le(576),ke=Le(913),_e=Le(22),qe=Le(545),_t=Le(711),Ue=Le(449),ut=Le(673),We=Le(500),Et=Le(944),gt=Le(162),gi=Le(187);function Pe(p){return p&&typeof p=="object"&&"default"in p?p:{default:p}}for(var Z=Pe(Me),oe=Pe(ke),Wt=Pe(_e),ze=Pe(qe),Ge=Pe(_t),ge=Pe(Ue),Ye=Pe(ut),It=Pe(We),li=Pe(Et),Ze=Pe(gt),Yt=Pe(gi),Hi="7.21.7",ti={},N=function(m,d){return ti[m]=ti[m]||[],d&&(ti[m]=ti[m].concat(d)),ti[m]},W=function(m,d){N(m,d)},be=function(m,d){var u=N(m).indexOf(d);return u<=-1?!1:(ti[m]=ti[m].slice(),ti[m].splice(u,1),!0)},le=function(m,d){N(m,[].concat(d).map(function(u){var n=function l(){return be(m,l),u.apply(void 0,arguments)};return n}))},H={prefixed:!0},x=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],ye=x[0],ue,Ke=0;Ke<x.length;Ke++)if(x[Ke][1]in oe.default){ue=x[Ke];break}if(ue){for(var Je=0;Je<ue.length;Je++)H[ye[Je]]=ue[Je];H.prefixed=ue[0]!==ye[0]}var Fe=[],me=function(m,d){return function(u,n,l){var g=d.levels[n],A=new RegExp("^("+g+")$");if(u!=="log"&&l.unshift(u.toUpperCase()+":"),l.unshift(m+":"),Fe){Fe.push([].concat(l));var L=Fe.length-1e3;Fe.splice(0,L>0?L:0)}if(Z.default.console){var M=Z.default.console[u];!M&&u==="debug"&&(M=Z.default.console.info||Z.default.console.log),!(!M||!g||!A.test(u))&&M[Array.isArray(l)?"apply":"call"](Z.default.console,l)}}};function ct(p){var m="info",d,u=function(){for(var l=arguments.length,g=new Array(l),A=0;A<l;A++)g[A]=arguments[A];d("log",m,g)};return d=me(p,u),u.createLogger=function(n){return ct(p+": "+n)},u.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:m},u.level=function(n){if(typeof n=="string"){if(!u.levels.hasOwnProperty(n))throw new Error('"'+n+'" in not a valid log level');m=n}return m},u.history=function(){return Fe?[].concat(Fe):[]},u.history.filter=function(n){return(Fe||[]).filter(function(l){return new RegExp(".*"+n+".*").test(l[0])})},u.history.clear=function(){Fe&&(Fe.length=0)},u.history.disable=function(){Fe!==null&&(Fe.length=0,Fe=null)},u.history.enable=function(){Fe===null&&(Fe=[])},u.error=function(){for(var n=arguments.length,l=new Array(n),g=0;g<n;g++)l[g]=arguments[g];return d("error",m,l)},u.warn=function(){for(var n=arguments.length,l=new Array(n),g=0;g<n;g++)l[g]=arguments[g];return d("warn",m,l)},u.debug=function(){for(var n=arguments.length,l=new Array(n),g=0;g<n;g++)l[g]=arguments[g];return d("debug",m,l)},u}var ve=ct("VIDEOJS"),xt=ve.createLogger,Jt=Object.prototype.toString,mt=function(m){return zt(m)?Object.keys(m):[]};function pt(p,m){mt(p).forEach(function(d){return m(p[d],d)})}function Ai(p,m,d){return d===void 0&&(d=0),mt(p).reduce(function(u,n){return m(u,p[n],n)},d)}function Ot(p){for(var m=arguments.length,d=new Array(m>1?m-1:0),u=1;u<m;u++)d[u-1]=arguments[u];return Object.assign?Wt.default.apply(void 0,[p].concat(d)):(d.forEach(function(n){n&&pt(n,function(l,g){p[g]=l})}),p)}function zt(p){return!!p&&typeof p=="object"}function Si(p){return zt(p)&&Jt.call(p)==="[object Object]"&&p.constructor===Object}function ii(p,m){if(!p||!m)return"";if(typeof Z.default.getComputedStyle=="function"){var d;try{d=Z.default.getComputedStyle(p)}catch(u){return""}return d?d.getPropertyValue(m)||d[m]:""}return""}var ui=Z.default.navigator&&Z.default.navigator.userAgent||"",At=/AppleWebKit\/([\d.]+)/i.exec(ui),Zi=At?parseFloat(At.pop()):null,Ms=/iPod/i.test(ui),mn=function(){var p=ui.match(/OS (\d+)_/i);return p&&p[1]?p[1]:null}(),rt=/Android/i.test(ui),Mi=function(){var p=ui.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!p)return null;var m=p[1]&&parseFloat(p[1]),d=p[2]&&parseFloat(p[2]);return m&&d?parseFloat(p[1]+"."+p[2]):m||null}(),Or=rt&&Mi<5&&Zi<537,et=/Firefox/i.test(ui),Gt=/Edg/i.test(ui),Fi=!Gt&&(/Chrome/i.test(ui)||/CriOS/i.test(ui)),Ni=function(){var p=ui.match(/(Chrome|CriOS)\/(\d+)/);return p&&p[2]?parseFloat(p[2]):null}(),Ee=function(){var p=/MSIE\s(\d+)\.\d/.exec(ui),m=p&&parseFloat(p[1]);return!m&&/Trident\/7.0/i.test(ui)&&/rv:11.0/.test(ui)&&(m=11),m}(),Yi=/Safari/i.test(ui)&&!Fi&&!rt&&!Gt,Rt=/Windows/i.test(ui),er=Boolean(Bt()&&("ontouchstart"in Z.default||Z.default.navigator.maxTouchPoints||Z.default.DocumentTouch&&Z.default.document instanceof Z.default.DocumentTouch)),Xt=/iPad/i.test(ui)||Yi&&er&&!/iPhone/i.test(ui),Mr=/iPhone/i.test(ui)&&!Xt,mi=Mr||Xt||Ms,vi=(Yi||mi)&&!Fi,Fr=Object.freeze({__proto__:null,IS_IPOD:Ms,IOS_VERSION:mn,IS_ANDROID:rt,ANDROID_VERSION:Mi,IS_NATIVE_ANDROID:Or,IS_FIREFOX:et,IS_EDGE:Gt,IS_CHROME:Fi,CHROME_VERSION:Ni,IE_VERSION:Ee,IS_SAFARI:Yi,IS_WINDOWS:Rt,TOUCH_ENABLED:er,IS_IPAD:Xt,IS_IPHONE:Mr,IS_IOS:mi,IS_ANY_SAFARI:vi});function Nr(p){return typeof p=="string"&&Boolean(p.trim())}function Br(p){if(p.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function Zt(p){return new RegExp("(^|\\s)"+p+"($|\\s)")}function Bt(){return oe.default===Z.default.document}function zi(p){return zt(p)&&p.nodeType===1}function tt(){try{return Z.default.parent!==Z.default.self}catch(p){return!0}}function Fs(p){return function(m,d){if(!Nr(m))return oe.default[p](null);Nr(d)&&(d=oe.default.querySelector(d));var u=zi(d)?d:oe.default;return u[p]&&u[p](m)}}function Tt(p,m,d,u){p===void 0&&(p="div"),m===void 0&&(m={}),d===void 0&&(d={});var n=oe.default.createElement(p);return Object.getOwnPropertyNames(m).forEach(function(l){var g=m[l];l.indexOf("aria-")!==-1||l==="role"||l==="type"?(ve.warn(`Setting attributes in the second argument of createEl()
has been deprecated. Use the third argument instead.
`+("createEl(type, properties, attributes). Attempting to set "+l+" to "+g+".")),n.setAttribute(l,g)):l==="textContent"?Gi(n,g):(n[l]!==g||l==="tabIndex")&&(n[l]=g)}),Object.getOwnPropertyNames(d).forEach(function(l){n.setAttribute(l,d[l])}),u&&ps(n,u),n}function Gi(p,m){return typeof p.textContent=="undefined"?p.innerText=m:p.textContent=m,p}function ht(p,m){m.firstChild?m.insertBefore(p,m.firstChild):m.appendChild(p)}function Vi(p,m){return Br(m),p.classList?p.classList.contains(m):Zt(m).test(p.className)}function xi(p,m){return p.classList?p.classList.add(m):Vi(p,m)||(p.className=(p.className+" "+m).trim()),p}function br(p,m){return p?(p.classList?p.classList.remove(m):(Br(m),p.className=p.className.split(/\s+/).filter(function(d){return d!==m}).join(" ")),p):(ve.warn("removeClass was called with an element that doesn't exist"),null)}function Ur(p,m,d){var u=Vi(p,m);if(typeof d=="function"&&(d=d(p,m)),typeof d!="boolean"&&(d=!u),d!==u)return d?xi(p,m):br(p,m),p}function vn(p,m){Object.getOwnPropertyNames(m).forEach(function(d){var u=m[d];u===null||typeof u=="undefined"||u===!1?p.removeAttribute(d):p.setAttribute(d,u===!0?"":u)})}function Bi(p){var m={},d=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(p&&p.attributes&&p.attributes.length>0)for(var u=p.attributes,n=u.length-1;n>=0;n--){var l=u[n].name,g=u[n].value;(typeof p[l]=="boolean"||d.indexOf(","+l+",")!==-1)&&(g=g!==null),m[l]=g}return m}function Sr(p,m){return p.getAttribute(m)}function yi(p,m,d){p.setAttribute(m,d)}function cs(p,m){p.removeAttribute(m)}function hs(){oe.default.body.focus(),oe.default.onselectstart=function(){return!1}}function yn(){oe.default.onselectstart=function(){return!0}}function xr(p){if(p&&p.getBoundingClientRect&&p.parentNode){var m=p.getBoundingClientRect(),d={};return["bottom","height","left","right","top","width"].forEach(function(u){m[u]!==void 0&&(d[u]=m[u])}),d.height||(d.height=parseFloat(ii(p,"height"))),d.width||(d.width=parseFloat(ii(p,"width"))),d}}function fi(p){if(!p||p&&!p.offsetParent)return{left:0,top:0,width:0,height:0};for(var m=p.offsetWidth,d=p.offsetHeight,u=0,n=0;p.offsetParent&&p!==oe.default[H.fullscreenElement];)u+=p.offsetLeft,n+=p.offsetTop,p=p.offsetParent;return{left:u,top:n,width:m,height:d}}function $r(p,m){var d={x:0,y:0};if(mi)for(var u=p;u&&u.nodeName.toLowerCase()!=="html";){var n=ii(u,"transform");if(/^matrix/.test(n)){var l=n.slice(7,-1).split(/,\s/).map(Number);d.x+=l[4],d.y+=l[5]}else if(/^matrix3d/.test(n)){var g=n.slice(9,-1).split(/,\s/).map(Number);d.x+=g[12],d.y+=g[13]}u=u.parentNode}var A={},L=fi(m.target),M=fi(p),G=M.width,Q=M.height,$=m.offsetY-(M.top-L.top),fe=m.offsetX-(M.left-L.left);return m.changedTouches&&(fe=m.changedTouches[0].pageX-M.left,$=m.changedTouches[0].pageY+M.top,mi&&(fe-=d.x,$-=d.y)),A.y=1-Math.max(0,Math.min(1,$/Q)),A.x=Math.max(0,Math.min(1,fe/G)),A}function Hr(p){return zt(p)&&p.nodeType===3}function ds(p){for(;p.firstChild;)p.removeChild(p.firstChild);return p}function fs(p){return typeof p=="function"&&(p=p()),(Array.isArray(p)?p:[p]).map(function(m){if(typeof m=="function"&&(m=m()),zi(m)||Hr(m))return m;if(typeof m=="string"&&/\S/.test(m))return oe.default.createTextNode(m)}).filter(function(m){return m})}function ps(p,m){return fs(m).forEach(function(d){return p.appendChild(d)}),p}function _n(p,m){return ps(ds(p),m)}function Gr(p){return p.button===void 0&&p.buttons===void 0||p.button===0&&p.buttons===void 0||p.type==="mouseup"&&p.button===0&&p.buttons===0?!0:!(p.button!==0||p.buttons!==1)}var tr=Fs("querySelector"),Ns=Fs("querySelectorAll"),ir=Object.freeze({__proto__:null,isReal:Bt,isEl:zi,isInFrame:tt,createEl:Tt,textContent:Gi,prependTo:ht,hasClass:Vi,addClass:xi,removeClass:br,toggleClass:Ur,setAttributes:vn,getAttributes:Bi,getAttribute:Sr,setAttribute:yi,removeAttribute:cs,blockTextSelection:hs,unblockTextSelection:yn,getBoundingClientRect:xr,findPosition:fi,getPointerPosition:$r,isTextNode:Hr,emptyEl:ds,normalizeContent:fs,appendContent:ps,insertContent:_n,isSingleLeftClick:Gr,$:tr,$$:Ns}),gs=!1,Vr,ms=function(){if(Vr.options.autoSetup!==!1){var m=Array.prototype.slice.call(oe.default.getElementsByTagName("video")),d=Array.prototype.slice.call(oe.default.getElementsByTagName("audio")),u=Array.prototype.slice.call(oe.default.getElementsByTagName("video-js")),n=m.concat(d,u);if(n&&n.length>0)for(var l=0,g=n.length;l<g;l++){var A=n[l];if(A&&A.getAttribute){if(A.player===void 0){var L=A.getAttribute("data-setup");L!==null&&Vr(A)}}else{hr(1);break}}else gs||hr(1)}};function hr(p,m){Bt()&&(m&&(Vr=m),Z.default.setTimeout(ms,p))}function vs(){gs=!0,Z.default.removeEventListener("load",vs)}Bt()&&(oe.default.readyState==="complete"?vs():Z.default.addEventListener("load",vs));var dr=function(m){var d=oe.default.createElement("style");return d.className=m,d},jr=function(m,d){m.styleSheet?m.styleSheet.cssText=d:m.textContent=d},Tn=3,En=Tn;function Li(){return En++}var bn;Z.default.WeakMap||(bn=function(){function p(){this.vdata="vdata"+Math.floor(Z.default.performance&&Z.default.performance.now()||Date.now()),this.data={}}var m=p.prototype;return m.set=function(u,n){var l=u[this.vdata]||Li();return u[this.vdata]||(u[this.vdata]=l),this.data[l]=n,this},m.get=function(u){var n=u[this.vdata];if(n)return this.data[n];ve("We have no data for this element",u)},m.has=function(u){var n=u[this.vdata];return n in this.data},m.delete=function(u){var n=u[this.vdata];n&&(delete this.data[n],delete u[this.vdata])},p}());var ci=Z.default.WeakMap?new WeakMap:new bn;function Bs(p,m){if(ci.has(p)){var d=ci.get(p);d.handlers[m].length===0&&(delete d.handlers[m],p.removeEventListener?p.removeEventListener(m,d.dispatcher,!1):p.detachEvent&&p.detachEvent("on"+m,d.dispatcher)),Object.getOwnPropertyNames(d.handlers).length<=0&&(delete d.handlers,delete d.dispatcher,delete d.disabled),Object.getOwnPropertyNames(d).length===0&&ci.delete(p)}}function ys(p,m,d,u){d.forEach(function(n){p(m,n,u)})}function Kr(p){if(p.fixed_)return p;function m(){return!0}function d(){return!1}if(!p||!p.isPropagationStopped||!p.isImmediatePropagationStopped){var u=p||Z.default.event;p={};for(var n in u)n!=="layerX"&&n!=="layerY"&&n!=="keyLocation"&&n!=="webkitMovementX"&&n!=="webkitMovementY"&&n!=="path"&&(n==="returnValue"&&u.preventDefault||(p[n]=u[n]));if(p.target||(p.target=p.srcElement||oe.default),p.relatedTarget||(p.relatedTarget=p.fromElement===p.target?p.toElement:p.fromElement),p.preventDefault=function(){u.preventDefault&&u.preventDefault(),p.returnValue=!1,u.returnValue=!1,p.defaultPrevented=!0},p.defaultPrevented=!1,p.stopPropagation=function(){u.stopPropagation&&u.stopPropagation(),p.cancelBubble=!0,u.cancelBubble=!0,p.isPropagationStopped=m},p.isPropagationStopped=d,p.stopImmediatePropagation=function(){u.stopImmediatePropagation&&u.stopImmediatePropagation(),p.isImmediatePropagationStopped=m,p.stopPropagation()},p.isImmediatePropagationStopped=d,p.clientX!==null&&p.clientX!==void 0){var l=oe.default.documentElement,g=oe.default.body;p.pageX=p.clientX+(l&&l.scrollLeft||g&&g.scrollLeft||0)-(l&&l.clientLeft||g&&g.clientLeft||0),p.pageY=p.clientY+(l&&l.scrollTop||g&&g.scrollTop||0)-(l&&l.clientTop||g&&g.clientTop||0)}p.which=p.charCode||p.keyCode,p.button!==null&&p.button!==void 0&&(p.button=p.button&1?0:p.button&4?1:p.button&2?2:0)}return p.fixed_=!0,p}var qr,Us=function(){if(typeof qr!="boolean"){qr=!1;try{var m=Object.defineProperty({},"passive",{get:function(){qr=!0}});Z.default.addEventListener("test",null,m),Z.default.removeEventListener("test",null,m)}catch(d){}}return qr},$s=["touchstart","touchmove"];function _i(p,m,d){if(Array.isArray(m))return ys(_i,p,m,d);ci.has(p)||ci.set(p,{});var u=ci.get(p);if(u.handlers||(u.handlers={}),u.handlers[m]||(u.handlers[m]=[]),d.guid||(d.guid=Li()),u.handlers[m].push(d),u.dispatcher||(u.disabled=!1,u.dispatcher=function(l,g){if(!u.disabled){l=Kr(l);var A=u.handlers[l.type];if(A)for(var L=A.slice(0),M=0,G=L.length;M<G&&!l.isImmediatePropagationStopped();M++)try{L[M].call(p,l,g)}catch(Q){ve.error(Q)}}}),u.handlers[m].length===1)if(p.addEventListener){var n=!1;Us()&&$s.indexOf(m)>-1&&(n={passive:!0}),p.addEventListener(m,u.dispatcher,n)}else p.attachEvent&&p.attachEvent("on"+m,u.dispatcher)}function hi(p,m,d){if(ci.has(p)){var u=ci.get(p);if(u.handlers){if(Array.isArray(m))return ys(hi,p,m,d);var n=function(M,G){u.handlers[G]=[],Bs(M,G)};if(m===void 0){for(var l in u.handlers)Object.prototype.hasOwnProperty.call(u.handlers||{},l)&&n(p,l);return}var g=u.handlers[m];if(g){if(!d){n(p,m);return}if(d.guid)for(var A=0;A<g.length;A++)g[A].guid===d.guid&&g.splice(A--,1);Bs(p,m)}}}}function Ii(p,m,d){var u=ci.has(p)?ci.get(p):{},n=p.parentNode||p.ownerDocument;if(typeof m=="string"?m={type:m,target:p}:m.target||(m.target=p),m=Kr(m),u.dispatcher&&u.dispatcher.call(p,m,d),n&&!m.isPropagationStopped()&&m.bubbles===!0)Ii.call(null,n,m,d);else if(!n&&!m.defaultPrevented&&m.target&&m.target[m.type]){ci.has(m.target)||ci.set(m.target,{});var l=ci.get(m.target);m.target[m.type]&&(l.disabled=!0,typeof m.target[m.type]=="function"&&m.target[m.type](),l.disabled=!1)}return!m.defaultPrevented}function _s(p,m,d){if(Array.isArray(m))return ys(_s,p,m,d);var u=function n(){hi(p,m,n),d.apply(this,arguments)};u.guid=d.guid=d.guid||Li(),_i(p,m,u)}function Sn(p,m,d){var u=function n(){hi(p,m,n),d.apply(this,arguments)};u.guid=d.guid=d.guid||Li(),_i(p,m,u)}var na=Object.freeze({__proto__:null,fixEvent:Kr,on:_i,off:hi,trigger:Ii,one:_s,any:Sn}),ki=30,Lt=function(m,d,u){d.guid||(d.guid=Li());var n=d.bind(m);return n.guid=u?u+"_"+d.guid:d.guid,n},Ui=function(m,d){var u=Z.default.performance.now(),n=function(){var g=Z.default.performance.now();g-u>=d&&(m.apply(void 0,arguments),u=g)};return n},xn=function(m,d,u,n){n===void 0&&(n=Z.default);var l,g=function(){n.clearTimeout(l),l=null},A=function(){var M=this,G=arguments,Q=function(){l=null,Q=null,u||m.apply(M,G)};!l&&u&&m.apply(M,G),n.clearTimeout(l),l=n.setTimeout(Q,d)};return A.cancel=g,A},ei=function(){};ei.prototype.allowedEvents_={},ei.prototype.on=function(p,m){var d=this.addEventListener;this.addEventListener=function(){},_i(this,p,m),this.addEventListener=d},ei.prototype.addEventListener=ei.prototype.on,ei.prototype.off=function(p,m){hi(this,p,m)},ei.prototype.removeEventListener=ei.prototype.off,ei.prototype.one=function(p,m){var d=this.addEventListener;this.addEventListener=function(){},_s(this,p,m),this.addEventListener=d},ei.prototype.any=function(p,m){var d=this.addEventListener;this.addEventListener=function(){},Sn(this,p,m),this.addEventListener=d},ei.prototype.trigger=function(p){var m=p.type||p;typeof p=="string"&&(p={type:m}),p=Kr(p),this.allowedEvents_[m]&&this["on"+m]&&this["on"+m](p),Ii(this,p)},ei.prototype.dispatchEvent=ei.prototype.trigger;var Wr;ei.prototype.queueTrigger=function(p){var m=this;Wr||(Wr=new Map);var d=p.type||p,u=Wr.get(this);u||(u=new Map,Wr.set(this,u));var n=u.get(d);u.delete(d),Z.default.clearTimeout(n);var l=Z.default.setTimeout(function(){u.delete(d),u.size===0&&(u=null,Wr.delete(m)),m.trigger(p)},0);u.set(d,l)};var fr=function(m){return typeof m.name=="function"?m.name():typeof m.name=="string"?m.name:m.name_?m.name_:m.constructor&&m.constructor.name?m.constructor.name:typeof m},ji=function(m){return m instanceof ei||!!m.eventBusEl_&&["on","one","off","trigger"].every(function(d){return typeof m[d]=="function"})},An=function(m,d){ji(m)?d():(m.eventedCallbacks||(m.eventedCallbacks=[]),m.eventedCallbacks.push(d))},pr=function(m){return typeof m=="string"&&/\S/.test(m)||Array.isArray(m)&&!!m.length},Yr=function(m,d,u){if(!m||!m.nodeName&&!ji(m))throw new Error("Invalid target for "+fr(d)+"#"+u+"; must be a DOM node or evented object.")},Ln=function(m,d,u){if(!pr(m))throw new Error("Invalid event type for "+fr(d)+"#"+u+"; must be a non-empty string or array.")},Hs=function(m,d,u){if(typeof m!="function")throw new Error("Invalid listener for "+fr(d)+"#"+u+"; must be a function.")},Gs=function(m,d,u){var n=d.length<3||d[0]===m||d[0]===m.eventBusEl_,l,g,A;return n?(l=m.eventBusEl_,d.length>=3&&d.shift(),g=d[0],A=d[1]):(l=d[0],g=d[1],A=d[2]),Yr(l,m,u),Ln(g,m,u),Hs(A,m,u),A=Lt(m,A),{isTargetingSelf:n,target:l,type:g,listener:A}},kt=function(m,d,u,n){Yr(m,m,d),m.nodeName?na[d](m,u,n):m[d](u,n)},aa={on:function(){for(var m=this,d=arguments.length,u=new Array(d),n=0;n<d;n++)u[n]=arguments[n];var l=Gs(this,u,"on"),g=l.isTargetingSelf,A=l.target,L=l.type,M=l.listener;if(kt(A,"on",L,M),!g){var G=function(){return m.off(A,L,M)};G.guid=M.guid;var Q=function(){return m.off("dispose",G)};Q.guid=M.guid,kt(this,"on","dispose",G),kt(A,"on","dispose",Q)}},one:function(){for(var m=this,d=arguments.length,u=new Array(d),n=0;n<d;n++)u[n]=arguments[n];var l=Gs(this,u,"one"),g=l.isTargetingSelf,A=l.target,L=l.type,M=l.listener;if(g)kt(A,"one",L,M);else{var G=function Q(){m.off(A,L,Q);for(var $=arguments.length,fe=new Array($),$e=0;$e<$;$e++)fe[$e]=arguments[$e];M.apply(null,fe)};G.guid=M.guid,kt(A,"one",L,G)}},any:function(){for(var m=this,d=arguments.length,u=new Array(d),n=0;n<d;n++)u[n]=arguments[n];var l=Gs(this,u,"any"),g=l.isTargetingSelf,A=l.target,L=l.type,M=l.listener;if(g)kt(A,"any",L,M);else{var G=function Q(){m.off(A,L,Q);for(var $=arguments.length,fe=new Array($),$e=0;$e<$;$e++)fe[$e]=arguments[$e];M.apply(null,fe)};G.guid=M.guid,kt(A,"any",L,G)}},off:function(m,d,u){if(!m||pr(m))hi(this.eventBusEl_,m,d);else{var n=m,l=d;Yr(n,this,"off"),Ln(l,this,"off"),Hs(u,this,"off"),u=Lt(this,u),this.off("dispose",u),n.nodeName?(hi(n,l,u),hi(n,"dispose",u)):ji(n)&&(n.off(l,u),n.off("dispose",u))}},trigger:function(m,d){Yr(this.eventBusEl_,this,"trigger");var u=m&&typeof m!="string"?m.type:m;if(!pr(u)){var n="Invalid event type for "+fr(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(m)(this.log||ve).error(n);else throw new Error(n)}return Ii(this.eventBusEl_,m,d)}};function Ri(p,m){m===void 0&&(m={});var d=m,u=d.eventBusKey;if(u){if(!p[u].nodeName)throw new Error('The eventBusKey "'+u+'" does not refer to an element.');p.eventBusEl_=p[u]}else p.eventBusEl_=Tt("span",{className:"vjs-event-bus"});return Ot(p,aa),p.eventedCallbacks&&p.eventedCallbacks.forEach(function(n){n()}),p.on("dispose",function(){p.off(),[p,p.el_,p.eventBusEl_].forEach(function(n){n&&ci.has(n)&&ci.delete(n)}),Z.default.setTimeout(function(){p.eventBusEl_=null},0)}),p}var In={state:{},setState:function(m){var d=this;typeof m=="function"&&(m=m());var u;return pt(m,function(n,l){d.state[l]!==n&&(u=u||{},u[l]={from:d.state[l],to:n}),d.state[l]=n}),u&&ji(this)&&this.trigger({changes:u,type:"statechanged"}),u}};function Ar(p,m){return Ot(p,In),p.state=Ot({},p.state,m),typeof p.handleStateChanged=="function"&&ji(p)&&p.on("statechanged",p.handleStateChanged),p}var zr=function(m){return typeof m!="string"?m:m.replace(/./,function(d){return d.toLowerCase()})},wt=function(m){return typeof m!="string"?m:m.replace(/./,function(d){return d.toUpperCase()})},wi=function(m,d){return wt(m)===wt(d)};function Dt(){for(var p={},m=arguments.length,d=new Array(m),u=0;u<m;u++)d[u]=arguments[u];return d.forEach(function(n){n&&pt(n,function(l,g){if(!Si(l)){p[g]=l;return}Si(p[g])||(p[g]={}),p[g]=Dt(p[g],l)})}),p}var oa=function(){function p(){this.map_={}}var m=p.prototype;return m.has=function(u){return u in this.map_},m.delete=function(u){var n=this.has(u);return delete this.map_[u],n},m.set=function(u,n){return this.map_[u]=n,this},m.forEach=function(u,n){for(var l in this.map_)u.call(n,this.map_[l],l,this)},p}(),gr=Z.default.Map?Z.default.Map:oa,la=function(){function p(){this.set_={}}var m=p.prototype;return m.has=function(u){return u in this.set_},m.delete=function(u){var n=this.has(u);return delete this.set_[u],n},m.add=function(u){return this.set_[u]=1,this},m.forEach=function(u,n){for(var l in this.set_)u.call(n,l,l,this)},p}(),Ts=Z.default.Set?Z.default.Set:la,ce=function(){function p(d,u,n){var l=this;if(!d&&this.play?this.player_=d=this:this.player_=d,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Dt({},this.options_),u=this.options_=Dt(this.options_,u),this.id_=u.id||u.el&&u.el.id,!this.id_){var g=d&&d.id&&d.id()||"no_player";this.id_=g+"_component_"+Li()}this.name_=u.name||null,u.el?this.el_=u.el:u.createEl!==!1&&(this.el_=this.createEl()),u.className&&this.el_&&u.className.split(" ").forEach(function(A){return l.addClass(A)}),u.evented!==!1&&(Ri(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Ar(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Ts,this.setIntervalIds_=new Ts,this.rafIds_=new Ts,this.namedRafs_=new gr,this.clearingTimersOnDispose_=!1,u.initChildren!==!1&&this.initChildren(),this.ready(n),u.reportTouchActivity!==!1&&this.enableTouchActivity()}var m=p.prototype;return m.dispose=function(u){if(u===void 0&&(u={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var n=this.children_.length-1;n>=0;n--)this.children_[n].dispose&&this.children_[n].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(u.restoreEl?this.el_.parentNode.replaceChild(u.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},m.isDisposed=function(){return Boolean(this.isDisposed_)},m.player=function(){return this.player_},m.options=function(u){return u?(this.options_=Dt(this.options_,u),this.options_):this.options_},m.el=function(){return this.el_},m.createEl=function(u,n,l){return Tt(u,n,l)},m.localize=function(u,n,l){l===void 0&&(l=u);var g=this.player_.language&&this.player_.language(),A=this.player_.languages&&this.player_.languages(),L=A&&A[g],M=g&&g.split("-")[0],G=A&&A[M],Q=l;return L&&L[u]?Q=L[u]:G&&G[u]&&(Q=G[u]),n&&(Q=Q.replace(/\{(\d+)\}/g,function($,fe){var $e=n[fe-1],bt=$e;return typeof $e=="undefined"&&(bt=$),bt})),Q},m.handleLanguagechange=function(){},m.contentEl=function(){return this.contentEl_||this.el_},m.id=function(){return this.id_},m.name=function(){return this.name_},m.children=function(){return this.children_},m.getChildById=function(u){return this.childIndex_[u]},m.getChild=function(u){if(u)return this.childNameIndex_[u]},m.getDescendant=function(){for(var u=arguments.length,n=new Array(u),l=0;l<u;l++)n[l]=arguments[l];n=n.reduce(function(L,M){return L.concat(M)},[]);for(var g=this,A=0;A<n.length;A++)if(g=g.getChild(n[A]),!g||!g.getChild)return;return g},m.addChild=function(u,n,l){n===void 0&&(n={}),l===void 0&&(l=this.children_.length);var g,A;if(typeof u=="string"){A=wt(u);var L=n.componentClass||A;n.name=A;var M=p.getComponent(L);if(!M)throw new Error("Component "+L+" does not exist");if(typeof M!="function")return null;g=new M(this.player_||this,n)}else g=u;if(g.parentComponent_&&g.parentComponent_.removeChild(g),this.children_.splice(l,0,g),g.parentComponent_=this,typeof g.id=="function"&&(this.childIndex_[g.id()]=g),A=A||g.name&&wt(g.name()),A&&(this.childNameIndex_[A]=g,this.childNameIndex_[zr(A)]=g),typeof g.el=="function"&&g.el()){var G=null;this.children_[l+1]&&(this.children_[l+1].el_?G=this.children_[l+1].el_:zi(this.children_[l+1])&&(G=this.children_[l+1])),this.contentEl().insertBefore(g.el(),G)}return g},m.removeChild=function(u){if(typeof u=="string"&&(u=this.getChild(u)),!(!u||!this.children_)){for(var n=!1,l=this.children_.length-1;l>=0;l--)if(this.children_[l]===u){n=!0,this.children_.splice(l,1);break}if(n){u.parentComponent_=null,this.childIndex_[u.id()]=null,this.childNameIndex_[wt(u.name())]=null,this.childNameIndex_[zr(u.name())]=null;var g=u.el();g&&g.parentNode===this.contentEl()&&this.contentEl().removeChild(u.el())}}},m.initChildren=function(){var u=this,n=this.options_.children;if(n){var l=this.options_,g=function(G){var Q=G.name,$=G.opts;if(l[Q]!==void 0&&($=l[Q]),$!==!1){$===!0&&($={}),$.playerOptions=u.options_.playerOptions;var fe=u.addChild(Q,$);fe&&(u[Q]=fe)}},A,L=p.getComponent("Tech");Array.isArray(n)?A=n:A=Object.keys(n),A.concat(Object.keys(this.options_).filter(function(M){return!A.some(function(G){return typeof G=="string"?M===G:M===G.name})})).map(function(M){var G,Q;return typeof M=="string"?(G=M,Q=n[G]||u.options_[G]||{}):(G=M.name,Q=M),{name:G,opts:Q}}).filter(function(M){var G=p.getComponent(M.opts.componentClass||wt(M.name));return G&&!L.isTech(G)}).forEach(g)}},m.buildCSSClass=function(){return""},m.ready=function(u,n){if(n===void 0&&(n=!1),!!u){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(u);return}n?u.call(this):this.setTimeout(u,1)}},m.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var u=this.readyQueue_;this.readyQueue_=[],u&&u.length>0&&u.forEach(function(n){n.call(this)},this),this.trigger("ready")},1)},m.$=function(u,n){return tr(u,n||this.contentEl())},m.$$=function(u,n){return Ns(u,n||this.contentEl())},m.hasClass=function(u){return Vi(this.el_,u)},m.addClass=function(u){xi(this.el_,u)},m.removeClass=function(u){br(this.el_,u)},m.toggleClass=function(u,n){Ur(this.el_,u,n)},m.show=function(){this.removeClass("vjs-hidden")},m.hide=function(){this.addClass("vjs-hidden")},m.lockShowing=function(){this.addClass("vjs-lock-showing")},m.unlockShowing=function(){this.removeClass("vjs-lock-showing")},m.getAttribute=function(u){return Sr(this.el_,u)},m.setAttribute=function(u,n){yi(this.el_,u,n)},m.removeAttribute=function(u){cs(this.el_,u)},m.width=function(u,n){return this.dimension("width",u,n)},m.height=function(u,n){return this.dimension("height",u,n)},m.dimensions=function(u,n){this.width(u,!0),this.height(n)},m.dimension=function(u,n,l){if(n!==void 0){(n===null||n!==n)&&(n=0),(""+n).indexOf("%")!==-1||(""+n).indexOf("px")!==-1?this.el_.style[u]=n:n==="auto"?this.el_.style[u]="":this.el_.style[u]=n+"px",l||this.trigger("componentresize");return}if(!this.el_)return 0;var g=this.el_.style[u],A=g.indexOf("px");return parseInt(A!==-1?g.slice(0,A):this.el_["offset"+wt(u)],10)},m.currentDimension=function(u){var n=0;if(u!=="width"&&u!=="height")throw new Error("currentDimension only accepts width or height value");if(n=ii(this.el_,u),n=parseFloat(n),n===0||isNaN(n)){var l="offset"+wt(u);n=this.el_[l]}return n},m.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},m.currentWidth=function(){return this.currentDimension("width")},m.currentHeight=function(){return this.currentDimension("height")},m.focus=function(){this.el_.focus()},m.blur=function(){this.el_.blur()},m.handleKeyDown=function(u){this.player_&&(ze.default.isEventKey(u,"Tab")||u.stopPropagation(),this.player_.handleKeyDown(u))},m.handleKeyPress=function(u){this.handleKeyDown(u)},m.emitTapEvents=function(){var u=0,n=null,l=10,g=200,A;this.on("touchstart",function(M){M.touches.length===1&&(n={pageX:M.touches[0].pageX,pageY:M.touches[0].pageY},u=Z.default.performance.now(),A=!0)}),this.on("touchmove",function(M){if(M.touches.length>1)A=!1;else if(n){var G=M.touches[0].pageX-n.pageX,Q=M.touches[0].pageY-n.pageY,$=Math.sqrt(G*G+Q*Q);$>l&&(A=!1)}});var L=function(){A=!1};this.on("touchleave",L),this.on("touchcancel",L),this.on("touchend",function(M){if(n=null,A===!0){var G=Z.default.performance.now()-u;G<g&&(M.preventDefault(),this.trigger("tap"))}})},m.enableTouchActivity=function(){if(!(!this.player()||!this.player().reportUserActivity)){var u=Lt(this.player(),this.player().reportUserActivity),n;this.on("touchstart",function(){u(),this.clearInterval(n),n=this.setInterval(u,250)});var l=function(A){u(),this.clearInterval(n)};this.on("touchmove",u),this.on("touchend",l),this.on("touchcancel",l)}},m.setTimeout=function(u,n){var l=this,g;return u=Lt(this,u),this.clearTimersOnDispose_(),g=Z.default.setTimeout(function(){l.setTimeoutIds_.has(g)&&l.setTimeoutIds_.delete(g),u()},n),this.setTimeoutIds_.add(g),g},m.clearTimeout=function(u){return this.setTimeoutIds_.has(u)&&(this.setTimeoutIds_.delete(u),Z.default.clearTimeout(u)),u},m.setInterval=function(u,n){u=Lt(this,u),this.clearTimersOnDispose_();var l=Z.default.setInterval(u,n);return this.setIntervalIds_.add(l),l},m.clearInterval=function(u){return this.setIntervalIds_.has(u)&&(this.setIntervalIds_.delete(u),Z.default.clearInterval(u)),u},m.requestAnimationFrame=function(u){var n=this;if(!this.supportsRaf_)return this.setTimeout(u,1e3/60);this.clearTimersOnDispose_();var l;return u=Lt(this,u),l=Z.default.requestAnimationFrame(function(){n.rafIds_.has(l)&&n.rafIds_.delete(l),u()}),this.rafIds_.add(l),l},m.requestNamedAnimationFrame=function(u,n){var l=this;if(!this.namedRafs_.has(u)){this.clearTimersOnDispose_(),n=Lt(this,n);var g=this.requestAnimationFrame(function(){n(),l.namedRafs_.has(u)&&l.namedRafs_.delete(u)});return this.namedRafs_.set(u,g),u}},m.cancelNamedAnimationFrame=function(u){this.namedRafs_.has(u)&&(this.cancelAnimationFrame(this.namedRafs_.get(u)),this.namedRafs_.delete(u))},m.cancelAnimationFrame=function(u){return this.supportsRaf_?(this.rafIds_.has(u)&&(this.rafIds_.delete(u),Z.default.cancelAnimationFrame(u)),u):this.clearTimeout(u)},m.clearTimersOnDispose_=function(){var u=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(n){var l=n[0],g=n[1];u[l].forEach(function(A,L){return u[g](L)})}),u.clearingTimersOnDispose_=!1}))},p.registerComponent=function(u,n){if(typeof u!="string"||!u)throw new Error('Illegal component name, "'+u+'"; must be a non-empty string.');var l=p.getComponent("Tech"),g=l&&l.isTech(n),A=p===n||p.prototype.isPrototypeOf(n.prototype);if(g||!A){var L;throw g?L="techs must be registered using Tech.registerTech()":L="must be a Component subclass",new Error('Illegal component, "'+u+'"; '+L+".")}u=wt(u),p.components_||(p.components_={});var M=p.getComponent("Player");if(u==="Player"&&M&&M.players){var G=M.players,Q=Object.keys(G);if(G&&Q.length>0&&Q.map(function($){return G[$]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return p.components_[u]=n,p.components_[zr(u)]=n,n},p.getComponent=function(u){if(!(!u||!p.components_))return p.components_[u]},p}();ce.prototype.supportsRaf_=typeof Z.default.requestAnimationFrame=="function"&&typeof Z.default.cancelAnimationFrame=="function",ce.registerComponent("Component",ce);function ua(p,m,d){if(typeof m!="number"||m<0||m>d)throw new Error("Failed to execute '"+p+"' on 'TimeRanges': The index provided ("+m+") is non-numeric or out of bounds (0-"+d+").")}function Vs(p,m,d,u){return ua(p,u,d.length-1),d[u][m]}function Lr(p){var m;return p===void 0||p.length===0?m={length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:m={length:p.length,start:Vs.bind(null,"start",0,p),end:Vs.bind(null,"end",1,p)},Z.default.Symbol&&Z.default.Symbol.iterator&&(m[Z.default.Symbol.iterator]=function(){return(p||[]).values()}),m}function Ti(p,m){return Array.isArray(p)?Lr(p):p===void 0||m===void 0?Lr():Lr([[p,m]])}function js(p,m){var d=0,u,n;if(!m)return 0;(!p||!p.length)&&(p=Ti(0,0));for(var l=0;l<p.length;l++)u=p.start(l),n=p.end(l),n>m&&(n=m),d+=n-u;return d/m}function di(p){if(p instanceof di)return p;typeof p=="number"?this.code=p:typeof p=="string"?this.message=p:zt(p)&&(typeof p.code=="number"&&(this.code=p.code),Ot(this,p)),this.message||(this.message=di.defaultMessages[this.code]||"")}di.prototype.code=0,di.prototype.message="",di.prototype.status=null,di.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],di.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var Ir=0;Ir<di.errorTypes.length;Ir++)di[di.errorTypes[Ir]]=Ir,di.prototype[di.errorTypes[Ir]]=Ir;function Cr(p){return p!=null&&typeof p.then=="function"}function Ci(p){Cr(p)&&p.then(null,function(m){})}var Es=function(m){var d=["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(u,n,l){return m[n]&&(u[n]=m[n]),u},{cues:m.cues&&Array.prototype.map.call(m.cues,function(u){return{startTime:u.startTime,endTime:u.endTime,text:u.text,id:u.id}})});return d},Ks=function(m){var d=m.$$("track"),u=Array.prototype.map.call(d,function(l){return l.track}),n=Array.prototype.map.call(d,function(l){var g=Es(l.track);return l.src&&(g.src=l.src),g});return n.concat(Array.prototype.filter.call(m.textTracks(),function(l){return u.indexOf(l)===-1}).map(Es))},Cn=function(m,d){return m.forEach(function(u){var n=d.addRemoteTextTrack(u).track;!u.src&&u.cues&&u.cues.forEach(function(l){return n.addCue(l)})}),d.textTracks()},Xr={textTracksToJson:Ks,jsonToTextTracks:Cn,trackToJson_:Es},qs="vjs-modal-dialog",ft=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.handleKeyDown_=function(g){return l.handleKeyDown(g)},l.close_=function(g){return l.close(g)},l.opened_=l.hasBeenOpened_=l.hasBeenFilled_=!1,l.closeable(!l.options_.uncloseable),l.content(l.options_.content),l.contentEl_=Tt("div",{className:qs+"-content"},{role:"document"}),l.descEl_=Tt("p",{className:qs+"-description vjs-control-text",id:l.el().getAttribute("aria-describedby")}),Gi(l.descEl_,l.description()),l.el_.appendChild(l.descEl_),l.el_.appendChild(l.contentEl_),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},d.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,p.prototype.dispose.call(this)},d.buildCSSClass=function(){return qs+" vjs-hidden "+p.prototype.buildCSSClass.call(this)},d.label=function(){return this.localize(this.options_.label||"Modal Window")},d.description=function(){var n=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(n+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),n},d.open=function(){if(!this.opened_){var n=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!n.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&n.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=n.controls(),n.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},d.opened=function(n){return typeof n=="boolean"&&this[n?"open":"close"](),this.opened_},d.close=function(){if(this.opened_){var n=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&n.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&n.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},d.closeable=function(n){if(typeof n=="boolean"){var l=this.closeable_=!!n,g=this.getChild("closeButton");if(l&&!g){var A=this.contentEl_;this.contentEl_=this.el_,g=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=A,this.on(g,"close",this.close_)}!l&&g&&(this.off(g,"close",this.close_),this.removeChild(g),g.dispose())}return this.closeable_},d.fill=function(){this.fillWith(this.content())},d.fillWith=function(n){var l=this.contentEl(),g=l.parentNode,A=l.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,g.removeChild(l),this.empty(),_n(l,n),this.trigger("modalfill"),A?g.insertBefore(l,A):g.appendChild(l);var L=this.getChild("closeButton");L&&g.appendChild(L.el_)},d.empty=function(){this.trigger("beforemodalempty"),ds(this.contentEl()),this.trigger("modalempty")},d.content=function(n){return typeof n!="undefined"&&(this.content_=n),this.content_},d.conditionalFocus_=function(){var n=oe.default.activeElement,l=this.player_.el_;this.previouslyActiveEl_=null,(l.contains(n)||l===n)&&(this.previouslyActiveEl_=n,this.focus())},d.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},d.handleKeyDown=function(n){if(n.stopPropagation(),ze.default.isEventKey(n,"Escape")&&this.closeable()){n.preventDefault(),this.close();return}if(ze.default.isEventKey(n,"Tab")){for(var l=this.focusableEls_(),g=this.el_.querySelector(":focus"),A,L=0;L<l.length;L++)if(g===l[L]){A=L;break}oe.default.activeElement===this.el_&&(A=0),n.shiftKey&&A===0?(l[l.length-1].focus(),n.preventDefault()):!n.shiftKey&&A===l.length-1&&(l[0].focus(),n.preventDefault())}},d.focusableEls_=function(){var n=this.el_.querySelectorAll("*");return Array.prototype.filter.call(n,function(l){return(l instanceof Z.default.HTMLAnchorElement||l instanceof Z.default.HTMLAreaElement)&&l.hasAttribute("href")||(l instanceof Z.default.HTMLInputElement||l instanceof Z.default.HTMLSelectElement||l instanceof Z.default.HTMLTextAreaElement||l instanceof Z.default.HTMLButtonElement)&&!l.hasAttribute("disabled")||l instanceof Z.default.HTMLIFrameElement||l instanceof Z.default.HTMLObjectElement||l instanceof Z.default.HTMLEmbedElement||l.hasAttribute("tabindex")&&l.getAttribute("tabindex")!==-1||l.hasAttribute("contenteditable")})},m}(ce);ft.prototype.options_={pauseOnOpen:!0,temporary:!0},ce.registerComponent("ModalDialog",ft);var Kt=function(p){ge.default(m,p);function m(u){var n;u===void 0&&(u=[]),n=p.call(this)||this,n.tracks_=[],Object.defineProperty(Ge.default(n),"length",{get:function(){return this.tracks_.length}});for(var l=0;l<u.length;l++)n.addTrack(u[l]);return n}var d=m.prototype;return d.addTrack=function(n){var l=this,g=this.tracks_.length;""+g in this||Object.defineProperty(this,g,{get:function(){return this.tracks_[g]}}),this.tracks_.indexOf(n)===-1&&(this.tracks_.push(n),this.trigger({track:n,type:"addtrack",target:this})),n.labelchange_=function(){l.trigger({track:n,type:"labelchange",target:l})},ji(n)&&n.addEventListener("labelchange",n.labelchange_)},d.removeTrack=function(n){for(var l,g=0,A=this.length;g<A;g++)if(this[g]===n){l=this[g],l.off&&l.off(),this.tracks_.splice(g,1);break}l&&this.trigger({track:l,type:"removetrack",target:this})},d.getTrackById=function(n){for(var l=null,g=0,A=this.length;g<A;g++){var L=this[g];if(L.id===n){l=L;break}}return l},m}(ei);Kt.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(var ca in Kt.prototype.allowedEvents_)Kt.prototype["on"+ca]=null;var jt=function(m,d){for(var u=0;u<m.length;u++)!Object.keys(m[u]).length||d.id===m[u].id||(m[u].enabled=!1)},ri=function(p){ge.default(m,p);function m(u){var n;u===void 0&&(u=[]);for(var l=u.length-1;l>=0;l--)if(u[l].enabled){jt(u,u[l]);break}return n=p.call(this,u)||this,n.changing_=!1,n}var d=m.prototype;return d.addTrack=function(n){var l=this;n.enabled&&jt(this,n),p.prototype.addTrack.call(this,n),n.addEventListener&&(n.enabledChange_=function(){l.changing_||(l.changing_=!0,jt(l,n),l.changing_=!1,l.trigger("change"))},n.addEventListener("enabledchange",n.enabledChange_))},d.removeTrack=function(n){p.prototype.removeTrack.call(this,n),n.removeEventListener&&n.enabledChange_&&(n.removeEventListener("enabledchange",n.enabledChange_),n.enabledChange_=null)},m}(Kt),bs=function(m,d){for(var u=0;u<m.length;u++)!Object.keys(m[u]).length||d.id===m[u].id||(m[u].selected=!1)},Qr=function(p){ge.default(m,p);function m(u){var n;u===void 0&&(u=[]);for(var l=u.length-1;l>=0;l--)if(u[l].selected){bs(u,u[l]);break}return n=p.call(this,u)||this,n.changing_=!1,Object.defineProperty(Ge.default(n),"selectedIndex",{get:function(){for(var A=0;A<this.length;A++)if(this[A].selected)return A;return-1},set:function(){}}),n}var d=m.prototype;return d.addTrack=function(n){var l=this;n.selected&&bs(this,n),p.prototype.addTrack.call(this,n),n.addEventListener&&(n.selectedChange_=function(){l.changing_||(l.changing_=!0,bs(l,n),l.changing_=!1,l.trigger("change"))},n.addEventListener("selectedchange",n.selectedChange_))},d.removeTrack=function(n){p.prototype.removeTrack.call(this,n),n.removeEventListener&&n.selectedChange_&&(n.removeEventListener("selectedchange",n.selectedChange_),n.selectedChange_=null)},m}(Kt),mr=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.addTrack=function(n){var l=this;p.prototype.addTrack.call(this,n),this.queueChange_||(this.queueChange_=function(){return l.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return l.trigger("selectedlanguagechange")}),n.addEventListener("modechange",this.queueChange_);var g=["metadata","chapters"];g.indexOf(n.kind)===-1&&n.addEventListener("modechange",this.triggerSelectedlanguagechange_)},d.removeTrack=function(n){p.prototype.removeTrack.call(this,n),n.removeEventListener&&(this.queueChange_&&n.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&n.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},m}(Kt),Ws=function(){function p(d){d===void 0&&(d=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var u=0,n=d.length;u<n;u++)this.addTrackElement_(d[u])}var m=p.prototype;return m.addTrackElement_=function(u){var n=this.trackElements_.length;""+n in this||Object.defineProperty(this,n,{get:function(){return this.trackElements_[n]}}),this.trackElements_.indexOf(u)===-1&&this.trackElements_.push(u)},m.getTrackElementByTrack_=function(u){for(var n,l=0,g=this.trackElements_.length;l<g;l++)if(u===this.trackElements_[l].track){n=this.trackElements_[l];break}return n},m.removeTrackElement_=function(u){for(var n=0,l=this.trackElements_.length;n<l;n++)if(u===this.trackElements_[n]){this.trackElements_[n].track&&typeof this.trackElements_[n].track.off=="function"&&this.trackElements_[n].track.off(),typeof this.trackElements_[n].off=="function"&&this.trackElements_[n].off(),this.trackElements_.splice(n,1);break}},p}(),Ki=function(){function p(d){p.prototype.setCues_.call(this,d),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var m=p.prototype;return m.setCues_=function(u){var n=this.length||0,l=0,g=u.length;this.cues_=u,this.length_=u.length;var A=function(M){""+M in this||Object.defineProperty(this,""+M,{get:function(){return this.cues_[M]}})};if(n<g)for(l=n;l<g;l++)A.call(this,l)},m.getCueById=function(u){for(var n=null,l=0,g=this.length;l<g;l++){var A=this[l];if(A.id===u){n=A;break}}return n},p}(),kn={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Rn={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},Jr={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},wn={disabled:"disabled",hidden:"hidden",showing:"showing"},Ys=function(p){ge.default(m,p);function m(d){var u;d===void 0&&(d={}),u=p.call(this)||this;var n={id:d.id||"vjs_track_"+Li(),kind:d.kind||"",language:d.language||""},l=d.label||"",g=function(M){Object.defineProperty(Ge.default(u),M,{get:function(){return n[M]},set:function(){}})};for(var A in n)g(A);return Object.defineProperty(Ge.default(u),"label",{get:function(){return l},set:function(M){M!==l&&(l=M,this.trigger("labelchange"))}}),u}return m}(ei),zs=function(m){var d=["protocol","hostname","port","pathname","search","hash","host"],u=oe.default.createElement("a");u.href=m;for(var n={},l=0;l<d.length;l++)n[d[l]]=u[d[l]];return n.protocol==="http:"&&(n.host=n.host.replace(/:80$/,"")),n.protocol==="https:"&&(n.host=n.host.replace(/:443$/,"")),n.protocol||(n.protocol=Z.default.location.protocol),n.host||(n.host=Z.default.location.host),n},Ss=function(m){if(!m.match(/^https?:\/\//)){var d=oe.default.createElement("a");d.href=m,m=d.href}return m},Zr=function(m){if(typeof m=="string"){var d=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/,u=d.exec(m);if(u)return u.pop().toLowerCase()}return""},es=function(m,d){d===void 0&&(d=Z.default.location);var u=zs(m),n=u.protocol===":"?d.protocol:u.protocol,l=n+u.host!==d.protocol+d.host;return l},vr=Object.freeze({__proto__:null,parseUrl:zs,getAbsoluteURL:Ss,getFileExtension:Zr,isCrossOrigin:es}),xs=function(m,d){var u=new Z.default.WebVTT.Parser(Z.default,Z.default.vttjs,Z.default.WebVTT.StringDecoder()),n=[];u.oncue=function(l){d.addCue(l)},u.onparsingerror=function(l){n.push(l)},u.onflush=function(){d.trigger({type:"loadeddata",target:d})},u.parse(m),n.length>0&&(Z.default.console&&Z.default.console.groupCollapsed&&Z.default.console.groupCollapsed("Text Track parsing errors for "+d.src),n.forEach(function(l){return ve.error(l)}),Z.default.console&&Z.default.console.groupEnd&&Z.default.console.groupEnd()),u.flush()},Xs=function(m,d){var u={uri:m},n=es(m);n&&(u.cors=n);var l=d.tech_.crossOrigin()==="use-credentials";l&&(u.withCredentials=l),It.default(u,Lt(this,function(g,A,L){if(g)return ve.error(g,A);d.loaded_=!0,typeof Z.default.WebVTT!="function"?d.tech_&&d.tech_.any(["vttjsloaded","vttjserror"],function(M){if(M.type==="vttjserror"){ve.error("vttjs failed to load, stopping trying to process "+d.src);return}return xs(L,d)}):xs(L,d)}))},Ut=function(p){ge.default(m,p);function m(u){var n;if(u===void 0&&(u={}),!u.tech)throw new Error("A tech was not provided.");var l=Dt(u,{kind:Jr[u.kind]||"subtitles",language:u.language||u.srclang||""}),g=wn[l.mode]||"disabled",A=l.default;(l.kind==="metadata"||l.kind==="chapters")&&(g="hidden"),n=p.call(this,l)||this,n.tech_=l.tech,n.cues_=[],n.activeCues_=[],n.preload_=n.tech_.preloadTextTracks!==!1;var L=new Ki(n.cues_),M=new Ki(n.activeCues_),G=!1;n.timeupdateHandler=Lt(Ge.default(n),function($){if($===void 0&&($={}),!this.tech_.isDisposed()){if(!this.tech_.isReady_){$.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,G&&(this.trigger("cuechange"),G=!1),$.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});var Q=function(){n.stopTracking()};return n.tech_.one("dispose",Q),g!=="disabled"&&n.startTracking(),Object.defineProperties(Ge.default(n),{default:{get:function(){return A},set:function(){}},mode:{get:function(){return g},set:function(fe){wn[fe]&&g!==fe&&(g=fe,!this.preload_&&g!=="disabled"&&this.cues.length===0&&Xs(this.src,this),this.stopTracking(),g!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?L:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(this.cues.length===0)return M;for(var fe=this.tech_.currentTime(),$e=[],bt=0,os=this.cues.length;bt<os;bt++){var ar=this.cues[bt];(ar.startTime<=fe&&ar.endTime>=fe||ar.startTime===ar.endTime&&ar.startTime<=fe&&ar.startTime+.5>=fe)&&$e.push(ar)}if(G=!1,$e.length!==this.activeCues_.length)G=!0;else for(var Dr=0;Dr<$e.length;Dr++)this.activeCues_.indexOf($e[Dr])===-1&&(G=!0);return this.activeCues_=$e,M.setCues_(this.activeCues_),M},set:function(){}}}),l.src?(n.src=l.src,n.preload_||(n.loaded_=!0),(n.preload_||l.kind!=="subtitles"&&l.kind!=="captions")&&Xs(n.src,Ge.default(n))):n.loaded_=!0,n}var d=m.prototype;return d.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)},d.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)},d.addCue=function(n){var l=n;if(!("getCueAsHTML"in l)){l=new Z.default.vttjs.VTTCue(n.startTime,n.endTime,n.text);for(var g in n)g in l||(l[g]=n[g]);l.id=n.id,l.originalCue_=n}for(var A=this.tech_.textTracks(),L=0;L<A.length;L++)A[L]!==this&&A[L].removeCue(l);this.cues_.push(l),this.cues.setCues_(this.cues_)},d.removeCue=function(n){for(var l=this.cues_.length;l--;){var g=this.cues_[l];if(g===n||g.originalCue_&&g.originalCue_===n){this.cues_.splice(l,1),this.cues.setCues_(this.cues_);break}}},m}(Ys);Ut.prototype.allowedEvents_={cuechange:"cuechange"};var As=function(p){ge.default(m,p);function m(d){var u;d===void 0&&(d={});var n=Dt(d,{kind:Rn[d.kind]||""});u=p.call(this,n)||this;var l=!1;return Object.defineProperty(Ge.default(u),"enabled",{get:function(){return l},set:function(A){typeof A!="boolean"||A===l||(l=A,this.trigger("enabledchange"))}}),n.enabled&&(u.enabled=n.enabled),u.loaded_=!0,u}return m}(Ys),ts=function(p){ge.default(m,p);function m(d){var u;d===void 0&&(d={});var n=Dt(d,{kind:kn[d.kind]||""});u=p.call(this,n)||this;var l=!1;return Object.defineProperty(Ge.default(u),"selected",{get:function(){return l},set:function(A){typeof A!="boolean"||A===l||(l=A,this.trigger("selectedchange"))}}),n.selected&&(u.selected=n.selected),u}return m}(Ys),is=0,Dn=1,st=2,I=3,T=function(p){ge.default(m,p);function m(d){var u;d===void 0&&(d={}),u=p.call(this)||this;var n,l=new Ut(d);return u.kind=l.kind,u.src=l.src,u.srclang=l.language,u.label=l.label,u.default=l.default,Object.defineProperties(Ge.default(u),{readyState:{get:function(){return n}},track:{get:function(){return l}}}),n=is,l.addEventListener("loadeddata",function(){n=st,u.trigger({type:"load",target:Ge.default(u)})}),u}return m}(ei);T.prototype.allowedEvents_={load:"load"},T.NONE=is,T.LOADING=Dn,T.LOADED=st,T.ERROR=I;var E={audio:{ListClass:ri,TrackClass:As,capitalName:"Audio"},video:{ListClass:Qr,TrackClass:ts,capitalName:"Video"},text:{ListClass:mr,TrackClass:Ut,capitalName:"Text"}};Object.keys(E).forEach(function(p){E[p].getterName=p+"Tracks",E[p].privateName=p+"Tracks_"});var w={remoteText:{ListClass:mr,TrackClass:Ut,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:Ws,TrackClass:T,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},D=Wt.default({},E,w);w.names=Object.keys(w),E.names=Object.keys(E),D.names=[].concat(w.names).concat(E.names);function P(p,m,d,u,n){n===void 0&&(n={});var l=p.textTracks();n.kind=m,d&&(n.label=d),u&&(n.language=u),n.tech=p;var g=new D.text.TrackClass(n);return l.addTrack(g),g}var C=function(p){ge.default(m,p);function m(u,n){var l;return u===void 0&&(u={}),n===void 0&&(n=function(){}),u.reportTouchActivity=!1,l=p.call(this,null,u,n)||this,l.onDurationChange_=function(g){return l.onDurationChange(g)},l.trackProgress_=function(g){return l.trackProgress(g)},l.trackCurrentTime_=function(g){return l.trackCurrentTime(g)},l.stopTrackingCurrentTime_=function(g){return l.stopTrackingCurrentTime(g)},l.disposeSourceHandler_=function(g){return l.disposeSourceHandler(g)},l.queuedHanders_=new Set,l.hasStarted_=!1,l.on("playing",function(){this.hasStarted_=!0}),l.on("loadstart",function(){this.hasStarted_=!1}),D.names.forEach(function(g){var A=D[g];u&&u[A.getterName]&&(l[A.privateName]=u[A.getterName])}),l.featuresProgressEvents||l.manualProgressOn(),l.featuresTimeupdateEvents||l.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(g){u["native"+g+"Tracks"]===!1&&(l["featuresNative"+g+"Tracks"]=!1)}),u.nativeCaptions===!1||u.nativeTextTracks===!1?l.featuresNativeTextTracks=!1:(u.nativeCaptions===!0||u.nativeTextTracks===!0)&&(l.featuresNativeTextTracks=!0),l.featuresNativeTextTracks||l.emulateTextTracks(),l.preloadTextTracks=u.preloadTextTracks!==!1,l.autoRemoteTextTracks_=new D.text.ListClass,l.initTrackListeners(),u.nativeControlsForTouch||l.emitTapEvents(),l.constructor&&(l.name_=l.constructor.name||"Unknown Tech"),l}var d=m.prototype;return d.triggerSourceset=function(n){var l=this;this.isReady_||this.one("ready",function(){return l.setTimeout(function(){return l.triggerSourceset(n)},1)}),this.trigger({src:n,type:"sourceset"})},d.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},d.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},d.trackProgress=function(n){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Lt(this,function(){var l=this.bufferedPercent();this.bufferedPercent_!==l&&this.trigger("progress"),this.bufferedPercent_=l,l===1&&this.stopTrackingProgress()}),500)},d.onDurationChange=function(n){this.duration_=this.duration()},d.buffered=function(){return Ti(0,0)},d.bufferedPercent=function(){return js(this.buffered(),this.duration_)},d.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},d.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},d.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},d.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},d.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},d.dispose=function(){this.clearTracks(E.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),p.prototype.dispose.call(this)},d.clearTracks=function(n){var l=this;n=[].concat(n),n.forEach(function(g){for(var A=l[g+"Tracks"]()||[],L=A.length;L--;){var M=A[L];g==="text"&&l.removeRemoteTextTrack(M),A.removeTrack(M)}})},d.cleanupAutoTextTracks=function(){for(var n=this.autoRemoteTextTracks_||[],l=n.length;l--;){var g=n[l];this.removeRemoteTextTrack(g)}},d.reset=function(){},d.crossOrigin=function(){},d.setCrossOrigin=function(){},d.error=function(n){return n!==void 0&&(this.error_=new di(n),this.trigger("error")),this.error_},d.played=function(){return this.hasStarted_?Ti(0,0):Ti()},d.play=function(){},d.setScrubbing=function(){},d.scrubbing=function(){},d.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},d.initTrackListeners=function(){var n=this;E.names.forEach(function(l){var g=E[l],A=function(){n.trigger(l+"trackchange")},L=n[g.getterName]();L.addEventListener("removetrack",A),L.addEventListener("addtrack",A),n.on("dispose",function(){L.removeEventListener("removetrack",A),L.removeEventListener("addtrack",A)})})},d.addWebVttScript_=function(){var n=this;if(!Z.default.WebVTT)if(oe.default.body.contains(this.el())){if(!this.options_["vtt.js"]&&Si(li.default)&&Object.keys(li.default).length>0){this.trigger("vttjsloaded");return}var l=oe.default.createElement("script");l.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",l.onload=function(){n.trigger("vttjsloaded")},l.onerror=function(){n.trigger("vttjserror")},this.on("dispose",function(){l.onload=null,l.onerror=null}),Z.default.WebVTT=!0,this.el().parentNode.appendChild(l)}else this.ready(this.addWebVttScript_)},d.emulateTextTracks=function(){var n=this,l=this.textTracks(),g=this.remoteTextTracks(),A=function($){return l.addTrack($.track)},L=function($){return l.removeTrack($.track)};g.on("addtrack",A),g.on("removetrack",L),this.addWebVttScript_();var M=function(){return n.trigger("texttrackchange")},G=function(){M();for(var $=0;$<l.length;$++){var fe=l[$];fe.removeEventListener("cuechange",M),fe.mode==="showing"&&fe.addEventListener("cuechange",M)}};G(),l.addEventListener("change",G),l.addEventListener("addtrack",G),l.addEventListener("removetrack",G),this.on("dispose",function(){g.off("addtrack",A),g.off("removetrack",L),l.removeEventListener("change",G),l.removeEventListener("addtrack",G),l.removeEventListener("removetrack",G);for(var Q=0;Q<l.length;Q++){var $=l[Q];$.removeEventListener("cuechange",M)}})},d.addTextTrack=function(n,l,g){if(!n)throw new Error("TextTrack kind is required but was not provided");return P(this,n,l,g)},d.createRemoteTextTrack=function(n){var l=Dt(n,{tech:this});return new w.remoteTextEl.TrackClass(l)},d.addRemoteTextTrack=function(n,l){var g=this;n===void 0&&(n={});var A=this.createRemoteTextTrack(n);return l!==!0&&l!==!1&&(ve.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),l=!0),this.remoteTextTrackEls().addTrackElement_(A),this.remoteTextTracks().addTrack(A.track),l!==!0&&this.ready(function(){return g.autoRemoteTextTracks_.addTrack(A.track)}),A},d.removeRemoteTextTrack=function(n){var l=this.remoteTextTrackEls().getTrackElementByTrack_(n);this.remoteTextTrackEls().removeTrackElement_(l),this.remoteTextTracks().removeTrack(n),this.autoRemoteTextTracks_.removeTrack(n)},d.getVideoPlaybackQuality=function(){return{}},d.requestPictureInPicture=function(){var n=this.options_.Promise||Z.default.Promise;if(n)return n.reject()},d.disablePictureInPicture=function(){return!0},d.setDisablePictureInPicture=function(){},d.requestVideoFrameCallback=function(n){var l=this,g=Li();return!this.isReady_||this.paused()?(this.queuedHanders_.add(g),this.one("playing",function(){l.queuedHanders_.has(g)&&(l.queuedHanders_.delete(g),n())})):this.requestNamedAnimationFrame(g,n),g},d.cancelVideoFrameCallback=function(n){this.queuedHanders_.has(n)?this.queuedHanders_.delete(n):this.cancelNamedAnimationFrame(n)},d.setPoster=function(){},d.playsinline=function(){},d.setPlaysinline=function(){},d.overrideNativeAudioTracks=function(){},d.overrideNativeVideoTracks=function(){},d.canPlayType=function(){return""},m.canPlayType=function(){return""},m.canPlaySource=function(n,l){return m.canPlayType(n.type)},m.isTech=function(n){return n.prototype instanceof m||n instanceof m||n===m},m.registerTech=function(n,l){if(m.techs_||(m.techs_={}),!m.isTech(l))throw new Error("Tech "+n+" must be a Tech");if(!m.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!m.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return n=wt(n),m.techs_[n]=l,m.techs_[zr(n)]=l,n!=="Tech"&&m.defaultTechOrder_.push(n),l},m.getTech=function(n){if(n){if(m.techs_&&m.techs_[n])return m.techs_[n];if(n=wt(n),Z.default&&Z.default.videojs&&Z.default.videojs[n])return ve.warn("The "+n+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),Z.default.videojs[n]}},m}(ce);D.names.forEach(function(p){var m=D[p];C.prototype[m.getterName]=function(){return this[m.privateName]=this[m.privateName]||new m.ListClass,this[m.privateName]}}),C.prototype.featuresVolumeControl=!0,C.prototype.featuresMuteControl=!0,C.prototype.featuresFullscreenResize=!1,C.prototype.featuresPlaybackRate=!1,C.prototype.featuresProgressEvents=!1,C.prototype.featuresSourceset=!1,C.prototype.featuresTimeupdateEvents=!1,C.prototype.featuresNativeTextTracks=!1,C.prototype.featuresVideoFrameCallback=!1,C.withSourceHandlers=function(p){p.registerSourceHandler=function(d,u){var n=p.sourceHandlers;n||(n=p.sourceHandlers=[]),u===void 0&&(u=n.length),n.splice(u,0,d)},p.canPlayType=function(d){for(var u=p.sourceHandlers||[],n,l=0;l<u.length;l++)if(n=u[l].canPlayType(d),n)return n;return""},p.selectSourceHandler=function(d,u){for(var n=p.sourceHandlers||[],l,g=0;g<n.length;g++)if(l=n[g].canHandleSource(d,u),l)return n[g];return null},p.canPlaySource=function(d,u){var n=p.selectSourceHandler(d,u);return n?n.canHandleSource(d,u):""};var m=["seekable","seeking","duration"];m.forEach(function(d){var u=this[d];typeof u=="function"&&(this[d]=function(){return this.sourceHandler_&&this.sourceHandler_[d]?this.sourceHandler_[d].apply(this.sourceHandler_,arguments):u.apply(this,arguments)})},p.prototype),p.prototype.setSource=function(d){var u=p.selectSourceHandler(d,this.options_);u||(p.nativeSourceHandler?u=p.nativeSourceHandler:ve.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),u!==p.nativeSourceHandler&&(this.currentSource_=d),this.sourceHandler_=u.handleSource(d,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},p.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},ce.registerComponent("Tech",C),C.registerTech("Tech",C),C.defaultTechOrder_=[];var U={},j={},X={};function se(p,m){U[p]=U[p]||[],U[p].push(m)}function te(p,m,d){p.setTimeout(function(){return ae(m,U[m.type],d,p)},1)}function de(p,m){p.forEach(function(d){return d.setTech&&d.setTech(m)})}function K(p,m,d){return p.reduceRight(Mt(d),m[d]())}function ie(p,m,d,u){return m[d](p.reduce(Mt(d),u))}function Se(p,m,d,u){u===void 0&&(u=null);var n="call"+wt(d),l=p.reduce(Mt(n),u),g=l===X,A=g?null:m[d](l);return yt(p,d,A,g),A}var xe={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},it={setCurrentTime:1,setMuted:1,setVolume:1},qt={play:1,pause:1};function Mt(p){return function(m,d){return m===X?X:d[p]?d[p](m):m}}function yt(p,m,d,u){for(var n=p.length-1;n>=0;n--){var l=p[n];l[m]&&l[m](u,d)}}function we(p){j[p.id()]=null}function he(p,m){var d=j[p.id()],u=null;if(d==null)return u=m(p),j[p.id()]=[[m,u]],u;for(var n=0;n<d.length;n++){var l=d[n],g=l[0],A=l[1];g===m&&(u=A)}return u===null&&(u=m(p),d.push([m,u])),u}function ae(p,m,d,u,n,l){p===void 0&&(p={}),m===void 0&&(m=[]),n===void 0&&(n=[]),l===void 0&&(l=!1);var g=m,A=g[0],L=g.slice(1);if(typeof A=="string")ae(p,U[A],d,u,n,l);else if(A){var M=he(u,A);if(!M.setSource)return n.push(M),ae(p,L,d,u,n,l);M.setSource(Ot({},p),function(G,Q){if(G)return ae(p,L,d,u,n,l);n.push(M),ae(Q,p.type===Q.type?L:U[Q.type],d,u,n,l)})}else L.length?ae(p,L,d,u,n,l):l?d(p,n):ae(p,U["*"],d,u,n,!0)}var Re={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Ne=function(m){m===void 0&&(m="");var d=Zr(m),u=Re[d.toLowerCase()];return u||""},nt=function(m,d){if(!d)return"";if(m.cache_.source.src===d&&m.cache_.source.type)return m.cache_.source.type;var u=m.cache_.sources.filter(function(A){return A.src===d});if(u.length)return u[0].type;for(var n=m.$$("source"),l=0;l<n.length;l++){var g=n[l];if(g.type&&g.src&&g.src===d)return g.type}return Ne(d)},dt=function p(m){if(Array.isArray(m)){var d=[];m.forEach(function(u){u=p(u),Array.isArray(u)?d=d.concat(u):zt(u)&&d.push(u)}),m=d}else typeof m=="string"&&m.trim()?m=[$t({src:m})]:zt(m)&&typeof m.src=="string"&&m.src&&m.src.trim()?m=[$t(m)]:m=[];return m};function $t(p){if(!p.type){var m=Ne(p.src);m&&(p.type=m)}return p}var Ht=function(p){ge.default(m,p);function m(d,u,n){var l,g=Dt({createEl:!1},u);if(l=p.call(this,d,g,n)||this,!u.playerOptions.sources||u.playerOptions.sources.length===0)for(var A=0,L=u.playerOptions.techOrder;A<L.length;A++){var M=wt(L[A]),G=C.getTech(M);if(M||(G=ce.getComponent(M)),G&&G.isSupported()){d.loadTech_(M);break}}else d.src(u.playerOptions.sources);return l}return m}(ce);ce.registerComponent("MediaLoader",Ht);var vt=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.options_.controlText&&l.controlText(l.options_.controlText),l.handleMouseOver_=function(g){return l.handleMouseOver(g)},l.handleMouseOut_=function(g){return l.handleMouseOut(g)},l.handleClick_=function(g){return l.handleClick(g)},l.handleKeyDown_=function(g){return l.handleKeyDown(g)},l.emitTapEvents(),l.enable(),l}var d=m.prototype;return d.createEl=function(n,l,g){n===void 0&&(n="div"),l===void 0&&(l={}),g===void 0&&(g={}),l=Ot({className:this.buildCSSClass(),tabIndex:0},l),n==="button"&&ve.error("Creating a ClickableComponent with an HTML element of "+n+" is not supported; use a Button instead."),g=Ot({role:"button"},g),this.tabIndex_=l.tabIndex;var A=Tt(n,l,g);return A.appendChild(Tt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(A),A},d.dispose=function(){this.controlTextEl_=null,p.prototype.dispose.call(this)},d.createControlTextEl=function(n){return this.controlTextEl_=Tt("span",{className:"vjs-control-text"},{"aria-live":"polite"}),n&&n.appendChild(this.controlTextEl_),this.controlText(this.controlText_,n),this.controlTextEl_},d.controlText=function(n,l){if(l===void 0&&(l=this.el()),n===void 0)return this.controlText_||"Need Text";var g=this.localize(n);this.controlText_=n,Gi(this.controlTextEl_,g),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&l.setAttribute("title",g)},d.buildCSSClass=function(){return"vjs-control vjs-button "+p.prototype.buildCSSClass.call(this)},d.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_!="undefined"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},d.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_!="undefined"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},d.handleLanguagechange=function(){this.controlText(this.controlText_)},d.handleClick=function(n){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},d.handleKeyDown=function(n){ze.default.isEventKey(n,"Space")||ze.default.isEventKey(n,"Enter")?(n.preventDefault(),n.stopPropagation(),this.trigger("click")):p.prototype.handleKeyDown.call(this,n)},m}(ce);ce.registerComponent("ClickableComponent",vt);var Vt=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.update(),l.update_=function(g){return l.update(g)},u.on("posterchange",l.update_),l}var d=m.prototype;return d.dispose=function(){this.player().off("posterchange",this.update_),p.prototype.dispose.call(this)},d.createEl=function(){var n=Tt("div",{className:"vjs-poster",tabIndex:-1});return n},d.update=function(n){var l=this.player().poster();this.setSrc(l),l?this.show():this.hide()},d.setSrc=function(n){var l="";n&&(l='url("'+n+'")'),this.el_.style.backgroundImage=l},d.handleClick=function(n){if(this.player_.controls()){var l=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;this.player_.tech(!0)&&!((Ee||Gt)&&l)&&this.player_.tech(!0).focus(),this.player_.paused()?Ci(this.player_.play()):this.player_.pause()}},m}(vt);ce.registerComponent("PosterImage",Vt);var Qt="#222",Xi="#ccc",rs={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Ei(p,m){var d;if(p.length===4)d=p[1]+p[1]+p[2]+p[2]+p[3]+p[3];else if(p.length===7)d=p.slice(1);else throw new Error("Invalid color code provided, "+p+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(d.slice(0,2),16)+","+parseInt(d.slice(2,4),16)+","+parseInt(d.slice(4,6),16)+","+m+")"}function qi(p,m,d){try{p.style[m]=d}catch(u){return}}var Qs=function(p){ge.default(m,p);function m(u,n,l){var g;g=p.call(this,u,n,l)||this;var A=function(M){return g.updateDisplay(M)};return u.on("loadstart",function(L){return g.toggleDisplay(L)}),u.on("texttrackchange",A),u.on("loadedmetadata",function(L){return g.preselectTrack(L)}),u.ready(Lt(Ge.default(g),function(){if(u.tech_&&u.tech_.featuresNativeTextTracks){this.hide();return}u.on("fullscreenchange",A),u.on("playerresize",A),Z.default.addEventListener("orientationchange",A),u.on("dispose",function(){return Z.default.removeEventListener("orientationchange",A)});for(var L=this.options_.playerOptions.tracks||[],M=0;M<L.length;M++)this.player_.addRemoteTextTrack(L[M],!0);this.preselectTrack()})),g}var d=m.prototype;return d.preselectTrack=function(){for(var n={captions:1,subtitles:1},l=this.player_.textTracks(),g=this.player_.cache_.selectedLanguage,A,L,M,G=0;G<l.length;G++){var Q=l[G];g&&g.enabled&&g.language&&g.language===Q.language&&Q.kind in n?Q.kind===g.kind?M=Q:M||(M=Q):g&&!g.enabled?(M=null,A=null,L=null):Q.default&&(Q.kind==="descriptions"&&!A?A=Q:Q.kind in n&&!L&&(L=Q))}M?M.mode="showing":L?L.mode="showing":A&&(A.mode="showing")},d.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},d.clearDisplay=function(){typeof Z.default.WebVTT=="function"&&Z.default.WebVTT.processCues(Z.default,[],this.el_)},d.updateDisplay=function(){var n=this.player_.textTracks(),l=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),l){for(var g=[],A=0;A<n.length;++A){var L=n[A];L.mode==="showing"&&g.push(L)}this.updateForTrack(g);return}for(var M=null,G=null,Q=n.length;Q--;){var $=n[Q];$.mode==="showing"&&($.kind==="descriptions"?M=$:G=$)}G?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(G)):M&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(M))},d.updateDisplayState=function(n){for(var l=this.player_.textTrackSettings.getValues(),g=n.activeCues,A=g.length;A--;){var L=g[A];if(L){var M=L.displayState;if(l.color&&(M.firstChild.style.color=l.color),l.textOpacity&&qi(M.firstChild,"color",Ei(l.color||"#fff",l.textOpacity)),l.backgroundColor&&(M.firstChild.style.backgroundColor=l.backgroundColor),l.backgroundOpacity&&qi(M.firstChild,"backgroundColor",Ei(l.backgroundColor||"#000",l.backgroundOpacity)),l.windowColor&&(l.windowOpacity?qi(M,"backgroundColor",Ei(l.windowColor,l.windowOpacity)):M.style.backgroundColor=l.windowColor),l.edgeStyle&&(l.edgeStyle==="dropshadow"?M.firstChild.style.textShadow="2px 2px 3px "+Qt+", 2px 2px 4px "+Qt+", 2px 2px 5px "+Qt:l.edgeStyle==="raised"?M.firstChild.style.textShadow="1px 1px "+Qt+", 2px 2px "+Qt+", 3px 3px "+Qt:l.edgeStyle==="depressed"?M.firstChild.style.textShadow="1px 1px "+Xi+", 0 1px "+Xi+", -1px -1px "+Qt+", 0 -1px "+Qt:l.edgeStyle==="uniform"&&(M.firstChild.style.textShadow="0 0 4px "+Qt+", 0 0 4px "+Qt+", 0 0 4px "+Qt+", 0 0 4px "+Qt)),l.fontPercent&&l.fontPercent!==1){var G=Z.default.parseFloat(M.style.fontSize);M.style.fontSize=G*l.fontPercent+"px",M.style.height="auto",M.style.top="auto"}l.fontFamily&&l.fontFamily!=="default"&&(l.fontFamily==="small-caps"?M.firstChild.style.fontVariant="small-caps":M.firstChild.style.fontFamily=rs[l.fontFamily])}}},d.updateForTrack=function(n){if(Array.isArray(n)||(n=[n]),!(typeof Z.default.WebVTT!="function"||n.every(function(fe){return!fe.activeCues}))){for(var l=[],g=0;g<n.length;++g)for(var A=n[g],L=0;L<A.activeCues.length;++L)l.push(A.activeCues[L]);Z.default.WebVTT.processCues(Z.default,l,this.el_);for(var M=0;M<n.length;++M){for(var G=n[M],Q=0;Q<G.activeCues.length;++Q){var $=G.activeCues[Q].displayState;xi($,"vjs-text-track-cue"),xi($,"vjs-text-track-cue-"+(G.language?G.language:M)),G.language&&yi($,"lang",G.language)}this.player_.textTrackSettings&&this.updateDisplayState(G)}}},m}(ce);ce.registerComponent("TextTrackDisplay",Qs);var ss=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.createEl=function(){var n=this.player_.isAudio(),l=this.localize(n?"Audio Player":"Video Player"),g=Tt("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[l])}),A=p.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return A.appendChild(g),A},m}(ce);ce.registerComponent("LoadingSpinner",ss);var bi=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.createEl=function(n,l,g){l===void 0&&(l={}),g===void 0&&(g={}),n="button",l=Ot({className:this.buildCSSClass()},l),g=Ot({type:"button"},g);var A=Tt(n,l,g);return A.appendChild(Tt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(A),A},d.addChild=function(n,l){l===void 0&&(l={});var g=this.constructor.name;return ve.warn("Adding an actionable (user controllable) child to a Button ("+g+") is not supported; use a ClickableComponent instead."),ce.prototype.addChild.call(this,n,l)},d.enable=function(){p.prototype.enable.call(this),this.el_.removeAttribute("disabled")},d.disable=function(){p.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},d.handleKeyDown=function(n){if(ze.default.isEventKey(n,"Space")||ze.default.isEventKey(n,"Enter")){n.stopPropagation();return}p.prototype.handleKeyDown.call(this,n)},m}(vt);ce.registerComponent("Button",bi);var si=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.mouseused_=!1,l.on("mousedown",function(g){return l.handleMouseDown(g)}),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-big-play-button"},d.handleClick=function(n){var l=this.player_.play();if(this.mouseused_&&n.clientX&&n.clientY){var g=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;Ci(l),this.player_.tech(!0)&&!((Ee||Gt)&&g)&&this.player_.tech(!0).focus();return}var A=this.player_.getChild("controlBar"),L=A&&A.getChild("playToggle");if(!L){this.player_.tech(!0).focus();return}var M=function(){return L.focus()};Cr(l)?l.then(M,function(){}):this.setTimeout(M,1)},d.handleKeyDown=function(n){this.mouseused_=!1,p.prototype.handleKeyDown.call(this,n)},d.handleMouseDown=function(n){this.mouseused_=!0},m}(bi);si.prototype.controlText_="Play Video",ce.registerComponent("BigPlayButton",si);var Pn=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.controlText(n&&n.controlText||l.localize("Close")),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-close-button "+p.prototype.buildCSSClass.call(this)},d.handleClick=function(n){this.trigger({type:"close",bubbles:!1})},d.handleKeyDown=function(n){ze.default.isEventKey(n,"Esc")?(n.preventDefault(),n.stopPropagation(),this.trigger("click")):p.prototype.handleKeyDown.call(this,n)},m}(bi);ce.registerComponent("CloseButton",Pn);var On=function(p){ge.default(m,p);function m(u,n){var l;return n===void 0&&(n={}),l=p.call(this,u,n)||this,n.replay=n.replay===void 0||n.replay,l.on(u,"play",function(g){return l.handlePlay(g)}),l.on(u,"pause",function(g){return l.handlePause(g)}),n.replay&&l.on(u,"ended",function(g){return l.handleEnded(g)}),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-play-control "+p.prototype.buildCSSClass.call(this)},d.handleClick=function(n){this.player_.paused()?Ci(this.player_.play()):this.player_.pause()},d.handleSeeked=function(n){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(n):this.handlePlay(n)},d.handlePlay=function(n){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},d.handlePause=function(n){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},d.handleEnded=function(n){var l=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(g){return l.handleSeeked(g)})},m}(bi);On.prototype.controlText_="Play",ce.registerComponent("PlayToggle",On);var Js=function(m,d){m=m<0?0:m;var u=Math.floor(m%60),n=Math.floor(m/60%60),l=Math.floor(m/3600),g=Math.floor(d/60%60),A=Math.floor(d/3600);return(isNaN(m)||m===1/0)&&(l=n=u="-"),l=l>0||A>0?l+":":"",n=((l||g>=10)&&n<10?"0"+n:n)+":",u=u<10?"0"+u:u,l+n+u},Ls=Js;function Xa(p){Ls=p}function Qa(){Ls=Js}function Is(p,m){return m===void 0&&(m=p),Ls(p,m)}var kr=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.on(u,["timeupdate","ended"],function(g){return l.updateContent(g)}),l.updateTextNode_(),l}var d=m.prototype;return d.createEl=function(){var n=this.buildCSSClass(),l=p.prototype.createEl.call(this,"div",{className:n+" vjs-time-control vjs-control"}),g=Tt("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+"\xA0"},{role:"presentation"});return l.appendChild(g),this.contentEl_=Tt("span",{className:n+"-display"},{"aria-live":"off",role:"presentation"}),l.appendChild(this.contentEl_),l},d.dispose=function(){this.contentEl_=null,this.textNode_=null,p.prototype.dispose.call(this)},d.updateTextNode_=function(n){var l=this;n===void 0&&(n=0),n=Is(n),this.formattedTime_!==n&&(this.formattedTime_=n,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(l.contentEl_){var g=l.textNode_;g&&l.contentEl_.firstChild!==g&&(g=null,ve.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),l.textNode_=oe.default.createTextNode(l.formattedTime_),l.textNode_&&(g?l.contentEl_.replaceChild(l.textNode_,g):l.contentEl_.appendChild(l.textNode_))}}))},d.updateContent=function(n){},m}(ce);kr.prototype.labelText_="Time",kr.prototype.controlText_="Time",ce.registerComponent("TimeDisplay",kr);var Mn=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-current-time"},d.updateContent=function(n){var l;this.player_.ended()?l=this.player_.duration():l=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(l)},m}(kr);Mn.prototype.labelText_="Current Time",Mn.prototype.controlText_="Current Time",ce.registerComponent("CurrentTimeDisplay",Mn);var Fn=function(p){ge.default(m,p);function m(u,n){var l;l=p.call(this,u,n)||this;var g=function(L){return l.updateContent(L)};return l.on(u,"durationchange",g),l.on(u,"loadstart",g),l.on(u,"loadedmetadata",g),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-duration"},d.updateContent=function(n){var l=this.player_.duration();this.updateTextNode_(l)},m}(kr);Fn.prototype.labelText_="Duration",Fn.prototype.controlText_="Duration",ce.registerComponent("DurationDisplay",Fn);var yr=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.createEl=function(){var n=p.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),l=p.prototype.createEl.call(this,"div"),g=p.prototype.createEl.call(this,"span",{textContent:"/"});return l.appendChild(g),n.appendChild(l),n},m}(ce);ce.registerComponent("TimeDivider",yr);var Nn=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.on(u,"durationchange",function(g){return l.updateContent(g)}),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-remaining-time"},d.createEl=function(){var n=p.prototype.createEl.call(this);return this.options_.displayNegative!==!1&&n.insertBefore(Tt("span",{},{"aria-hidden":!0},"-"),this.contentEl_),n},d.updateContent=function(n){if(typeof this.player_.duration()=="number"){var l;this.player_.ended()?l=0:this.player_.remainingTimeDisplay?l=this.player_.remainingTimeDisplay():l=this.player_.remainingTime(),this.updateTextNode_(l)}},m}(kr);Nn.prototype.labelText_="Remaining Time",Nn.prototype.controlText_="Remaining Time",ce.registerComponent("RemainingTimeDisplay",Nn);var ha=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.updateShowing(),l.on(l.player(),"durationchange",function(g){return l.updateShowing(g)}),l}var d=m.prototype;return d.createEl=function(){var n=p.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Tt("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Tt("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+"\xA0"})),this.contentEl_.appendChild(oe.default.createTextNode(this.localize("LIVE"))),n.appendChild(this.contentEl_),n},d.dispose=function(){this.contentEl_=null,p.prototype.dispose.call(this)},d.updateShowing=function(n){this.player().duration()===1/0?this.show():this.hide()},m}(ce);ce.registerComponent("LiveDisplay",ha);var da=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.updateLiveEdgeStatus(),l.player_.liveTracker&&(l.updateLiveEdgeStatusHandler_=function(g){return l.updateLiveEdgeStatus(g)},l.on(l.player_.liveTracker,"liveedgechange",l.updateLiveEdgeStatusHandler_)),l}var d=m.prototype;return d.createEl=function(){var n=p.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Tt("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),n.appendChild(this.textEl_),n},d.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},d.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},d.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,p.prototype.dispose.call(this)},m}(bi);da.prototype.controlText_="Seek to live, currently playing live",ce.registerComponent("SeekToLive",da);var Bn=function(m,d,u){return m=Number(m),Math.min(u,Math.max(d,isNaN(m)?d:m))},fa=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.handleMouseDown_=function(g){return l.handleMouseDown(g)},l.handleMouseUp_=function(g){return l.handleMouseUp(g)},l.handleKeyDown_=function(g){return l.handleKeyDown(g)},l.handleClick_=function(g){return l.handleClick(g)},l.handleMouseMove_=function(g){return l.handleMouseMove(g)},l.update_=function(g){return l.update(g)},l.bar=l.getChild(l.options_.barName),l.vertical(!!l.options_.vertical),l.enable(),l}var d=m.prototype;return d.enabled=function(){return this.enabled_},d.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},d.disable=function(){if(this.enabled()){var n=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(n,"mousemove",this.handleMouseMove_),this.off(n,"mouseup",this.handleMouseUp_),this.off(n,"touchmove",this.handleMouseMove_),this.off(n,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},d.createEl=function(n,l,g){return l===void 0&&(l={}),g===void 0&&(g={}),l.className=l.className+" vjs-slider",l=Ot({tabIndex:0},l),g=Ot({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},g),p.prototype.createEl.call(this,n,l,g)},d.handleMouseDown=function(n){var l=this.bar.el_.ownerDocument;n.type==="mousedown"&&n.preventDefault(),n.type==="touchstart"&&!Fi&&n.preventDefault(),hs(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(l,"mousemove",this.handleMouseMove_),this.on(l,"mouseup",this.handleMouseUp_),this.on(l,"touchmove",this.handleMouseMove_),this.on(l,"touchend",this.handleMouseUp_),this.handleMouseMove(n,!0)},d.handleMouseMove=function(n){},d.handleMouseUp=function(){var n=this.bar.el_.ownerDocument;yn(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(n,"mousemove",this.handleMouseMove_),this.off(n,"mouseup",this.handleMouseUp_),this.off(n,"touchmove",this.handleMouseMove_),this.off(n,"touchend",this.handleMouseUp_),this.update()},d.update=function(){var n=this;if(!(!this.el_||!this.bar)){var l=this.getProgress();return l===this.progress_||(this.progress_=l,this.requestNamedAnimationFrame("Slider#update",function(){var g=n.vertical()?"height":"width";n.bar.el().style[g]=(l*100).toFixed(2)+"%"})),l}},d.getProgress=function(){return Number(Bn(this.getPercent(),0,1).toFixed(4))},d.calculateDistance=function(n){var l=$r(this.el_,n);return this.vertical()?l.y:l.x},d.handleKeyDown=function(n){ze.default.isEventKey(n,"Left")||ze.default.isEventKey(n,"Down")?(n.preventDefault(),n.stopPropagation(),this.stepBack()):ze.default.isEventKey(n,"Right")||ze.default.isEventKey(n,"Up")?(n.preventDefault(),n.stopPropagation(),this.stepForward()):p.prototype.handleKeyDown.call(this,n)},d.handleClick=function(n){n.stopPropagation(),n.preventDefault()},d.vertical=function(n){if(n===void 0)return this.vertical_||!1;this.vertical_=!!n,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},m}(ce);ce.registerComponent("Slider",fa);var pa=function(m,d){return Bn(m/d*100,0,100).toFixed(2)+"%"},Io=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.partEls_=[],l.on(u,"progress",function(g){return l.update(g)}),l}var d=m.prototype;return d.createEl=function(){var n=p.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),l=Tt("span",{className:"vjs-control-text"}),g=Tt("span",{textContent:this.localize("Loaded")}),A=oe.default.createTextNode(": ");return this.percentageEl_=Tt("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),n.appendChild(l),l.appendChild(g),l.appendChild(A),l.appendChild(this.percentageEl_),n},d.dispose=function(){this.partEls_=null,this.percentageEl_=null,p.prototype.dispose.call(this)},d.update=function(n){var l=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var g=l.player_.liveTracker,A=l.player_.buffered(),L=g&&g.isLive()?g.seekableEnd():l.player_.duration(),M=l.player_.bufferedEnd(),G=l.partEls_,Q=pa(M,L);l.percent_!==Q&&(l.el_.style.width=Q,Gi(l.percentageEl_,Q),l.percent_=Q);for(var $=0;$<A.length;$++){var fe=A.start($),$e=A.end($),bt=G[$];bt||(bt=l.el_.appendChild(Tt()),G[$]=bt),!(bt.dataset.start===fe&&bt.dataset.end===$e)&&(bt.dataset.start=fe,bt.dataset.end=$e,bt.style.left=pa(fe,M),bt.style.width=pa($e-fe,M))}for(var os=G.length;os>A.length;os--)l.el_.removeChild(G[os-1]);G.length=A.length})},m}(ce);ce.registerComponent("LoadProgressBar",Io);var Ja=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.update=Ui(Lt(Ge.default(l),l.update),ki),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},d.update=function(n,l,g){var A=fi(this.el_),L=xr(this.player_.el()),M=n.width*l;if(!(!L||!A)){var G=n.left-L.left+M,Q=n.width-M+(L.right-n.right),$=A.width/2;G<$?$+=$-G:Q<$&&($=Q),$<0?$=0:$>A.width&&($=A.width),$=Math.round($),this.el_.style.right="-"+$+"px",this.write(g)}},d.write=function(n){Gi(this.el_,n)},d.updateTime=function(n,l,g,A){var L=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var M,G=L.player_.duration();if(L.player_.liveTracker&&L.player_.liveTracker.isLive()){var Q=L.player_.liveTracker.liveWindow(),$=Q-l*Q;M=($<1?"":"-")+Is($,Q)}else M=Is(g,G);L.update(n,l,M),A&&A()})},m}(ce);ce.registerComponent("TimeTooltip",Ja);var Un=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.update=Ui(Lt(Ge.default(l),l.update),ki),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},d.update=function(n,l){var g=this.getChild("timeTooltip");if(g){var A=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();g.updateTime(n,l,A)}},m}(ce);Un.prototype.options_={children:[]},!mi&&!rt&&Un.prototype.options_.children.push("timeTooltip"),ce.registerComponent("PlayProgressBar",Un);var $n=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.update=Ui(Lt(Ge.default(l),l.update),ki),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},d.update=function(n,l){var g=this,A=l*this.player_.duration();this.getChild("timeTooltip").updateTime(n,l,A,function(){g.el_.style.left=n.width*l+"px"})},m}(ce);$n.prototype.options_={children:["timeTooltip"]},ce.registerComponent("MouseTimeDisplay",$n);var Zs=5,ga=12,Hn=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.setEventHandlers_(),l}var d=m.prototype;return d.setEventHandlers_=function(){var n=this;this.update_=Lt(this,this.update),this.update=Ui(this.update_,ki),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(l){return n.enableInterval_(l)},this.disableIntervalHandler_=function(l){return n.disableInterval_(l)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in oe.default&&"visibilityState"in oe.default&&this.on(oe.default,"visibilitychange",this.toggleVisibility_)},d.toggleVisibility_=function(n){oe.default.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(n)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())},d.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,ki))},d.disableInterval_=function(n){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&n&&n.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},d.update=function(n){var l=this;if(oe.default.visibilityState!=="hidden"){var g=p.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var A=l.player_.ended()?l.player_.duration():l.getCurrentTime_(),L=l.player_.liveTracker,M=l.player_.duration();L&&L.isLive()&&(M=l.player_.liveTracker.liveCurrentTime()),l.percent_!==g&&(l.el_.setAttribute("aria-valuenow",(g*100).toFixed(2)),l.percent_=g),(l.currentTime_!==A||l.duration_!==M)&&(l.el_.setAttribute("aria-valuetext",l.localize("progress bar timing: currentTime={1} duration={2}",[Is(A,M),Is(M,M)],"{1} of {2}")),l.currentTime_=A,l.duration_=M),l.bar&&l.bar.update(xr(l.el()),l.getProgress())}),g}},d.userSeek_=function(n){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(n)},d.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},d.getPercent=function(){var n=this.getCurrentTime_(),l,g=this.player_.liveTracker;return g&&g.isLive()?(l=(n-g.seekableStart())/g.liveWindow(),g.atLiveEdge()&&(l=1)):l=n/this.player_.duration(),l},d.handleMouseDown=function(n){Gr(n)&&(n.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),p.prototype.handleMouseDown.call(this,n))},d.handleMouseMove=function(n,l){if(l===void 0&&(l=!1),!!Gr(n)){!l&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);var g,A=this.calculateDistance(n),L=this.player_.liveTracker;if(!L||!L.isLive())g=A*this.player_.duration(),g===this.player_.duration()&&(g=g-.1);else{if(A>=.99){L.seekToLiveEdge();return}var M=L.seekableStart(),G=L.liveCurrentTime();if(g=M+A*L.liveWindow(),g>=G&&(g=G),g<=M&&(g=M+.1),g===1/0)return}this.userSeek_(g)}},d.enable=function(){p.prototype.enable.call(this);var n=this.getChild("mouseTimeDisplay");n&&n.show()},d.disable=function(){p.prototype.disable.call(this);var n=this.getChild("mouseTimeDisplay");n&&n.hide()},d.handleMouseUp=function(n){p.prototype.handleMouseUp.call(this,n),n&&n.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Ci(this.player_.play()):this.update_()},d.stepForward=function(){this.userSeek_(this.player_.currentTime()+Zs)},d.stepBack=function(){this.userSeek_(this.player_.currentTime()-Zs)},d.handleAction=function(n){this.player_.paused()?this.player_.play():this.player_.pause()},d.handleKeyDown=function(n){var l=this.player_.liveTracker;if(ze.default.isEventKey(n,"Space")||ze.default.isEventKey(n,"Enter"))n.preventDefault(),n.stopPropagation(),this.handleAction(n);else if(ze.default.isEventKey(n,"Home"))n.preventDefault(),n.stopPropagation(),this.userSeek_(0);else if(ze.default.isEventKey(n,"End"))n.preventDefault(),n.stopPropagation(),l&&l.isLive()?this.userSeek_(l.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(ze.default(n))){n.preventDefault(),n.stopPropagation();var g=(ze.default.codes[ze.default(n)]-ze.default.codes[0])*10/100;l&&l.isLive()?this.userSeek_(l.seekableStart()+l.liveWindow()*g):this.userSeek_(this.player_.duration()*g)}else ze.default.isEventKey(n,"PgDn")?(n.preventDefault(),n.stopPropagation(),this.userSeek_(this.player_.currentTime()-Zs*ga)):ze.default.isEventKey(n,"PgUp")?(n.preventDefault(),n.stopPropagation(),this.userSeek_(this.player_.currentTime()+Zs*ga)):p.prototype.handleKeyDown.call(this,n)},d.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in oe.default&&"visibilityState"in oe.default&&this.off(oe.default,"visibilitychange",this.toggleVisibility_),p.prototype.dispose.call(this)},m}(fa);Hn.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},!mi&&!rt&&Hn.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),ce.registerComponent("SeekBar",Hn);var ma=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.handleMouseMove=Ui(Lt(Ge.default(l),l.handleMouseMove),ki),l.throttledHandleMouseSeek=Ui(Lt(Ge.default(l),l.handleMouseSeek),ki),l.handleMouseUpHandler_=function(g){return l.handleMouseUp(g)},l.handleMouseDownHandler_=function(g){return l.handleMouseDown(g)},l.enable(),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},d.handleMouseMove=function(n){var l=this.getChild("seekBar");if(l){var g=l.getChild("playProgressBar"),A=l.getChild("mouseTimeDisplay");if(!(!g&&!A)){var L=l.el(),M=fi(L),G=$r(L,n).x;G=Bn(G,0,1),A&&A.update(M,G),g&&g.update(M,l.getProgress())}}},d.handleMouseSeek=function(n){var l=this.getChild("seekBar");l&&l.handleMouseMove(n)},d.enabled=function(){return this.enabled_},d.disable=function(){if(this.children().forEach(function(l){return l.disable&&l.disable()}),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var n=this.getChild("seekBar");this.player_.scrubbing(!1),n.videoWasPlaying&&Ci(this.player_.play())}},d.enable=function(){this.children().forEach(function(n){return n.enable&&n.enable()}),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},d.removeListenersAddedOnMousedownAndTouchstart=function(){var n=this.el_.ownerDocument;this.off(n,"mousemove",this.throttledHandleMouseSeek),this.off(n,"touchmove",this.throttledHandleMouseSeek),this.off(n,"mouseup",this.handleMouseUpHandler_),this.off(n,"touchend",this.handleMouseUpHandler_)},d.handleMouseDown=function(n){var l=this.el_.ownerDocument,g=this.getChild("seekBar");g&&g.handleMouseDown(n),this.on(l,"mousemove",this.throttledHandleMouseSeek),this.on(l,"touchmove",this.throttledHandleMouseSeek),this.on(l,"mouseup",this.handleMouseUpHandler_),this.on(l,"touchend",this.handleMouseUpHandler_)},d.handleMouseUp=function(n){var l=this.getChild("seekBar");l&&l.handleMouseUp(n),this.removeListenersAddedOnMousedownAndTouchstart()},m}(ce);ma.prototype.options_={children:["seekBar"]},ce.registerComponent("ProgressControl",ma);var va=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.on(u,["enterpictureinpicture","leavepictureinpicture"],function(g){return l.handlePictureInPictureChange(g)}),l.on(u,["disablepictureinpicturechanged","loadedmetadata"],function(g){return l.handlePictureInPictureEnabledChange(g)}),l.on(u,["loadedmetadata","audioonlymodechange","audiopostermodechange"],function(){var g=u.currentType().substring(0,5)==="audio";g||u.audioPosterMode()||u.audioOnlyMode()?(u.isInPictureInPicture()&&u.exitPictureInPicture(),l.hide()):l.show()}),l.disable(),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-picture-in-picture-control "+p.prototype.buildCSSClass.call(this)},d.handlePictureInPictureEnabledChange=function(){oe.default.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1?this.enable():this.disable()},d.handlePictureInPictureChange=function(n){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},d.handleClick=function(n){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},m}(bi);va.prototype.controlText_="Picture-in-Picture",ce.registerComponent("PictureInPictureToggle",va);var Cs=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.on(u,"fullscreenchange",function(g){return l.handleFullscreenChange(g)}),oe.default[u.fsApi_.fullscreenEnabled]===!1&&l.disable(),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-fullscreen-control "+p.prototype.buildCSSClass.call(this)},d.handleFullscreenChange=function(n){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},d.handleClick=function(n){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},m}(bi);Cs.prototype.controlText_="Fullscreen",ce.registerComponent("FullscreenToggle",Cs);var Co=function(m,d){d.tech_&&!d.tech_.featuresVolumeControl&&m.addClass("vjs-hidden"),m.on(d,"loadstart",function(){d.tech_.featuresVolumeControl?m.removeClass("vjs-hidden"):m.addClass("vjs-hidden")})},Za=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.createEl=function(){var n=p.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return n.appendChild(p.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),n},m}(ce);ce.registerComponent("VolumeLevel",Za);var eo=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.update=Ui(Lt(Ge.default(l),l.update),ki),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},d.update=function(n,l,g,A){if(!g){var L=xr(this.el_),M=xr(this.player_.el()),G=n.width*l;if(!M||!L)return;var Q=n.left-M.left+G,$=n.width-G+(M.right-n.right),fe=L.width/2;Q<fe?fe+=fe-Q:$<fe&&(fe=$),fe<0?fe=0:fe>L.width&&(fe=L.width),this.el_.style.right="-"+fe+"px"}this.write(A+"%")},d.write=function(n){Gi(this.el_,n)},d.updateVolume=function(n,l,g,A,L){var M=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){M.update(n,l,g,A.toFixed(0)),L&&L()})},m}(ce);ce.registerComponent("VolumeLevelTooltip",eo);var to=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.update=Ui(Lt(Ge.default(l),l.update),ki),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},d.update=function(n,l,g){var A=this,L=100*l;this.getChild("volumeLevelTooltip").updateVolume(n,l,g,L,function(){g?A.el_.style.bottom=n.height*l+"px":A.el_.style.left=n.width*l+"px"})},m}(ce);to.prototype.options_={children:["volumeLevelTooltip"]},ce.registerComponent("MouseVolumeLevelDisplay",to);var en=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.on("slideractive",function(g){return l.updateLastVolume_(g)}),l.on(u,"volumechange",function(g){return l.updateARIAAttributes(g)}),u.ready(function(){return l.updateARIAAttributes()}),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},d.handleMouseDown=function(n){Gr(n)&&p.prototype.handleMouseDown.call(this,n)},d.handleMouseMove=function(n){var l=this.getChild("mouseVolumeLevelDisplay");if(l){var g=this.el(),A=xr(g),L=this.vertical(),M=$r(g,n);M=L?M.y:M.x,M=Bn(M,0,1),l.update(A,M,L)}Gr(n)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(n)))},d.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},d.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},d.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},d.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},d.updateARIAAttributes=function(n){var l=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",l),this.el_.setAttribute("aria-valuetext",l+"%")},d.volumeAsPercentage_=function(){return Math.round(this.player_.volume()*100)},d.updateLastVolume_=function(){var n=this,l=this.player_.volume();this.one("sliderinactive",function(){n.player_.volume()===0&&n.player_.lastVolume_(l)})},m}(fa);en.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},!mi&&!rt&&en.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),en.prototype.playerEvent="volumechange",ce.registerComponent("VolumeBar",en);var tn=function(p){ge.default(m,p);function m(u,n){var l;return n===void 0&&(n={}),n.vertical=n.vertical||!1,(typeof n.volumeBar=="undefined"||Si(n.volumeBar))&&(n.volumeBar=n.volumeBar||{},n.volumeBar.vertical=n.vertical),l=p.call(this,u,n)||this,Co(Ge.default(l),u),l.throttledHandleMouseMove=Ui(Lt(Ge.default(l),l.handleMouseMove),ki),l.handleMouseUpHandler_=function(g){return l.handleMouseUp(g)},l.on("mousedown",function(g){return l.handleMouseDown(g)}),l.on("touchstart",function(g){return l.handleMouseDown(g)}),l.on("mousemove",function(g){return l.handleMouseMove(g)}),l.on(l.volumeBar,["focus","slideractive"],function(){l.volumeBar.addClass("vjs-slider-active"),l.addClass("vjs-slider-active"),l.trigger("slideractive")}),l.on(l.volumeBar,["blur","sliderinactive"],function(){l.volumeBar.removeClass("vjs-slider-active"),l.removeClass("vjs-slider-active"),l.trigger("sliderinactive")}),l}var d=m.prototype;return d.createEl=function(){var n="vjs-volume-horizontal";return this.options_.vertical&&(n="vjs-volume-vertical"),p.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+n})},d.handleMouseDown=function(n){var l=this.el_.ownerDocument;this.on(l,"mousemove",this.throttledHandleMouseMove),this.on(l,"touchmove",this.throttledHandleMouseMove),this.on(l,"mouseup",this.handleMouseUpHandler_),this.on(l,"touchend",this.handleMouseUpHandler_)},d.handleMouseUp=function(n){var l=this.el_.ownerDocument;this.off(l,"mousemove",this.throttledHandleMouseMove),this.off(l,"touchmove",this.throttledHandleMouseMove),this.off(l,"mouseup",this.handleMouseUpHandler_),this.off(l,"touchend",this.handleMouseUpHandler_)},d.handleMouseMove=function(n){this.volumeBar.handleMouseMove(n)},m}(ce);tn.prototype.options_={children:["volumeBar"]},ce.registerComponent("VolumeControl",tn);var ko=function(m,d){d.tech_&&!d.tech_.featuresMuteControl&&m.addClass("vjs-hidden"),m.on(d,"loadstart",function(){d.tech_.featuresMuteControl?m.removeClass("vjs-hidden"):m.addClass("vjs-hidden")})},ne=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,ko(Ge.default(l),u),l.on(u,["loadstart","volumechange"],function(g){return l.update(g)}),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-mute-control "+p.prototype.buildCSSClass.call(this)},d.handleClick=function(n){var l=this.player_.volume(),g=this.player_.lastVolume_();if(l===0){var A=g<.1?.1:g;this.player_.volume(A),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},d.update=function(n){this.updateIcon_(),this.updateControlText_()},d.updateIcon_=function(){var n=this.player_.volume(),l=3;mi&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),n===0||this.player_.muted()?l=0:n<.33?l=1:n<.67&&(l=2);for(var g=0;g<4;g++)br(this.el_,"vjs-vol-"+g);xi(this.el_,"vjs-vol-"+l)},d.updateControlText_=function(){var n=this.player_.muted()||this.player_.volume()===0,l=n?"Unmute":"Mute";this.controlText()!==l&&this.controlText(l)},m}(bi);ne.prototype.controlText_="Mute",ce.registerComponent("MuteToggle",ne);var Gn=function(p){ge.default(m,p);function m(u,n){var l;return n===void 0&&(n={}),typeof n.inline!="undefined"?n.inline=n.inline:n.inline=!0,(typeof n.volumeControl=="undefined"||Si(n.volumeControl))&&(n.volumeControl=n.volumeControl||{},n.volumeControl.vertical=!n.inline),l=p.call(this,u,n)||this,l.handleKeyPressHandler_=function(g){return l.handleKeyPress(g)},l.on(u,["loadstart"],function(g){return l.volumePanelState_(g)}),l.on(l.muteToggle,"keyup",function(g){return l.handleKeyPress(g)}),l.on(l.volumeControl,"keyup",function(g){return l.handleVolumeControlKeyUp(g)}),l.on("keydown",function(g){return l.handleKeyPress(g)}),l.on("mouseover",function(g){return l.handleMouseOver(g)}),l.on("mouseout",function(g){return l.handleMouseOut(g)}),l.on(l.volumeControl,["slideractive"],l.sliderActive_),l.on(l.volumeControl,["sliderinactive"],l.sliderInactive_),l}var d=m.prototype;return d.sliderActive_=function(){this.addClass("vjs-slider-active")},d.sliderInactive_=function(){this.removeClass("vjs-slider-active")},d.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},d.createEl=function(){var n="vjs-volume-panel-horizontal";return this.options_.inline||(n="vjs-volume-panel-vertical"),p.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+n})},d.dispose=function(){this.handleMouseOut(),p.prototype.dispose.call(this)},d.handleVolumeControlKeyUp=function(n){ze.default.isEventKey(n,"Esc")&&this.muteToggle.focus()},d.handleMouseOver=function(n){this.addClass("vjs-hover"),_i(oe.default,"keyup",this.handleKeyPressHandler_)},d.handleMouseOut=function(n){this.removeClass("vjs-hover"),hi(oe.default,"keyup",this.handleKeyPressHandler_)},d.handleKeyPress=function(n){ze.default.isEventKey(n,"Esc")&&this.handleMouseOut()},m}(ce);Gn.prototype.options_={children:["muteToggle","volumeControl"]},ce.registerComponent("VolumePanel",Gn);var ya=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,n&&(l.menuButton_=n.menuButton),l.focusedChild_=-1,l.on("keydown",function(g){return l.handleKeyDown(g)}),l.boundHandleBlur_=function(g){return l.handleBlur(g)},l.boundHandleTapClick_=function(g){return l.handleTapClick(g)},l}var d=m.prototype;return d.addEventListenerForItem=function(n){n instanceof ce&&(this.on(n,"blur",this.boundHandleBlur_),this.on(n,["tap","click"],this.boundHandleTapClick_))},d.removeEventListenerForItem=function(n){n instanceof ce&&(this.off(n,"blur",this.boundHandleBlur_),this.off(n,["tap","click"],this.boundHandleTapClick_))},d.removeChild=function(n){typeof n=="string"&&(n=this.getChild(n)),this.removeEventListenerForItem(n),p.prototype.removeChild.call(this,n)},d.addItem=function(n){var l=this.addChild(n);l&&this.addEventListenerForItem(l)},d.createEl=function(){var n=this.options_.contentElType||"ul";this.contentEl_=Tt(n,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var l=p.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return l.appendChild(this.contentEl_),_i(l,"click",function(g){g.preventDefault(),g.stopImmediatePropagation()}),l},d.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,p.prototype.dispose.call(this)},d.handleBlur=function(n){var l=n.relatedTarget||oe.default.activeElement;if(!this.children().some(function(A){return A.el()===l})){var g=this.menuButton_;g&&g.buttonPressed_&&l!==g.el().firstChild&&g.unpressButton()}},d.handleTapClick=function(n){if(this.menuButton_){this.menuButton_.unpressButton();var l=this.children();if(!Array.isArray(l))return;var g=l.filter(function(A){return A.el()===n.target})[0];if(!g)return;g.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}},d.handleKeyDown=function(n){ze.default.isEventKey(n,"Left")||ze.default.isEventKey(n,"Down")?(n.preventDefault(),n.stopPropagation(),this.stepForward()):(ze.default.isEventKey(n,"Right")||ze.default.isEventKey(n,"Up"))&&(n.preventDefault(),n.stopPropagation(),this.stepBack())},d.stepForward=function(){var n=0;this.focusedChild_!==void 0&&(n=this.focusedChild_+1),this.focus(n)},d.stepBack=function(){var n=0;this.focusedChild_!==void 0&&(n=this.focusedChild_-1),this.focus(n)},d.focus=function(n){n===void 0&&(n=0);var l=this.children().slice(),g=l.length&&l[0].hasClass("vjs-menu-title");g&&l.shift(),l.length>0&&(n<0?n=0:n>=l.length&&(n=l.length-1),this.focusedChild_=n,l[n].el_.focus())},m}(ce);ce.registerComponent("Menu",ya);var Vn=function(p){ge.default(m,p);function m(u,n){var l;n===void 0&&(n={}),l=p.call(this,u,n)||this,l.menuButton_=new bi(u,n),l.menuButton_.controlText(l.controlText_),l.menuButton_.el_.setAttribute("aria-haspopup","true");var g=bi.prototype.buildCSSClass();l.menuButton_.el_.className=l.buildCSSClass()+" "+g,l.menuButton_.removeClass("vjs-control"),l.addChild(l.menuButton_),l.update(),l.enabled_=!0;var A=function(M){return l.handleClick(M)};return l.handleMenuKeyUp_=function(L){return l.handleMenuKeyUp(L)},l.on(l.menuButton_,"tap",A),l.on(l.menuButton_,"click",A),l.on(l.menuButton_,"keydown",function(L){return l.handleKeyDown(L)}),l.on(l.menuButton_,"mouseenter",function(){l.addClass("vjs-hover"),l.menu.show(),_i(oe.default,"keyup",l.handleMenuKeyUp_)}),l.on("mouseleave",function(L){return l.handleMouseLeave(L)}),l.on("keydown",function(L){return l.handleSubmenuKeyDown(L)}),l}var d=m.prototype;return d.update=function(){var n=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=n,this.addChild(n),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))},d.createMenu=function(){var n=new ya(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var l=Tt("li",{className:"vjs-menu-title",textContent:wt(this.options_.title),tabIndex:-1}),g=new ce(this.player_,{el:l});n.addItem(g)}if(this.items=this.createItems(),this.items)for(var A=0;A<this.items.length;A++)n.addItem(this.items[A]);return n},d.createItems=function(){},d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},d.buildWrapperCSSClass=function(){var n="vjs-menu-button";this.options_.inline===!0?n+="-inline":n+="-popup";var l=bi.prototype.buildCSSClass();return"vjs-menu-button "+n+" "+l+" "+p.prototype.buildCSSClass.call(this)},d.buildCSSClass=function(){var n="vjs-menu-button";return this.options_.inline===!0?n+="-inline":n+="-popup","vjs-menu-button "+n+" "+p.prototype.buildCSSClass.call(this)},d.controlText=function(n,l){return l===void 0&&(l=this.menuButton_.el()),this.menuButton_.controlText(n,l)},d.dispose=function(){this.handleMouseLeave(),p.prototype.dispose.call(this)},d.handleClick=function(n){this.buttonPressed_?this.unpressButton():this.pressButton()},d.handleMouseLeave=function(n){this.removeClass("vjs-hover"),hi(oe.default,"keyup",this.handleMenuKeyUp_)},d.focus=function(){this.menuButton_.focus()},d.blur=function(){this.menuButton_.blur()},d.handleKeyDown=function(n){ze.default.isEventKey(n,"Esc")||ze.default.isEventKey(n,"Tab")?(this.buttonPressed_&&this.unpressButton(),ze.default.isEventKey(n,"Tab")||(n.preventDefault(),this.menuButton_.focus())):(ze.default.isEventKey(n,"Up")||ze.default.isEventKey(n,"Down"))&&(this.buttonPressed_||(n.preventDefault(),this.pressButton()))},d.handleMenuKeyUp=function(n){(ze.default.isEventKey(n,"Esc")||ze.default.isEventKey(n,"Tab"))&&this.removeClass("vjs-hover")},d.handleSubmenuKeyPress=function(n){this.handleSubmenuKeyDown(n)},d.handleSubmenuKeyDown=function(n){(ze.default.isEventKey(n,"Esc")||ze.default.isEventKey(n,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),ze.default.isEventKey(n,"Tab")||(n.preventDefault(),this.menuButton_.focus()))},d.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),mi&&tt())return;this.menu.focus()}},d.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},d.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},d.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},m}(ce);ce.registerComponent("MenuButton",Vn);var _a=function(p){ge.default(m,p);function m(d,u){var n,l=u.tracks;if(n=p.call(this,d,u)||this,n.items.length<=1&&n.hide(),!l)return Ge.default(n);var g=Lt(Ge.default(n),n.update);return l.addEventListener("removetrack",g),l.addEventListener("addtrack",g),l.addEventListener("labelchange",g),n.player_.on("ready",g),n.player_.on("dispose",function(){l.removeEventListener("removetrack",g),l.removeEventListener("addtrack",g),l.removeEventListener("labelchange",g)}),n}return m}(Vn);ce.registerComponent("TrackButton",_a);var Ta=["Tab","Esc","Up","Down","Right","Left"],ks=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.selectable=n.selectable,l.isSelected_=n.selected||!1,l.multiSelectable=n.multiSelectable,l.selected(l.isSelected_),l.selectable?l.multiSelectable?l.el_.setAttribute("role","menuitemcheckbox"):l.el_.setAttribute("role","menuitemradio"):l.el_.setAttribute("role","menuitem"),l}var d=m.prototype;return d.createEl=function(n,l,g){this.nonIconControl=!0;var A=p.prototype.createEl.call(this,"li",Ot({className:"vjs-menu-item",tabIndex:-1},l),g);return A.replaceChild(Tt("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),A.querySelector(".vjs-icon-placeholder")),A},d.handleKeyDown=function(n){Ta.some(function(l){return ze.default.isEventKey(n,l)})||p.prototype.handleKeyDown.call(this,n)},d.handleClick=function(n){this.selected(!0)},d.selected=function(n){this.selectable&&(n?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},m}(vt);ce.registerComponent("MenuItem",ks);var rn=function(p){ge.default(m,p);function m(u,n){var l,g=n.track,A=u.textTracks();n.label=g.label||g.language||"Unknown",n.selected=g.mode==="showing",l=p.call(this,u,n)||this,l.track=g,l.kinds=(n.kinds||[n.kind||l.track.kind]).filter(Boolean);var L=function(){for(var $=arguments.length,fe=new Array($),$e=0;$e<$;$e++)fe[$e]=arguments[$e];l.handleTracksChange.apply(Ge.default(l),fe)},M=function(){for(var $=arguments.length,fe=new Array($),$e=0;$e<$;$e++)fe[$e]=arguments[$e];l.handleSelectedLanguageChange.apply(Ge.default(l),fe)};if(u.on(["loadstart","texttrackchange"],L),A.addEventListener("change",L),A.addEventListener("selectedlanguagechange",M),l.on("dispose",function(){u.off(["loadstart","texttrackchange"],L),A.removeEventListener("change",L),A.removeEventListener("selectedlanguagechange",M)}),A.onchange===void 0){var G;l.on(["tap","click"],function(){if(typeof Z.default.Event!="object")try{G=new Z.default.Event("change")}catch(Q){}G||(G=oe.default.createEvent("Event"),G.initEvent("change",!0,!0)),A.dispatchEvent(G)})}return l.handleTracksChange(),l}var d=m.prototype;return d.handleClick=function(n){var l=this.track,g=this.player_.textTracks();if(p.prototype.handleClick.call(this,n),!!g)for(var A=0;A<g.length;A++){var L=g[A];this.kinds.indexOf(L.kind)!==-1&&(L===l?L.mode!=="showing"&&(L.mode="showing"):L.mode!=="disabled"&&(L.mode="disabled"))}},d.handleTracksChange=function(n){var l=this.track.mode==="showing";l!==this.isSelected_&&this.selected(l)},d.handleSelectedLanguageChange=function(n){if(this.track.mode==="showing"){var l=this.player_.cache_.selectedLanguage;if(l&&l.enabled&&l.language===this.track.language&&l.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},d.dispose=function(){this.track=null,p.prototype.dispose.call(this)},m}(ks);ce.registerComponent("TextTrackMenuItem",rn);var io=function(p){ge.default(m,p);function m(u,n){return n.track={player:u,kind:n.kind,kinds:n.kinds,default:!1,mode:"disabled"},n.kinds||(n.kinds=[n.kind]),n.label?n.track.label=n.label:n.track.label=n.kinds.join(" and ")+" off",n.selectable=!0,n.multiSelectable=!1,p.call(this,u,n)||this}var d=m.prototype;return d.handleTracksChange=function(n){for(var l=this.player().textTracks(),g=!0,A=0,L=l.length;A<L;A++){var M=l[A];if(this.options_.kinds.indexOf(M.kind)>-1&&M.mode==="showing"){g=!1;break}}g!==this.isSelected_&&this.selected(g)},d.handleSelectedLanguageChange=function(n){for(var l=this.player().textTracks(),g=!0,A=0,L=l.length;A<L;A++){var M=l[A];if(["captions","descriptions","subtitles"].indexOf(M.kind)>-1&&M.mode==="showing"){g=!1;break}}g&&(this.player_.cache_.selectedLanguage={enabled:!1})},m}(rn);ce.registerComponent("OffTextTrackMenuItem",io);var Rr=function(p){ge.default(m,p);function m(u,n){return n===void 0&&(n={}),n.tracks=u.textTracks(),p.call(this,u,n)||this}var d=m.prototype;return d.createItems=function(n,l){n===void 0&&(n=[]),l===void 0&&(l=rn);var g;this.label_&&(g=this.label_+" off"),n.push(new io(this.player_,{kinds:this.kinds_,kind:this.kind_,label:g})),this.hideThreshold_+=1;var A=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var L=0;L<A.length;L++){var M=A[L];if(this.kinds_.indexOf(M.kind)>-1){var G=new l(this.player_,{track:M,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});G.addClass("vjs-"+M.kind+"-menu-item"),n.push(G)}}return n},m}(_a);ce.registerComponent("TextTrackButton",Rr);var Rs=function(p){ge.default(m,p);function m(u,n){var l,g=n.track,A=n.cue,L=u.currentTime();return n.selectable=!0,n.multiSelectable=!1,n.label=A.text,n.selected=A.startTime<=L&&L<A.endTime,l=p.call(this,u,n)||this,l.track=g,l.cue=A,l}var d=m.prototype;return d.handleClick=function(n){p.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},m}(ks);ce.registerComponent("ChaptersTrackMenuItem",Rs);var wr=function(p){ge.default(m,p);function m(u,n,l){var g;return g=p.call(this,u,n,l)||this,g.selectCurrentItem_=function(){g.items.forEach(function(A){A.selected(g.track_.activeCues[0]===A.cue)})},g}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-chapters-button "+p.prototype.buildCSSClass.call(this)},d.buildWrapperCSSClass=function(){return"vjs-chapters-button "+p.prototype.buildWrapperCSSClass.call(this)},d.update=function(n){if(!(n&&n.track&&n.track.kind!=="chapters")){var l=this.findChaptersTrack();l!==this.track_?(this.setTrack(l),p.prototype.update.call(this)):(!this.items||l&&l.cues&&l.cues.length!==this.items.length)&&p.prototype.update.call(this)}},d.setTrack=function(n){if(this.track_!==n){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var l=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);l&&l.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=n,this.track_){this.track_.mode="hidden";var g=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);g&&g.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}},d.findChaptersTrack=function(){for(var n=this.player_.textTracks()||[],l=n.length-1;l>=0;l--){var g=n[l];if(g.kind===this.kind_)return g}},d.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(wt(this.kind_))},d.createMenu=function(){return this.options_.title=this.getMenuCaption(),p.prototype.createMenu.call(this)},d.createItems=function(){var n=[];if(!this.track_)return n;var l=this.track_.cues;if(!l)return n;for(var g=0,A=l.length;g<A;g++){var L=l[g],M=new Rs(this.player_,{track:this.track_,cue:L});n.push(M)}return n},m}(Rr);wr.prototype.kind_="chapters",wr.prototype.controlText_="Chapters",ce.registerComponent("ChaptersButton",wr);var Ea=function(p){ge.default(m,p);function m(u,n,l){var g;g=p.call(this,u,n,l)||this;var A=u.textTracks(),L=Lt(Ge.default(g),g.handleTracksChange);return A.addEventListener("change",L),g.on("dispose",function(){A.removeEventListener("change",L)}),g}var d=m.prototype;return d.handleTracksChange=function(n){for(var l=this.player().textTracks(),g=!1,A=0,L=l.length;A<L;A++){var M=l[A];if(M.kind!==this.kind_&&M.mode==="showing"){g=!0;break}}g?this.disable():this.enable()},d.buildCSSClass=function(){return"vjs-descriptions-button "+p.prototype.buildCSSClass.call(this)},d.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+p.prototype.buildWrapperCSSClass.call(this)},m}(Rr);Ea.prototype.kind_="descriptions",Ea.prototype.controlText_="Descriptions",ce.registerComponent("DescriptionsButton",Ea);var ba=function(p){ge.default(m,p);function m(u,n,l){return p.call(this,u,n,l)||this}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-subtitles-button "+p.prototype.buildCSSClass.call(this)},d.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+p.prototype.buildWrapperCSSClass.call(this)},m}(Rr);ba.prototype.kind_="subtitles",ba.prototype.controlText_="Subtitles",ce.registerComponent("SubtitlesButton",ba);var Sa=function(p){ge.default(m,p);function m(u,n){var l;return n.track={player:u,kind:n.kind,label:n.kind+" settings",selectable:!1,default:!1,mode:"disabled"},n.selectable=!1,n.name="CaptionSettingsMenuItem",l=p.call(this,u,n)||this,l.addClass("vjs-texttrack-settings"),l.controlText(", opens "+n.kind+" settings dialog"),l}var d=m.prototype;return d.handleClick=function(n){this.player().getChild("textTrackSettings").open()},m}(rn);ce.registerComponent("CaptionSettingsMenuItem",Sa);var xa=function(p){ge.default(m,p);function m(u,n,l){return p.call(this,u,n,l)||this}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-captions-button "+p.prototype.buildCSSClass.call(this)},d.buildWrapperCSSClass=function(){return"vjs-captions-button "+p.prototype.buildWrapperCSSClass.call(this)},d.createItems=function(){var n=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(n.push(new Sa(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),p.prototype.createItems.call(this,n)},m}(Rr);xa.prototype.kind_="captions",xa.prototype.controlText_="Captions",ce.registerComponent("CaptionsButton",xa);var Aa=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.createEl=function(n,l,g){var A=p.prototype.createEl.call(this,n,l,g),L=A.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(L.appendChild(Tt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),L.appendChild(Tt("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),A},m}(rn);ce.registerComponent("SubsCapsMenuItem",Aa);var sn=function(p){ge.default(m,p);function m(u,n){var l;return n===void 0&&(n={}),l=p.call(this,u,n)||this,l.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(l.player_.language_)>-1&&(l.label_="captions"),l.menuButton_.controlText(wt(l.label_)),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-subs-caps-button "+p.prototype.buildCSSClass.call(this)},d.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+p.prototype.buildWrapperCSSClass.call(this)},d.createItems=function(){var n=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(n.push(new Sa(this.player_,{kind:this.label_})),this.hideThreshold_+=1),n=p.prototype.createItems.call(this,n,Aa),n},m}(Rr);sn.prototype.kinds_=["captions","subtitles"],sn.prototype.controlText_="Subtitles",ce.registerComponent("SubsCapsButton",sn);var nn=function(p){ge.default(m,p);function m(u,n){var l,g=n.track,A=u.audioTracks();n.label=g.label||g.language||"Unknown",n.selected=g.enabled,l=p.call(this,u,n)||this,l.track=g,l.addClass("vjs-"+g.kind+"-menu-item");var L=function(){for(var G=arguments.length,Q=new Array(G),$=0;$<G;$++)Q[$]=arguments[$];l.handleTracksChange.apply(Ge.default(l),Q)};return A.addEventListener("change",L),l.on("dispose",function(){A.removeEventListener("change",L)}),l}var d=m.prototype;return d.createEl=function(n,l,g){var A=p.prototype.createEl.call(this,n,l,g),L=A.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="main-desc"&&(L.appendChild(Tt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),L.appendChild(Tt("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),A},d.handleClick=function(n){if(p.prototype.handleClick.call(this,n),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var l=this.player_.audioTracks(),g=0;g<l.length;g++){var A=l[g];A!==this.track&&(A.enabled=A===this.track)}},d.handleTracksChange=function(n){this.selected(this.track.enabled)},m}(ks);ce.registerComponent("AudioTrackMenuItem",nn);var ws=function(p){ge.default(m,p);function m(u,n){return n===void 0&&(n={}),n.tracks=u.audioTracks(),p.call(this,u,n)||this}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-audio-button "+p.prototype.buildCSSClass.call(this)},d.buildWrapperCSSClass=function(){return"vjs-audio-button "+p.prototype.buildWrapperCSSClass.call(this)},d.createItems=function(n){n===void 0&&(n=[]),this.hideThreshold_=1;for(var l=this.player_.audioTracks(),g=0;g<l.length;g++){var A=l[g];n.push(new nn(this.player_,{track:A,selectable:!0,multiSelectable:!1}))}return n},m}(_a);ws.prototype.controlText_="Audio Track",ce.registerComponent("AudioTrackButton",ws);var La=function(p){ge.default(m,p);function m(u,n){var l,g=n.rate,A=parseFloat(g,10);return n.label=g,n.selected=A===u.playbackRate(),n.selectable=!0,n.multiSelectable=!1,l=p.call(this,u,n)||this,l.label=g,l.rate=A,l.on(u,"ratechange",function(L){return l.update(L)}),l}var d=m.prototype;return d.handleClick=function(n){p.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},d.update=function(n){this.selected(this.player().playbackRate()===this.rate)},m}(ks);La.prototype.contentElType="button",ce.registerComponent("PlaybackRateMenuItem",La);var Ia=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.menuButton_.el_.setAttribute("aria-describedby",l.labelElId_),l.updateVisibility(),l.updateLabel(),l.on(u,"loadstart",function(g){return l.updateVisibility(g)}),l.on(u,"ratechange",function(g){return l.updateLabel(g)}),l.on(u,"playbackrateschange",function(g){return l.handlePlaybackRateschange(g)}),l}var d=m.prototype;return d.createEl=function(){var n=p.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Tt("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),n.appendChild(this.labelEl_),n},d.dispose=function(){this.labelEl_=null,p.prototype.dispose.call(this)},d.buildCSSClass=function(){return"vjs-playback-rate "+p.prototype.buildCSSClass.call(this)},d.buildWrapperCSSClass=function(){return"vjs-playback-rate "+p.prototype.buildWrapperCSSClass.call(this)},d.createItems=function(){for(var n=this.playbackRates(),l=[],g=n.length-1;g>=0;g--)l.push(new La(this.player(),{rate:n[g]+"x"}));return l},d.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},d.handleClick=function(n){var l=this.player().playbackRate(),g=this.playbackRates(),A=g.indexOf(l),L=(A+1)%g.length;this.player().playbackRate(g[L])},d.handlePlaybackRateschange=function(n){this.update()},d.playbackRates=function(){var n=this.player();return n.playbackRates&&n.playbackRates()||[]},d.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},d.updateVisibility=function(n){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},d.updateLabel=function(n){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},m}(Vn);Ia.prototype.controlText_="Playback Rate",ce.registerComponent("PlaybackRateMenuButton",Ia);var Ca=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-spacer "+p.prototype.buildCSSClass.call(this)},d.createEl=function(n,l,g){return n===void 0&&(n="div"),l===void 0&&(l={}),g===void 0&&(g={}),l.className||(l.className=this.buildCSSClass()),p.prototype.createEl.call(this,n,l,g)},m}(ce);ce.registerComponent("Spacer",Ca);var ka=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-custom-control-spacer "+p.prototype.buildCSSClass.call(this)},d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:"\xA0"})},m}(Ca);ce.registerComponent("CustomControlSpacer",ka);var jn=function(p){ge.default(m,p);function m(){return p.apply(this,arguments)||this}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},m}(ce);jn.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in oe.default&&jn.prototype.options_.children.splice(jn.prototype.options_.children.length-1,0,"pictureInPictureToggle"),ce.registerComponent("ControlBar",jn);var an=function(p){ge.default(m,p);function m(u,n){var l;return l=p.call(this,u,n)||this,l.on(u,"error",function(g){return l.open(g)}),l}var d=m.prototype;return d.buildCSSClass=function(){return"vjs-error-display "+p.prototype.buildCSSClass.call(this)},d.content=function(){var n=this.player().error();return n?this.localize(n.message):""},m}(ft);an.prototype.options_=Wt.default({},ft.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),ce.registerComponent("ErrorDisplay",an);var Ra="vjs-text-track-settings",ro=["#000","Black"],wa=["#00F","Blue"],Da=["#0FF","Cyan"],so=["#0F0","Green"],Pa=["#F0F","Magenta"],no=["#F00","Red"],ao=["#FFF","White"],Kn=["#FF0","Yellow"],Oa=["1","Opaque"],Ma=["0.5","Semi-Transparent"],oo=["0","Transparent"],ns={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[ro,ao,no,so,wa,Kn,Pa,Da]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[Oa,Ma,oo]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[ao,ro,no,so,wa,Kn,Pa,Da]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(m){return m==="1.00"?null:Number(m)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[Oa,Ma]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[oo,Ma,Oa]}};ns.windowColor.options=ns.backgroundColor.options;function lo(p,m){if(m&&(p=m(p)),p&&p!=="none")return p}function Ro(p,m){var d=p.options[p.options.selectedIndex].value;return lo(d,m)}function wo(p,m,d){if(m){for(var u=0;u<p.options.length;u++)if(lo(p.options[u].value,d)===m){p.selectedIndex=u;break}}}var Do=function(p){ge.default(m,p);function m(u,n){var l;return n.temporary=!1,l=p.call(this,u,n)||this,l.updateDisplay=l.updateDisplay.bind(Ge.default(l)),l.fill(),l.hasBeenOpened_=l.hasBeenFilled_=!0,l.endDialog=Tt("p",{className:"vjs-control-text",textContent:l.localize("End of dialog window.")}),l.el().appendChild(l.endDialog),l.setDefaults(),n.persistTextTrackSettings===void 0&&(l.options_.persistTextTrackSettings=l.options_.playerOptions.persistTextTrackSettings),l.on(l.$(".vjs-done-button"),"click",function(){l.saveSettings(),l.close()}),l.on(l.$(".vjs-default-button"),"click",function(){l.setDefaults(),l.updateDisplay()}),pt(ns,function(g){l.on(l.$(g.selector),"change",l.updateDisplay)}),l.options_.persistTextTrackSettings&&l.restoreSettings(),l}var d=m.prototype;return d.dispose=function(){this.endDialog=null,p.prototype.dispose.call(this)},d.createElSelect_=function(n,l,g){var A=this;l===void 0&&(l=""),g===void 0&&(g="label");var L=ns[n],M=L.id.replace("%s",this.id_),G=[l,M].join(" ").trim();return["<"+g+' id="'+M+'" class="'+(g==="label"?"vjs-label":"")+'">',this.localize(L.label),"</"+g+">",'<select aria-labelledby="'+G+'">'].concat(L.options.map(function(Q){var $=M+"-"+Q[1].replace(/\W+/g,"");return['<option id="'+$+'" value="'+Q[0]+'" ','aria-labelledby="'+G+" "+$+'">',A.localize(Q[1]),"</option>"].join("")})).concat("</select>").join("")},d.createElFgColor_=function(){var n="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+n+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",n),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",n),"</span>","</fieldset>"].join("")},d.createElBgColor_=function(){var n="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+n+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",n),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",n),"</span>","</fieldset>"].join("")},d.createElWinColor_=function(){var n="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+n+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",n),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",n),"</span>","</fieldset>"].join("")},d.createElColors_=function(){return Tt("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},d.createElFont_=function(){return Tt("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},d.createElControls_=function(){var n=this.localize("restore all settings to the default values");return Tt("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+n+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+n+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},d.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},d.label=function(){return this.localize("Caption Settings Dialog")},d.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},d.buildCSSClass=function(){return p.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},d.getValues=function(){var n=this;return Ai(ns,function(l,g,A){var L=Ro(n.$(g.selector),g.parser);return L!==void 0&&(l[A]=L),l},{})},d.setValues=function(n){var l=this;pt(ns,function(g,A){wo(l.$(g.selector),n[A],g.parser)})},d.setDefaults=function(){var n=this;pt(ns,function(l){var g=l.hasOwnProperty("default")?l.default:0;n.$(l.selector).selectedIndex=g})},d.restoreSettings=function(){var n;try{n=JSON.parse(Z.default.localStorage.getItem(Ra))}catch(l){ve.warn(l)}n&&this.setValues(n)},d.saveSettings=function(){if(this.options_.persistTextTrackSettings){var n=this.getValues();try{Object.keys(n).length?Z.default.localStorage.setItem(Ra,JSON.stringify(n)):Z.default.localStorage.removeItem(Ra)}catch(l){ve.warn(l)}}},d.updateDisplay=function(){var n=this.player_.getChild("textTrackDisplay");n&&n.updateDisplay()},d.conditionalBlur_=function(){this.previouslyActiveEl_=null;var n=this.player_.controlBar,l=n&&n.subsCapsButton,g=n&&n.captionsButton;l?l.focus():g&&g.focus()},m}(ft);ce.registerComponent("TextTrackSettings",Do);var Po=function(p){ge.default(m,p);function m(u,n){var l,g=n.ResizeObserver||Z.default.ResizeObserver;n.ResizeObserver===null&&(g=!1);var A=Dt({createEl:!g,reportTouchActivity:!1},n);return l=p.call(this,u,A)||this,l.ResizeObserver=n.ResizeObserver||Z.default.ResizeObserver,l.loadListener_=null,l.resizeObserver_=null,l.debouncedHandler_=xn(function(){l.resizeHandler()},100,!1,Ge.default(l)),g?(l.resizeObserver_=new l.ResizeObserver(l.debouncedHandler_),l.resizeObserver_.observe(u.el())):(l.loadListener_=function(){if(!(!l.el_||!l.el_.contentWindow)){var L=l.debouncedHandler_,M=l.unloadListener_=function(){hi(this,"resize",L),hi(this,"unload",M),M=null};_i(l.el_.contentWindow,"unload",M),_i(l.el_.contentWindow,"resize",L)}},l.one("load",l.loadListener_)),l}var d=m.prototype;return d.createEl=function(){return p.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})},d.resizeHandler=function(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")},d.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,p.prototype.dispose.call(this)},m}(ce);ce.registerComponent("ResizeManager",Po);var qn={trackingThreshold:20,liveTolerance:15},Oo=function(p){ge.default(m,p);function m(u,n){var l,g=Dt(qn,n,{createEl:!1});return l=p.call(this,u,g)||this,l.handleVisibilityChange_=function(A){return l.handleVisibilityChange(A)},l.trackLiveHandler_=function(){return l.trackLive_()},l.handlePlay_=function(A){return l.handlePlay(A)},l.handleFirstTimeupdate_=function(A){return l.handleFirstTimeupdate(A)},l.handleSeeked_=function(A){return l.handleSeeked(A)},l.seekToLiveEdge_=function(A){return l.seekToLiveEdge(A)},l.reset_(),l.on(l.player_,"durationchange",function(A){return l.handleDurationchange(A)}),l.on(l.player_,"canplay",function(){return l.toggleTracking()}),Ee&&"hidden"in oe.default&&"visibilityState"in oe.default&&l.on(oe.default,"visibilitychange",l.handleVisibilityChange_),l}var d=m.prototype;return d.handleVisibilityChange=function(){this.player_.duration()===1/0&&(oe.default.hidden?this.stopTracking():this.startTracking())},d.trackLive_=function(){var n=this.player_.seekable();if(!(!n||!n.length)){var l=Number(Z.default.performance.now().toFixed(4)),g=this.lastTime_===-1?0:(l-this.lastTime_)/1e3;this.lastTime_=l,this.pastSeekEnd_=this.pastSeekEnd()+g;var A=this.liveCurrentTime(),L=this.player_.currentTime(),M=this.player_.paused()||this.seekedBehindLive_||Math.abs(A-L)>this.options_.liveTolerance;(!this.timeupdateSeen_||A===1/0)&&(M=!1),M!==this.behindLiveEdge_&&(this.behindLiveEdge_=M,this.trigger("liveedgechange"))}},d.handleDurationchange=function(){this.toggleTracking()},d.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},d.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,ki),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},d.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},d.handleSeeked=function(){var n=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&n>2,this.nextSeekedFromUser_=!1,this.trackLive_()},d.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},d.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},d.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},d.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},d.seekableEnd=function(){for(var n=this.player_.seekable(),l=[],g=n?n.length:0;g--;)l.push(n.end(g));return l.length?l.sort()[l.length-1]:1/0},d.seekableStart=function(){for(var n=this.player_.seekable(),l=[],g=n?n.length:0;g--;)l.push(n.start(g));return l.length?l.sort()[0]:0},d.liveWindow=function(){var n=this.liveCurrentTime();return n===1/0?0:n-this.seekableStart()},d.isLive=function(){return this.isTracking()},d.atLiveEdge=function(){return!this.behindLiveEdge()},d.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},d.pastSeekEnd=function(){var n=this.seekableEnd();return this.lastSeekEnd_!==-1&&n!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=n,this.pastSeekEnd_},d.behindLiveEdge=function(){return this.behindLiveEdge_},d.isTracking=function(){return typeof this.trackingInterval_=="number"},d.seekToLiveEdge=function(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},d.dispose=function(){this.off(oe.default,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),p.prototype.dispose.call(this)},m}(ce);ce.registerComponent("LiveTracker",Oo);var Wn=function(m){var d=m.el();if(d.hasAttribute("src"))return m.triggerSourceset(d.src),!0;var u=m.$$("source"),n=[],l="";if(!u.length)return!1;for(var g=0;g<u.length;g++){var A=u[g].src;A&&n.indexOf(A)===-1&&n.push(A)}return n.length?(n.length===1&&(l=n[0]),m.triggerSourceset(l),!0):!1},uo=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(m){var d=oe.default.createElement(this.nodeName.toLowerCase());d.innerHTML=m;for(var u=oe.default.createDocumentFragment();d.childNodes.length;)u.appendChild(d.childNodes[0]);return this.innerText="",Z.default.Element.prototype.appendChild.call(this,u),this.innerHTML}}),co=function(m,d){for(var u={},n=0;n<m.length&&(u=Object.getOwnPropertyDescriptor(m[n],d),!(u&&u.set&&u.get));n++);return u.enumerable=!0,u.configurable=!0,u},Fa=function(m){return co([m.el(),Z.default.HTMLMediaElement.prototype,Z.default.Element.prototype,uo],"innerHTML")},Di=function(m){var d=m.el();if(!d.resetSourceWatch_){var u={},n=Fa(m),l=function(A){return function(){for(var L=arguments.length,M=new Array(L),G=0;G<L;G++)M[G]=arguments[G];var Q=A.apply(d,M);return Wn(m),Q}};["append","appendChild","insertAdjacentHTML"].forEach(function(g){d[g]&&(u[g]=d[g],d[g]=l(u[g]))}),Object.defineProperty(d,"innerHTML",Dt(n,{set:l(n.set)})),d.resetSourceWatch_=function(){d.resetSourceWatch_=null,Object.keys(u).forEach(function(g){d[g]=u[g]}),Object.defineProperty(d,"innerHTML",n)},m.one("sourceset",d.resetSourceWatch_)}},rr=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?Ss(Z.default.Element.prototype.getAttribute.call(this,"src")):""},set:function(m){return Z.default.Element.prototype.setAttribute.call(this,"src",m),m}}),Na=function(m){return co([m.el(),Z.default.HTMLMediaElement.prototype,rr],"src")},Mo=function(m){if(m.featuresSourceset){var d=m.el();if(!d.resetSourceset_){var u=Na(m),n=d.setAttribute,l=d.load;Object.defineProperty(d,"src",Dt(u,{set:function(A){var L=u.set.call(d,A);return m.triggerSourceset(d.src),L}})),d.setAttribute=function(g,A){var L=n.call(d,g,A);return/src/i.test(g)&&m.triggerSourceset(d.src),L},d.load=function(){var g=l.call(d);return Wn(m)||(m.triggerSourceset(""),Di(m)),g},d.currentSrc?m.triggerSourceset(d.currentSrc):Wn(m)||Di(m),d.resetSourceset_=function(){d.resetSourceset_=null,d.load=l,d.setAttribute=n,Object.defineProperty(d,"src",u),d.resetSourceWatch_&&d.resetSourceWatch_()}}}},Ds=function(m,d,u,n){n===void 0&&(n=!0);var l=function(L){return Object.defineProperty(m,d,{value:L,enumerable:!0,writable:!0})},g={configurable:!0,enumerable:!0,get:function(){var L=u();return l(L),L}};return n&&(g.set=l),Object.defineProperty(m,d,g)},De=function(p){ge.default(m,p);function m(u,n){var l;l=p.call(this,u,n)||this;var g=u.source,A=!1;if(l.featuresVideoFrameCallback=l.featuresVideoFrameCallback&&l.el_.tagName==="VIDEO",g&&(l.el_.currentSrc!==g.src||u.tag&&u.tag.initNetworkState_===3)?l.setSource(g):l.handleLateInit_(l.el_),u.enableSourceset&&l.setupSourcesetHandling_(),l.isScrubbing_=!1,l.el_.hasChildNodes()){for(var L=l.el_.childNodes,M=L.length,G=[];M--;){var Q=L[M],$=Q.nodeName.toLowerCase();$==="track"&&(l.featuresNativeTextTracks?(l.remoteTextTrackEls().addTrackElement_(Q),l.remoteTextTracks().addTrack(Q.track),l.textTracks().addTrack(Q.track),!A&&!l.el_.hasAttribute("crossorigin")&&es(Q.src)&&(A=!0)):G.push(Q))}for(var fe=0;fe<G.length;fe++)l.el_.removeChild(G[fe])}return l.proxyNativeTracks_(),l.featuresNativeTextTracks&&A&&ve.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),l.restoreMetadataTracksInIOSNativePlayer_(),(er||Mr||Or)&&u.nativeControlsForTouch===!0&&l.setControls(!0),l.proxyWebkitFullscreen_(),l.triggerReady(),l}var d=m.prototype;return d.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),m.disposeMediaElement(this.el_),this.options_=null,p.prototype.dispose.call(this)},d.setupSourcesetHandling_=function(){Mo(this)},d.restoreMetadataTracksInIOSNativePlayer_=function(){var n=this.textTracks(),l,g=function(){l=[];for(var M=0;M<n.length;M++){var G=n[M];G.kind==="metadata"&&l.push({track:G,storedMode:G.mode})}};g(),n.addEventListener("change",g),this.on("dispose",function(){return n.removeEventListener("change",g)});var A=function L(){for(var M=0;M<l.length;M++){var G=l[M];G.track.mode==="disabled"&&G.track.mode!==G.storedMode&&(G.track.mode=G.storedMode)}n.removeEventListener("change",L)};this.on("webkitbeginfullscreen",function(){n.removeEventListener("change",g),n.removeEventListener("change",A),n.addEventListener("change",A)}),this.on("webkitendfullscreen",function(){n.removeEventListener("change",g),n.addEventListener("change",g),n.removeEventListener("change",A)})},d.overrideNative_=function(n,l){var g=this;if(l===this["featuresNative"+n+"Tracks"]){var A=n.toLowerCase();this[A+"TracksListeners_"]&&Object.keys(this[A+"TracksListeners_"]).forEach(function(L){var M=g.el()[A+"Tracks"];M.removeEventListener(L,g[A+"TracksListeners_"][L])}),this["featuresNative"+n+"Tracks"]=!l,this[A+"TracksListeners_"]=null,this.proxyNativeTracksForType_(A)}},d.overrideNativeAudioTracks=function(n){this.overrideNative_("Audio",n)},d.overrideNativeVideoTracks=function(n){this.overrideNative_("Video",n)},d.proxyNativeTracksForType_=function(n){var l=this,g=E[n],A=this.el()[g.getterName],L=this[g.getterName]();if(!(!this["featuresNative"+g.capitalName+"Tracks"]||!A||!A.addEventListener)){var M={change:function($){var fe={type:"change",target:L,currentTarget:L,srcElement:L};L.trigger(fe),n==="text"&&l[w.remoteText.getterName]().trigger(fe)},addtrack:function($){L.addTrack($.track)},removetrack:function($){L.removeTrack($.track)}},G=function(){for(var $=[],fe=0;fe<L.length;fe++){for(var $e=!1,bt=0;bt<A.length;bt++)if(A[bt]===L[fe]){$e=!0;break}$e||$.push(L[fe])}for(;$.length;)L.removeTrack($.shift())};this[g.getterName+"Listeners_"]=M,Object.keys(M).forEach(function(Q){var $=M[Q];A.addEventListener(Q,$),l.on("dispose",function(fe){return A.removeEventListener(Q,$)})}),this.on("loadstart",G),this.on("dispose",function(Q){return l.off("loadstart",G)})}},d.proxyNativeTracks_=function(){var n=this;E.names.forEach(function(l){n.proxyNativeTracksForType_(l)})},d.createEl=function(){var n=this.options_.tag;if(!n||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(n){var l=n.cloneNode(!0);n.parentNode&&n.parentNode.insertBefore(l,n),m.disposeMediaElement(n),n=l}else{n=oe.default.createElement("video");var g=this.options_.tag&&Bi(this.options_.tag),A=Dt({},g);(!er||this.options_.nativeControlsForTouch!==!0)&&delete A.controls,vn(n,Ot(A,{id:this.options_.techId,class:"vjs-tech"}))}n.playerId=this.options_.playerId}typeof this.options_.preload!="undefined"&&yi(n,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(n.disablePictureInPicture=this.options_.disablePictureInPicture);for(var L=["loop","muted","playsinline","autoplay"],M=0;M<L.length;M++){var G=L[M],Q=this.options_[G];typeof Q!="undefined"&&(Q?yi(n,G,G):cs(n,G),n[G]=Q)}return n},d.handleLateInit_=function(n){if(!(n.networkState===0||n.networkState===3)){if(n.readyState===0){var l=!1,g=function(){l=!0};this.on("loadstart",g);var A=function(){l||this.trigger("loadstart")};this.on("loadedmetadata",A),this.ready(function(){this.off("loadstart",g),this.off("loadedmetadata",A),l||this.trigger("loadstart")});return}var L=["loadstart"];L.push("loadedmetadata"),n.readyState>=2&&L.push("loadeddata"),n.readyState>=3&&L.push("canplay"),n.readyState>=4&&L.push("canplaythrough"),this.ready(function(){L.forEach(function(M){this.trigger(M)},this)})}},d.setScrubbing=function(n){this.isScrubbing_=n},d.scrubbing=function(){return this.isScrubbing_},d.setCurrentTime=function(n){try{this.isScrubbing_&&this.el_.fastSeek&&vi?this.el_.fastSeek(n):this.el_.currentTime=n}catch(l){ve(l,"Video is not ready. (Video.js)")}},d.duration=function(){var n=this;if(this.el_.duration===1/0&&rt&&Fi&&this.el_.currentTime===0){var l=function g(){n.el_.currentTime>0&&(n.el_.duration===1/0&&n.trigger("durationchange"),n.off("timeupdate",g))};return this.on("timeupdate",l),NaN}return this.el_.duration||NaN},d.width=function(){return this.el_.offsetWidth},d.height=function(){return this.el_.offsetHeight},d.proxyWebkitFullscreen_=function(){var n=this;if("webkitDisplayingFullscreen"in this.el_){var l=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},g=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",l),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",g),this.on("dispose",function(){n.off("webkitbeginfullscreen",g),n.off("webkitendfullscreen",l)})}},d.supportsFullScreen=function(){if(typeof this.el_.webkitEnterFullScreen=="function"){var n=Z.default.navigator&&Z.default.navigator.userAgent||"";if(/Android/.test(n)||!/Chrome|Mac OS X 10.5/.test(n))return!0}return!1},d.enterFullScreen=function(){var n=this.el_;if(n.paused&&n.networkState<=n.HAVE_METADATA)Ci(this.el_.play()),this.setTimeout(function(){n.pause();try{n.webkitEnterFullScreen()}catch(l){this.trigger("fullscreenerror",l)}},0);else try{n.webkitEnterFullScreen()}catch(l){this.trigger("fullscreenerror",l)}},d.exitFullScreen=function(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()},d.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},d.requestVideoFrameCallback=function(n){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(n):p.prototype.requestVideoFrameCallback.call(this,n)},d.cancelVideoFrameCallback=function(n){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(n):p.prototype.cancelVideoFrameCallback.call(this,n)},d.src=function(n){if(n===void 0)return this.el_.src;this.setSrc(n)},d.reset=function(){m.resetMediaElement(this.el_)},d.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},d.setControls=function(n){this.el_.controls=!!n},d.addTextTrack=function(n,l,g){return this.featuresNativeTextTracks?this.el_.addTextTrack(n,l,g):p.prototype.addTextTrack.call(this,n,l,g)},d.createRemoteTextTrack=function(n){if(!this.featuresNativeTextTracks)return p.prototype.createRemoteTextTrack.call(this,n);var l=oe.default.createElement("track");return n.kind&&(l.kind=n.kind),n.label&&(l.label=n.label),(n.language||n.srclang)&&(l.srclang=n.language||n.srclang),n.default&&(l.default=n.default),n.id&&(l.id=n.id),n.src&&(l.src=n.src),l},d.addRemoteTextTrack=function(n,l){var g=p.prototype.addRemoteTextTrack.call(this,n,l);return this.featuresNativeTextTracks&&this.el().appendChild(g),g},d.removeRemoteTextTrack=function(n){if(p.prototype.removeRemoteTextTrack.call(this,n),this.featuresNativeTextTracks)for(var l=this.$$("track"),g=l.length;g--;)(n===l[g]||n===l[g].track)&&this.el().removeChild(l[g])},d.getVideoPlaybackQuality=function(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();var n={};return typeof this.el().webkitDroppedFrameCount!="undefined"&&typeof this.el().webkitDecodedFrameCount!="undefined"&&(n.droppedVideoFrames=this.el().webkitDroppedFrameCount,n.totalVideoFrames=this.el().webkitDecodedFrameCount),Z.default.performance&&typeof Z.default.performance.now=="function"?n.creationTime=Z.default.performance.now():Z.default.performance&&Z.default.performance.timing&&typeof Z.default.performance.timing.navigationStart=="number"&&(n.creationTime=Z.default.Date.now()-Z.default.performance.timing.navigationStart),n},m}(C);Ds(De,"TEST_VID",function(){if(Bt()){var p=oe.default.createElement("video"),m=oe.default.createElement("track");return m.kind="captions",m.srclang="en",m.label="English",p.appendChild(m),p}}),De.isSupported=function(){try{De.TEST_VID.volume=.5}catch(p){return!1}return!!(De.TEST_VID&&De.TEST_VID.canPlayType)},De.canPlayType=function(p){return De.TEST_VID.canPlayType(p)},De.canPlaySource=function(p,m){return De.canPlayType(p.type)},De.canControlVolume=function(){try{var p=De.TEST_VID.volume;De.TEST_VID.volume=p/2+.1;var m=p!==De.TEST_VID.volume;return m&&mi?(Z.default.setTimeout(function(){De&&De.prototype&&(De.prototype.featuresVolumeControl=p!==De.TEST_VID.volume)}),!1):m}catch(d){return!1}},De.canMuteVolume=function(){try{var p=De.TEST_VID.muted;return De.TEST_VID.muted=!p,De.TEST_VID.muted?yi(De.TEST_VID,"muted","muted"):cs(De.TEST_VID,"muted","muted"),p!==De.TEST_VID.muted}catch(m){return!1}},De.canControlPlaybackRate=function(){if(rt&&Fi&&Ni<58)return!1;try{var p=De.TEST_VID.playbackRate;return De.TEST_VID.playbackRate=p/2+.1,p!==De.TEST_VID.playbackRate}catch(m){return!1}},De.canOverrideAttributes=function(){try{var p=function(){};Object.defineProperty(oe.default.createElement("video"),"src",{get:p,set:p}),Object.defineProperty(oe.default.createElement("audio"),"src",{get:p,set:p}),Object.defineProperty(oe.default.createElement("video"),"innerHTML",{get:p,set:p}),Object.defineProperty(oe.default.createElement("audio"),"innerHTML",{get:p,set:p})}catch(m){return!1}return!0},De.supportsNativeTextTracks=function(){return vi||mi&&Fi},De.supportsNativeVideoTracks=function(){return!!(De.TEST_VID&&De.TEST_VID.videoTracks)},De.supportsNativeAudioTracks=function(){return!!(De.TEST_VID&&De.TEST_VID.audioTracks)},De.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(p){var m=p[0],d=p[1];Ds(De.prototype,m,function(){return De[d]()},!0)}),De.prototype.featuresVolumeControl=De.canControlVolume(),De.prototype.movingMediaElementInDOM=!mi,De.prototype.featuresFullscreenResize=!0,De.prototype.featuresProgressEvents=!0,De.prototype.featuresTimeupdateEvents=!0,De.prototype.featuresVideoFrameCallback=!!(De.TEST_VID&&De.TEST_VID.requestVideoFrameCallback);var Yn;De.patchCanPlayType=function(){Mi>=4&&!et&&!Fi&&(Yn=De.TEST_VID&&De.TEST_VID.constructor.prototype.canPlayType,De.TEST_VID.constructor.prototype.canPlayType=function(p){var m=/^application\/(?:x-|vnd\.apple\.)mpegurl/i;return p&&m.test(p)?"maybe":Yn.call(this,p)})},De.unpatchCanPlayType=function(){var p=De.TEST_VID.constructor.prototype.canPlayType;return Yn&&(De.TEST_VID.constructor.prototype.canPlayType=Yn),p},De.patchCanPlayType(),De.disposeMediaElement=function(p){if(p){for(p.parentNode&&p.parentNode.removeChild(p);p.hasChildNodes();)p.removeChild(p.firstChild);p.removeAttribute("src"),typeof p.load=="function"&&function(){try{p.load()}catch(m){}}()}},De.resetMediaElement=function(p){if(p){for(var m=p.querySelectorAll("source"),d=m.length;d--;)p.removeChild(m[d]);p.removeAttribute("src"),typeof p.load=="function"&&function(){try{p.load()}catch(u){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(p){De.prototype[p]=function(){return this.el_[p]||this.el_.hasAttribute(p)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(p){De.prototype["set"+wt(p)]=function(m){this.el_[p]=m,m?this.el_.setAttribute(p,p):this.el_.removeAttribute(p)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(p){De.prototype[p]=function(){return this.el_[p]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(p){De.prototype["set"+wt(p)]=function(m){this.el_[p]=m}}),["pause","load","play"].forEach(function(p){De.prototype[p]=function(){return this.el_[p]()}}),C.withSourceHandlers(De),De.nativeSourceHandler={},De.nativeSourceHandler.canPlayType=function(p){try{return De.TEST_VID.canPlayType(p)}catch(m){return""}},De.nativeSourceHandler.canHandleSource=function(p,m){if(p.type)return De.nativeSourceHandler.canPlayType(p.type);if(p.src){var d=Zr(p.src);return De.nativeSourceHandler.canPlayType("video/"+d)}return""},De.nativeSourceHandler.handleSource=function(p,m,d){m.setSrc(p.src)},De.nativeSourceHandler.dispose=function(){},De.registerSourceHandler(De.nativeSourceHandler),C.registerTech("Html5",De);var ho=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Ba={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},zn=["tiny","xsmall","small","medium","large","xlarge","huge"],on={};zn.forEach(function(p){var m=p.charAt(0)==="x"?"x-"+p.substring(1):p;on[p]="vjs-layout-"+m});var Ua={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},ni=function(p){ge.default(m,p);function m(u,n,l){var g;if(u.id=u.id||n.id||"vjs_video_"+Li(),n=Ot(m.getTagSettings(u),n),n.initChildren=!1,n.createEl=!1,n.evented=!1,n.reportTouchActivity=!1,!n.language)if(typeof u.closest=="function"){var A=u.closest("[lang]");A&&A.getAttribute&&(n.language=A.getAttribute("lang"))}else for(var L=u;L&&L.nodeType===1;){if(Bi(L).hasOwnProperty("lang")){n.language=L.getAttribute("lang");break}L=L.parentNode}if(g=p.call(this,null,n,l)||this,g.boundDocumentFullscreenChange_=function($){return g.documentFullscreenChange_($)},g.boundFullWindowOnEscKey_=function($){return g.fullWindowOnEscKey($)},g.boundUpdateStyleEl_=function($){return g.updateStyleEl_($)},g.boundApplyInitTime_=function($){return g.applyInitTime_($)},g.boundUpdateCurrentBreakpoint_=function($){return g.updateCurrentBreakpoint_($)},g.boundHandleTechClick_=function($){return g.handleTechClick_($)},g.boundHandleTechDoubleClick_=function($){return g.handleTechDoubleClick_($)},g.boundHandleTechTouchStart_=function($){return g.handleTechTouchStart_($)},g.boundHandleTechTouchMove_=function($){return g.handleTechTouchMove_($)},g.boundHandleTechTouchEnd_=function($){return g.handleTechTouchEnd_($)},g.boundHandleTechTap_=function($){return g.handleTechTap_($)},g.isFullscreen_=!1,g.log=xt(g.id_),g.fsApi_=H,g.isPosterFromTech_=!1,g.queuedCallbacks_=[],g.isReady_=!1,g.hasStarted_=!1,g.userActive_=!1,g.debugEnabled_=!1,g.audioOnlyMode_=!1,g.audioPosterMode_=!1,g.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!g.options_||!g.options_.techOrder||!g.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(g.tag=u,g.tagAttributes=u&&Bi(u),g.language(g.options_.language),n.languages){var M={};Object.getOwnPropertyNames(n.languages).forEach(function($){M[$.toLowerCase()]=n.languages[$]}),g.languages_=M}else g.languages_=m.prototype.options_.languages;g.resetCache_(),g.poster_=n.poster||"",g.controls_=!!n.controls,u.controls=!1,u.removeAttribute("controls"),g.changingSrc_=!1,g.playCallbacks_=[],g.playTerminatedQueue_=[],u.hasAttribute("autoplay")?g.autoplay(!0):g.autoplay(g.options_.autoplay),n.plugins&&Object.keys(n.plugins).forEach(function($){if(typeof g[$]!="function")throw new Error('plugin "'+$+'" does not exist')}),g.scrubbing_=!1,g.el_=g.createEl(),Ri(Ge.default(g),{eventBusKey:"el_"}),g.fsApi_.requestFullscreen&&(_i(oe.default,g.fsApi_.fullscreenchange,g.boundDocumentFullscreenChange_),g.on(g.fsApi_.fullscreenchange,g.boundDocumentFullscreenChange_)),g.fluid_&&g.on(["playerreset","resize"],g.boundUpdateStyleEl_);var G=Dt(g.options_);n.plugins&&Object.keys(n.plugins).forEach(function($){g[$](n.plugins[$])}),n.debug&&g.debug(!0),g.options_.playerOptions=G,g.middleware_=[],g.playbackRates(n.playbackRates),g.initChildren(),g.isAudio(u.nodeName.toLowerCase()==="audio"),g.controls()?g.addClass("vjs-controls-enabled"):g.addClass("vjs-controls-disabled"),g.el_.setAttribute("role","region"),g.isAudio()?g.el_.setAttribute("aria-label",g.localize("Audio Player")):g.el_.setAttribute("aria-label",g.localize("Video Player")),g.isAudio()&&g.addClass("vjs-audio"),g.flexNotSupported_()&&g.addClass("vjs-no-flex"),er&&g.addClass("vjs-touch-enabled"),mi||g.addClass("vjs-workinghover"),m.players[g.id_]=Ge.default(g);var Q=Hi.split(".")[0];return g.addClass("vjs-v"+Q),g.userActive(!0),g.reportUserActivity(),g.one("play",function($){return g.listenForUserActivity_($)}),g.on("stageclick",function($){return g.handleStageClick_($)}),g.on("keydown",function($){return g.handleKeyDown($)}),g.on("languagechange",function($){return g.handleLanguagechange($)}),g.breakpoints(g.options_.breakpoints),g.responsive(g.options_.responsive),g.on("ready",function(){g.audioPosterMode(g.options_.audioPosterMode),g.audioOnlyMode(g.options_.audioOnlyMode)}),g}var d=m.prototype;return d.dispose=function(){var n=this;this.trigger("dispose"),this.off("dispose"),hi(oe.default,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),hi(oe.default,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),m.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),we(this),D.names.forEach(function(l){var g=D[l],A=n[g.getterName]();A&&A.off&&A.off()}),p.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},d.createEl=function(){var n=this.tag,l,g=this.playerElIngest_=n.parentNode&&n.parentNode.hasAttribute&&n.parentNode.hasAttribute("data-vjs-player"),A=this.tag.tagName.toLowerCase()==="video-js";g?l=this.el_=n.parentNode:A||(l=this.el_=p.prototype.createEl.call(this,"div"));var L=Bi(n);if(A){for(l=this.el_=n,n=this.tag=oe.default.createElement("video");l.children.length;)n.appendChild(l.firstChild);Vi(l,"video-js")||xi(l,"video-js"),l.appendChild(n),g=this.playerElIngest_=l,Object.keys(l).forEach(function($e){try{n[$e]=l[$e]}catch(bt){}})}if(n.setAttribute("tabindex","-1"),L.tabindex="-1",(Ee||Fi&&Rt)&&(n.setAttribute("role","application"),L.role="application"),n.removeAttribute("width"),n.removeAttribute("height"),"width"in L&&delete L.width,"height"in L&&delete L.height,Object.getOwnPropertyNames(L).forEach(function($e){A&&$e==="class"||l.setAttribute($e,L[$e]),A&&n.setAttribute($e,L[$e])}),n.playerId=n.id,n.id+="_html5_api",n.className="vjs-tech",n.player=l.player=this,this.addClass("vjs-paused"),Z.default.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=dr("vjs-styles-dimensions");var M=tr(".vjs-styles-defaults"),G=tr("head");G.insertBefore(this.styleEl_,M?M.nextSibling:G.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var Q=n.getElementsByTagName("a"),$=0;$<Q.length;$++){var fe=Q.item($);xi(fe,"vjs-hidden"),fe.setAttribute("hidden","hidden")}return n.initNetworkState_=n.networkState,n.parentNode&&!g&&n.parentNode.insertBefore(l,n),ht(n,l),this.children_.unshift(n),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=l,l},d.crossOrigin=function(n){if(!n)return this.techGet_("crossOrigin");if(n!=="anonymous"&&n!=="use-credentials"){ve.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+n+'"');return}this.techCall_("setCrossOrigin",n)},d.width=function(n){return this.dimension("width",n)},d.height=function(n){return this.dimension("height",n)},d.dimension=function(n,l){var g=n+"_";if(l===void 0)return this[g]||0;if(l===""||l==="auto"){this[g]=void 0,this.updateStyleEl_();return}var A=parseFloat(l);if(isNaN(A)){ve.error('Improper value "'+l+'" supplied for for '+n);return}this[g]=A,this.updateStyleEl_()},d.fluid=function(n){var l=this;if(n===void 0)return!!this.fluid_;this.fluid_=!!n,ji(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),n?(this.addClass("vjs-fluid"),this.fill(!1),An(this,function(){l.on(["playerreset","resize"],l.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()},d.fill=function(n){if(n===void 0)return!!this.fill_;this.fill_=!!n,n?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},d.aspectRatio=function(n){if(n===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(n))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=n,this.fluid(!0),this.updateStyleEl_()},d.updateStyleEl_=function(){if(Z.default.VIDEOJS_NO_DYNAMIC_STYLE===!0){var n=typeof this.width_=="number"?this.width_:this.options_.width,l=typeof this.height_=="number"?this.height_:this.options_.height,g=this.tech_&&this.tech_.el();g&&(n>=0&&(g.width=n),l>=0&&(g.height=l));return}var A,L,M,G;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?M=this.aspectRatio_:this.videoWidth()>0?M=this.videoWidth()+":"+this.videoHeight():M="16:9";var Q=M.split(":"),$=Q[1]/Q[0];this.width_!==void 0?A=this.width_:this.height_!==void 0?A=this.height_/$:A=this.videoWidth()||300,this.height_!==void 0?L=this.height_:L=A*$,/^[^a-zA-Z]/.test(this.id())?G="dimensions-"+this.id():G=this.id()+"-dimensions",this.addClass(G),jr(this.styleEl_,`
      .`+G+` {
        width: `+A+`px;
        height: `+L+`px;
      }

      .`+G+`.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: `+$*100+`%;
      }
    `)},d.loadTech_=function(n,l){var g=this;this.tech_&&this.unloadTech_();var A=wt(n),L=n.charAt(0).toLowerCase()+n.slice(1);A!=="Html5"&&this.tag&&(C.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=A,this.isReady_=!1;var M=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(M=!1);var G={source:l,autoplay:M,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+L+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};D.names.forEach(function($){var fe=D[$];G[fe.getterName]=g[fe.privateName]}),Ot(G,this.options_[A]),Ot(G,this.options_[L]),Ot(G,this.options_[n.toLowerCase()]),this.tag&&(G.tag=this.tag),l&&l.src===this.cache_.src&&this.cache_.currentTime>0&&(G.startTime=this.cache_.currentTime);var Q=C.getTech(n);if(!Q)throw new Error("No Tech named '"+A+"' exists! '"+A+"' should be registered using videojs.registerTech()'");this.tech_=new Q(G),this.tech_.ready(Lt(this,this.handleTechReady_),!0),Xr.jsonToTextTracks(this.textTracksJson_||[],this.tech_),ho.forEach(function($){g.on(g.tech_,$,function(fe){return g["handleTech"+wt($)+"_"](fe)})}),Object.keys(Ba).forEach(function($){g.on(g.tech_,$,function(fe){if(g.tech_.playbackRate()===0&&g.tech_.seeking()){g.queuedCallbacks_.push({callback:g["handleTech"+Ba[$]+"_"].bind(g),event:fe});return}g["handleTech"+Ba[$]+"_"](fe)})}),this.on(this.tech_,"loadstart",function($){return g.handleTechLoadStart_($)}),this.on(this.tech_,"sourceset",function($){return g.handleTechSourceset_($)}),this.on(this.tech_,"waiting",function($){return g.handleTechWaiting_($)}),this.on(this.tech_,"ended",function($){return g.handleTechEnded_($)}),this.on(this.tech_,"seeking",function($){return g.handleTechSeeking_($)}),this.on(this.tech_,"play",function($){return g.handleTechPlay_($)}),this.on(this.tech_,"firstplay",function($){return g.handleTechFirstPlay_($)}),this.on(this.tech_,"pause",function($){return g.handleTechPause_($)}),this.on(this.tech_,"durationchange",function($){return g.handleTechDurationChange_($)}),this.on(this.tech_,"fullscreenchange",function($,fe){return g.handleTechFullscreenChange_($,fe)}),this.on(this.tech_,"fullscreenerror",function($,fe){return g.handleTechFullscreenError_($,fe)}),this.on(this.tech_,"enterpictureinpicture",function($){return g.handleTechEnterPictureInPicture_($)}),this.on(this.tech_,"leavepictureinpicture",function($){return g.handleTechLeavePictureInPicture_($)}),this.on(this.tech_,"error",function($){return g.handleTechError_($)}),this.on(this.tech_,"posterchange",function($){return g.handleTechPosterChange_($)}),this.on(this.tech_,"textdata",function($){return g.handleTechTextData_($)}),this.on(this.tech_,"ratechange",function($){return g.handleTechRateChange_($)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(A!=="Html5"||!this.tag)&&ht(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},d.unloadTech_=function(){var n=this;D.names.forEach(function(l){var g=D[l];n[g.privateName]=n[g.getterName]()}),this.textTracksJson_=Xr.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},d.tech=function(n){return n===void 0&&ve.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_},d.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},d.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},d.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},d.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())},d.manualAutoplay_=function(n){var l=this;if(!(!this.tech_||typeof n!="string")){var g=function(){var M=l.muted();l.muted(!0);var G=function(){l.muted(M)};l.playTerminatedQueue_.push(G);var Q=l.play();if(Cr(Q))return Q.catch(function($){throw G(),new Error("Rejection at manualAutoplay. Restoring muted value. "+($||""))})},A;if(n==="any"&&!this.muted()?(A=this.play(),Cr(A)&&(A=A.catch(g))):n==="muted"&&!this.muted()?A=g():A=this.play(),!!Cr(A))return A.then(function(){l.trigger({type:"autoplay-success",autoplay:n})}).catch(function(){l.trigger({type:"autoplay-failure",autoplay:n})})}},d.updateSourceCaches_=function(n){n===void 0&&(n="");var l=n,g="";typeof l!="string"&&(l=n.src,g=n.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],l&&!g&&(g=nt(this,l)),this.cache_.source=Dt({},n,{src:l,type:g});for(var A=this.cache_.sources.filter(function(fe){return fe.src&&fe.src===l}),L=[],M=this.$$("source"),G=[],Q=0;Q<M.length;Q++){var $=Bi(M[Q]);L.push($),$.src&&$.src===l&&G.push($.src)}G.length&&!A.length?this.cache_.sources=L:A.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=l},d.handleTechSourceset_=function(n){var l=this;if(!this.changingSrc_){var g=function(G){return l.updateSourceCaches_(G)},A=this.currentSource().src,L=n.src;A&&!/^blob:/.test(A)&&/^blob:/.test(L)&&(!this.lastSource_||this.lastSource_.tech!==L&&this.lastSource_.player!==A)&&(g=function(){}),g(L),n.src||this.tech_.any(["sourceset","loadstart"],function(M){if(M.type!=="sourceset"){var G=l.techGet("currentSrc");l.lastSource_.tech=G,l.updateSourceCaches_(G)}})}this.lastSource_={player:this.currentSource().src,tech:n.src},this.trigger({src:n.src,type:"sourceset"})},d.hasStarted=function(n){if(n===void 0)return this.hasStarted_;n!==this.hasStarted_&&(this.hasStarted_=n,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},d.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},d.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(function(n){return n.callback(n.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},d.handleTechWaiting_=function(){var n=this;this.addClass("vjs-waiting"),this.trigger("waiting");var l=this.currentTime(),g=function A(){l!==n.currentTime()&&(n.removeClass("vjs-waiting"),n.off("timeupdate",A))};this.on("timeupdate",g)},d.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},d.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},d.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},d.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},d.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},d.handleTechFirstPlay_=function(){this.options_.starttime&&(ve.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},d.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},d.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},d.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},d.handleTechClick_=function(n){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,n):this.paused()?Ci(this.play()):this.pause())},d.handleTechDoubleClick_=function(n){if(this.controls_){var l=Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(g){return g.contains(n.target)});l||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,n):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}},d.handleTechTap_=function(){this.userActive(!this.userActive())},d.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},d.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},d.handleTechTouchEnd_=function(n){n.cancelable&&n.preventDefault()},d.handleStageClick_=function(){this.reportUserActivity()},d.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},d.documentFullscreenChange_=function(n){var l=n.target.player;if(!(l&&l!==this)){var g=this.el(),A=oe.default[this.fsApi_.fullscreenElement]===g;!A&&g.matches?A=g.matches(":"+this.fsApi_.fullscreen):!A&&g.msMatchesSelector&&(A=g.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(A)}},d.handleTechFullscreenChange_=function(n,l){var g=this;l&&(l.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",function(){g.removeClass("vjs-ios-native-fs")})),this.isFullscreen(l.isFullscreen))},d.handleTechFullscreenError_=function(n,l){this.trigger("fullscreenerror",l)},d.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},d.handleTechEnterPictureInPicture_=function(n){this.isInPictureInPicture(!0)},d.handleTechLeavePictureInPicture_=function(n){this.isInPictureInPicture(!1)},d.handleTechError_=function(){var n=this.tech_.error();this.error(n)},d.handleTechTextData_=function(){var n=null;arguments.length>1&&(n=arguments[1]),this.trigger("textdata",n)},d.getCache=function(){return this.cache_},d.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},d.techCall_=function(n,l){this.ready(function(){if(n in it)return ie(this.middleware_,this.tech_,n,l);if(n in qt)return Se(this.middleware_,this.tech_,n,l);try{this.tech_&&this.tech_[n](l)}catch(g){throw ve(g),g}},!0)},d.techGet_=function(n){if(!(!this.tech_||!this.tech_.isReady_)){if(n in xe)return K(this.middleware_,this.tech_,n);if(n in qt)return Se(this.middleware_,this.tech_,n);try{return this.tech_[n]()}catch(l){throw this.tech_[n]===void 0?(ve("Video.js: "+n+" method not defined for "+this.techName_+" playback technology.",l),l):l.name==="TypeError"?(ve("Video.js: "+n+" unavailable on "+this.techName_+" playback technology element.",l),this.tech_.isReady_=!1,l):(ve(l),l)}}},d.play=function(){var n=this,l=this.options_.Promise||Z.default.Promise;return l?new l(function(g){n.play_(g)}):this.play_()},d.play_=function(n){var l=this;n===void 0&&(n=Ci),this.playCallbacks_.push(n);var g=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),A=Boolean(vi||mi);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!g){this.waitToPlay_=function(G){l.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!g&&A&&this.load();return}var L=this.techGet_("play"),M=A&&this.hasClass("vjs-ended");M&&this.resetProgressBar_(),L===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(L)},d.runPlayTerminatedQueue_=function(){var n=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],n.forEach(function(l){l()})},d.runPlayCallbacks_=function(n){var l=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],l.forEach(function(g){g(n)})},d.pause=function(){this.techCall_("pause")},d.paused=function(){return this.techGet_("paused")!==!1},d.played=function(){return this.techGet_("played")||Ti(0,0)},d.scrubbing=function(n){if(typeof n=="undefined")return this.scrubbing_;this.scrubbing_=!!n,this.techCall_("setScrubbing",this.scrubbing_),n?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},d.currentTime=function(n){if(typeof n!="undefined"){if(n<0&&(n=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=n,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",n),this.cache_.initTime=0;return}return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime},d.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},d.duration=function(n){if(n===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;n=parseFloat(n),n<0&&(n=1/0),n!==this.cache_.duration&&(this.cache_.duration=n,n===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(n)||this.trigger("durationchange"))},d.remainingTime=function(){return this.duration()-this.currentTime()},d.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},d.buffered=function(){var n=this.techGet_("buffered");return(!n||!n.length)&&(n=Ti(0,0)),n},d.bufferedPercent=function(){return js(this.buffered(),this.duration())},d.bufferedEnd=function(){var n=this.buffered(),l=this.duration(),g=n.end(n.length-1);return g>l&&(g=l),g},d.volume=function(n){var l;if(n!==void 0){l=Math.max(0,Math.min(1,parseFloat(n))),this.cache_.volume=l,this.techCall_("setVolume",l),l>0&&this.lastVolume_(l);return}return l=parseFloat(this.techGet_("volume")),isNaN(l)?1:l},d.muted=function(n){if(n!==void 0){this.techCall_("setMuted",n);return}return this.techGet_("muted")||!1},d.defaultMuted=function(n){return n!==void 0?this.techCall_("setDefaultMuted",n):this.techGet_("defaultMuted")||!1},d.lastVolume_=function(n){if(n!==void 0&&n!==0){this.cache_.lastVolume=n;return}return this.cache_.lastVolume},d.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},d.isFullscreen=function(n){if(n!==void 0){var l=this.isFullscreen_;this.isFullscreen_=Boolean(n),this.isFullscreen_!==l&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_},d.requestFullscreen=function(n){var l=this.options_.Promise||Z.default.Promise;if(l){var g=this;return new l(function(A,L){function M(){g.off("fullscreenerror",Q),g.off("fullscreenchange",G)}function G(){M(),A()}function Q(fe,$e){M(),L($e)}g.one("fullscreenchange",G),g.one("fullscreenerror",Q);var $=g.requestFullscreenHelper_(n);$&&($.then(M,M),$.then(A,L))})}return this.requestFullscreenHelper_()},d.requestFullscreenHelper_=function(n){var l=this,g;if(this.fsApi_.prefixed||(g=this.options_.fullscreen&&this.options_.fullscreen.options||{},n!==void 0&&(g=n)),this.fsApi_.requestFullscreen){var A=this.el_[this.fsApi_.requestFullscreen](g);return A&&A.then(function(){return l.isFullscreen(!0)},function(){return l.isFullscreen(!1)}),A}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},d.exitFullscreen=function(){var n=this.options_.Promise||Z.default.Promise;if(n){var l=this;return new n(function(g,A){function L(){l.off("fullscreenerror",G),l.off("fullscreenchange",M)}function M(){L(),g()}function G($,fe){L(),A(fe)}l.one("fullscreenchange",M),l.one("fullscreenerror",G);var Q=l.exitFullscreenHelper_();Q&&(Q.then(L,L),Q.then(g,A))})}return this.exitFullscreenHelper_()},d.exitFullscreenHelper_=function(){var n=this;if(this.fsApi_.requestFullscreen){var l=oe.default[this.fsApi_.exitFullscreen]();return l&&Ci(l.then(function(){return n.isFullscreen(!1)})),l}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},d.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=oe.default.documentElement.style.overflow,_i(oe.default,"keydown",this.boundFullWindowOnEscKey_),oe.default.documentElement.style.overflow="hidden",xi(oe.default.body,"vjs-full-window"),this.trigger("enterFullWindow")},d.fullWindowOnEscKey=function(n){ze.default.isEventKey(n,"Esc")&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},d.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,hi(oe.default,"keydown",this.boundFullWindowOnEscKey_),oe.default.documentElement.style.overflow=this.docOrigOverflow,br(oe.default.body,"vjs-full-window"),this.trigger("exitFullWindow")},d.disablePictureInPicture=function(n){if(n===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",n),this.options_.disablePictureInPicture=n,this.trigger("disablepictureinpicturechanged")},d.isInPictureInPicture=function(n){if(n!==void 0){this.isInPictureInPicture_=!!n,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_},d.requestPictureInPicture=function(){if("pictureInPictureEnabled"in oe.default&&this.disablePictureInPicture()===!1)return this.techGet_("requestPictureInPicture")},d.exitPictureInPicture=function(){if("pictureInPictureEnabled"in oe.default)return oe.default.exitPictureInPicture()},d.handleKeyDown=function(n){var l=this.options_.userActions;if(!(!l||!l.hotkeys)){var g=function(L){var M=L.tagName.toLowerCase();if(L.isContentEditable)return!0;var G=["button","checkbox","hidden","radio","reset","submit"];if(M==="input")return G.indexOf(L.type)===-1;var Q=["textarea"];return Q.indexOf(M)!==-1};g(this.el_.ownerDocument.activeElement)||(typeof l.hotkeys=="function"?l.hotkeys.call(this,n):this.handleHotkeys(n))}},d.handleHotkeys=function(n){var l=this.options_.userActions?this.options_.userActions.hotkeys:{},g=l.fullscreenKey,A=g===void 0?function(bt){return ze.default.isEventKey(bt,"f")}:g,L=l.muteKey,M=L===void 0?function(bt){return ze.default.isEventKey(bt,"m")}:L,G=l.playPauseKey,Q=G===void 0?function(bt){return ze.default.isEventKey(bt,"k")||ze.default.isEventKey(bt,"Space")}:G;if(A.call(this,n)){n.preventDefault(),n.stopPropagation();var $=ce.getComponent("FullscreenToggle");oe.default[this.fsApi_.fullscreenEnabled]!==!1&&$.prototype.handleClick.call(this,n)}else if(M.call(this,n)){n.preventDefault(),n.stopPropagation();var fe=ce.getComponent("MuteToggle");fe.prototype.handleClick.call(this,n)}else if(Q.call(this,n)){n.preventDefault(),n.stopPropagation();var $e=ce.getComponent("PlayToggle");$e.prototype.handleClick.call(this,n)}},d.canPlayType=function(n){for(var l,g=0,A=this.options_.techOrder;g<A.length;g++){var L=A[g],M=C.getTech(L);if(M||(M=ce.getComponent(L)),!M){ve.error('The "'+L+'" tech is undefined. Skipped browser support check for that tech.');continue}if(M.isSupported()&&(l=M.canPlayType(n),l))return l}return""},d.selectSource=function(n){var l=this,g=this.options_.techOrder.map(function(Q){return[Q,C.getTech(Q)]}).filter(function(Q){var $=Q[0],fe=Q[1];return fe?fe.isSupported():(ve.error('The "'+$+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),A=function($,fe,$e){var bt;return $.some(function(os){return fe.some(function(ar){if(bt=$e(os,ar),bt)return!0})}),bt},L,M=function($){return function(fe,$e){return $($e,fe)}},G=function($,fe){var $e=$[0],bt=$[1];if(bt.canPlaySource(fe,l.options_[$e.toLowerCase()]))return{source:fe,tech:$e}};return this.options_.sourceOrder?L=A(n,g,M(G)):L=A(g,n,G),L||!1},d.handleSrc_=function(n,l){var g=this;if(typeof n=="undefined")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var A=dt(n);if(!A.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,l||(this.cache_.sources=A),this.updateSourceCaches_(A[0]),te(this,A[0],function(G,Q){g.middleware_=Q,l||(g.cache_.sources=A),g.updateSourceCaches_(G);var $=g.src_(G);if($){if(A.length>1)return g.handleSrc_(A.slice(1));g.changingSrc_=!1,g.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),g.triggerReady();return}de(Q,g.tech_)}),this.options_.retryOnError&&A.length>1){var L=function(){g.error(null),g.handleSrc_(A.slice(1),!0)},M=function(){g.off("error",L)};this.one("error",L),this.one("playing",M),this.resetRetryOnError_=function(){g.off("error",L),g.off("playing",M)}}},d.src=function(n){return this.handleSrc_(n,!1)},d.src_=function(n){var l=this,g=this.selectSource([n]);return g?wi(g.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",n):this.techCall_("src",n.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(g.tech,g.source),this.tech_.ready(function(){l.changingSrc_=!1}),!1):!0},d.load=function(){this.techCall_("load")},d.reset=function(){var n=this,l=this.options_.Promise||Z.default.Promise;if(this.paused()||!l)this.doReset_();else{var g=this.play();Ci(g.then(function(){return n.doReset_()}))}},d.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),ji(this)&&this.trigger("playerreset")},d.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},d.resetProgressBar_=function(){this.currentTime(0);var n=this.controlBar||{},l=n.durationDisplay,g=n.remainingTimeDisplay;l&&l.updateContent(),g&&g.updateContent()},d.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},d.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},d.currentSources=function(){var n=this.currentSource(),l=[];return Object.keys(n).length!==0&&l.push(n),this.cache_.sources||l},d.currentSource=function(){return this.cache_.source||{}},d.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},d.currentType=function(){return this.currentSource()&&this.currentSource().type||""},d.preload=function(n){if(n!==void 0){this.techCall_("setPreload",n),this.options_.preload=n;return}return this.techGet_("preload")},d.autoplay=function(n){if(n===void 0)return this.options_.autoplay||!1;var l;typeof n=="string"&&/(any|play|muted)/.test(n)||n===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=n,this.manualAutoplay_(typeof n=="string"?n:"play"),l=!1):n?this.options_.autoplay=!0:this.options_.autoplay=!1,l=typeof l=="undefined"?this.options_.autoplay:l,this.tech_&&this.techCall_("setAutoplay",l)},d.playsinline=function(n){return n!==void 0?(this.techCall_("setPlaysinline",n),this.options_.playsinline=n,this):this.techGet_("playsinline")},d.loop=function(n){if(n!==void 0){this.techCall_("setLoop",n),this.options_.loop=n;return}return this.techGet_("loop")},d.poster=function(n){if(n===void 0)return this.poster_;n||(n=""),n!==this.poster_&&(this.poster_=n,this.techCall_("setPoster",n),this.isPosterFromTech_=!1,this.trigger("posterchange"))},d.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var n=this.tech_.poster()||"";n!==this.poster_&&(this.poster_=n,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},d.controls=function(n){if(n===void 0)return!!this.controls_;n=!!n,this.controls_!==n&&(this.controls_=n,this.usingNativeControls()&&this.techCall_("setControls",n),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},d.usingNativeControls=function(n){if(n===void 0)return!!this.usingNativeControls_;n=!!n,this.usingNativeControls_!==n&&(this.usingNativeControls_=n,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},d.error=function(n){var l=this;if(n===void 0)return this.error_||null;if(N("beforeerror").forEach(function(A){var L=A(l,n);if(!(zt(L)&&!Array.isArray(L)||typeof L=="string"||typeof L=="number"||L===null)){l.log.error("please return a value that MediaError expects in beforeerror hooks");return}n=L}),this.options_.suppressNotSupportedError&&n&&n.code===4){var g=function(){this.error(n)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],g),this.one("loadstart",function(){this.off(["click","touchstart"],g)});return}if(n===null){this.error_=n,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new di(n),this.addClass("vjs-error"),ve.error("(CODE:"+this.error_.code+" "+di.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),N("error").forEach(function(A){return A(l,l.error_)})},d.reportUserActivity=function(n){this.userActivity_=!0},d.userActive=function(n){if(n===void 0)return this.userActive_;if(n=!!n,n!==this.userActive_){if(this.userActive_=n,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(l){l.stopPropagation(),l.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},d.listenForUserActivity_=function(){var n,l,g,A=Lt(this,this.reportUserActivity),L=function($e){($e.screenX!==l||$e.screenY!==g)&&(l=$e.screenX,g=$e.screenY,A())},M=function(){A(),this.clearInterval(n),n=this.setInterval(A,250)},G=function($e){A(),this.clearInterval(n)};this.on("mousedown",M),this.on("mousemove",L),this.on("mouseup",G),this.on("mouseleave",G);var Q=this.getChild("controlBar");Q&&!mi&&!rt&&(Q.on("mouseenter",function(fe){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),Q.on("mouseleave",function(fe){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",A),this.on("keyup",A);var $;this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout($);var fe=this.options_.inactivityTimeout;fe<=0||($=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},fe))}},250)},d.playbackRate=function(n){if(n!==void 0){this.techCall_("setPlaybackRate",n);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1},d.defaultPlaybackRate=function(n){return n!==void 0?this.techCall_("setDefaultPlaybackRate",n):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},d.isAudio=function(n){if(n!==void 0){this.isAudio_=!!n;return}return!!this.isAudio_},d.enableAudioOnlyUI_=function(){var n=this;this.addClass("vjs-audio-only-mode");var l=this.children(),g=this.getChild("ControlBar"),A=g&&g.currentHeight();l.forEach(function(L){L!==g&&L.el_&&!L.hasClass("vjs-hidden")&&(L.hide(),n.audioOnlyCache_.hiddenChildren.push(L))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(A),this.trigger("audioonlymodechange")},d.disableAudioOnlyUI_=function(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(function(n){return n.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")},d.audioOnlyMode=function(n){var l=this;if(typeof n!="boolean"||n===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=n;var g=this.options_.Promise||Z.default.Promise;if(g){if(n){var A=[];return this.isInPictureInPicture()&&A.push(this.exitPictureInPicture()),this.isFullscreen()&&A.push(this.exitFullscreen()),this.audioPosterMode()&&A.push(this.audioPosterMode(!1)),g.all(A).then(function(){return l.enableAudioOnlyUI_()})}return g.resolve().then(function(){return l.disableAudioOnlyUI_()})}n?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},d.enablePosterModeUI_=function(){var n=this.tech_&&this.tech_;n.hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},d.disablePosterModeUI_=function(){var n=this.tech_&&this.tech_;n.show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},d.audioPosterMode=function(n){var l=this;if(typeof n!="boolean"||n===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=n;var g=this.options_.Promise||Z.default.Promise;if(g){if(n){if(this.audioOnlyMode()){var A=this.audioOnlyMode(!1);return A.then(function(){l.enablePosterModeUI_()})}return g.resolve().then(function(){l.enablePosterModeUI_()})}return g.resolve().then(function(){l.disablePosterModeUI_()})}if(n){this.audioOnlyMode()&&this.audioOnlyMode(!1),this.enablePosterModeUI_();return}this.disablePosterModeUI_()},d.addTextTrack=function(n,l,g){if(this.tech_)return this.tech_.addTextTrack(n,l,g)},d.addRemoteTextTrack=function(n,l){if(this.tech_)return this.tech_.addRemoteTextTrack(n,l)},d.removeRemoteTextTrack=function(n){n===void 0&&(n={});var l=n,g=l.track;if(g||(g=n),this.tech_)return this.tech_.removeRemoteTextTrack(g)},d.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},d.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},d.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},d.language=function(n){if(n===void 0)return this.language_;this.language_!==String(n).toLowerCase()&&(this.language_=String(n).toLowerCase(),ji(this)&&this.trigger("languagechange"))},d.languages=function(){return Dt(m.prototype.options_.languages,this.languages_)},d.toJSON=function(){var n=Dt(this.options_),l=n.tracks;n.tracks=[];for(var g=0;g<l.length;g++){var A=l[g];A=Dt(A),A.player=void 0,n.tracks[g]=A}return n},d.createModal=function(n,l){var g=this;l=l||{},l.content=n||"";var A=new ft(this,l);return this.addChild(A),A.on("dispose",function(){g.removeChild(A)}),A.open(),A},d.updateCurrentBreakpoint_=function(){if(this.responsive())for(var n=this.currentBreakpoint(),l=this.currentWidth(),g=0;g<zn.length;g++){var A=zn[g],L=this.breakpoints_[A];if(l<=L){if(n===A)return;n&&this.removeClass(on[n]),this.addClass(on[A]),this.breakpoint_=A;break}}},d.removeCurrentBreakpoint_=function(){var n=this.currentBreakpointClass();this.breakpoint_="",n&&this.removeClass(n)},d.breakpoints=function(n){return n===void 0?Ot(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Ot({},Ua,n),this.updateCurrentBreakpoint_(),Ot(this.breakpoints_))},d.responsive=function(n){if(n===void 0)return this.responsive_;n=Boolean(n);var l=this.responsive_;if(n!==l)return this.responsive_=n,n?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),n},d.currentBreakpoint=function(){return this.breakpoint_},d.currentBreakpointClass=function(){return on[this.breakpoint_]||""},d.loadMedia=function(n,l){var g=this;if(!(!n||typeof n!="object")){this.reset(),this.cache_.media=Dt(n);var A=this.cache_.media,L=A.artwork,M=A.poster,G=A.src,Q=A.textTracks;!L&&M&&(this.cache_.media.artwork=[{src:M,type:Ne(M)}]),G&&this.src(G),M&&this.poster(M),Array.isArray(Q)&&Q.forEach(function($){return g.addRemoteTextTrack($,!1)}),this.ready(l)}},d.getMedia=function(){if(!this.cache_.media){var n=this.poster(),l=this.currentSources(),g=Array.prototype.map.call(this.remoteTextTracks(),function(L){return{kind:L.kind,label:L.label,language:L.language,src:L.src}}),A={src:l,textTracks:g};return n&&(A.poster=n,A.artwork=[{src:A.poster,type:Ne(A.poster)}]),A}return Dt(this.cache_.media)},m.getTagSettings=function(n){var l={sources:[],tracks:[]},g=Bi(n),A=g["data-setup"];if(Vi(n,"vjs-fill")&&(g.fill=!0),Vi(n,"vjs-fluid")&&(g.fluid=!0),A!==null){var L=Ye.default(A||"{}"),M=L[0],G=L[1];M&&ve.error(M),Ot(g,G)}if(Ot(l,g),n.hasChildNodes())for(var Q=n.childNodes,$=0,fe=Q.length;$<fe;$++){var $e=Q[$],bt=$e.nodeName.toLowerCase();bt==="source"?l.sources.push(Bi($e)):bt==="track"&&l.tracks.push(Bi($e))}return l},d.flexNotSupported_=function(){var n=oe.default.createElement("i");return!("flexBasis"in n.style||"webkitFlexBasis"in n.style||"mozFlexBasis"in n.style||"msFlexBasis"in n.style||"msFlexOrder"in n.style)},d.debug=function(n){if(n===void 0)return this.debugEnabled_;n?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},d.playbackRates=function(n){if(n===void 0)return this.cache_.playbackRates;Array.isArray(n)&&n.every(function(l){return typeof l=="number"})&&(this.cache_.playbackRates=n,this.trigger("playbackrateschange"))},m}(ce);D.names.forEach(function(p){var m=D[p];ni.prototype[m.getterName]=function(){return this.tech_?this.tech_[m.getterName]():(this[m.privateName]=this[m.privateName]||new m.ListClass,this[m.privateName])}}),ni.prototype.crossorigin=ni.prototype.crossOrigin,ni.players={};var ln=Z.default.navigator;ni.prototype.options_={techOrder:C.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:ln&&(ln.languages&&ln.languages[0]||ln.userLanguage||ln.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(p){ni.prototype[p]=function(){return this.techGet_(p)}}),ho.forEach(function(p){ni.prototype["handleTech"+wt(p)+"_"]=function(){return this.trigger(p)}}),ce.registerComponent("Player",ni);var un="plugin",Ps="activePlugins_",as={},Xn=function(m){return as.hasOwnProperty(m)},cn=function(m){return Xn(m)?as[m]:void 0},fo=function(m,d){m[Ps]=m[Ps]||{},m[Ps][d]=!0},Qn=function(m,d,u){var n=(u?"before":"")+"pluginsetup";m.trigger(n,d),m.trigger(n+":"+d.name,d)},Fo=function(m,d){var u=function(){Qn(this,{name:m,plugin:d,instance:null},!0);var l=d.apply(this,arguments);return fo(this,m),Qn(this,{name:m,plugin:d,instance:l}),l};return Object.keys(d).forEach(function(n){u[n]=d[n]}),u},$a=function(m,d){return d.prototype.name=m,function(){Qn(this,{name:m,plugin:d,instance:null},!0);for(var u=arguments.length,n=new Array(u),l=0;l<u;l++)n[l]=arguments[l];var g=Ze.default(d,[this].concat(n));return this[m]=function(){return g},Qn(this,g.getEventHash()),g}},sr=function(){function p(d){if(this.constructor===p)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=d,this.log||(this.log=this.player.log.createLogger(this.name)),Ri(this),delete this.trigger,Ar(this,this.constructor.defaultState),fo(d,this.name),this.dispose=this.dispose.bind(this),d.on("dispose",this.dispose)}var m=p.prototype;return m.version=function(){return this.constructor.VERSION},m.getEventHash=function(u){return u===void 0&&(u={}),u.name=this.name,u.plugin=this.constructor,u.instance=this,u},m.trigger=function(u,n){return n===void 0&&(n={}),Ii(this.eventBusEl_,u,this.getEventHash(n))},m.handleStateChanged=function(u){},m.dispose=function(){var u=this.name,n=this.player;this.trigger("dispose"),this.off(),n.off("dispose",this.dispose),n[Ps][u]=!1,this.player=this.state=null,n[u]=$a(u,as[u])},p.isBasic=function(u){var n=typeof u=="string"?cn(u):u;return typeof n=="function"&&!p.prototype.isPrototypeOf(n.prototype)},p.registerPlugin=function(u,n){if(typeof u!="string")throw new Error('Illegal plugin name, "'+u+'", must be a string, was '+typeof u+".");if(Xn(u))ve.warn('A plugin named "'+u+'" already exists. You may want to avoid re-registering plugins!');else if(ni.prototype.hasOwnProperty(u))throw new Error('Illegal plugin name, "'+u+'", cannot share a name with an existing player method!');if(typeof n!="function")throw new Error('Illegal plugin for "'+u+'", must be a function, was '+typeof n+".");return as[u]=n,u!==un&&(p.isBasic(n)?ni.prototype[u]=Fo(u,n):ni.prototype[u]=$a(u,n)),n},p.deregisterPlugin=function(u){if(u===un)throw new Error("Cannot de-register base plugin.");Xn(u)&&(delete as[u],delete ni.prototype[u])},p.getPlugins=function(u){u===void 0&&(u=Object.keys(as));var n;return u.forEach(function(l){var g=cn(l);g&&(n=n||{},n[l]=g)}),n},p.getPluginVersion=function(u){var n=cn(u);return n&&n.VERSION||""},p}();sr.getPlugin=cn,sr.BASE_PLUGIN_NAME=un,sr.registerPlugin(un,sr),ni.prototype.usingPlugin=function(p){return!!this[Ps]&&this[Ps][p]===!0},ni.prototype.hasPlugin=function(p){return!!Xn(p)};var Ha=!1,hn=function(m,d){d===void 0&&(d={}),Ha||(ve.warn("videojs.extend is deprecated as of Video.js 7.22.0 and will be removed in Video.js 8.0.0"),Ha=!0);var u=function(){m.apply(this,arguments)},n={};typeof d=="object"?(d.constructor!==Object.prototype.constructor&&(u=d.constructor),n=d):typeof d=="function"&&(u=d),Yt.default(u,m),m&&(u.super_=m);for(var l in n)n.hasOwnProperty(l)&&(u.prototype[l]=n[l]);return u},Ga=function(m){return m.indexOf("#")===0?m.slice(1):m};function je(p,m,d){var u=je.getPlayer(p);if(u)return m&&ve.warn('Player "'+p+'" is already initialised. Options will not be applied.'),d&&u.ready(d),u;var n=typeof p=="string"?tr("#"+Ga(p)):p;if(!zi(n))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!n.ownerDocument.defaultView||!n.ownerDocument.body.contains(n))&&ve.warn("The element supplied is not included in the DOM"),m=m||{},m.restoreEl===!0&&(m.restoreEl=(n.parentNode&&n.parentNode.hasAttribute("data-vjs-player")?n.parentNode:n).cloneNode(!0)),N("beforesetup").forEach(function(g){var A=g(n,Dt(m));if(!zt(A)||Array.isArray(A)){ve.error("please return an object in beforesetup hooks");return}m=Dt(m,A)});var l=ce.getComponent("Player");return u=new l(n,m,d),N("setup").forEach(function(g){return g(u)}),u}if(je.hooks_=ti,je.hooks=N,je.hook=W,je.hookOnce=le,je.removeHook=be,Z.default.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&Bt()){var ai=tr(".vjs-styles-defaults");if(!ai){ai=dr("vjs-styles-defaults");var nr=tr("head");nr&&nr.insertBefore(ai,nr.firstChild),jr(ai,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}hr(1,je),je.VERSION=Hi,je.options=ni.prototype.options_,je.getPlayers=function(){return ni.players},je.getPlayer=function(p){var m=ni.players,d;if(typeof p=="string"){var u=Ga(p),n=m[u];if(n)return n;d=tr("#"+u)}else d=p;if(zi(d)){var l=d,g=l.player,A=l.playerId;if(g||m[A])return g||m[A]}},je.getAllPlayers=function(){return Object.keys(ni.players).map(function(p){return ni.players[p]}).filter(Boolean)},je.players=ni.players,je.getComponent=ce.getComponent,je.registerComponent=function(p,m){C.isTech(m)&&ve.warn("The "+p+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),ce.registerComponent.call(ce,p,m)},je.getTech=C.getTech,je.registerTech=C.registerTech,je.use=se,Object.defineProperty(je,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(je.middleware,"TERMINATOR",{value:X,writeable:!1,enumerable:!0}),je.browser=Fr,je.TOUCH_ENABLED=er,je.extend=hn,je.mergeOptions=Dt,je.bind=Lt,je.registerPlugin=sr.registerPlugin,je.deregisterPlugin=sr.deregisterPlugin,je.plugin=function(p,m){return ve.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),sr.registerPlugin(p,m)},je.getPlugins=sr.getPlugins,je.getPlugin=sr.getPlugin,je.getPluginVersion=sr.getPluginVersion,je.addLanguage=function(p,m){var d;return p=(""+p).toLowerCase(),je.options.languages=Dt(je.options.languages,(d={},d[p]=m,d)),je.options.languages[p]},je.log=ve,je.createLogger=xt,je.createTimeRange=je.createTimeRanges=Ti,je.formatTime=Is,je.setFormatTime=Xa,je.resetFormatTime=Qa,je.parseUrl=zs,je.isCrossOrigin=es,je.EventTarget=ei,je.on=_i,je.one=_s,je.off=hi,je.trigger=Ii,je.xhr=It.default,je.TextTrack=Ut,je.AudioTrack=As,je.VideoTrack=ts,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(p){je[p]=function(){return ve.warn("videojs."+p+"() is deprecated; use videojs.dom."+p+"() instead"),ir[p].apply(null,arguments)}}),je.computedStyle=ii,je.dom=ir,je.url=vr,je.defineLazyProperty=Ds,je.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"}),Te.exports=je},162:(Te,Qe,Le)=>{var Me=Le(882),ke=Le(40);function _e(qe,_t,Ue){if(Me())return Reflect.construct.apply(null,arguments);var ut=[null];ut.push.apply(ut,_t);var We=new(qe.bind.apply(qe,ut));return Ue&&ke(We,Ue.prototype),We}Te.exports=_e,Te.exports.__esModule=!0,Te.exports.default=Te.exports},187:(Te,Qe,Le)=>{var Me=Le(40);function ke(_e,qe){if(typeof qe!="function"&&qe!==null)throw new TypeError("Super expression must either be null or a function");_e.prototype=Object.create(qe&&qe.prototype,{constructor:{value:_e,writable:!0,configurable:!0}}),Object.defineProperty(_e,"prototype",{writable:!1}),qe&&Me(_e,qe)}Te.exports=ke,Te.exports.__esModule=!0,Te.exports.default=Te.exports},220:(Te,Qe,Le)=>{Te.exports=Le(14).default},448:Te=>{var Qe="auto",Le={"":1,lr:1,rl:1},Me={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function ke(_t){if(typeof _t!="string")return!1;var Ue=Le[_t.toLowerCase()];return Ue?_t.toLowerCase():!1}function _e(_t){if(typeof _t!="string")return!1;var Ue=Me[_t.toLowerCase()];return Ue?_t.toLowerCase():!1}function qe(_t,Ue,ut){this.hasBeenReset=!1;var We="",Et=!1,gt=_t,gi=Ue,Pe=ut,Z=null,oe="",Wt=!0,ze="auto",Ge="start",ge="auto",Ye="auto",It=100,li="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return We},set:function(Ze){We=""+Ze}},pauseOnExit:{enumerable:!0,get:function(){return Et},set:function(Ze){Et=!!Ze}},startTime:{enumerable:!0,get:function(){return gt},set:function(Ze){if(typeof Ze!="number")throw new TypeError("Start time must be set to a number.");gt=Ze,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return gi},set:function(Ze){if(typeof Ze!="number")throw new TypeError("End time must be set to a number.");gi=Ze,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return Pe},set:function(Ze){Pe=""+Ze,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return Z},set:function(Ze){Z=Ze,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return oe},set:function(Ze){var Yt=ke(Ze);if(Yt===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");oe=Yt,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return Wt},set:function(Ze){Wt=!!Ze,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return ze},set:function(Ze){if(typeof Ze!="number"&&Ze!==Qe)throw new SyntaxError("Line: an invalid number or illegal string was specified.");ze=Ze,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return Ge},set:function(Ze){var Yt=_e(Ze);Yt?(Ge=Yt,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return ge},set:function(Ze){if(Ze<0||Ze>100)throw new Error("Position must be between 0 and 100.");ge=Ze,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return Ye},set:function(Ze){var Yt=_e(Ze);Yt?(Ye=Yt,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return It},set:function(Ze){if(Ze<0||Ze>100)throw new Error("Size must be between 0 and 100.");It=Ze,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return li},set:function(Ze){var Yt=_e(Ze);if(!Yt)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");li=Yt,this.hasBeenReset=!0}}}),this.displayState=void 0}qe.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},Te.exports=qe},449:(Te,Qe,Le)=>{var Me=Le(40);function ke(_e,qe){_e.prototype=Object.create(qe.prototype),_e.prototype.constructor=_e,Me(_e,qe)}Te.exports=ke,Te.exports.__esModule=!0,Te.exports.default=Te.exports},500:(Te,Qe,Le)=>{"use strict";var Me=Le(576),ke=Le(22),_e=Le(840);We.httpHandler=Le(543);/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Björklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */var qe=function(Z){var oe={};return Z&&Z.trim().split(`
`).forEach(function(Wt){var ze=Wt.indexOf(":"),Ge=Wt.slice(0,ze).trim().toLowerCase(),ge=Wt.slice(ze+1).trim();typeof oe[Ge]=="undefined"?oe[Ge]=ge:Array.isArray(oe[Ge])?oe[Ge].push(ge):oe[Ge]=[oe[Ge],ge]}),oe};Te.exports=We,Te.exports.default=We,We.XMLHttpRequest=Me.XMLHttpRequest||gi,We.XDomainRequest="withCredentials"in new We.XMLHttpRequest?We.XMLHttpRequest:Me.XDomainRequest,_t(["get","put","post","patch","head","delete"],function(Pe){We[Pe==="delete"?"del":Pe]=function(Z,oe,Wt){return oe=ut(Z,oe,Wt),oe.method=Pe.toUpperCase(),Et(oe)}});function _t(Pe,Z){for(var oe=0;oe<Pe.length;oe++)Z(Pe[oe])}function Ue(Pe){for(var Z in Pe)if(Pe.hasOwnProperty(Z))return!1;return!0}function ut(Pe,Z,oe){var Wt=Pe;return _e(Z)?(oe=Z,typeof Pe=="string"&&(Wt={uri:Pe})):Wt=ke({},Z,{uri:Pe}),Wt.callback=oe,Wt}function We(Pe,Z,oe){return Z=ut(Pe,Z,oe),Et(Z)}function Et(Pe){if(typeof Pe.callback=="undefined")throw new Error("callback argument missing");var Z=!1,oe=function(x,ye,ue){Z||(Z=!0,Pe.callback(x,ye,ue))};function Wt(){Ye.readyState===4&&setTimeout(ge,0)}function ze(){var H=void 0;if(Ye.response?H=Ye.response:H=Ye.responseText||gt(Ye),W)try{H=JSON.parse(H)}catch(x){}return H}function Ge(H){return clearTimeout(be),H instanceof Error||(H=new Error(""+(H||"Unknown XMLHttpRequest Error"))),H.statusCode=0,oe(H,le)}function ge(){if(!li){var H;clearTimeout(be),Pe.useXDR&&Ye.status===void 0?H=200:H=Ye.status===1223?204:Ye.status;var x=le,ye=null;return H!==0?(x={body:ze(),statusCode:H,method:Yt,headers:{},url:Ze,rawRequest:Ye},Ye.getAllResponseHeaders&&(x.headers=qe(Ye.getAllResponseHeaders()))):ye=new Error("Internal XMLHttpRequest Error"),oe(ye,x,x.body)}}var Ye=Pe.xhr||null;Ye||(Pe.cors||Pe.useXDR?Ye=new We.XDomainRequest:Ye=new We.XMLHttpRequest);var It,li,Ze=Ye.url=Pe.uri||Pe.url,Yt=Ye.method=Pe.method||"GET",Hi=Pe.body||Pe.data,ti=Ye.headers=Pe.headers||{},N=!!Pe.sync,W=!1,be,le={body:void 0,headers:{},statusCode:0,method:Yt,url:Ze,rawRequest:Ye};if("json"in Pe&&Pe.json!==!1&&(W=!0,ti.accept||ti.Accept||(ti.Accept="application/json"),Yt!=="GET"&&Yt!=="HEAD"&&(ti["content-type"]||ti["Content-Type"]||(ti["Content-Type"]="application/json"),Hi=JSON.stringify(Pe.json===!0?Hi:Pe.json))),Ye.onreadystatechange=Wt,Ye.onload=ge,Ye.onerror=Ge,Ye.onprogress=function(){},Ye.onabort=function(){li=!0},Ye.ontimeout=Ge,Ye.open(Yt,Ze,!N,Pe.username,Pe.password),N||(Ye.withCredentials=!!Pe.withCredentials),!N&&Pe.timeout>0&&(be=setTimeout(function(){if(!li){li=!0,Ye.abort("timeout");var H=new Error("XMLHttpRequest timeout");H.code="ETIMEDOUT",Ge(H)}},Pe.timeout)),Ye.setRequestHeader)for(It in ti)ti.hasOwnProperty(It)&&Ye.setRequestHeader(It,ti[It]);else if(Pe.headers&&!Ue(Pe.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in Pe&&(Ye.responseType=Pe.responseType),"beforeSend"in Pe&&typeof Pe.beforeSend=="function"&&Pe.beforeSend(Ye),Ye.send(Hi||null),Ye}function gt(Pe){try{if(Pe.responseType==="document")return Pe.responseXML;var Z=Pe.responseXML&&Pe.responseXML.documentElement.nodeName==="parsererror";if(Pe.responseType===""&&!Z)return Pe.responseXML}catch(oe){}return null}function gi(){}},542:()=>{},543:(Te,Qe,Le)=>{"use strict";var Me=Le(576),ke=function(_t,Ue){return Ue===void 0&&(Ue=!1),function(ut,We,Et){if(ut){_t(ut);return}if(We.statusCode>=400&&We.statusCode<=599){var gt=Et;if(Ue)if(Me.TextDecoder){var gi=_e(We.headers&&We.headers["content-type"]);try{gt=new TextDecoder(gi).decode(Et)}catch(Pe){}}else gt=String.fromCharCode.apply(null,new Uint8Array(Et));_t({cause:gt});return}_t(null,Et)}};function _e(qe){return qe===void 0&&(qe=""),qe.toLowerCase().split(";").reduce(function(_t,Ue){var ut=Ue.split("="),We=ut[0],Et=ut[1];return We.trim()==="charset"?Et.trim():_t},"utf-8")}Te.exports=ke},545:(Te,Qe)=>{function Le(Ue){if(Ue&&typeof Ue=="object"){var ut=Ue.which||Ue.keyCode||Ue.charCode;ut&&(Ue=ut)}if(typeof Ue=="number")return qe[Ue];var We=String(Ue),Et=Me[We.toLowerCase()];if(Et)return Et;var Et=ke[We.toLowerCase()];if(Et)return Et;if(We.length===1)return We.charCodeAt(0)}Le.isEventKey=function(ut,We){if(ut&&typeof ut=="object"){var Et=ut.which||ut.keyCode||ut.charCode;if(Et==null)return!1;if(typeof We=="string"){var gt=Me[We.toLowerCase()];if(gt)return gt===Et;var gt=ke[We.toLowerCase()];if(gt)return gt===Et}else if(typeof We=="number")return We===Et;return!1}},Qe=Te.exports=Le;var Me=Qe.code=Qe.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},ke=Qe.aliases={windows:91,"\u21E7":16,"\u2325":18,"\u2303":17,"\u2318":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
 * Programatically add the following
 */for(_e=97;_e<123;_e++)Me[String.fromCharCode(_e)]=_e-32;for(var _e=48;_e<58;_e++)Me[_e-48]=_e;for(_e=1;_e<13;_e++)Me["f"+_e]=_e+111;for(_e=0;_e<10;_e++)Me["numpad "+_e]=_e+96;var qe=Qe.names=Qe.title={};for(_e in Me)qe[Me[_e]]=_e;for(var _t in ke)Me[_t]=ke[_t]},576:(Te,Qe,Le)=>{var Me;typeof window!="undefined"?Me=window:typeof Le.g!="undefined"?Me=Le.g:typeof self!="undefined"?Me=self:Me={},Te.exports=Me},667:Te=>{var Qe={"":!0,up:!0};function Le(_e){if(typeof _e!="string")return!1;var qe=Qe[_e.toLowerCase()];return qe?_e.toLowerCase():!1}function Me(_e){return typeof _e=="number"&&_e>=0&&_e<=100}function ke(){var _e=100,qe=3,_t=0,Ue=100,ut=0,We=100,Et="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return _e},set:function(gt){if(!Me(gt))throw new Error("Width must be between 0 and 100.");_e=gt}},lines:{enumerable:!0,get:function(){return qe},set:function(gt){if(typeof gt!="number")throw new TypeError("Lines must be set to a number.");qe=gt}},regionAnchorY:{enumerable:!0,get:function(){return Ue},set:function(gt){if(!Me(gt))throw new Error("RegionAnchorX must be between 0 and 100.");Ue=gt}},regionAnchorX:{enumerable:!0,get:function(){return _t},set:function(gt){if(!Me(gt))throw new Error("RegionAnchorY must be between 0 and 100.");_t=gt}},viewportAnchorY:{enumerable:!0,get:function(){return We},set:function(gt){if(!Me(gt))throw new Error("ViewportAnchorY must be between 0 and 100.");We=gt}},viewportAnchorX:{enumerable:!0,get:function(){return ut},set:function(gt){if(!Me(gt))throw new Error("ViewportAnchorX must be between 0 and 100.");ut=gt}},scroll:{enumerable:!0,get:function(){return Et},set:function(gt){var gi=Le(gt);gi===!1?console.warn("Scroll: an invalid or illegal string was specified."):Et=gi}}})}Te.exports=ke},673:Te=>{Te.exports=Qe;function Qe(Le,Me){var ke,_e=null;try{ke=JSON.parse(Le,Me)}catch(qe){_e=qe}return[_e,ke]}},711:Te=>{function Qe(Le){if(Le===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Le}Te.exports=Qe,Te.exports.__esModule=!0,Te.exports.default=Te.exports},840:Te=>{Te.exports=Le;var Qe=Object.prototype.toString;function Le(Me){if(!Me)return!1;var ke=Qe.call(Me);return ke==="[object Function]"||typeof Me=="function"&&ke!=="[object RegExp]"||typeof window!="undefined"&&(Me===window.setTimeout||Me===window.alert||Me===window.confirm||Me===window.prompt)}},882:Te=>{function Qe(){try{var Le=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Me){}return(Te.exports=Qe=function(){return!!Le},Te.exports.__esModule=!0,Te.exports.default=Te.exports)()}Te.exports=Qe,Te.exports.__esModule=!0,Te.exports.default=Te.exports},906:(Te,Qe,Le)=>{/*!
 * videojs-mux
 * @version 4.21.10
 * @copyright 2025 Mux, Inc.
 */(function(){(function(Me,ke){if(!0)Te.exports=ke(Le(50));else var _e,qe})(this,function(Me){return function(){var ke={48:function(Ue,ut,We){var Et;Et=typeof window!="undefined"?window:We.g!==void 0?We.g:typeof self!="undefined"?self:{},Ue.exports=Et},855:function(Ue){"use strict";Ue.exports=Me}},_e={};function qe(Ue){var ut=_e[Ue];if(ut!==void 0)return ut.exports;var We=_e[Ue]={exports:{}};return ke[Ue](We,We.exports,qe),We.exports}qe.n=function(Ue){var ut=Ue&&Ue.__esModule?function(){return Ue.default}:function(){return Ue};return qe.d(ut,{a:ut}),ut},qe.d=function(Ue,ut){for(var We in ut)qe.o(ut,We)&&!qe.o(Ue,We)&&Object.defineProperty(Ue,We,{enumerable:!0,get:ut[We]})},qe.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(Ue){if(typeof window=="object")return window}}(),qe.o=function(Ue,ut){return Object.prototype.hasOwnProperty.call(Ue,ut)},qe.r=function(Ue){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(Ue,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Ue,"__esModule",{value:!0})};var _t={};return function(){"use strict";qe.r(_t),qe.d(_t,{register:function(){return st}});var Ue=qe(48),ut=qe.n(Ue),We=qe(855),Et=qe.n(We),gt=Object.create,gi=Object.defineProperty,Pe=Object.getOwnPropertyDescriptor,Z=Object.getOwnPropertyNames,oe=Object.getPrototypeOf,Wt=Object.prototype.hasOwnProperty,ze=function(I,T){return function(){return I&&(T=I(I=0)),T}},Ge=function(I,T){return function(){return T||I((T={exports:{}}).exports,T),T.exports}},ge=function(I,T,E){return E=I!=null?gt(oe(I)):{},function(w,D,P,C){if(D&&typeof D=="object"||typeof D=="function")for(var U,j=Z(D),X=0,se=j.length;X<se;X++)U=j[X],!Wt.call(w,U)&&U!==P&&gi(w,U,{get:function(te){return D[te]}.bind(null,U),enumerable:!(C=Pe(D,U))||C.enumerable});return w}(!T&&I&&I.__esModule?E:gi(E,"default",{value:I,enumerable:!0}),I)},Ye=Ge(function(I,T){var E;E=typeof window!="undefined"?window:typeof Le.g!="undefined"?Le.g:typeof self!="undefined"?self:{},T.exports=E});function It(I,T){return T!=null&&typeof Symbol!="undefined"&&T[Symbol.hasInstance]?!!T[Symbol.hasInstance](I):It(I,T)}var li=ze(function(){li()});function Ze(I){return I&&typeof Symbol!="undefined"&&I.constructor===Symbol?"symbol":typeof I}var Yt=ze(function(){}),Hi=Ge(function(I,T){var E=Array.prototype.slice;T.exports=function(w,D){for(("length"in w)||(w=[w]),w=E.call(w);w.length;){var P=w.shift(),C=D(P);if(C)return C;P.childNodes&&P.childNodes.length&&(w=E.call(P.childNodes).concat(w))}}}),ti=Ge(function(I,T){function E(w,D){if(!It(this,E))return new E(w,D);this.data=w,this.nodeValue=w,this.length=w.length,this.ownerDocument=D||null}li(),T.exports=E,E.prototype.nodeType=8,E.prototype.nodeName="#comment",E.prototype.toString=function(){return"[object Comment]"}}),N=Ge(function(I,T){function E(w,D){if(!It(this,E))return new E(w);this.data=w||"",this.length=this.data.length,this.ownerDocument=D||null}li(),T.exports=E,E.prototype.type="DOMTextNode",E.prototype.nodeType=3,E.prototype.nodeName="#text",E.prototype.toString=function(){return this.data},E.prototype.replaceData=function(w,D,P){var C=this.data,U=C.substring(0,w),j=C.substring(w+D,C.length);this.data=U+P+j,this.length=this.data.length}}),W=Ge(function(I,T){T.exports=function(E){var w=this,D=E.type;E.target||(E.target=w),w.listeners||(w.listeners={});var P=w.listeners[D];if(P)return P.forEach(function(C){E.currentTarget=w,typeof C=="function"?C(E):C.handleEvent(E)});w.parentNode&&w.parentNode.dispatchEvent(E)}}),be=Ge(function(I,T){T.exports=function(E,w){var D=this;D.listeners||(D.listeners={}),D.listeners[E]||(D.listeners[E]=[]),D.listeners[E].indexOf(w)===-1&&D.listeners[E].push(w)}}),le=Ge(function(I,T){T.exports=function(E,w){var D=this;if(D.listeners&&D.listeners[E]){var P=D.listeners[E],C=P.indexOf(w);C!==-1&&P.splice(C,1)}}}),H=Ge(function(I,T){Yt(),T.exports=w;var E=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function w(U){switch(U.nodeType){case 3:return C(U.data);case 8:return"<!--"+U.data+"-->";default:return function(j){var X=[],se=j.tagName;return j.namespaceURI==="http://www.w3.org/1999/xhtml"&&(se=se.toLowerCase()),X.push("<"+se+function(te){var de=[];for(var K in te)D(te,K)&&de.push({name:K,value:te[K]});for(var ie in te._attributes)for(var Se in te._attributes[ie]){var xe=te._attributes[ie][Se],it=(xe.prefix?xe.prefix+":":"")+Se;de.push({name:it,value:xe.value})}return te.className&&de.push({name:"class",value:te.className}),de.length?P(de):""}(j)+function(te){var de=te.dataset,K=[];for(var ie in de)K.push({name:"data-"+ie,value:de[ie]});return K.length?P(K):""}(j)),E.indexOf(se)>-1?X.push(" />"):(X.push(">"),j.childNodes.length?X.push.apply(X,j.childNodes.map(w)):j.textContent||j.innerText?X.push(C(j.textContent||j.innerText)):j.innerHTML&&X.push(j.innerHTML),X.push("</"+se+">")),X.join("")}(U)}}function D(U,j){var X=Ze(U[j]);return j==="style"&&Object.keys(U.style).length>0||U.hasOwnProperty(j)&&(X==="string"||X==="boolean"||X==="number")&&j!=="nodeName"&&j!=="className"&&j!=="tagName"&&j!=="textContent"&&j!=="innerText"&&j!=="namespaceURI"&&j!=="innerHTML"}function P(U){var j=[];return U.forEach(function(X){var se=X.name,te=X.value;se==="style"&&(te=function(de){if(typeof de=="string")return de;var K="";return Object.keys(de).forEach(function(ie){var Se=de[ie];ie=ie.replace(/[A-Z]/g,function(xe){return"-"+xe.toLowerCase()}),K+=ie+":"+Se+";"}),K}(te)),j.push(se+'="'+function(de){return C(de).replace(/"/g,"&quot;")}(te)+'"')}),j.length?" "+j.join(" "):""}function C(U){var j="";return typeof U=="string"?j=U:U&&(j=U.toString()),j.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}),x=Ge(function(I,T){li();var E=Hi(),w=W(),D=be(),P=le(),C=H(),U="http://www.w3.org/1999/xhtml";function j(X,se,te){if(!It(this,j))return new j(X);var de=te===void 0?U:te||null;this.tagName=de===U?String(X).toUpperCase():X,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=se||null,this.namespaceURI=de,this._attributes={},this.tagName==="INPUT"&&(this.type="text")}T.exports=j,j.prototype.type="DOMElement",j.prototype.nodeType=1,j.prototype.appendChild=function(X){return X.parentNode&&X.parentNode.removeChild(X),this.childNodes.push(X),X.parentNode=this,X},j.prototype.replaceChild=function(X,se){X.parentNode&&X.parentNode.removeChild(X);var te=this.childNodes.indexOf(se);return se.parentNode=null,this.childNodes[te]=X,X.parentNode=this,se},j.prototype.removeChild=function(X){var se=this.childNodes.indexOf(X);return this.childNodes.splice(se,1),X.parentNode=null,X},j.prototype.insertBefore=function(X,se){X.parentNode&&X.parentNode.removeChild(X);var te=se==null?-1:this.childNodes.indexOf(se);return te>-1?this.childNodes.splice(te,0,X):this.childNodes.push(X),X.parentNode=this,X},j.prototype.setAttributeNS=function(X,se,te){var de=null,K=se,ie=se.indexOf(":");ie>-1&&(de=se.substr(0,ie),K=se.substr(ie+1)),this.tagName==="INPUT"&&se==="type"?this.type=te:(this._attributes[X]||(this._attributes[X]={}))[K]={value:te,prefix:de}},j.prototype.getAttributeNS=function(X,se){var te=this._attributes[X],de=te&&te[se]&&te[se].value;return this.tagName==="INPUT"&&se==="type"?this.type:typeof de!="string"?null:de},j.prototype.removeAttributeNS=function(X,se){var te=this._attributes[X];te&&delete te[se]},j.prototype.hasAttributeNS=function(X,se){var te=this._attributes[X];return!!te&&se in te},j.prototype.setAttribute=function(X,se){return this.setAttributeNS(null,X,se)},j.prototype.getAttribute=function(X){return this.getAttributeNS(null,X)},j.prototype.removeAttribute=function(X){return this.removeAttributeNS(null,X)},j.prototype.hasAttribute=function(X){return this.hasAttributeNS(null,X)},j.prototype.removeEventListener=P,j.prototype.addEventListener=D,j.prototype.dispatchEvent=w,j.prototype.focus=function(){},j.prototype.toString=function(){return C(this)},j.prototype.getElementsByClassName=function(X){var se=X.split(" "),te=[];return E(this,function(de){if(de.nodeType===1){var K=(de.className||"").split(" ");se.every(function(ie){return K.indexOf(ie)!==-1})&&te.push(de)}}),te},j.prototype.getElementsByTagName=function(X){X=X.toLowerCase();var se=[];return E(this.childNodes,function(te){te.nodeType===1&&(X==="*"||te.tagName.toLowerCase()===X)&&se.push(te)}),se},j.prototype.contains=function(X){return E(this,function(se){return X===se})||!1}}),ye=Ge(function(I,T){li();var E=x();function w(D){if(!It(this,w))return new w;this.childNodes=[],this.parentNode=null,this.ownerDocument=D||null}T.exports=w,w.prototype.type="DocumentFragment",w.prototype.nodeType=11,w.prototype.nodeName="#document-fragment",w.prototype.appendChild=E.prototype.appendChild,w.prototype.replaceChild=E.prototype.replaceChild,w.prototype.removeChild=E.prototype.removeChild,w.prototype.toString=function(){return this.childNodes.map(function(D){return String(D)}).join("")}}),ue=Ge(function(I,T){function E(w){}T.exports=E,E.prototype.initEvent=function(w,D,P){this.type=w,this.bubbles=D,this.cancelable=P},E.prototype.preventDefault=function(){}}),Ke=Ge(function(I,T){li();var E=Hi(),w=ti(),D=N(),P=x(),C=ye(),U=ue(),j=W(),X=be(),se=le();function te(){if(!It(this,te))return new te;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}T.exports=te;var de=te.prototype;de.createTextNode=function(K){return new D(K,this)},de.createElementNS=function(K,ie){var Se=K===null?null:String(K);return new P(ie,this,Se)},de.createElement=function(K){return new P(K,this)},de.createDocumentFragment=function(){return new C(this)},de.createEvent=function(K){return new U(K)},de.createComment=function(K){return new w(K,this)},de.getElementById=function(K){return K=String(K),E(this.childNodes,function(ie){if(String(ie.id)===K)return ie})||null},de.getElementsByClassName=P.prototype.getElementsByClassName,de.getElementsByTagName=P.prototype.getElementsByTagName,de.contains=P.prototype.contains,de.removeEventListener=se,de.addEventListener=X,de.dispatchEvent=j}),Je=Ge(function(I,T){var E=Ke();T.exports=new E}),Fe=Ge(function(I,T){var E,w=typeof Le.g!="undefined"?Le.g:typeof window!="undefined"?window:{},D=Je();typeof document!="undefined"?E=document:(E=w["__GLOBAL_DOCUMENT_CACHE@4"])||(E=w["__GLOBAL_DOCUMENT_CACHE@4"]=D),T.exports=E});function me(I,T){(T==null||T>I.length)&&(T=I.length);for(var E=0,w=new Array(T);E<T;E++)w[E]=I[E];return w}function ct(I,T){if(I){if(typeof I=="string")return me(I,T);var E=Object.prototype.toString.call(I).slice(8,-1);if(E==="Object"&&I.constructor&&(E=I.constructor.name),E==="Map"||E==="Set")return Array.from(E);if(E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E))return me(I,T)}}function ve(I,T){return function(E){if(Array.isArray(E))return E}(I)||function(E,w){var D=E==null?null:typeof Symbol!="undefined"&&E[Symbol.iterator]||E["@@iterator"];if(D!=null){var P,C,U=[],j=!0,X=!1;try{for(D=D.call(E);!(j=(P=D.next()).done)&&(U.push(P.value),!w||U.length!==w);j=!0);}catch(se){X=!0,C=se}finally{try{!j&&D.return!=null&&D.return()}finally{if(X)throw C}}return U}}(I,T)||ct(I,T)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}var xt=ge(Ye()),Jt=ge(Ye()),mt=ge(Ye()),pt={now:function(){var I=mt.default.performance,T=I&&I.timing,E=T&&T.navigationStart,w=typeof E=="number"&&typeof I.now=="function"?E+I.now():Date.now();return Math.round(w)}},Ai=function(){var I,T,E;if(typeof((I=Jt.default.crypto)===null||I===void 0?void 0:I.getRandomValues)=="function"){E=new Uint8Array(32),Jt.default.crypto.getRandomValues(E);for(var w=0;w<32;w++)E[w]=E[w]%16}else{E=[];for(var D=0;D<32;D++)E[D]=16*Math.random()|0}var P=0;T="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(j){var X=j==="x"?E[P]:3&E[P]|8;return P++,X.toString(16)});var C=pt.now(),U=C==null?void 0:C.toString(16).substring(3);return U?T.substring(0,28)+U:T},Ot=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},zt=function(I){if(I&&I.nodeName!==void 0)return I.muxId||(I.muxId=Ot()),I.muxId;var T;try{T=document.querySelector(I)}catch(E){}return T&&!T.muxId&&(T.muxId=I),(T==null?void 0:T.muxId)||I},Si=function(I){var T;I&&I.nodeName!==void 0?I=zt(T=I):T=document.querySelector(I);var E=T&&T.nodeName?T.nodeName.toLowerCase():"";return[T,I,E]};function ii(I){return function(T){if(Array.isArray(T))return me(T)}(I)||function(T){if(typeof Symbol!="undefined"&&T[Symbol.iterator]!=null||T["@@iterator"]!=null)return Array.from(T)}(I)||ct(I)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}var ui=0,At=1,Zi=2,Ms=3,mn=4,rt=function(I){var T,E,w,D,P,C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,U=I?[console,I]:[console],j=(T=console.trace).bind.apply(T,ii(U)),X=(E=console.info).bind.apply(E,ii(U)),se=(w=console.debug).bind.apply(w,ii(U)),te=(D=console.warn).bind.apply(D,ii(U)),de=(P=console.error).bind.apply(P,ii(U)),K=C;return{trace:function(){for(var ie=arguments.length,Se=new Array(ie),xe=0;xe<ie;xe++)Se[xe]=arguments[xe];if(!(K>ui))return j.apply(void 0,ii(Se))},debug:function(){for(var ie=arguments.length,Se=new Array(ie),xe=0;xe<ie;xe++)Se[xe]=arguments[xe];if(!(K>At))return se.apply(void 0,ii(Se))},info:function(){for(var ie=arguments.length,Se=new Array(ie),xe=0;xe<ie;xe++)Se[xe]=arguments[xe];if(!(K>Zi))return X.apply(void 0,ii(Se))},warn:function(){for(var ie=arguments.length,Se=new Array(ie),xe=0;xe<ie;xe++)Se[xe]=arguments[xe];if(!(K>Ms))return te.apply(void 0,ii(Se))},error:function(){for(var ie=arguments.length,Se=new Array(ie),xe=0;xe<ie;xe++)Se[xe]=arguments[xe];if(!(K>mn))return de.apply(void 0,ii(Se))},get level(){return K},set level(ie){ie!==this.level&&(K=ie!=null?ie:C)}}}("[mux]"),Mi=ge(Ye());function Or(){return(Mi.default.doNotTrack||Mi.default.navigator&&Mi.default.navigator.doNotTrack)==="1"}function et(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function Gt(I,T){if(!It(I,T))throw new TypeError("Cannot call a class as a function")}function Fi(I,T){for(var E=0;E<T.length;E++){var w=T[E];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(I,w.key,w)}}function Ni(I,T,E){return T&&Fi(I.prototype,T),E&&Fi(I,E),I}function Ee(I,T,E){return T in I?Object.defineProperty(I,T,{value:E,enumerable:!0,configurable:!0,writable:!0}):I[T]=E,I}function Yi(I){return(Yi=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)})(I)}function Rt(I,T,E){return Rt=typeof Reflect!="undefined"&&Reflect.get?Reflect.get:function(w,D,P){var C=function(j,X){for(;!Object.prototype.hasOwnProperty.call(j,X)&&(j=Yi(j))!==null;);return j}(w,D);if(C){var U=Object.getOwnPropertyDescriptor(C,D);return U.get?U.get.call(P||w):U.value}},Rt(I,T,E||I)}function er(I,T){return(er=Object.setPrototypeOf||function(E,w){return E.__proto__=w,E})(I,T)}function Xt(I,T){if(I==null)return{};var E,w,D=function(C,U){if(C==null)return{};var j,X,se={},te=Object.keys(C);for(X=0;X<te.length;X++)j=te[X],!(U.indexOf(j)>=0)&&(se[j]=C[j]);return se}(I,T);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(I);for(w=0;w<P.length;w++)E=P[w],!(T.indexOf(E)>=0)&&Object.prototype.propertyIsEnumerable.call(I,E)&&(D[E]=I[E])}return D}function Mr(I,T){return!T||Ze(T)!=="object"&&typeof T!="function"?et(I):T}function mi(I){var T=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}();return function(){var E,w=Yi(I);if(T){var D=Yi(this).constructor;E=Reflect.construct(w,arguments,D)}else E=w.apply(this,arguments);return Mr(this,E)}}li(),Yt();var vi=function(I){return Fr(I)[0]},Fr=function(I){if(typeof I!="string"||I==="")return["localhost"];var T,E=(I.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return E&&(T=(E.match(/[^\.]+\.[^\.]+$/)||[])[0]),[E,T]},Nr=ge(Ye()),Br={exists:function(){var I=Nr.default.performance;return(I&&I.timing)!==void 0},domContentLoadedEventEnd:function(){var I=Nr.default.performance,T=I&&I.timing;return T&&T.domContentLoadedEventEnd},navigationStart:function(){var I=Nr.default.performance,T=I&&I.timing;return T&&T.navigationStart}};function Zt(I,T,E){E=E===void 0?1:E,I[T]=I[T]||0,I[T]+=E}function Bt(I){for(var T=1;T<arguments.length;T++){var E=arguments[T]!=null?arguments[T]:{},w=Object.keys(E);typeof Object.getOwnPropertySymbols=="function"&&(w=w.concat(Object.getOwnPropertySymbols(E).filter(function(D){return Object.getOwnPropertyDescriptor(E,D).enumerable}))),w.forEach(function(D){Ee(I,D,E[D])})}return I}function zi(I,T){return T=T!=null?T:{},Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(T)):function(E,w){var D=Object.keys(E);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(E);w&&(P=P.filter(function(C){return Object.getOwnPropertyDescriptor(E,C).enumerable})),D.push.apply(D,P)}return D}(Object(T)).forEach(function(E){Object.defineProperty(I,E,Object.getOwnPropertyDescriptor(T,E))}),I}var tt=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],Fs=["x-cdn","content-type"].concat(tt);function Tt(I){var T={};return(I=I||"").trim().split(/[\r\n]+/).forEach(function(E){if(E){var w=E.split(": "),D=w.shift();D&&(Fs.indexOf(D.toLowerCase())>=0||D.toLowerCase().indexOf("x-litix-")===0)&&(T[D]=w.join(": "))}}),T}function Gi(I){if(I){var T=tt.find(function(E){return I[E]!==void 0});return T?I[T]:void 0}}var ht=function(I){var T={};for(var E in I){var w=I[E];w["DATA-ID"].search("io.litix.data.")!==-1&&(T[w["DATA-ID"].replace("io.litix.data.","")]=w.VALUE)}return T},Vi=function(I){if(!I)return{};var T=Br.navigationStart(),E=I.loading,w=E?E.start:I.trequest,D=E?E.first:I.tfirst,P=E?E.end:I.tload;return{bytesLoaded:I.total,requestStart:Math.round(T+w),responseStart:Math.round(T+D),responseEnd:Math.round(T+P)}},xi=function(I){if(I&&typeof I.getAllResponseHeaders=="function")return Tt(I.getAllResponseHeaders())},br=function(I,T){if(!I||!I.requestEndDate)return{};var E,w=vi(I.url),D=I.url,P=I.bytesLoaded,C=new Date(I.requestStartDate).getTime(),U=new Date(I.firstByteDate).getTime(),j=new Date(I.requestEndDate).getTime(),X=isNaN(I.duration)?0:I.duration,se=typeof T.getMetricsFor=="function"?T.getMetricsFor(I.mediaType).HttpList:T.getDashMetrics().getHttpRequests(I.mediaType);return se.length>0&&(E=Tt(se[se.length-1]._responseHeaders||"")),{requestStart:C,requestResponseStart:U,requestResponseEnd:j,requestBytesLoaded:P,requestResponseHeaders:E,requestMediaDuration:X,requestHostname:w,requestUrl:D,requestId:E?Gi(E):void 0}},Ur=function(I,T){var E=T.getQualityFor(I),w=T.getCurrentTrackFor(I).bitrateList;return w?{currentLevel:E,renditionWidth:w[E].width||null,renditionHeight:w[E].height||null,renditionBitrate:w[E].bandwidth}:{}},vn=function(I){var T;return(T=I.match(/.*codecs\*?="(.*)"/))===null||T===void 0?void 0:T[1]},Bi=function(I){try{var T,E;return(E=I.getVersion)===null||E===void 0||(T=E.call(I))===null||T===void 0?void 0:T.split(".").map(function(w){return parseInt(w)})[0]}catch(w){return!1}},Sr=0,yi=function(){function I(){Gt(this,I),Ee(this,"_listeners",void 0)}return Ni(I,[{key:"on",value:function(T,E,w){return E._eventEmitterGuid=E._eventEmitterGuid||++Sr,this._listeners=this._listeners||{},this._listeners[T]=this._listeners[T]||[],w&&(E=E.bind(w)),this._listeners[T].push(E),E}},{key:"off",value:function(T,E){var w=this._listeners&&this._listeners[T];w&&w.forEach(function(D,P){D._eventEmitterGuid===E._eventEmitterGuid&&w.splice(P,1)})}},{key:"one",value:function(T,E,w){var D=this;E._eventEmitterGuid=E._eventEmitterGuid||++Sr;var P=function(){D.off(T,P),E.apply(w||this,arguments)};P._eventEmitterGuid=E._eventEmitterGuid,this.on(T,P)}},{key:"emit",value:function(T,E){var w=this;if(this._listeners){E=E||{};var D=this._listeners["before"+T]||[],P=this._listeners["before*"]||[],C=this._listeners[T]||[],U=this._listeners["after"+T]||[],j=function(X,se){(X=X.slice()).forEach(function(te){te.call(w,{type:T},se)})};j(D,E),j(P,E),j(C,E),j(U,E)}}}]),I}(),cs=yi,hs=ge(Ye()),yn=function(){function I(T){var E=this;Gt(this,I),Ee(this,"_playbackHeartbeatInterval",void 0),Ee(this,"_playheadShouldBeProgressing",void 0),Ee(this,"pm",void 0),this.pm=T,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,T.on("playing",function(){E._playheadShouldBeProgressing=!0}),T.on("play",this._startPlaybackHeartbeatInterval.bind(this)),T.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),T.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),T.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),T.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),T.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),T.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),T.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),T.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),T.on("seeked",function(){T.data.player_is_paused?E._stopPlaybackHeartbeatInterval():E._startPlaybackHeartbeatInterval()}),T.on("timeupdate",function(){E._playbackHeartbeatInterval!==null&&T.emit("playbackheartbeat")}),T.on("devicesleep",function(w,D){E._playbackHeartbeatInterval!==null&&(hs.default.clearInterval(E._playbackHeartbeatInterval),T.emit("playbackheartbeatend",{viewer_time:D.viewer_time}),E._playbackHeartbeatInterval=null)})}return Ni(I,[{key:"_startPlaybackHeartbeatInterval",value:function(){var T=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=hs.default.setInterval(function(){T.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(hs.default.clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}]),I}(),xr=function I(T){var E=this;Gt(this,I),Ee(this,"viewErrored",void 0),T.on("viewinit",function(){E.viewErrored=!1}),T.on("error",function(w,D){try{var P=T.errorTranslator({player_error_code:D.player_error_code,player_error_message:D.player_error_message,player_error_context:D.player_error_context,player_error_severity:D.player_error_severity,player_error_business_exception:D.player_error_business_exception});P&&(T.data.player_error_code=P.player_error_code||D.player_error_code,T.data.player_error_message=P.player_error_message||D.player_error_message,T.data.player_error_context=P.player_error_context||D.player_error_context,T.data.player_error_severity=P.player_error_severity||D.player_error_severity,T.data.player_error_business_exception=P.player_error_business_exception||D.player_error_business_exception,E.viewErrored=!0)}catch(C){T.mux.log.warn("Exception in error translator callback.",C),E.viewErrored=!0}}),T.on("aftererror",function(){var w,D,P,C,U;(w=T.data)===null||w===void 0||delete w.player_error_code,(D=T.data)===null||D===void 0||delete D.player_error_message,(P=T.data)===null||P===void 0||delete P.player_error_context,(C=T.data)===null||C===void 0||delete C.player_error_severity,(U=T.data)===null||U===void 0||delete U.player_error_business_exception})},fi=function(){function I(T){Gt(this,I),Ee(this,"_watchTimeTrackerLastCheckedTime",void 0),Ee(this,"pm",void 0),this.pm=T,this._watchTimeTrackerLastCheckedTime=null,T.on("playbackheartbeat",this._updateWatchTime.bind(this)),T.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}return Ni(I,[{key:"_updateWatchTime",value:function(T,E){var w=E.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=w),Zt(this.pm.data,"view_watch_time",w-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=w}},{key:"_clearWatchTimeState",value:function(T,E){this._updateWatchTime(T,E),this._watchTimeTrackerLastCheckedTime=null}}]),I}(),$r=function(){function I(T){var E=this;Gt(this,I),Ee(this,"_playbackTimeTrackerLastPlayheadPosition",void 0),Ee(this,"_lastTime",void 0),Ee(this,"_isAdPlaying",void 0),Ee(this,"_callbackUpdatePlaybackTime",void 0),Ee(this,"pm",void 0),this.pm=T,this._playbackTimeTrackerLastPlayheadPosition=-1,this._lastTime=pt.now(),this._isAdPlaying=!1,this._callbackUpdatePlaybackTime=null;var w=this._startPlaybackTimeTracking.bind(this);T.on("playing",w),T.on("adplaying",w),T.on("seeked",w);var D=this._stopPlaybackTimeTracking.bind(this);T.on("playbackheartbeatend",D),T.on("seeking",D),T.on("adplaying",function(){E._isAdPlaying=!0}),T.on("adended",function(){E._isAdPlaying=!1}),T.on("adpause",function(){E._isAdPlaying=!1}),T.on("adbreakstart",function(){E._isAdPlaying=!1}),T.on("adbreakend",function(){E._isAdPlaying=!1}),T.on("adplay",function(){E._isAdPlaying=!1}),T.on("viewinit",function(){E._playbackTimeTrackerLastPlayheadPosition=-1,E._lastTime=pt.now(),E._isAdPlaying=!1,E._callbackUpdatePlaybackTime=null})}return Ni(I,[{key:"_startPlaybackTimeTracking",value:function(){this._callbackUpdatePlaybackTime===null&&(this._callbackUpdatePlaybackTime=this._updatePlaybackTime.bind(this),this._playbackTimeTrackerLastPlayheadPosition=this.pm.data.player_playhead_time,this.pm.on("playbackheartbeat",this._callbackUpdatePlaybackTime))}},{key:"_stopPlaybackTimeTracking",value:function(){this._callbackUpdatePlaybackTime&&(this._updatePlaybackTime(),this.pm.off("playbackheartbeat",this._callbackUpdatePlaybackTime),this._callbackUpdatePlaybackTime=null,this._playbackTimeTrackerLastPlayheadPosition=-1)}},{key:"_updatePlaybackTime",value:function(){var T=this.pm.data.player_playhead_time,E=pt.now(),w=-1;this._playbackTimeTrackerLastPlayheadPosition>=0&&T>this._playbackTimeTrackerLastPlayheadPosition?w=T-this._playbackTimeTrackerLastPlayheadPosition:this._isAdPlaying&&(w=E-this._lastTime),w>0&&w<=1e3&&Zt(this.pm.data,"view_content_playback_time",w),this._playbackTimeTrackerLastPlayheadPosition=T,this._lastTime=E}}]),I}(),Hr=function(){function I(T){Gt(this,I),Ee(this,"pm",void 0),this.pm=T;var E=this._updatePlayheadTime.bind(this);T.on("playbackheartbeat",E),T.on("playbackheartbeatend",E),T.on("timeupdate",E),T.on("destroy",function(){T.off("timeupdate",E)})}return Ni(I,[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=this.pm.data.view_max_playhead_position===void 0?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(T,E){var w=this,D=function(){w.pm.currentFragmentPDT&&w.pm.currentFragmentStart&&(w.pm.data.player_program_time=w.pm.currentFragmentPDT+w.pm.data.player_playhead_time-w.pm.currentFragmentStart)};if(E&&E.player_playhead_time)this.pm.data.player_playhead_time=E.player_playhead_time,D(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var P=this.pm.getPlayheadTime();P!==void 0&&(this.pm.data.player_playhead_time=P,D(),this._updateMaxPlayheadPosition())}}}]),I}(),ds=3e5,fs=function I(T){if(Gt(this,I),!T.disableRebufferTracking){var E,w=function(P,C){D(C),E=void 0},D=function(P){if(E){var C=P.viewer_time-E;Zt(T.data,"view_rebuffer_duration",C),E=P.viewer_time,T.data.view_rebuffer_duration>ds&&(T.emit("viewend"),T.send("viewend"),T.mux.log.warn("Ending view after rebuffering for longer than ".concat(ds,"ms, future events will be ignored unless a programchange or videochange occurs.")))}T.data.view_watch_time>=0&&T.data.view_rebuffer_count>0&&(T.data.view_rebuffer_frequency=T.data.view_rebuffer_count/T.data.view_watch_time,T.data.view_rebuffer_percentage=T.data.view_rebuffer_duration/T.data.view_watch_time)};T.on("playbackheartbeat",function(P,C){return D(C)}),T.on("rebufferstart",function(P,C){E||(Zt(T.data,"view_rebuffer_count",1),E=C.viewer_time,T.one("rebufferend",w))}),T.on("viewinit",function(){E=void 0,T.off("rebufferend",w)})}},ps=function(){function I(T){var E=this;Gt(this,I),Ee(this,"_lastCheckedTime",void 0),Ee(this,"_lastPlayheadTime",void 0),Ee(this,"_lastPlayheadTimeUpdatedTime",void 0),Ee(this,"_rebuffering",void 0),Ee(this,"pm",void 0),this.pm=T,!T.disableRebufferTracking&&!T.disablePlayheadRebufferTracking&&(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,T.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),T.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),T.on("seeking",function(){E._cleanupRebufferTracker(null,{viewer_time:pt.now()})}))}return Ni(I,[{key:"_checkIfRebuffering",value:function(T,E){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(T,E);else if(this._lastCheckedTime!==null)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var w=E.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&w>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=E.viewer_time}else this._cleanupRebufferTracker(T,E,!0);else this._prepareRebufferTrackerState(E.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(T){this._lastCheckedTime=T,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=T}},{key:"_cleanupRebufferTracker",value:function(T,E){var w=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:E.viewer_time});else{if(this._lastCheckedTime===null)return;var D=this.pm.data.player_playhead_time-this._lastPlayheadTime,P=E.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&D>0&&P-D>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+P-D}))}w?this._prepareRebufferTrackerState(E.viewer_time):this._clearRebufferTrackerState()}}]),I}(),_n=ps,Gr=function(){function I(T){var E=this;Gt(this,I),Ee(this,"pm",void 0),this.pm=T,T.on("viewinit",function(){var w=T.data,D=w.view_id;if(!w.view_program_changed){var P=function(C,U){var j=U.viewer_time;(C.type==="playing"&&T.data.view_time_to_first_frame===void 0||C.type==="adplaying"&&(T.data.view_time_to_first_frame===void 0||E._inPrerollPosition()))&&E.calculateTimeToFirstFrame(j||pt.now(),D)};T.one("playing",P),T.one("adplaying",P),T.one("viewend",function(){T.off("playing",P),T.off("adplaying",P)})}})}return Ni(I,[{key:"_inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(T,E){E===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:T}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.pm.pageLoadInitTime&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.pm.pageLoadInitTime))}}]),I}(),tr=function I(T){var E=this;Gt(this,I),Ee(this,"_lastPlayerHeight",void 0),Ee(this,"_lastPlayerWidth",void 0),Ee(this,"_lastPlayheadPosition",void 0),Ee(this,"_lastSourceHeight",void 0),Ee(this,"_lastSourceWidth",void 0),T.on("viewinit",function(){E._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb","renditionchange","orientationchange","viewend"].forEach(function(w){T.on(w,function(){if(E._lastPlayheadPosition>=0&&T.data.player_playhead_time>=0&&E._lastPlayerWidth>=0&&E._lastSourceWidth>0&&E._lastPlayerHeight>=0&&E._lastSourceHeight>0){var D=T.data.player_playhead_time-E._lastPlayheadPosition;if(D<0)return void(E._lastPlayheadPosition=-1);var P=Math.min(E._lastPlayerWidth/E._lastSourceWidth,E._lastPlayerHeight/E._lastSourceHeight),C=Math.max(0,P-1),U=Math.max(0,1-P);T.data.view_max_upscale_percentage=Math.max(T.data.view_max_upscale_percentage||0,C),T.data.view_max_downscale_percentage=Math.max(T.data.view_max_downscale_percentage||0,U),Zt(T.data,"view_total_content_playback_time",D),Zt(T.data,"view_total_upscaling",C*D),Zt(T.data,"view_total_downscaling",U*D)}E._lastPlayheadPosition=-1})}),["playing","hb","renditionchange","orientationchange"].forEach(function(w){T.on(w,function(){E._lastPlayheadPosition=T.data.player_playhead_time,E._lastPlayerWidth=T.data.player_width,E._lastPlayerHeight=T.data.player_height,E._lastSourceWidth=T.data.video_source_width,E._lastSourceHeight=T.data.video_source_height})})},Ns=function I(T){var E=this;Gt(this,I),Ee(this,"isSeeking",void 0),this.isSeeking=!1;var w=-1,D=function(){var P=pt.now(),C=(T.data.viewer_time||P)-(w||P);Zt(T.data,"view_seek_duration",C),T.data.view_max_seek_time=Math.max(T.data.view_max_seek_time||0,C),E.isSeeking=!1,w=-1};T.on("seeking",function(P,C){Object.assign(T.data,C),E.isSeeking&&C.viewer_time-w<=2e3?w=C.viewer_time:(E.isSeeking&&D(),E.isSeeking=!0,w=C.viewer_time,Zt(T.data,"view_seek_count",1),T.send("seeking"))}),T.on("seeked",function(){D()}),T.on("viewend",function(){E.isSeeking&&(D(),T.send("seeked")),E.isSeeking=!1,w=-1})},ir=function(I,T){I.push(T),I.sort(function(E,w){return E.viewer_time-w.viewer_time})},gs=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror","adclicked","adskipped"],Vr=function(){function I(T){var E=this;Gt(this,I),Ee(this,"_adHasPlayed",void 0),Ee(this,"_adRequests",void 0),Ee(this,"_adResponses",void 0),Ee(this,"_currentAdRequestNumber",void 0),Ee(this,"_currentAdResponseNumber",void 0),Ee(this,"_prerollPlayTime",void 0),Ee(this,"_wouldBeNewAdPlay",void 0),Ee(this,"isAdBreak",void 0),Ee(this,"pm",void 0),this.pm=T,T.on("viewinit",function(){E.isAdBreak=!1,E._currentAdRequestNumber=0,E._currentAdResponseNumber=0,E._adRequests=[],E._adResponses=[],E._adHasPlayed=!1,E._wouldBeNewAdPlay=!0,E._prerollPlayTime=void 0}),gs.forEach(function(D){return T.on(D,E._updateAdData.bind(E))});var w=function(){E.isAdBreak=!1};T.on("adbreakstart",function(){E.isAdBreak=!0}),T.on("play",w),T.on("playing",w),T.on("viewend",w),T.on("adrequest",function(D,P){P=Object.assign({ad_request_id:"generatedAdRequestId"+E._currentAdRequestNumber++},P),ir(E._adRequests,P),Zt(T.data,"view_ad_request_count"),E.inPrerollPosition()&&(T.data.view_preroll_requested=!0,E._adHasPlayed||Zt(T.data,"view_preroll_request_count"))}),T.on("adresponse",function(D,P){P=Object.assign({ad_request_id:"generatedAdRequestId"+E._currentAdResponseNumber++},P),ir(E._adResponses,P);var C=E.findAdRequest(P.ad_request_id);C&&Zt(T.data,"view_ad_request_time",Math.max(0,P.viewer_time-C.viewer_time))}),T.on("adplay",function(D,P){E._adHasPlayed=!0,E._wouldBeNewAdPlay&&(E._wouldBeNewAdPlay=!1,Zt(T.data,"view_ad_played_count")),E.inPrerollPosition()&&!T.data.view_preroll_played&&(T.data.view_preroll_played=!0,E._adRequests.length>0&&(T.data.view_preroll_request_time=Math.max(0,P.viewer_time-E._adRequests[0].viewer_time)),T.data.view_start&&(T.data.view_startup_preroll_request_time=Math.max(0,P.viewer_time-T.data.view_start)),E._prerollPlayTime=P.viewer_time)}),T.on("adplaying",function(D,P){E.inPrerollPosition()&&T.data.view_preroll_load_time===void 0&&E._prerollPlayTime!==void 0&&(T.data.view_preroll_load_time=P.viewer_time-E._prerollPlayTime,T.data.view_startup_preroll_load_time=P.viewer_time-E._prerollPlayTime)}),T.on("adclicked",function(D,P){E._wouldBeNewAdPlay||Zt(T.data,"view_ad_clicked_count")}),T.on("adskipped",function(D,P){E._wouldBeNewAdPlay||Zt(T.data,"view_ad_skipped_count")}),T.on("adended",function(){E._wouldBeNewAdPlay=!0}),T.on("aderror",function(){E._wouldBeNewAdPlay=!0})}return Ni(I,[{key:"inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(T){for(var E=0;E<this._adRequests.length;E++)if(this._adRequests[E].ad_request_id===T)return this._adRequests[E]}},{key:"_updateAdData",value:function(T,E){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&E.ad_tag_url){var w=ve(Fr(E.ad_tag_url),2),D=w[0],P=w[1];this.pm.data.view_preroll_ad_tag_domain=P,this.pm.data.view_preroll_ad_tag_hostname=D}if(!this.pm.data.view_preroll_ad_asset_hostname&&E.ad_asset_url){var C=ve(Fr(E.ad_asset_url),2),U=C[0],j=C[1];this.pm.data.view_preroll_ad_asset_domain=j,this.pm.data.view_preroll_ad_asset_hostname=U}}this.pm.data.ad_asset_url=E==null?void 0:E.ad_asset_url,this.pm.data.ad_tag_url=E==null?void 0:E.ad_tag_url,this.pm.data.ad_creative_id=E==null?void 0:E.ad_creative_id,this.pm.data.ad_id=E==null?void 0:E.ad_id,this.pm.data.ad_universal_id=E==null?void 0:E.ad_universal_id}}]),I}(),ms=ge(Ye()),hr=function I(T){Gt(this,I);var E,w,D=function(){T.disableRebufferTracking||E&&(Zt(T.data,"view_waiting_rebuffer_duration",pt.now()-E),E=!1,ms.default.clearInterval(w))},P=!1,C=function(){P=!1,D()};T.on("waiting",function(){P&&(T.disableRebufferTracking||(Zt(T.data,"view_waiting_rebuffer_count",1),E=pt.now(),w=ms.default.setInterval(function(){if(E){var U=pt.now();Zt(T.data,"view_waiting_rebuffer_duration",U-E),E=U}},250)))}),T.on("playing",function(){D(),P=!0}),T.on("pause",C),T.on("seeking",C)},vs=function I(T){var E=this;Gt(this,I),Ee(this,"lastWallClockTime",void 0);var w=function(){E.lastWallClockTime=pt.now(),T.on("before*",D)},D=function(P){var C=pt.now(),U=E.lastWallClockTime;E.lastWallClockTime=C,C-U>3e4&&(T.emit("devicesleep",{viewer_time:U}),Object.assign(T.data,{viewer_time:U}),T.send("devicesleep"),T.emit("devicewake",{viewer_time:C}),Object.assign(T.data,{viewer_time:C}),T.send("devicewake"))};T.one("playbackheartbeat",w),T.on("playbackheartbeatend",function(){T.off("before*",D),T.one("playbackheartbeat",w)})},dr=ge(Ye()),jr=function(){var I=function(){for(var E=0,w={};E<arguments.length;E++){var D=arguments[E];for(var P in D)w[P]=D[P]}return w};function T(E){function w(D,P,C){var U;if(typeof document!="undefined"){if(arguments.length>1){if(typeof(C=I({path:"/"},w.defaults,C)).expires=="number"){var j=new Date;j.setMilliseconds(j.getMilliseconds()+864e5*C.expires),C.expires=j}try{U=JSON.stringify(P),/^[\{\[]/.test(U)&&(P=U)}catch(Se){}return P=E.write?E.write(P,D):encodeURIComponent(String(P)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),D=(D=(D=encodeURIComponent(String(D))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[D,"=",P,C.expires?"; expires="+C.expires.toUTCString():"",C.path?"; path="+C.path:"",C.domain?"; domain="+C.domain:"",C.secure?"; secure":""].join("")}D||(U={});for(var X=document.cookie?document.cookie.split("; "):[],se=/(%[0-9A-Z]{2})+/g,te=0;te<X.length;te++){var de=X[te].split("="),K=de.slice(1).join("=");K.charAt(0)==='"'&&(K=K.slice(1,-1));try{var ie=de[0].replace(se,decodeURIComponent);if(K=E.read?E.read(K,ie):E(K,ie)||K.replace(se,decodeURIComponent),this.json)try{K=JSON.parse(K)}catch(Se){}if(D===ie){U=K;break}D||(U[ie]=K)}catch(Se){}}return U}}return w.set=w,w.get=function(D){return w.call(w,D)},w.getJSON=function(){return w.apply({json:!0},[].slice.call(arguments))},w.defaults={},w.remove=function(D,P){w(D,"",I(P,{expires:-1}))},w.withConverter=T,w}return T(function(){})}(),Tn="muxData",En=function(){var I;try{I=(jr.get(Tn)||"").split("&").reduce(function(T,E){var w=ve(E.split("="),2),D=w[0],P=w[1],C=+P,U=P&&C==P?C:P;return T[D]=U,T},{})}catch(T){I={}}return I},Li=function(I){try{jr.set(Tn,(T=I,Object.entries(T).map(function(E){var w=ve(E,2),D=w[0],P=w[1];return"".concat(D,"=").concat(P)}).join("&")),{expires:365})}catch(E){}var T},bn=function(){var I=En();return I.mux_viewer_id=I.mux_viewer_id||Ai(),I.msn=I.msn||Math.random(),Li(I),{mux_viewer_id:I.mux_viewer_id,mux_sample_number:I.msn}};function ci(I,T){var E=T.beaconCollectionDomain,w=T.beaconDomain;if(E)return"https://"+E;var D=w||"litix.io";return(I=I||"inferred").match(/^[a-z0-9]+$/)?"https://"+I+"."+D:"https://img.litix.io/a.gif"}var Bs=ge(Ye()),ys=function(){var I;switch(Kr()){case"cellular":I="cellular";break;case"ethernet":I="wired";break;case"wifi":I="wifi";break;case void 0:break;default:I="other"}return I},Kr=function(){var I=Bs.default.navigator,T=I&&(I.connection||I.mozConnection||I.webkitConnection);return T&&T.type};ys.getConnectionFromAPI=Kr;var qr=ys,Us=_i({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),$s=_i({ad:"ad",af:"affiliate",ag:"aggregate",ap:"api",al:"application",ao:"audio",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",bn:"brand",br:"break",bw:"browser",by:"bytes",bz:"business",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",ci:"client",ck:"clicked",cl:"canceled",cm:"cmcd",cn:"config",co:"count",ce:"counter",cp:"complete",cq:"creator",cr:"creative",cs:"captions",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",dy:"dynamic",eb:"enabled",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",ep:"experiments",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ez:"exception",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",or:"origin",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pp:"pip",pr:"preload",ps:"position",pt:"part",pv:"previous",py:"property",px:"pop",pz:"plan",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rg:"range",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",sd:"skipped",se:"session",sh:"shift",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",ss:"status",st:"start",su:"startup",sv:"server",sw:"software",sy:"severity",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function _i(I){var T={};for(var E in I)I.hasOwnProperty(E)&&(T[I[E]]=E);return T}function hi(I){var T={},E={};return Object.keys(I).forEach(function(w){var D=!1;if(I.hasOwnProperty(w)&&I[w]!==void 0){var P=w.split("_"),C=P[0],U=Us[C];U||(rt.info("Data key word `"+P[0]+"` not expected in "+w),U=C+"_"),P.splice(1).forEach(function(j){j==="url"&&(D=!0),$s[j]?U+=$s[j]:Number.isInteger(Number(j))?U+=j:(rt.info("Data key word `"+j+"` not expected in "+w),U+="_"+j+"_")}),D?E[U]=I[w]:T[U]=I[w]}}),Object.assign(T,E)}var Ii=ge(Ye()),_s=ge(Fe()),Sn={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},na=["hb","requestcompleted","requestfailed","requestcanceled"],ki="https://img.litix.io",Lt=function(I){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._beaconUrl=I||ki,this._eventQueue=[],this._postInFlight=!1,this._resendAfterPost=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},Sn,T)};Lt.prototype.queueEvent=function(I,T){var E=Object.assign({},T);return(this._eventQueue.length<=this._options.maxQueueLength||I==="eventrateexceeded")&&(this._eventQueue.push(E),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},Lt.prototype.flushEvents=function(){var I=arguments.length>0&&arguments[0]!==void 0&&arguments[0];I&&this._eventQueue.length===1?this._eventQueue.pop():(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},Lt.prototype.destroy=function(){var I=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,I?this._clearBeaconQueue():this.flushEvents(),Ii.default.clearTimeout(this._sendTimeout)},Lt.prototype._clearBeaconQueue=function(){var I=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,T=this._eventQueue.slice(I);I>0&&Object.assign(T[T.length-1],hi({mux_view_message:"event queue truncated"}));var E=this._createPayload(T);xn(this._beaconUrl,E,!0,function(){})},Lt.prototype._sendBeaconQueue=function(){var I=this;if(this._postInFlight)this._resendAfterPost=!0;else{var T=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var E=this._createPayload(T),w=pt.now();xn(this._beaconUrl,E,!1,function(D,P){P?(I._eventQueue=T.concat(I._eventQueue),I._failureCount+=1,rt.info("Error sending beacon: "+P)):I._failureCount=0,I._roundTripTime=pt.now()-w,I._postInFlight=!1,I._resendAfterPost&&(I._resendAfterPost=!1,I._eventQueue.length>0&&I._sendBeaconQueue())})}},Lt.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var I=Math.pow(2,this._failureCount-1);return(1+(I*=Math.random()))*this._options.baseTimeBetweenBeacons},Lt.prototype._startBeaconSending=function(){var I=this;Ii.default.clearTimeout(this._sendTimeout),!this.destroyed&&(this._sendTimeout=Ii.default.setTimeout(function(){I._eventQueue.length&&I._sendBeaconQueue(),I._startBeaconSending()},this._getNextBeaconTime()))},Lt.prototype._createPayload=function(I){var T=this,E={transmission_timestamp:Math.round(pt.now())};this._roundTripTime&&(E.rtt_ms=Math.round(this._roundTripTime));var w,D,P,C=function(){w=JSON.stringify({metadata:E,events:D||I}),P=w.length/1024},U=function(){return P<=T._options.maxPayloadKBSize};return C(),U()||(rt.info("Payload size is too big ("+P+" kb). Removing unnecessary events."),D=I.filter(function(j){return na.indexOf(j.e)===-1}),C()),U()||(rt.info("Payload size still too big ("+P+" kb). Cropping fields.."),D.forEach(function(j){for(var X in j){var se=j[X];typeof se=="string"&&se.length>51200&&(j[X]=se.substring(0,51200))}}),C()),w};var Ui=typeof _s.default.exitPictureInPicture=="function"?function(I){return I.length<=57344}:function(I){return!1},xn=function(I,T,E,w){if(E&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(I,T))w();else if(Ii.default.fetch)Ii.default.fetch(I,{method:"POST",body:T,headers:{"Content-Type":"text/plain"},keepalive:Ui(T)}).then(function(P){return w(null,P.ok?null:"Error")}).catch(function(P){return w(null,P)});else{if(Ii.default.XMLHttpRequest){var D=new Ii.default.XMLHttpRequest;return D.onreadystatechange=function(){if(D.readyState===4)return w(null,D.status!==200?"error":void 0)},D.open("POST",I),D.setRequestHeader("Content-Type","text/plain"),void D.send(T)}w()}},ei=Lt,Wr=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id","player_error_code","player_error_message","player_error_context","player_error_severity","player_error_business_exception"],fr=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse","adrequest"],ji=["ad_id","ad_creative_id","ad_universal_id"],An=["viewstart","error","ended","viewend"],pr=function(){function I(T,E){var w,D,P,C,U,j,X,se,te,de,K,ie,Se,xe,it,qt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Gt(this,I),Ee(this,"mux",void 0),Ee(this,"envKey",void 0),Ee(this,"options",void 0),Ee(this,"eventQueue",void 0),Ee(this,"sampleRate",void 0),Ee(this,"disableCookies",void 0),Ee(this,"respectDoNotTrack",void 0),Ee(this,"previousBeaconData",void 0),Ee(this,"lastEventTime",void 0),Ee(this,"rateLimited",void 0),Ee(this,"pageLevelData",void 0),Ee(this,"viewerData",void 0),this.mux=T,this.envKey=E,this.options=qt,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.eventQueue=new ei(ci(this.envKey,this.options)),this.sampleRate=(Se=this.options.sampleRate)!==null&&Se!==void 0?Se:1,this.disableCookies=(xe=this.options.disableCookies)!==null&&xe!==void 0&&xe,this.respectDoNotTrack=(it=this.options.respectDoNotTrack)!==null&&it!==void 0&&it,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:(w=this.options.platform)===null||w===void 0?void 0:w.name,viewer_application_version:(D=this.options.platform)===null||D===void 0?void 0:D.version,viewer_application_engine:(P=this.options.platform)===null||P===void 0?void 0:P.layout,viewer_device_name:(C=this.options.platform)===null||C===void 0?void 0:C.product,viewer_device_category:"",viewer_device_manufacturer:(U=this.options.platform)===null||U===void 0?void 0:U.manufacturer,viewer_os_family:(X=this.options.platform)===null||X===void 0||(j=X.os)===null||j===void 0?void 0:j.family,viewer_os_architecture:(te=this.options.platform)===null||te===void 0||(se=te.os)===null||se===void 0?void 0:se.architecture,viewer_os_version:(K=this.options.platform)===null||K===void 0||(de=K.os)===null||de===void 0?void 0:de.version,viewer_connection_type:qr(),page_url:dr.default===null||dr.default===void 0||(ie=dr.default.location)===null||ie===void 0?void 0:ie.href},this.viewerData=this.disableCookies?{}:bn()}return Ni(I,[{key:"send",value:function(T,E){if(T&&E!=null&&E.view_id){if(this.respectDoNotTrack&&Or())return rt.info("Not sending `"+T+"` because Do Not Track is enabled");if(!E||typeof E!="object")return rt.error("A data object was expected in send() but was not provided");var w=this.disableCookies?{}:function(){var j=En(),X=pt.now();return j.session_start&&(j.sst=j.session_start,delete j.session_start),j.session_id&&(j.sid=j.session_id,delete j.session_id),j.session_expires&&(j.sex=j.session_expires,delete j.session_expires),(!j.sex||j.sex<X)&&(j.sid=Ai(),j.sst=X),j.sex=X+15e5,Li(j),{session_id:j.sid,session_start:j.sst,session_expires:j.sex}}(),D=zi(Bt({},this.pageLevelData,E,w,this.viewerData),{event:T,env_key:this.envKey});D.user_id&&(D.viewer_user_id=D.user_id,delete D.user_id);var P,C=((P=D.mux_sample_number)!==null&&P!==void 0?P:0)>=this.sampleRate,U=hi(this._deduplicateBeaconData(T,D));if(this.lastEventTime=this.mux.utils.now(),C)return rt.info("Not sending event due to sample rate restriction",T,D,U);if(this.envKey||rt.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",T,D,U),!this.rateLimited){if(rt.info("Sending event",T,D,U),this.rateLimited=!this.eventQueue.queueEvent(T,U),this.mux.WINDOW_UNLOADING&&T==="viewend")this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&T==="hb"?this.eventQueue.flushEvents(!0):An.indexOf(T)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return D.event="eventrateexceeded",U=hi(D),this.eventQueue.queueEvent(D.event,U),rt.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(T,E){var w=this,D={},P=E.view_id;if(P==="-1"||T==="viewstart"||T==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)D=Bt({},E),P&&(this.previousBeaconData=D),P&&T==="viewend"&&(this.previousBeaconData=null);else{var C=T.indexOf("request")===0;Object.entries(E).forEach(function(U){var j=ve(U,2),X=j[0],se=j[1];w.previousBeaconData&&(se!==w.previousBeaconData[X]||Wr.indexOf(X)>-1||w.objectHasChanged(C,X,se,w.previousBeaconData[X])||w.eventRequiresKey(T,X))&&(D[X]=se,w.previousBeaconData[X]=se)})}return D}},{key:"objectHasChanged",value:function(T,E,w,D){return!(!T||E.indexOf("request_")!==0)&&(E==="request_response_headers"||typeof w!="object"||typeof D!="object"||Object.keys(w||{}).length!==Object.keys(D||{}).length)}},{key:"eventRequiresKey",value:function(T,E){return!!(T==="renditionchange"&&E.indexOf("video_source_")===0||ji.includes(E)&&fr.includes(T))}}]),I}(),Yr=function I(T){Gt(this,I);var E=0,w=0,D=0,P=0,C=0,U=0,j=0;T.on("requestcompleted",function(X,se){var te,de,K=se.request_start,ie=se.request_response_start,Se=se.request_response_end,xe=se.request_bytes_loaded;if(P++,ie?(te=ie-(K!=null?K:0),de=(Se!=null?Se:0)-ie):de=(Se!=null?Se:0)-(K!=null?K:0),de>0&&xe&&xe>0){var it=xe/de*8e3;C++,w+=xe,D+=de,T.data.view_min_request_throughput=Math.min(T.data.view_min_request_throughput||1/0,it),T.data.view_average_request_throughput=w/D*8e3,T.data.view_request_count=P,te>0&&(E+=te,T.data.view_max_request_latency=Math.max(T.data.view_max_request_latency||0,te),T.data.view_average_request_latency=E/C)}}),T.on("requestfailed",function(X,se){P++,U++,T.data.view_request_count=P,T.data.view_request_failed_count=U}),T.on("requestcanceled",function(X,se){P++,j++,T.data.view_request_count=P,T.data.view_request_canceled_count=j})},Ln=function I(T){var E=this;Gt(this,I),Ee(this,"_lastEventTime",void 0),T.on("before*",function(w,D){var P=D.viewer_time,C=pt.now(),U=E._lastEventTime;if(E._lastEventTime=C,U&&C-U>36e5){var j=Object.keys(T.data).reduce(function(se,te){return te.indexOf("video_")===0?Object.assign(se,Ee({},te,T.data[te])):se},{});T.mux.log.info("Received event after at least an hour inactivity, creating a new view");var X=T.playbackHeartbeat._playheadShouldBeProgressing;T._resetView(Object.assign({viewer_time:P},j)),T.playbackHeartbeat._playheadShouldBeProgressing=X,T.playbackHeartbeat._playheadShouldBeProgressing&&w.type!=="play"&&w.type!=="adbreakstart"&&(T.emit("play",{viewer_time:P}),w.type!=="playing"&&T.emit("playing",{viewer_time:P}))}})};function Hs(I,T){return(I==null?void 0:I.toLowerCase())===(T==null?void 0:T.toLowerCase())}var Gs=function I(T){Gt(this,I);var E=function(U){var j=function(te){var de;return te!=null&&te.request_type&&(te.request_type==="media"||te.request_type==="video")&&(de=te.request_response_headers)!==null&&de!==void 0&&de["x-cdn"]?te.request_response_headers["x-cdn"]:te!=null&&te.video_cdn?te.video_cdn:null}(U),X=function(te){return te!=null&&te.request_start?te.request_start:te!=null&&te.viewer_time?te.viewer_time:Date.now()}(U);if(j!=null&&!Hs(j,P)&&C<=X){P=j,C=X;var se={video_cdn:j};T.emit("cdnchange",se)}},w=null,D=null,P=null,C=0;T.on("viewinit",function(){w=null,D=null,P=null,C=0}),T.on("beforecdnchange",function(U,j){var X=j==null?void 0:j.video_cdn;X&&(j.video_previous_cdn===void 0||j.video_previous_cdn===null)&&(Hs(X,D)?j.video_previous_cdn=w!=null?w:void 0:(j.video_previous_cdn=D!=null?D:void 0,w=D,D=X))}),T.on("requestcompleted",function(U,j){E(j)})},kt=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange","cdnchange"],aa=new Set(["requestcompleted","requestfailed","requestcanceled"]),Ri=function(I){(function(w,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(D&&D.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),D&&er(w,D)})(E,I);var T=mi(E);function E(w,D,P){var C;Gt(this,E),Ee(et(C=T.call(this)),"pageLoadEndTime",void 0),Ee(et(C),"pageLoadInitTime",void 0),Ee(et(C),"_destroyed",void 0),Ee(et(C),"_heartBeatTimeout",void 0),Ee(et(C),"adTracker",void 0),Ee(et(C),"dashjs",void 0),Ee(et(C),"data",void 0),Ee(et(C),"disablePlayheadRebufferTracking",void 0),Ee(et(C),"disableRebufferTracking",void 0),Ee(et(C),"errorTracker",void 0),Ee(et(C),"errorTranslator",void 0),Ee(et(C),"emitTranslator",void 0),Ee(et(C),"getAdData",void 0),Ee(et(C),"getPlayheadTime",void 0),Ee(et(C),"getStateData",void 0),Ee(et(C),"stateDataTranslator",void 0),Ee(et(C),"hlsjs",void 0),Ee(et(C),"id",void 0),Ee(et(C),"longResumeTracker",void 0),Ee(et(C),"minimumRebufferDuration",void 0),Ee(et(C),"mux",void 0),Ee(et(C),"playbackEventDispatcher",void 0),Ee(et(C),"playbackHeartbeat",void 0),Ee(et(C),"playbackHeartbeatTime",void 0),Ee(et(C),"playheadTime",void 0),Ee(et(C),"seekingTracker",void 0),Ee(et(C),"sustainedRebufferThreshold",void 0),Ee(et(C),"watchTimeTracker",void 0),Ee(et(C),"currentFragmentPDT",void 0),Ee(et(C),"currentFragmentStart",void 0),C.pageLoadInitTime=Br.navigationStart(),C.pageLoadEndTime=Br.domContentLoadedEventEnd();var U={debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(te){return te},emitTranslator:function(){for(var te=arguments.length,de=new Array(te),K=0;K<te;K++)de[K]=arguments[K];return de},stateDataTranslator:function(te){return te}};C.mux=w,C.id=D,P!=null&&P.beaconDomain&&C.mux.log.warn("The `beaconDomain` setting has been deprecated in favor of `beaconCollectionDomain`. Please change your integration to use `beaconCollectionDomain` instead of `beaconDomain`."),(P=Object.assign(U,P)).data=P.data||{},P.data.property_key&&(P.data.env_key=P.data.property_key,delete P.data.property_key),rt.level=P.debug?At:Ms,C.getPlayheadTime=P.getPlayheadTime,C.getStateData=P.getStateData||function(){return{}},C.getAdData=P.getAdData||function(){},C.minimumRebufferDuration=P.minimumRebufferDuration,C.sustainedRebufferThreshold=P.sustainedRebufferThreshold,C.playbackHeartbeatTime=P.playbackHeartbeatTime,C.disableRebufferTracking=P.disableRebufferTracking,C.disableRebufferTracking&&C.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),C.disablePlayheadRebufferTracking=P.disablePlayheadRebufferTracking,C.errorTranslator=P.errorTranslator,C.emitTranslator=P.emitTranslator,C.stateDataTranslator=P.stateDataTranslator,C.playbackEventDispatcher=new pr(w,P.data.env_key,P),C.data={player_instance_id:Ai(),mux_sample_rate:P.sampleRate,beacon_domain:P.beaconCollectionDomain||P.beaconDomain},C.data.view_sequence_number=1,C.data.player_sequence_number=1;var j=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(et(C));if(C.on("viewinit",function(te,de){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,de),this._initializeViewData(),this.one("play",j),this.one("adbreakstart",j)}),C.on("videochange",function(te,de){this._resetView(de)}),C.on("programchange",function(te,de){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),this._resetView(Object.assign(de,{view_program_changed:!0})),j(),this.emit("play"),this.emit("playing")}),C.on("fragmentchange",function(te,de){this.currentFragmentPDT=de.currentFragmentPDT,this.currentFragmentStart=de.currentFragmentStart}),C.on("destroy",C.destroy),typeof window!="undefined"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var X=function(){var te=C.data.view_start!==void 0;C.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",te&&C.mux.WINDOW_HIDDEN&&(C.data.player_is_paused||C.emit("hb"))};window.addEventListener("visibilitychange",X,!1);var se=function(te){te.persisted||C.destroy()};window.addEventListener("pagehide",se,!1),C.on("destroy",function(){window.removeEventListener("visibilitychange",X),window.removeEventListener("pagehide",se)})}return C.on("playerready",function(te,de){Object.assign(this.data,de)}),kt.forEach(function(te){C.on(te,function(de,K){te.indexOf("ad")!==0&&this._updateStateData(),Object.assign(this.data,K),this._sanitizeData()}),C.on("after"+te,function(){(te!=="error"||this.errorTracker.viewErrored)&&this.send(te)})}),C.on("viewend",function(te,de){Object.assign(C.data,de)}),C.one("playerready",function(te){var de=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=de-this.data.player_init_time),this.pageLoadInitTime=this.data.page_load_init_time||this.pageLoadInitTime,this.pageLoadEndTime=this.data.page_load_end_time||this.pageLoadEndTime,!this.mux.PLAYER_TRACKED&&this.pageLoadInitTime&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.pageLoadEndTime)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.pageLoadEndTime||1/0)-this.pageLoadInitTime)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),C.longResumeTracker=new Ln(et(C)),C.errorTracker=new xr(et(C)),new vs(et(C)),C.seekingTracker=new Ns(et(C)),C.playheadTime=new Hr(et(C)),C.playbackHeartbeat=new yn(et(C)),new tr(et(C)),C.watchTimeTracker=new fi(et(C)),new $r(et(C)),C.adTracker=new Vr(et(C)),new _n(et(C)),new fs(et(C)),new Gr(et(C)),new hr(et(C)),new Yr(et(C)),new Gs(et(C)),P.hlsjs&&C.addHLSJS(P),P.dashjs&&C.addDashJS(P),C.emit("viewinit",P.data),C}return Ni(E,[{key:"emit",value:function(w,D){var P,C=Object.assign({viewer_time:this.mux.utils.now()},D),U=[w,C];if(this.emitTranslator)try{U=this.emitTranslator(w,C)}catch(j){this.mux.log.warn("Exception in emit translator callback.",j)}U!=null&&U.length&&(P=Rt(Yi(E.prototype),"emit",this)).call.apply(P,[this].concat(ii(U)))}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(w){if(this.data.view_id){var D=Object.assign({},this.data);if(D.video_source_is_live===void 0&&(D.player_source_duration===1/0||D.video_source_duration===1/0?D.video_source_is_live=!0:(D.player_source_duration>0||D.video_source_duration>0)&&(D.video_source_is_live=!1)),D.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(j){D[j]=void 0}),D.video_source_url=D.video_source_url||D.player_source_url,D.video_source_url){var P=ve(Fr(D.video_source_url),2),C=P[0],U=P[1];D.video_source_domain=U,D.video_source_hostname=C}delete D.ad_request_id,this.playbackEventDispatcher.send(w,D),this.data.view_sequence_number++,this.data.player_sequence_number++,aa.has(w)||this._restartHeartBeat(),w==="viewend"&&delete this.data.view_id}}},{key:"_resetView",value:function(w){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",w)}},{key:"_updateStateData",value:function(){var w,D=this.getStateData();if(typeof this.stateDataTranslator=="function")try{D=this.stateDataTranslator(D)}catch(P){this.mux.log.warn("Exception in stateDataTranslator translator callback.",P)}(w=this.data)!==null&&w!==void 0&&w.video_cdn&&D!=null&&D.video_cdn&&(D.video_cdn,D=Xt(D,["video_cdn"])),Object.assign(this.data,D),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var w=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(D){var P=parseInt(w.data[D],10);w.data[D]=isNaN(P)?void 0:P}),["player_source_url","video_source_url"].forEach(function(D){if(w.data[D]){var P=w.data[D].toLowerCase();(P.indexOf("data:")===0||P.indexOf("blob:")===0)&&(w.data[D]="MSE style URL")}})}},{key:"_resetVideoData",value:function(){var w=this;Object.keys(this.data).forEach(function(D){D.indexOf("video_")===0&&delete w.data[D]})}},{key:"_resetViewData",value:function(){var w=this;Object.keys(this.data).forEach(function(D){D.indexOf("view_")===0&&delete w.data[D]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(){delete this.data.player_error_code,delete this.data.player_error_message,delete this.data.player_error_context,delete this.data.player_error_severity,delete this.data.player_error_business_exception}},{key:"_initializeViewData",value:function(){var w=this,D=this.data.view_id=Ai(),P=function(){D===w.data.view_id&&Zt(w.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",P):P()}},{key:"_restartHeartBeat",value:function(){var w=this;window.clearTimeout(this._heartBeatTimeout),this._heartBeatTimeout=window.setTimeout(function(){w.data.player_is_paused||w.emit("hb")},1e4)}},{key:"addHLSJS",value:function(w){w.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=w.hlsjs,function(D,P,C){var U=arguments.length>4?arguments[4]:void 0,j=D.log,X=D.utils.secondsToMs,se=function(yt){var we,he=parseInt(U.version);return he===1&&yt.programDateTime!==null&&(we=yt.programDateTime),he===0&&yt.pdt!==null&&(we=yt.pdt),we};if(Br.exists()){var te=function(yt,we){return D.emit(P,yt,we)},de=function(yt,we){var he=we.levels,ae=we.audioTracks,Re=we.url,Ne=we.stats,nt=we.networkDetails,dt=we.sessionData,$t={},Ht={};he.forEach(function(Ei,qi){$t[qi]={width:Ei.width,height:Ei.height,bitrate:Ei.bitrate,attrs:Ei.attrs}}),ae.forEach(function(Ei,qi){Ht[qi]={name:Ei.name,language:Ei.lang,bitrate:Ei.bitrate}});var vt=Vi(Ne),Vt=vt.bytesLoaded,Qt=vt.requestStart,Xi=vt.responseStart,rs=vt.responseEnd;te("requestcompleted",zi(Bt({},ht(dt)),{request_event_type:yt,request_bytes_loaded:Vt,request_start:Qt,request_response_start:Xi,request_response_end:rs,request_type:"manifest",request_hostname:vi(Re),request_response_headers:xi(nt),request_rendition_lists:{media:$t,audio:Ht,video:{}}}))};C.on(U.Events.MANIFEST_LOADED,de);var K=function(yt,we){var he=we.details,ae=we.level,Re=we.networkDetails,Ne=we.stats,nt=Vi(Ne),dt=nt.bytesLoaded,$t=nt.requestStart,Ht=nt.responseStart,vt=nt.responseEnd,Vt=he.fragments[he.fragments.length-1],Qt=se(Vt)+X(Vt.duration);te("requestcompleted",{request_event_type:yt,request_bytes_loaded:dt,request_start:$t,request_response_start:Ht,request_response_end:vt,request_current_level:ae,request_type:"manifest",request_hostname:vi(he.url),request_response_headers:xi(Re),video_holdback:he.holdBack&&X(he.holdBack),video_part_holdback:he.partHoldBack&&X(he.partHoldBack),video_part_target_duration:he.partTarget&&X(he.partTarget),video_target_duration:he.targetduration&&X(he.targetduration),video_source_is_live:he.live,player_manifest_newest_program_time:isNaN(Qt)?void 0:Qt})};C.on(U.Events.LEVEL_LOADED,K);var ie=function(yt,we){var he=we.details,ae=we.networkDetails,Re=we.stats,Ne=Vi(Re),nt=Ne.bytesLoaded,dt=Ne.requestStart,$t=Ne.responseStart,Ht=Ne.responseEnd;te("requestcompleted",{request_event_type:yt,request_bytes_loaded:nt,request_start:dt,request_response_start:$t,request_response_end:Ht,request_type:"manifest",request_hostname:vi(he.url),request_response_headers:xi(ae)})};C.on(U.Events.AUDIO_TRACK_LOADED,ie);var Se=function(yt,we){var he=we.stats,ae=we.networkDetails,Re=we.frag;he=he||Re.stats;var Ne=Vi(he),nt=Ne.bytesLoaded,dt=Ne.requestStart,$t=Ne.responseStart,Ht=Ne.responseEnd,vt=ae?xi(ae):void 0,Vt={request_event_type:yt,request_bytes_loaded:nt,request_start:dt,request_response_start:$t,request_response_end:Ht,request_hostname:ae?vi(ae.responseURL):void 0,request_id:vt?Gi(vt):void 0,request_response_headers:vt,request_media_duration:Re.duration,request_url:ae==null?void 0:ae.responseURL};Re.type==="main"?(Vt.request_type="media",Vt.request_current_level=Re.level,Vt.request_video_width=(C.levels[Re.level]||{}).width,Vt.request_video_height=(C.levels[Re.level]||{}).height,Vt.request_labeled_bitrate=(C.levels[Re.level]||{}).bitrate):Vt.request_type=Re.type,te("requestcompleted",Vt)};C.on(U.Events.FRAG_LOADED,Se);var xe=function(yt,we){var he=we.frag,ae=he.start,Re={currentFragmentPDT:se(he),currentFragmentStart:X(ae)};te("fragmentchange",Re)};C.on(U.Events.FRAG_CHANGED,xe);var it=function(yt,we){var he=we.type,ae=we.details,Re=we.response,Ne=we.fatal,nt=we.frag,dt=we.networkDetails,$t=(nt==null?void 0:nt.url)||we.url||"",Ht=dt?xi(dt):void 0;if((ae===U.ErrorDetails.MANIFEST_LOAD_ERROR||ae===U.ErrorDetails.MANIFEST_LOAD_TIMEOUT||ae===U.ErrorDetails.FRAG_LOAD_ERROR||ae===U.ErrorDetails.FRAG_LOAD_TIMEOUT||ae===U.ErrorDetails.LEVEL_LOAD_ERROR||ae===U.ErrorDetails.LEVEL_LOAD_TIMEOUT||ae===U.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||ae===U.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT||ae===U.ErrorDetails.SUBTITLE_LOAD_ERROR||ae===U.ErrorDetails.SUBTITLE_LOAD_TIMEOUT||ae===U.ErrorDetails.KEY_LOAD_ERROR||ae===U.ErrorDetails.KEY_LOAD_TIMEOUT)&&te("requestfailed",{request_error:ae,request_url:$t,request_hostname:vi($t),request_id:Ht?Gi(Ht):void 0,request_type:ae===U.ErrorDetails.FRAG_LOAD_ERROR||ae===U.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":ae===U.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||ae===U.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":ae===U.ErrorDetails.SUBTITLE_LOAD_ERROR||ae===U.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":ae===U.ErrorDetails.KEY_LOAD_ERROR||ae===U.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:Re==null?void 0:Re.code,request_error_text:Re==null?void 0:Re.text}),Ne){var vt,Vt="".concat($t?"url: ".concat($t,`
`):"")+"".concat(Re&&(Re.code||Re.text)?"response: ".concat(Re.code,", ").concat(Re.text,`
`):"")+"".concat(we.reason?"failure reason: ".concat(we.reason,`
`):"")+"".concat(we.level?"level: ".concat(we.level,`
`):"")+"".concat(we.parent?"parent stream controller: ".concat(we.parent,`
`):"")+"".concat(we.buffer?"buffer length: ".concat(we.buffer,`
`):"")+"".concat(we.error?"error: ".concat(we.error,`
`):"")+"".concat(we.event?"event: ".concat(we.event,`
`):"")+"".concat(we.err?"error message: ".concat((vt=we.err)===null||vt===void 0?void 0:vt.message,`
`):"");te("error",{player_error_code:he,player_error_message:ae,player_error_context:Vt})}};C.on(U.Events.ERROR,it);var qt=function(yt,we){var he=we.frag,ae=he&&he._url||"";te("requestcanceled",{request_event_type:yt,request_url:ae,request_type:"media",request_hostname:vi(ae)})};C.on(U.Events.FRAG_LOAD_EMERGENCY_ABORTED,qt);var Mt=function(yt,we){var he=we.level,ae=C.levels[he];if(ae&&ae.attrs&&ae.attrs.BANDWIDTH){var Re,Ne=ae.attrs.BANDWIDTH,nt=parseFloat(ae.attrs["FRAME-RATE"]);isNaN(nt)||(Re=nt),Ne?te("renditionchange",{video_source_fps:Re,video_source_bitrate:Ne,video_source_width:ae.width,video_source_height:ae.height,video_source_rendition_name:ae.name,video_source_codec:ae==null?void 0:ae.videoCodec}):j.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};C.on(U.Events.LEVEL_SWITCHED,Mt),C._stopMuxMonitor=function(){C.off(U.Events.MANIFEST_LOADED,de),C.off(U.Events.LEVEL_LOADED,K),C.off(U.Events.AUDIO_TRACK_LOADED,ie),C.off(U.Events.FRAG_LOADED,Se),C.off(U.Events.FRAG_CHANGED,xe),C.off(U.Events.ERROR,it),C.off(U.Events.FRAG_LOAD_EMERGENCY_ABORTED,qt),C.off(U.Events.LEVEL_SWITCHED,Mt),C.off(U.Events.DESTROYING,C._stopMuxMonitor),delete C._stopMuxMonitor},C.on(U.Events.DESTROYING,C._stopMuxMonitor)}else j.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,w.hlsjs,{},w.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){this.hlsjs&&(function(w){w&&typeof w._stopMuxMonitor=="function"&&w._stopMuxMonitor()}(this.hlsjs),this.hlsjs=void 0)}},{key:"addDashJS",value:function(w){w.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=w.dashjs,function(D,P,C){var U=D.log;if(C&&C.on){var j=Bi(C),X=function(he,ae){return D.emit(P,he,ae)},se=function(he){var ae=he.type,Re=(he.data||{}).url;X("requestcompleted",{request_event_type:ae,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:vi(Re),request_url:Re})};C.on("manifestLoaded",se);var te={},de=function(he){if(typeof he.getRequests!="function")return null;var ae=he.getRequests({state:"executed"});return ae.length===0?null:ae[ae.length-1]},K=function(he){var ae=he.type,Re=he.fragmentModel,Ne=he.chunk,nt=de(Re);ie({type:ae,request:nt,chunk:Ne})},ie=function(he){var ae=he.type,Re=he.chunk,Ne=he.request,nt=(Re||{}).mediaInfo||{},dt=nt.type,$t=nt.bitrateList,Ht={};($t=$t||[]).forEach(function(bi,si){Ht[si]={},Ht[si].width=bi.width,Ht[si].height=bi.height,Ht[si].bitrate=bi.bandwidth,Ht[si].attrs={}}),dt==="video"?te.video=Ht:dt==="audio"?te.audio=Ht:te.media=Ht;var vt=br(Ne,C),Vt=vt.requestStart,Qt=vt.requestResponseStart,Xi=vt.requestResponseEnd,rs=vt.requestResponseHeaders,Ei=vt.requestMediaDuration,qi=vt.requestHostname,Qs=vt.requestUrl,ss=vt.requestId;X("requestcompleted",{request_event_type:ae,request_start:Vt,request_response_start:Qt,request_response_end:Xi,request_bytes_loaded:-1,request_type:dt+"_init",request_response_headers:rs,request_hostname:qi,request_id:ss,request_url:Qs,request_media_duration:Ei,request_rendition_lists:te})};j>=4?C.on("initFragmentLoaded",ie):C.on("initFragmentLoaded",K);var Se=function(he){var ae=he.type,Re=he.fragmentModel,Ne=he.chunk,nt=de(Re);xe({type:ae,request:nt,chunk:Ne})},xe=function(he){var ae=he.type,Re=he.chunk,Ne=he.request,nt=Re||{},dt=nt.mediaInfo,$t=nt.start,Ht=(dt||{}).type,vt=br(Ne,C),Vt=vt.requestStart,Qt=vt.requestResponseStart,Xi=vt.requestResponseEnd,rs=vt.requestBytesLoaded,Ei=vt.requestResponseHeaders,qi=vt.requestMediaDuration,Qs=vt.requestHostname,ss=vt.requestUrl,bi=vt.requestId,si=Ur(Ht,C),Pn=si.currentLevel,On=si.renditionWidth,Js=si.renditionHeight,Ls=si.renditionBitrate;X("requestcompleted",{request_event_type:ae,request_start:Vt,request_response_start:Qt,request_response_end:Xi,request_bytes_loaded:rs,request_type:Ht,request_response_headers:Ei,request_hostname:Qs,request_id:bi,request_url:ss,request_media_start_time:$t,request_media_duration:qi,request_current_level:Pn,request_labeled_bitrate:Ls,request_video_width:On,request_video_height:Js})};j>=4?C.on("mediaFragmentLoaded",xe):C.on("mediaFragmentLoaded",Se);var it={video:void 0,audio:void 0,totalBitrate:void 0},qt=function(){if(it.video&&typeof it.video.bitrate=="number"){if(!it.video.width||!it.video.height)return void U.warn("have bitrate info for video but missing width/height");var he=it.video.bitrate;if(it.audio&&typeof it.audio.bitrate=="number"&&(he+=it.audio.bitrate),he!==it.totalBitrate)return it.totalBitrate=he,{video_source_bitrate:he,video_source_height:it.video.height,video_source_width:it.video.width,video_source_codec:vn(it.video.codec)}}},Mt=function(he,ae,Re){if(typeof he.newQuality=="number"){var Ne=he.mediaType;if(Ne==="audio"||Ne==="video"){var nt=C.getBitrateInfoListFor(Ne).find(function($t){return $t.qualityIndex===he.newQuality});if(!nt||typeof nt.bitrate!="number")return void U.warn("missing bitrate info for ".concat(Ne));it[Ne]=zi(Bt({},nt),{codec:C.getCurrentTrackFor(Ne).codec});var dt=qt();dt&&X("renditionchange",dt)}}else U.warn("missing evt.newQuality in qualityChangeRendered event",he)};C.on("qualityChangeRendered",Mt);var yt=function(he){var ae=he.request,Re=he.mediaType;X("requestcanceled",{request_event_type:(ae=ae||{}).type+"_"+ae.action,request_url:ae.url,request_type:Re,request_hostname:vi(ae.url)})};C.on("fragmentLoadingAbandoned",yt);var we=function(he){var ae,Re,Ne=he.error,nt=(Ne==null||(ae=Ne.data)===null||ae===void 0?void 0:ae.request)||{},dt=(Ne==null||(Re=Ne.data)===null||Re===void 0?void 0:Re.response)||{};(Ne==null?void 0:Ne.code)===27&&X("requestfailed",{request_error:nt.type+"_"+nt.action,request_url:nt.url,request_hostname:vi(nt.url),request_type:nt.mediaType,request_error_code:dt.status,request_error_text:dt.statusText});var $t="".concat(nt!=null&&nt.url?"url: ".concat(nt.url,`
`):"")+"".concat(dt!=null&&dt.status||dt!=null&&dt.statusText?"response: ".concat(dt==null?void 0:dt.status,", ").concat(dt==null?void 0:dt.statusText,`
`):"");X("error",{player_error_code:Ne==null?void 0:Ne.code,player_error_message:Ne==null?void 0:Ne.message,player_error_context:$t})};C.on("error",we),C._stopMuxMonitor=function(){C.off("manifestLoaded",se),C.off("initFragmentLoaded",ie),C.off("mediaFragmentLoaded",xe),C.off("qualityChangeRendered",Mt),C.off("error",we),C.off("fragmentLoadingAbandoned",yt),delete C._stopMuxMonitor}}else U.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,w.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){this.dashjs&&(function(w){w&&typeof w._stopMuxMonitor=="function"&&w._stopMuxMonitor()}(this.dashjs),this.dashjs=void 0)}}]),E}(cs),In=Ri,Ar=ge(Fe()),zr=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],wt={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},wi,Dt=ge(Ye());Dt.default&&Dt.default.WeakMap&&(wi=new WeakMap);var oa="#EXT-X-TARGETDURATION",gr="#EXT-X-PART-INF",la="#EXT-X-SERVER-CONTROL",Ts="#EXTINF",ce="#EXT-X-PROGRAM-DATE-TIME",ua="#EXT-X-VERSION",Vs="#EXT-X-SESSION-DATA",Lr=function(I){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(I),this.manifest};Lr.prototype.process=function(I){var T;for(this.buffer+=I,T=this.buffer.indexOf(`
`);T>-1;T=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,T)),this.buffer=this.buffer.substring(T+1)},Lr.prototype.processLine=function(I){var T=I.indexOf(":"),E=Es(I,T),w=E[0],D=E.length===2?di(E[1]):void 0;if(w[0]!=="#")this.currentUri.uri=w,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(w){case oa:if(!isFinite(D)||D<0)return;this.manifest.targetDuration=D,this.setHoldBack();break;case gr:Ti(this.manifest,E),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case la:Ti(this.manifest,E),this.setHoldBack();break;case Ts:D===0?this.currentUri.duration=.01:D>0&&(this.currentUri.duration=D);break;case ce:var P=D,C=new Date(P);this.manifest.dateTimeString||(this.manifest.dateTimeString=P,this.manifest.dateTimeObject=C),this.currentUri.dateTimeString=P,this.currentUri.dateTimeObject=C;break;case ua:Ti(this.manifest,E);break;case Vs:var U=Ks(E[1]),j=ht(U);Object.assign(this.manifest.sessionData,j)}},Lr.prototype.setHoldBack=function(){var I=this.manifest,T=I.serverControl,E=I.targetDuration,w=I.partTargetDuration;if(T){var D="holdBack",P="partHoldBack",C=E&&3*E,U=w&&2*w;E&&!T.hasOwnProperty(D)&&(T[D]=C),C&&T[D]<C&&(T[D]=C),w&&!T.hasOwnProperty(P)&&(T[P]=3*w),w&&T[P]<U&&(T[P]=U)}};var Ti=function(I,T){var E,w=js(T[0].replace("#EXT-X-",""));Ci(T[1])?(E={},E=Object.assign(Cr(T[1]),E)):E=di(T[1]),I[w]=E},js=function(I){return I.toLowerCase().replace(/-(\w)/g,function(T){return T[1].toUpperCase()})},di=function(I){if(I.toLowerCase()==="yes"||I.toLowerCase()==="no")return I.toLowerCase()==="yes";var T=I.indexOf(":")!==-1?I:parseFloat(I);return isNaN(T)?I:T},Ir=function(I){var T={},E=I.split("=");return E.length>1&&(T[js(E[0])]=di(E[1])),T},Cr=function(I){for(var T=I.split(","),E={},w=0;T.length>w;w++){var D=T[w],P=Ir(D);E=Object.assign(P,E)}return E},Ci=function(I){return I.indexOf("=")>-1},Es=function(I,T){return T===-1?[I]:[I.substring(0,T),I.substring(T+1)]},Ks=function(I){var T={};if(I){var E=I.search(",");return[I.slice(0,E),I.slice(E+1)].forEach(function(w,D){for(var P=w.replace(/['"]+/g,"").split("="),C=0;C<P.length;C++)P[C]==="DATA-ID"&&(T["DATA-ID"]=P[1-C]),P[C]==="VALUE"&&(T.VALUE=P[1-C])}),{data:T}}},Cn=Lr,Xr={safeCall:function(I,T,E,w){var D=w;if(I&&typeof I[T]=="function")try{D=I[T].apply(I,E)}catch(P){rt.info("safeCall error",P)}return D},safeIncrement:Zt,getComputedStyle:function(I,T){return I&&T&&Dt.default&&typeof Dt.default.getComputedStyle=="function"?(wi&&wi.has(I)&&(E=wi.get(I)),E||(E=Dt.default.getComputedStyle(I,null),wi&&wi.set(I,E)),E.getPropertyValue(T)):"";var E},secondsToMs:function(I){return Math.floor(1e3*I)},assign:Object.assign,headersStringToObject:Tt,cdnHeadersToRequestId:Gi,extractHostnameAndDomain:Fr,extractHostname:vi,manifestParser:Cn,generateShortID:Ot,generateUUID:Ai,now:pt.now,findMediaElement:Si},qs={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled",HEARTBEAT:"hb",DESTROY:"destroy"},ft={},Kt=function(I){var T=arguments;typeof I=="string"?Kt.hasOwnProperty(I)?xt.default.setTimeout(function(){T=Array.prototype.splice.call(T,1),Kt[I].apply(null,T)},0):rt.warn("`"+I+"` is an unknown task"):typeof I=="function"?xt.default.setTimeout(function(){I(Kt)},0):rt.warn("`"+I+"` is invalid.")},ca={loaded:pt.now(),NAME:"mux-embed",VERSION:"5.11.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(I,T){return function(E,w,D){var P=ve(Si(w),3),C=P[0],U=P[1],j=P[2],X=E.log,se=E.utils.getComputedStyle,te=E.utils.secondsToMs;if(!C)return X.error("No element was found with the `"+U+"` query selector.");if(j!=="video"&&j!=="audio")return X.error("The element of `"+U+"` was not a media element.");C.mux&&(C.mux.destroy(),delete C.mux,X.warn("Already monitoring this video element, replacing existing event listeners"));var de={getPlayheadTime:function(){return te(C.currentTime)},getStateData:function(){var ie,Se,xe=((ie=this.getPlayheadTime)===null||ie===void 0?void 0:ie.call(this))||te(C.currentTime),it=this.hlsjs&&this.hlsjs.url,qt=this.dashjs&&typeof this.dashjs.getSource=="function"&&this.dashjs.getSource(),Mt={player_is_paused:C.paused,player_width:parseInt(se(C,"width")),player_height:parseInt(se(C,"height")),player_autoplay_on:C.autoplay,player_preload_on:C.preload,player_language_code:C.lang,player_is_fullscreen:Ar.default&&!!(Ar.default.fullscreenElement||Ar.default.webkitFullscreenElement||Ar.default.mozFullScreenElement||Ar.default.msFullscreenElement),video_poster_url:C.poster,video_source_url:it||qt||C.currentSrc,video_source_duration:te(C.duration),video_source_height:C.videoHeight,video_source_width:C.videoWidth,view_dropped_frame_count:C==null||(Se=C.getVideoPlaybackQuality)===null||Se===void 0?void 0:Se.call(C).droppedVideoFrames};if(C.getStartDate&&xe>0){var yt=C.getStartDate();if(yt&&typeof yt.getTime=="function"&&yt.getTime()){var we=yt.getTime();if(Mt.player_program_time=we+xe,C.seekable.length>0){var he=we+C.seekable.end(C.seekable.length-1);Mt.player_live_edge_program_time=he}}}return Mt}};(D=Object.assign({automaticErrorTracking:!0},D,de)).data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:E.VERSION},D.data),C.mux=C.mux||{},C.mux.deleted=!1,C.mux.emit=function(ie,Se){E.emit(U,ie,Se)},C.mux.updateData=function(ie){C.mux.emit("hb",ie)};var K=function(){X.error("The monitor for this video element has already been destroyed.")};C.mux.destroy=function(){Object.keys(C.mux.listeners).forEach(function(ie){C.removeEventListener(ie,C.mux.listeners[ie],!1)}),delete C.mux.listeners,C.mux.destroy=K,C.mux.swapElement=K,C.mux.emit=K,C.mux.addHLSJS=K,C.mux.addDashJS=K,C.mux.removeHLSJS=K,C.mux.removeDashJS=K,C.mux.updateData=K,C.mux.setEmitTranslator=K,C.mux.setStateDataTranslator=K,C.mux.setGetPlayheadTime=K,C.mux.deleted=!0,E.emit(U,"destroy")},C.mux.swapElement=function(ie){var Se=ve(Si(ie),3),xe=Se[0],it=Se[1],qt=Se[2];return xe?qt!=="video"&&qt!=="audio"?E.log.error("The element of `"+it+"` was not a media element."):(xe.muxId=C.muxId,delete C.muxId,xe.mux=xe.mux||{},xe.mux.listeners=Object.assign({},C.mux.listeners),delete C.mux.listeners,Object.keys(xe.mux.listeners).forEach(function(Mt){C.removeEventListener(Mt,xe.mux.listeners[Mt],!1),xe.addEventListener(Mt,xe.mux.listeners[Mt],!1)}),xe.mux.swapElement=C.mux.swapElement,xe.mux.destroy=C.mux.destroy,delete C.mux,void(C=xe)):E.log.error("No element was found with the `"+it+"` query selector.")},C.mux.addHLSJS=function(ie){E.addHLSJS(U,ie)},C.mux.addDashJS=function(ie){E.addDashJS(U,ie)},C.mux.removeHLSJS=function(){E.removeHLSJS(U)},C.mux.removeDashJS=function(){E.removeDashJS(U)},C.mux.setEmitTranslator=function(ie){E.setEmitTranslator(U,ie)},C.mux.setStateDataTranslator=function(ie){E.setStateDataTranslator(U,ie)},C.mux.setGetPlayheadTime=function(ie){ie||(ie=D.getPlayheadTime),E.setGetPlayheadTime(U,ie)},E.init(U,D),E.emit(U,"playerready"),C.paused||(E.emit(U,"play"),C.readyState>2&&E.emit(U,"playing")),C.mux.listeners={},zr.forEach(function(ie){ie==="error"&&!D.automaticErrorTracking||(C.mux.listeners[ie]=function(){var Se={};if(ie==="error"){if(!C.error||C.error.code===1)return;Se.player_error_code=C.error.code,Se.player_error_message=wt[C.error.code]||C.error.message}E.emit(U,ie,Se)},C.addEventListener(ie,C.mux.listeners[ie],!1))})}(Kt,I,T)},destroyMonitor:function(I){var T=ve(Si(I),1)[0];T&&T.mux&&typeof T.mux.destroy=="function"?T.mux.destroy():rt.error("A video element monitor for `"+I+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(I,T){var E=zt(I);ft[E]?ft[E].addHLSJS(T):rt.error("A monitor for `"+E+"` has not been initialized.")},addDashJS:function(I,T){var E=zt(I);ft[E]?ft[E].addDashJS(T):rt.error("A monitor for `"+E+"` has not been initialized.")},removeHLSJS:function(I){var T=zt(I);ft[T]?ft[T].removeHLSJS():rt.error("A monitor for `"+T+"` has not been initialized.")},removeDashJS:function(I){var T=zt(I);ft[T]?ft[T].removeDashJS():rt.error("A monitor for `"+T+"` has not been initialized.")},init:function(I,T){Or()&&T&&T.respectDoNotTrack&&rt.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var E=zt(I);ft[E]=new In(Kt,E,T)},emit:function(I,T,E){var w=zt(I);ft[w]?(ft[w].emit(T,E),T==="destroy"&&delete ft[w]):rt.error("A monitor for `"+w+"` has not been initialized.")},updateData:function(I,T){var E=zt(I);ft[E]?ft[E].emit("hb",T):rt.error("A monitor for `"+E+"` has not been initialized.")},setEmitTranslator:function(I,T){var E=zt(I);ft[E]?ft[E].emitTranslator=T:rt.error("A monitor for `"+E+"` has not been initialized.")},setStateDataTranslator:function(I,T){var E=zt(I);ft[E]?ft[E].stateDataTranslator=T:rt.error("A monitor for `"+E+"` has not been initialized.")},setGetPlayheadTime:function(I,T){var E=zt(I);ft[E]?ft[E].getPlayheadTime=T:rt.error("A monitor for `"+E+"` has not been initialized.")},checkDoNotTrack:Or,log:rt,utils:Xr,events:qs,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(Kt,ca),xt.default!==void 0&&typeof xt.default.addEventListener=="function"&&xt.default.addEventListener("pagehide",function(I){I.persisted||(Kt.WINDOW_UNLOADING=!0)},!1);var jt=Kt;/*!
* JavaScript Cookie v2.1.3
* https://github.com/js-cookie/js-cookie
*
* Copyright 2006, 2015 Klaus Hartl & Fagner Brack
* Released under the MIT license
*/var ri=jt.utils.secondsToMs;function bs(I,T){var E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],D=arguments.length>4&&arguments[4]!==void 0?arguments[4]:function(){return{}},P=!1;I.on("adstart",function(){P=!0}),I.on("adend",function(){P=!1}),I.on("adserror",function(){P=!1});var C=function(){var U=ri(T.currentTime()),j=function se(){var te=jt.utils.now(),de=ri(T.currentTime());if(P){if(de>U){var K=D();K.viewer_time=te-Math.max(0,de-U),T.off("timeupdate",se),I.mux.emit("adplaying",K)}}else T.off("timeupdate",se)};T.on("timeupdate",j);var X=function se(){T.off("timeupdate",j),E.forEach(function(te){T.off(te,se)})};E.forEach(function(se){T.on(se,X)})};w.forEach(function(U){T.on(U,C)})}function Qr(I){if(typeof I!="string")return!1;var T=I.split(".").map(function(D){return parseInt(D)}),E=T[0],w=T[1];return E>2||E===2&&w>=3}var mr=jt.utils.manifestParser;function Ws(I,T){return function(E){if(Array.isArray(E))return E}(I)||function(E,w){var D=E==null?null:typeof Symbol!="undefined"&&E[Symbol.iterator]||E["@@iterator"];if(D!=null){var P,C,U=[],j=!0,X=!1;try{for(D=D.call(E);!(j=(P=D.next()).done)&&(U.push(P.value),!w||U.length!==w);j=!0);}catch(se){X=!0,C=se}finally{try{j||D.return==null||D.return()}finally{if(X)throw C}}return U}}(I,T)||function(E,w){if(E){if(typeof E=="string")return Ki(E,w);var D=Object.prototype.toString.call(E).slice(8,-1);if(D==="Object"&&E.constructor&&(D=E.constructor.name),D==="Map"||D==="Set")return Array.from(E);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return Ki(E,w)}}(I,T)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ki(I,T){(T==null||T>I.length)&&(T=I.length);for(var E=0,w=new Array(T);E<T;E++)w[E]=I[E];return w}var kn=jt.utils,Rn=kn.assign,Jr=kn.secondsToMs;function wn(I,T,E){var w=0;return function(){var D,P=T.readyState;if(P>=2){if(w=w||jt.utils.now(),P!==4)return;var C=I(),U=C.mux.utils.extractHostnameAndDomain,j=C.mux.utils.headersStringToObject,X=jt.utils.now(),se=Ws(U(T.responseURL),1)[0],te=T.responseType==="arraybuffer"?T.response.byteLength:T.responseText.length,de=j(T.getAllResponseHeaders?T.getAllResponseHeaders():""),K=function(nt){var dt=nt["content-type"];return dt?dt.match(/^audio\/mpegurl/i)?"manifest":dt.match(/^audio.*/i)?"audio":dt.match(/^video.*/)?"video":dt.match(/^application\/x-mpegurl/i)||dt.match(/^application\/vnd.apple.mpegurl/i)||dt.match(/^application\/dash+xml/i)?"manifest":"unknown":"unknown"}(de);if(T.status>=200&&T.status<300){var ie={request_start:E,request_response_start:w,request_response_end:X,request_bytes_loaded:te,request_hostname:se,request_url:T.responseURL,request_response_headers:de,request_type:K};if(K==="manifest"){var Se,xe,it,qt,Mt,yt,we,he=(D=T.responseText,new mr(D));if(he){Se=he.partTargetDuration,xe=he.targetDuration,it=he.segments;var ae=he.serverControl;qt=ae.partHoldBack,Mt=ae.holdBack,we=he.sessionData;var Re=it[it.length-1];Re&&Re.dateTimeObject&&(yt=Re.dateTimeObject.getTime()+Jr(Re.duration)),ie=Rn(ie,{video_holdback:Mt&&Jr(Mt),video_part_holdback:qt&&Jr(qt),video_part_target_duration:Se&&Jr(Se),video_target_duration:xe&&Jr(xe),player_manifest_newest_program_time:yt}),we&&(ie=Rn(ie,we))}}C.mux.emit("requestcompleted",ie)}else{var Ne={request_hostname:Ws(U(T.responseURL),1)[0],request_url:T.responseURL,request_type:K};C.mux.emit("requestfailed",Ne)}}}}function Ys(I,T){var E,w=function(D){return function(P){var C=jt.utils.now();try{D(P)}catch(U){}try{P.onreadystatechange=function(U,j,X){var se=wn(I,U,j);return function(){try{se()}catch(te){}try{X()}catch(te){}}}(P,C,P.onreadystatechange||function(){})}catch(U){}}};typeof(T==null?void 0:T.onRequest)=="function"?T.onRequest(function(D){return D.beforeSend=w(D.beforeSend||function(){}),D}):T.beforeRequest=(E=T.beforeRequest||function(D){return D},function(D){var P=E(D);return P?(P.beforeSend=w(P.beforeSend||function(){}),P):D})}var zs=function(I){var T,E=function(w){for(var D,P=w.textTracks(),C=0;C<P.length;C++)P[C].label==="segment-metadata"&&(D=P[C]);return D}(I);E&&E.on&&E.on("cuechange",function(){try{var w=I.tech({IWillNotUseThisInPlugins:!0}),D=(w.vhs||w.hls).playlists.media().attributes.BANDWIDTH;T!==D&&I.mux.emit("renditionchange",{video_source_bitrate:D}),T=D}catch(P){I.mux&&I.mux.log&&I.mux.log.warn&&I.mux.log.warn("Cannot retrieve BANDWIDTH information from player: ".concat(P))}})};function Ss(I,T){return function(E){if(Array.isArray(E))return E}(I)||function(E,w){var D=E==null?null:typeof Symbol!="undefined"&&E[Symbol.iterator]||E["@@iterator"];if(D!=null){var P,C,U=[],j=!0,X=!1;try{for(D=D.call(E);!(j=(P=D.next()).done)&&(U.push(P.value),!w||U.length!==w);j=!0);}catch(se){X=!0,C=se}finally{try{j||D.return==null||D.return()}finally{if(X)throw C}}return U}}(I,T)||function(E,w){if(E){if(typeof E=="string")return Zr(E,w);var D=Object.prototype.toString.call(E).slice(8,-1);if(D==="Object"&&E.constructor&&(D=E.constructor.name),D==="Map"||D==="Set")return Array.from(E);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return Zr(E,w)}}(I,T)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Zr(I,T){(T==null||T>I.length)&&(T=I.length);for(var E=0,w=new Array(T);E<T;E++)w[E]=I[E];return w}var es=new Map,vr,xs=jt.log,Xs=jt.utils.assign,Ut=jt.utils.safeCall,As=jt.utils.getComputedStyle,ts=jt.utils.secondsToMs,is=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"];function Dn(I){var T=I;return function(E){var w,D;if(T.IS_IE8)return!1;var P=this,C=P.id(),U=((w=P.tech)===null||w===void 0||(D=w.call(P,!0))===null||D===void 0?void 0:D.el())||P.tag,j=vr&&(vr.get(U)||vr.get(P.el()));(E=Xs({automaticErrorTracking:!0},E)).data=Xs({player_software_name:"Video.js",player_software_version:T.VERSION||"< 4.11",player_mux_plugin_name:"videojs-mux",player_mux_plugin_version:"4.21.10",player_init_time:j},E.data),E.getPlayheadTime=function(){return ts(P.currentTime())},E.getStateData=function(){var K=Ut(P,"videoHeight"),ie=Ut(P,"videoWidth");if(ie===void 0||K===void 0){var Se=P.el().firstChild;Se&&Se.nodeName.toUpperCase()==="VIDEO"&&(K=Se.videoHeight,ie=Se.videoWidth)}return{player_is_paused:Ut(P,"paused"),player_is_fullscreen:Ut(P,"isFullscreen"),player_autoplay_on:!!Ut(P,"autoplay"),player_preload_on:Ut(P,"preload"),player_width:parseInt(As(P.el(),"width"),10),player_height:parseInt(As(P.el(),"height"),10),player_language_code:Ut(P,"language"),video_poster_url:Ut(P,"poster"),video_source_url:Ut(P,"currentSrc"),video_source_mime_type:Ut(P,"currentType")&&Ut(P,"currentType").toLowerCase(),video_source_duration:ts(Ut(P,"duration")||0),video_source_is_live:P.duration()===1/0,video_source_height:K,video_source_width:ie}},P.mux=function(){xs.error("[videojs-mux] The plugin was initialized more than once.")},P.mux.emit=function(K,ie){jt.emit(C,K,ie)},P.mux.updateData=function(K){P.mux.emit("hb",K)},P.mux.addHLSJS=function(K){jt.addHLSJS(C,K)},P.mux.log=xs,P.mux.utils=jt.utils,jt.init(C,E);var X=!1,se=function(){X||P.mux.emit("playerready"),X=!0};P.ready(function(){P.addClass("vjs-mux"),ut().setTimeout(se,0)});var te=!1;P.one("play",se),is.forEach(function(K){(K!=="error"||E.automaticErrorTracking)&&P.on(K,function(){if(!te){var ie={};if(K==="error"){var Se=Ut(P,"error");if(Se){if(Se.code===1)return;ie={player_error_code:Se.code,player_error_message:Se.message,player_error_context:Se.status}}}P.mux.emit(K,ie)}})});var de=!1;P.on("play",function(){de=!0}),P.on("pause",function(){de=!1}),P.on("adstart",function(){te=!0,de&&P.mux.emit("pause"),P.mux.emit("adbreakstart")}),P.on("adend",function(){P.mux.emit("adbreakend"),te=!1,Ut(P,"paused")||(P.mux.emit("play"),de=!0,P.onceux&&P.mux.emit("playing"))}),P.ima&&function(K){var ie,Se,xe,it,qt,Mt,yt=function(ae){var Re=typeof(ae=ae||{}).getAdData=="function"?ae.getAdData():{},Ne=typeof ae.getAd=="function"?ae.getAd():{},nt=typeof Ne.getMediaUrl=="function"?Ne.getMediaUrl():Re.mediaUrl,dt=Re==null?void 0:Re.adId,$t=Re==null?void 0:Re.creativeId,Ht=Re==null?void 0:Re.universalAdIdValue,vt=K.ima.settings||{},Vt={};return nt&&(Vt.ad_asset_url=nt),vt.adTagUrl&&(Vt.ad_tag_url=vt.adTagUrl),dt&&(Vt.ad_id=dt),$t&&(Vt.ad_creative_id=$t),Ht&&(Vt.ad_universal_id=Ht),Vt};try{var we=window.google.ima.AdEvent.Type;ie=we.LOADED,Se=we.STARTED,xe=we.COMPLETE,it=we.PAUSED,qt=we.RESUMED,Mt=we.SKIPPED}catch(ae){ie="loaded",Se="start",xe="complete",it="pause",qt="resume",Mt="skip"}var he=0;K.mux.triggerAdRequest=function(){he++,K.mux.emit("adrequest",yt())},K.on("adsready",function(){var ae=K.ima.addEventListener||function(){};ae(ie,function(Re){var Ne=yt(Re);he>0&&(he--,K.mux.emit("adresponse",Ne)),K.mux.emit("adplay",Ne)}),ae(Se,function(Re){var Ne=yt(Re);K.mux.emit("adplaying",Ne)}),ae(qt,function(Re){var Ne=yt(Re);K.mux.emit("adplay",Ne),K.mux.emit("adplaying",Ne)}),ae(it,function(Re){var Ne=yt(Re);K.mux.emit("adpause",Ne)}),ae(xe,function(Re){var Ne=yt(Re);K.mux.emit("adended",Ne)}),ae(Mt,function(Re){var Ne=yt(Re);K.mux.emit("adended",Ne)}),K.on("adserror",function(){he>0&&(he--,K.mux.emit("adresponse")),K.mux.emit("aderror")})})}(P),P.onceux&&function(K){bs(K,K,["onceux-linearad-pause","onceux-linearad-skipped","onceux-linearad-complete","adserror"],["adstart","onceux-linearad-resume"]),K.on("adstart",function(){K.mux.emit("adplay")}),K.on("onceux-linearad-start",function(ie){ie.linearAd&&ie.linearAd.index>0&&(K.mux.emit("adplay"),K.mux.emit("adplaying"))}),K.on("onceux-linearad-resume",function(){K.mux.emit("adplay")}),K.on("onceux-linearad-pause",function(){K.mux.emit("adpause")}),K.on("onceux-linearad-complete",function(){K.mux.emit("adended")}),K.on("onceux-linearad-skipped",function(){K.mux.emit("adended")})}(P),P.ima3&&typeof P.ima3.ready=="function"&&function(K){var ie=function(){var it=K.ima3.currentAd,qt=K.ima3.settings,Mt={};return it&&(Mt.ad_asset_url=it.mediaUrl),qt&&(Mt.ad_tag_url=qt.serverUrl),Mt};if(Qr(K.ima3.version)){var Se=0,xe=function(){Se>0&&(Se--,K.mux.emit("adresponse",ie()))};K.on("ads-request",function(){Se++,K.mux.emit("adrequest",ie())}),K.on("ads-load",function(){xe(),K.mux.emit("adplay",ie())}),K.on("adserror",function(){xe(),K.mux.emit("aderror")}),K.on("ads-play",function(){K.mux.emit("adplay",ie())}),K.on("ads-pause",function(){K.mux.emit("adpause",ie())}),K.on("ads-ad-ended",function(){K.mux.emit("adended",ie())})}K.ima3.ready(function(){K.ima3.adPlayer?(Qr(K.ima3.version)||(K.ima3.adPlayer.on("play",function(){K.mux.emit("adplay")}),K.ima3.adPlayer.on("pause",function(){K.mux.emit("adpause")}),K.ima3.adPlayer.on("ended",function(){K.mux.emit("adended")})),bs(K,K.ima3.adPlayer,["pause","ended","adserror"],["play"],ie)):(K.mux.log("Legacy IMA3 plugin found, ad events may not track correctly."),K.on("ads-ad-started",function(){K.mux.emit("adplaying",ie())}),K.on("ads-play",function(){K.mux.emit("adplaying",ie())}))})}(P),P.FreeWheelPlugin&&P.FreeWheelPlugin.VERSION&&function(K){var ie=function(Se){var xe=K.FreeWheelPlugin,it={};switch(Se){case"adplay":case"adplaying":case"adpause":it.ad_asset_url=K.currentSrc()}return xe&&(it.ad_tag_url=xe.tech.toLowerCase()==="html5"?xe.settings.Html5.serverUrl:xe.settings.Flash.serverUrl),it};K.on("ads-request",function(){K.mux.emit("adrequest",ie("adrequest"))}),K.on("ads-load",function(){K.mux.emit("adresponse",ie("adresponse"))}),K.on("adserror",function(){K.mux.emit("aderror")}),K.on("ads-ad-started",function(){K.mux.emit("adplay",ie("adplay")),K.mux.emit("adplaying",ie("adplaying"))}),K.on("ads-play",function(){K.mux.emit("adplay",ie("adplay")),K.mux.emit("adplaying",ie("adplaying"))}),K.on("ads-pause",function(){K.mux.emit("adpause",ie("adpause"))}),K.on("ads-ad-ended",function(){K.mux.emit("adended",ie("adended"))}),K.on("adend",function(){K.mux.emit("play")})}(P),P.on("dispose",function(){P.mux.emit("destroy"),vr.delete(P)})}}function st(I){(I.registerPlugin||I.plugin||function(){jt.log.error("No valid method to register videojs plugin available.")})("mux",Dn(I)),function(T){if(!es.get(T)&&(es.set(T,"video.js ".concat(T.VERSION," initialized")),typeof T.getTech=="function"))for(var E=(T.getTech("Html5")||{}).sourceHandlers,w=T.Vhs||T.Hls,D=function(C){var U=E[C],j=U.handleSource;U.handleSource=function(X,se){var te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};w&&w.xhr&&Ys(function(){return T(se.el())},w.xhr);var de=j(X,se,te);if(de&&typeof de.xhr=="function")try{var K=Ss(T.VERSION.split("."),2),ie=K[0],Se=K[1];ie=parseInt(ie),Se=parseInt(Se);var xe=ie>=7&&Se>=4?de.player().id():de.player_.el_.parentNode.id;zs(T(xe))}catch(it){}return de}},P=0;P<E.length;P++)D(P)}(I)}vr=typeof WeakMap!="undefined"?new WeakMap:new Map,Et().hook&&Et().hook("beforesetup",function(I,T){return vr.set(I,jt.utils.now()),T}),st(Et())}(),_t}()})})()},913:(Te,Qe,Le)=>{var Me=typeof Le.g!="undefined"?Le.g:typeof window!="undefined"?window:{},ke=Le(542),_e;typeof document!="undefined"?_e=document:(_e=Me["__GLOBAL_DOCUMENT_CACHE@4"],_e||(_e=Me["__GLOBAL_DOCUMENT_CACHE@4"]=ke)),Te.exports=_e},919:(Te,Qe,Le)=>{var Me=Le(913),ke=Object.create||function(){function N(){}return function(W){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return N.prototype=W,new N}}();function _e(N,W){this.name="ParsingError",this.code=N.code,this.message=W||N.message}_e.prototype=ke(Error.prototype),_e.prototype.constructor=_e,_e.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function qe(N){function W(le,H,x,ye){return(le|0)*3600+(H|0)*60+(x|0)+(ye|0)/1e3}var be=N.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return be?be[3]?W(be[1],be[2],be[3].replace(":",""),be[4]):be[1]>59?W(be[1],be[2],0,be[4]):W(0,be[1],be[2],be[4]):null}function _t(){this.values=ke(null)}_t.prototype={set:function(N,W){!this.get(N)&&W!==""&&(this.values[N]=W)},get:function(N,W,be){return be?this.has(N)?this.values[N]:W[be]:this.has(N)?this.values[N]:W},has:function(N){return N in this.values},alt:function(N,W,be){for(var le=0;le<be.length;++le)if(W===be[le]){this.set(N,W);break}},integer:function(N,W){/^-?\d+$/.test(W)&&this.set(N,parseInt(W,10))},percent:function(N,W){var be;return(be=W.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(W=parseFloat(W),W>=0&&W<=100)?(this.set(N,W),!0):!1}};function Ue(N,W,be,le){var H=le?N.split(le):[N];for(var x in H)if(typeof H[x]=="string"){var ye=H[x].split(be);if(ye.length===2){var ue=ye[0].trim(),Ke=ye[1].trim();W(ue,Ke)}}}function ut(N,W,be){var le=N;function H(){var ue=qe(N);if(ue===null)throw new _e(_e.Errors.BadTimeStamp,"Malformed timestamp: "+le);return N=N.replace(/^[^\sa-zA-Z-]+/,""),ue}function x(ue,Ke){var Je=new _t;Ue(ue,function(Fe,me){switch(Fe){case"region":for(var ct=be.length-1;ct>=0;ct--)if(be[ct].id===me){Je.set(Fe,be[ct].region);break}break;case"vertical":Je.alt(Fe,me,["rl","lr"]);break;case"line":var ve=me.split(","),xt=ve[0];Je.integer(Fe,xt),Je.percent(Fe,xt)&&Je.set("snapToLines",!1),Je.alt(Fe,xt,["auto"]),ve.length===2&&Je.alt("lineAlign",ve[1],["start","center","end"]);break;case"position":ve=me.split(","),Je.percent(Fe,ve[0]),ve.length===2&&Je.alt("positionAlign",ve[1],["start","center","end"]);break;case"size":Je.percent(Fe,me);break;case"align":Je.alt(Fe,me,["start","center","end","left","right"]);break}},/:/,/\s/),Ke.region=Je.get("region",null),Ke.vertical=Je.get("vertical","");try{Ke.line=Je.get("line","auto")}catch(Fe){}Ke.lineAlign=Je.get("lineAlign","start"),Ke.snapToLines=Je.get("snapToLines",!0),Ke.size=Je.get("size",100);try{Ke.align=Je.get("align","center")}catch(Fe){Ke.align=Je.get("align","middle")}try{Ke.position=Je.get("position","auto")}catch(Fe){Ke.position=Je.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},Ke.align)}Ke.positionAlign=Je.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},Ke.align)}function ye(){N=N.replace(/^\s+/,"")}if(ye(),W.startTime=H(),ye(),N.substr(0,3)!=="-->")throw new _e(_e.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+le);N=N.substr(3),ye(),W.endTime=H(),ye(),x(N,W)}var We=Me.createElement&&Me.createElement("textarea"),Et={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},gt={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},gi={v:"title",lang:"lang"},Pe={rt:"ruby"};function Z(N,W){function be(){if(!W)return null;function xt(mt){return W=W.substr(mt.length),mt}var Jt=W.match(/^([^<]*)(<[^>]*>?)?/);return xt(Jt[1]?Jt[1]:Jt[2])}function le(xt){return We.innerHTML=xt,xt=We.textContent,We.textContent="",xt}function H(xt,Jt){return!Pe[Jt.localName]||Pe[Jt.localName]===xt.localName}function x(xt,Jt){var mt=Et[xt];if(!mt)return null;var pt=N.document.createElement(mt),Ai=gi[xt];return Ai&&Jt&&(pt[Ai]=Jt.trim()),pt}for(var ye=N.document.createElement("div"),ue=ye,Ke,Je=[];(Ke=be())!==null;){if(Ke[0]==="<"){if(Ke[1]==="/"){Je.length&&Je[Je.length-1]===Ke.substr(2).replace(">","")&&(Je.pop(),ue=ue.parentNode);continue}var Fe=qe(Ke.substr(1,Ke.length-2)),me;if(Fe){me=N.document.createProcessingInstruction("timestamp",Fe),ue.appendChild(me);continue}var ct=Ke.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!ct||(me=x(ct[1],ct[3]),!me)||!H(ue,me))continue;if(ct[2]){var ve=ct[2].split(".");ve.forEach(function(xt){var Jt=/^bg_/.test(xt),mt=Jt?xt.slice(3):xt;if(gt.hasOwnProperty(mt)){var pt=Jt?"background-color":"color",Ai=gt[mt];me.style[pt]=Ai}}),me.className=ve.join(" ")}Je.push(ct[1]),ue.appendChild(me),ue=me;continue}ue.appendChild(N.document.createTextNode(le(Ke)))}return ye}var oe=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function Wt(N){for(var W=0;W<oe.length;W++){var be=oe[W];if(N>=be[0]&&N<=be[1])return!0}return!1}function ze(N){var W=[],be="",le;if(!N||!N.childNodes)return"ltr";function H(ue,Ke){for(var Je=Ke.childNodes.length-1;Je>=0;Je--)ue.push(Ke.childNodes[Je])}function x(ue){if(!ue||!ue.length)return null;var Ke=ue.pop(),Je=Ke.textContent||Ke.innerText;if(Je){var Fe=Je.match(/^.*(\n|\r)/);return Fe?(ue.length=0,Fe[0]):Je}if(Ke.tagName==="ruby")return x(ue);if(Ke.childNodes)return H(ue,Ke),x(ue)}for(H(W,N);be=x(W);)for(var ye=0;ye<be.length;ye++)if(le=be.charCodeAt(ye),Wt(le))return"rtl";return"ltr"}function Ge(N){if(typeof N.line=="number"&&(N.snapToLines||N.line>=0&&N.line<=100))return N.line;if(!N.track||!N.track.textTrackList||!N.track.textTrackList.mediaElement)return-1;for(var W=N.track,be=W.textTrackList,le=0,H=0;H<be.length&&be[H]!==W;H++)be[H].mode==="showing"&&le++;return++le*-1}function ge(){}ge.prototype.applyStyles=function(N,W){W=W||this.div;for(var be in N)N.hasOwnProperty(be)&&(W.style[be]=N[be])},ge.prototype.formatStyle=function(N,W){return N===0?0:N+W};function Ye(N,W,be){ge.call(this),this.cue=W,this.cueDiv=Z(N,W.text);var le={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:W.vertical===""?"horizontal-tb":W.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(le,this.cueDiv),this.div=N.document.createElement("div"),le={direction:ze(this.cueDiv),writingMode:W.vertical===""?"horizontal-tb":W.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:W.align==="middle"?"center":W.align,font:be.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(le),this.div.appendChild(this.cueDiv);var H=0;switch(W.positionAlign){case"start":case"line-left":H=W.position;break;case"center":H=W.position-W.size/2;break;case"end":case"line-right":H=W.position-W.size;break}W.vertical===""?this.applyStyles({left:this.formatStyle(H,"%"),width:this.formatStyle(W.size,"%")}):this.applyStyles({top:this.formatStyle(H,"%"),height:this.formatStyle(W.size,"%")}),this.move=function(x){this.applyStyles({top:this.formatStyle(x.top,"px"),bottom:this.formatStyle(x.bottom,"px"),left:this.formatStyle(x.left,"px"),right:this.formatStyle(x.right,"px"),height:this.formatStyle(x.height,"px"),width:this.formatStyle(x.width,"px")})}}Ye.prototype=ke(ge.prototype),Ye.prototype.constructor=Ye;function It(N){var W,be,le,H;if(N.div){be=N.div.offsetHeight,le=N.div.offsetWidth,H=N.div.offsetTop;var x=(x=N.div.childNodes)&&(x=x[0])&&x.getClientRects&&x.getClientRects();N=N.div.getBoundingClientRect(),W=x?Math.max(x[0]&&x[0].height||0,N.height/x.length):0}this.left=N.left,this.right=N.right,this.top=N.top||H,this.height=N.height||be,this.bottom=N.bottom||H+(N.height||be),this.width=N.width||le,this.lineHeight=W!==void 0?W:N.lineHeight}It.prototype.move=function(N,W){switch(W=W!==void 0?W:this.lineHeight,N){case"+x":this.left+=W,this.right+=W;break;case"-x":this.left-=W,this.right-=W;break;case"+y":this.top+=W,this.bottom+=W;break;case"-y":this.top-=W,this.bottom-=W;break}},It.prototype.overlaps=function(N){return this.left<N.right&&this.right>N.left&&this.top<N.bottom&&this.bottom>N.top},It.prototype.overlapsAny=function(N){for(var W=0;W<N.length;W++)if(this.overlaps(N[W]))return!0;return!1},It.prototype.within=function(N){return this.top>=N.top&&this.bottom<=N.bottom&&this.left>=N.left&&this.right<=N.right},It.prototype.overlapsOppositeAxis=function(N,W){switch(W){case"+x":return this.left<N.left;case"-x":return this.right>N.right;case"+y":return this.top<N.top;case"-y":return this.bottom>N.bottom}},It.prototype.intersectPercentage=function(N){var W=Math.max(0,Math.min(this.right,N.right)-Math.max(this.left,N.left)),be=Math.max(0,Math.min(this.bottom,N.bottom)-Math.max(this.top,N.top)),le=W*be;return le/(this.height*this.width)},It.prototype.toCSSCompatValues=function(N){return{top:this.top-N.top,bottom:N.bottom-this.bottom,left:this.left-N.left,right:N.right-this.right,height:this.height,width:this.width}},It.getSimpleBoxPosition=function(N){var W=N.div?N.div.offsetHeight:N.tagName?N.offsetHeight:0,be=N.div?N.div.offsetWidth:N.tagName?N.offsetWidth:0,le=N.div?N.div.offsetTop:N.tagName?N.offsetTop:0;N=N.div?N.div.getBoundingClientRect():N.tagName?N.getBoundingClientRect():N;var H={left:N.left,right:N.right,top:N.top||le,height:N.height||W,bottom:N.bottom||le+(N.height||W),width:N.width||be};return H};function li(N,W,be,le){function H(mt,pt){for(var Ai,Ot=new It(mt),zt=1,Si=0;Si<pt.length;Si++){for(;mt.overlapsOppositeAxis(be,pt[Si])||mt.within(be)&&mt.overlapsAny(le);)mt.move(pt[Si]);if(mt.within(be))return mt;var ii=mt.intersectPercentage(be);zt>ii&&(Ai=new It(mt),zt=ii),mt=new It(Ot)}return Ai||Ot}var x=new It(W),ye=W.cue,ue=Ge(ye),Ke=[];if(ye.snapToLines){var Je;switch(ye.vertical){case"":Ke=["+y","-y"],Je="height";break;case"rl":Ke=["+x","-x"],Je="width";break;case"lr":Ke=["-x","+x"],Je="width";break}var Fe=x.lineHeight,me=Fe*Math.round(ue),ct=be[Je]+Fe,ve=Ke[0];Math.abs(me)>ct&&(me=me<0?-1:1,me*=Math.ceil(ct/Fe)*Fe),ue<0&&(me+=ye.vertical===""?be.height:be.width,Ke=Ke.reverse()),x.move(ve,me)}else{var xt=x.lineHeight/be.height*100;switch(ye.lineAlign){case"center":ue-=xt/2;break;case"end":ue-=xt;break}switch(ye.vertical){case"":W.applyStyles({top:W.formatStyle(ue,"%")});break;case"rl":W.applyStyles({left:W.formatStyle(ue,"%")});break;case"lr":W.applyStyles({right:W.formatStyle(ue,"%")});break}Ke=["+y","-x","+x","-y"],x=new It(W)}var Jt=H(x,Ke);W.move(Jt.toCSSCompatValues(be))}function Ze(){}Ze.StringDecoder=function(){return{decode:function(N){if(!N)return"";if(typeof N!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(N))}}},Ze.convertCueToDOMTree=function(N,W){return!N||!W?null:Z(N,W)};var Yt=.05,Hi="sans-serif",ti="1.5%";Ze.processCues=function(N,W,be){if(!N||!W||!be)return null;for(;be.firstChild;)be.removeChild(be.firstChild);var le=N.document.createElement("div");le.style.position="absolute",le.style.left="0",le.style.right="0",le.style.top="0",le.style.bottom="0",le.style.margin=ti,be.appendChild(le);function H(Fe){for(var me=0;me<Fe.length;me++)if(Fe[me].hasBeenReset||!Fe[me].displayState)return!0;return!1}if(!H(W)){for(var x=0;x<W.length;x++)le.appendChild(W[x].displayState);return}var ye=[],ue=It.getSimpleBoxPosition(le),Ke=Math.round(ue.height*Yt*100)/100,Je={font:Ke+"px "+Hi};(function(){for(var Fe,me,ct=0;ct<W.length;ct++)me=W[ct],Fe=new Ye(N,me,Je),le.appendChild(Fe.div),li(N,Fe,ue,ye),me.displayState=Fe.div,ye.push(It.getSimpleBoxPosition(Fe))})()},Ze.Parser=function(N,W,be){be||(be=W,W={}),W||(W={}),this.window=N,this.vttjs=W,this.state="INITIAL",this.buffer="",this.decoder=be||new TextDecoder("utf8"),this.regionList=[]},Ze.Parser.prototype={reportOrThrowError:function(N){if(N instanceof _e)this.onparsingerror&&this.onparsingerror(N);else throw N},parse:function(N){var W=this;N&&(W.buffer+=W.decoder.decode(N,{stream:!0}));function be(){for(var Fe=W.buffer,me=0;me<Fe.length&&Fe[me]!=="\r"&&Fe[me]!==`
`;)++me;var ct=Fe.substr(0,me);return Fe[me]==="\r"&&++me,Fe[me]===`
`&&++me,W.buffer=Fe.substr(me),ct}function le(Fe){var me=new _t;if(Ue(Fe,function(ve,xt){switch(ve){case"id":me.set(ve,xt);break;case"width":me.percent(ve,xt);break;case"lines":me.integer(ve,xt);break;case"regionanchor":case"viewportanchor":var Jt=xt.split(",");if(Jt.length!==2)break;var mt=new _t;if(mt.percent("x",Jt[0]),mt.percent("y",Jt[1]),!mt.has("x")||!mt.has("y"))break;me.set(ve+"X",mt.get("x")),me.set(ve+"Y",mt.get("y"));break;case"scroll":me.alt(ve,xt,["up"]);break}},/=/,/\s/),me.has("id")){var ct=new(W.vttjs.VTTRegion||W.window.VTTRegion);ct.width=me.get("width",100),ct.lines=me.get("lines",3),ct.regionAnchorX=me.get("regionanchorX",0),ct.regionAnchorY=me.get("regionanchorY",100),ct.viewportAnchorX=me.get("viewportanchorX",0),ct.viewportAnchorY=me.get("viewportanchorY",100),ct.scroll=me.get("scroll",""),W.onregion&&W.onregion(ct),W.regionList.push({id:me.get("id"),region:ct})}}function H(Fe){var me=new _t;Ue(Fe,function(ct,ve){switch(ct){case"MPEGT":me.integer(ct+"S",ve);break;case"LOCA":me.set(ct+"L",qe(ve));break}},/[^\d]:/,/,/),W.ontimestampmap&&W.ontimestampmap({MPEGTS:me.get("MPEGTS"),LOCAL:me.get("LOCAL")})}function x(Fe){Fe.match(/X-TIMESTAMP-MAP/)?Ue(Fe,function(me,ct){switch(me){case"X-TIMESTAMP-MAP":H(ct);break}},/=/):Ue(Fe,function(me,ct){switch(me){case"Region":le(ct);break}},/:/)}try{var ye;if(W.state==="INITIAL"){if(!/\r\n|\n/.test(W.buffer))return this;ye=be();var ue=ye.match(/^WEBVTT([ \t].*)?$/);if(!ue||!ue[0])throw new _e(_e.Errors.BadSignature);W.state="HEADER"}for(var Ke=!1;W.buffer;){if(!/\r\n|\n/.test(W.buffer))return this;switch(Ke?Ke=!1:ye=be(),W.state){case"HEADER":/:/.test(ye)?x(ye):ye||(W.state="ID");continue;case"NOTE":ye||(W.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(ye)){W.state="NOTE";break}if(!ye)continue;W.cue=new(W.vttjs.VTTCue||W.window.VTTCue)(0,0,"");try{W.cue.align="center"}catch(Fe){W.cue.align="middle"}if(W.state="CUE",ye.indexOf("-->")===-1){W.cue.id=ye;continue}case"CUE":try{ut(ye,W.cue,W.regionList)}catch(Fe){W.reportOrThrowError(Fe),W.cue=null,W.state="BADCUE";continue}W.state="CUETEXT";continue;case"CUETEXT":var Je=ye.indexOf("-->")!==-1;if(!ye||Je&&(Ke=!0)){W.oncue&&W.oncue(W.cue),W.cue=null,W.state="ID";continue}W.cue.text&&(W.cue.text+=`
`),W.cue.text+=ye.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":ye||(W.state="ID");continue}}}catch(Fe){W.reportOrThrowError(Fe),W.state==="CUETEXT"&&W.cue&&W.oncue&&W.oncue(W.cue),W.cue=null,W.state=W.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var N=this;try{if(N.buffer+=N.decoder.decode(),(N.cue||N.state==="HEADER")&&(N.buffer+=`

`,N.parse()),N.state==="INITIAL")throw new _e(_e.Errors.BadSignature)}catch(W){N.reportOrThrowError(W)}return N.onflush&&N.onflush(),this}},Te.exports=Ze},944:(Te,Qe,Le)=>{var Me=Le(576),ke=Te.exports={WebVTT:Le(919),VTTCue:Le(448),VTTRegion:Le(667)};Me.vttjs=ke,Me.WebVTT=ke.WebVTT;var _e=ke.VTTCue,qe=ke.VTTRegion,_t=Me.VTTCue,Ue=Me.VTTRegion;ke.shim=function(){Me.VTTCue=_e,Me.VTTRegion=qe},ke.restore=function(){Me.VTTCue=_t,Me.VTTRegion=Ue},Me.VTTCue||ke.shim()}},za={};function $i(Te){var Qe=za[Te];if(Qe!==void 0)return Qe.exports;var Le=za[Te]={exports:{}};return cl[Te](Le,Le.exports,$i),Le.exports}$i.n=Te=>{var Qe=Te&&Te.__esModule?()=>Te.default:()=>Te;return $i.d(Qe,{a:Qe}),Qe},$i.d=(Te,Qe)=>{for(var Le in Qe)$i.o(Qe,Le)&&!$i.o(Te,Le)&&Object.defineProperty(Te,Le,{enumerable:!0,get:Qe[Le]})},$i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(Te){if(typeof window=="object")return window}}(),$i.o=(Te,Qe)=>Object.prototype.hasOwnProperty.call(Te,Qe);var Tu=$i(220);return Tu})());
